"use strict";(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[7507],{840009:(e,t,n)=>{n.d(t,{ML:()=>o.ML,DN:()=>o.DN});var r=n(53656);var o=n(348922)},297504:(e,t,n)=>{n.r(t);n.d(t,{RCBLFModule:()=>q});var r=n(667489);var o=n(862926);var i=n(587040);var s=n(888148);var a=n(211951);var l=n(379269);var u=n(70200);var c=n(671760);var f=n(98690);var d=n(298784);var h=n.n(d);var p=n(470033);var g=n(827027);var _=n(61165);var v=n(547659);var b=undefined&&undefined.__assign||function(){b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return b.apply(this,arguments)};var y=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var C=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var E=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var L=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var x=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],s;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(s)throw s.error}}return i};var I=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(x(arguments[t]));return e};var m=_.k.tags("[HUDItemController]");var D=function(){function BLFItemController(e,t,n,r){var o=this;this._grantExtensionDataFetchController=e;this._delegateDataFetchController=t;this._delegationAssignmentDataFetchController=n;this._blfExtensionPresenceController=r;this._grantExtensionMap=new Map;this._handlePresenceChange=function(e){var t;m.info("handlePresenceChange",{extIds:I(e.keys())});(t=o._monitorPresenceListener)===null||t===void 0?void 0:t.call(o,I(e.keys()))};this._subscribeMonitorExtensionPresence=function(){m.info("subscribeMonitorExtensionPresence");o._blfExtensionPresenceController.subscribe(o._handlePresenceChange)};this._unsubscribeMonitorExtensionPresence=function(){m.info("unsubscribeMonitorExtensionPresence");o._blfExtensionPresenceController.unsubscribe(o._handlePresenceChange)};this._handleGrantExtensionListChange=function(e){var t;m.info("handleGrantExtensionListChange",{extIds:e.map((function(e){return e.extension.id}))});var n=new Set(I(o._grantExtensionMap.keys(),e.map((function(e){return e.extension.id}))));o._grantExtensionMap.clear();e.forEach((function(e){o._grantExtensionMap.set(e.extension.id,o._getGrantPermissionFromGrantExtension(e))}));(t=o._grantExtensionListener)===null||t===void 0?void 0:t.call(o,I(n.keys()))};this._handleRCConferenceChanged=function(e){m.info("handleRCConferenceChanged",e);var t=e.phoneNumbers.map((function(e){return e.phoneNumber}));if(h().isEqual(t,o._conferencePhoneNumbers)){return}o._conferencePhoneNumbers=t;o._rcConferenceListener&&o._rcConferenceListener()};this._handleRCPresenceChanged=function(e){m.info("handleRCPresenceChanged",e);if(o._pickUpCallsOnHold===e.pickUpCallsOnHold){return}o._pickUpCallsOnHold=!!e.pickUpCallsOnHold;o._rcPresenceListener&&o._rcPresenceListener()};this._handleDelegateListChanged=function(e){m.info("_handleDelegateListChanged",e);o._delegatedInfoListener&&o._delegatedInfoListener()};this._handleDelegatedAssignmentListChanged=function(e){m.info("_handleDelegatedAssignmentListChanged",e);o._delegatedInfoListener&&o._delegatedInfoListener()}}BLFItemController.prototype.observeBLFItem=function(e){m.info("observeHUDItem");var t=e.grantExtensionListener,n=e.monitorPresenceListener,o=e.callerIdControlListener,i=e.rcConferenceListener,s=e.rcPresenceListener,a=e.refreshItemListener,u=e.delegatedInfoListener;this._grantExtensionListener=t;this._monitorPresenceListener=n;this._callerIdControlListener=o;this._rcConferenceListener=i;this._rcPresenceListener=s;this._refreshItemListener=a;this._delegatedInfoListener=u;this._subscribeMonitorExtensionPresence();var c=(0,r.getCurrentAccount)().context.entitlement;c.on(p.H3.RCExtensionFeaturesId.CallerIdControl,this._callerIdControlListener);r.notificationCenter.on(l.FY.RC_INFO.RC_CONFERENCE,this._handleRCConferenceChanged);r.notificationCenter.on(l.FY.RC_INFO.RC_PRESENCE,this._handleRCPresenceChanged);this._delegateDataFetchController.subscribe(this._handleDelegateListChanged);this._delegationAssignmentDataFetchController.subscribe(this._handleDelegatedAssignmentListChanged);this._grantExtensionDataFetchController.subscribe(this._handleGrantExtensionListChange);this._refreshCache()};BLFItemController.prototype.unobserveBLFItem=function(){this._unsubscribeMonitorExtensionPresence();var e=(0,r.getCurrentAccount)().context.entitlement;this._callerIdControlListener&&e.off(p.H3.RCExtensionFeaturesId.CallerIdControl,this._callerIdControlListener);r.notificationCenter.off(l.FY.RC_INFO.RC_CONFERENCE,this._handleRCConferenceChanged);r.notificationCenter.off(l.FY.RC_INFO.RC_PRESENCE,this._handleRCPresenceChanged);this._delegateDataFetchController.unsubscribe(this._handleDelegateListChanged);this._delegationAssignmentDataFetchController.unsubscribe(this._handleDelegatedAssignmentListChanged);this._grantExtensionDataFetchController.unsubscribe(this._handleGrantExtensionListChange)};BLFItemController.prototype._refreshCache=function(){return E(this,void 0,void 0,(function(){var e,t;var n=this;return L(this,(function(r){switch(r.label){case 0:return[4,this._rcInfoModule.getRCConferenceLocally()];case 1:e=r.sent();this._conferencePhoneNumbers=e?e.phoneNumbers.map((function(e){return e.phoneNumber})):[];return[4,this._grantExtensionDataFetchController.getGrantExtensionList()];case 2:t=r.sent();if(t===null||t===void 0?void 0:t.length){t.forEach((function(e){n._grantExtensionMap.set(e.extension.id,n._getGrantPermissionFromGrantExtension(e))}))}this._refreshItemListener&&this._refreshItemListener();return[2]}}))}))};BLFItemController.prototype._getGrantExtensionById=function(e){return b({},this._grantExtensionMap.get(e))};BLFItemController.prototype._getMonitorPresenceById=function(e){return this._blfExtensionPresenceController.getExtensionPresenceById(e)};BLFItemController.prototype.getAssembledEntities=function(e){var t=this;var n=this._callerIdControlEnabled;return e.map((function(e){var r;var o=t._getMonitorPresenceById(e.id);e.grantInfo=t._getGrantExtensionById(e.id);e.callInfos=h().cloneDeep(o===null||o===void 0?void 0:o.activeCalls);e.telephonyStatus=o===null||o===void 0?void 0:o.telephonyStatus;t._setIsConferenceCall(e.callInfos);t._setIsOnYourBehalf(e.callInfos);t._setShowTelephonyDetail(e,n);t._setCallMonitoring(e,(r=e.grantInfo)===null||r===void 0?void 0:r.callMonitoring);t._setPickUpCallsOnHold(e);t._setDelegatedType(e);t._setIsDelegatorCall(e);t._setSourceExtension(e);return e}))};BLFItemController.prototype.assembleMonitorPresence=function(e){var t=this;e.forEach((function(e){var n=t._getMonitorPresenceById(e.id);e.callInfos=h().cloneDeep(n===null||n===void 0?void 0:n.activeCalls);t._setIsConferenceCall(e.callInfos);t._setIsOnYourBehalf(e.callInfos);e.telephonyStatus=n===null||n===void 0?void 0:n.telephonyStatus;var r=t._getGrantExtensionById(e.id);t._setCallMonitoring(e,r===null||r===void 0?void 0:r.callMonitoring);t._setIsDelegatorCall(e);t._setSourceExtension(e)}))};BLFItemController.prototype.assembleGrantPermission=function(e){var t=this;var n=this._callerIdControlEnabled;e.forEach((function(e){var r=t._getGrantExtensionById(e.id);e.grantInfo=r;t._setShowTelephonyDetail(e,n);t._setCallMonitoring(e,r===null||r===void 0?void 0:r.callMonitoring);t._setPickUpCallsOnHold(e)}))};BLFItemController.prototype.assemblePickupCallsOnHold=function(e){var t=this;e.forEach((function(e){t._setPickUpCallsOnHold(e)}))};BLFItemController.prototype.getNeedUpdateEntitiesByCallerIdControl=function(e){var t=this;var n=[];e.forEach((function(e){var r,o;var i=(r=e.grantInfo)===null||r===void 0?void 0:r.showTelephonyDetail;t._setShowTelephonyDetail(e,t._callerIdControlEnabled);if(((o=e.grantInfo)===null||o===void 0?void 0:o.showTelephonyDetail)!==i){n.push(e)}}));return n};BLFItemController.prototype.getNeedUpdateEntitiesByRCConference=function(e){var t=this;var n=[];e.forEach((function(e){var r;var o=false;(r=e.callInfos)===null||r===void 0?void 0:r.forEach((function(e){var n=t._isConferenceCall(e);if(n!==e.isRCConferenceCall){e.isRCConferenceCall=n;o=true}}));o&&n.push(e)}));return n};BLFItemController.prototype.getAndUpdateDelegatedTypeNeeded=function(e){var t=this;var n=[];e.forEach((function(e){var r=t._getDelegatedType(e);if(e.delegatedType!==r){e.delegatedType=r;n.push(e)}}));return n};Object.defineProperty(BLFItemController.prototype,"_callerIdControlEnabled",{get:function(){return(0,r.getCurrentAccount)().context.entitlement.get(p.H3.RCExtensionFeaturesId.CallerIdControl)},enumerable:true,configurable:true});BLFItemController.prototype._getGrantPermissionFromGrantExtension=function(e){return{callDelegation:e.callDelegation,callMonitoring:e.callMonitoring,callOnBehalfOf:e.callOnBehalfOf,callPickup:e.callPickup,callQueueMembersSetup:e.callQueueMembersSetup,callQueueSetup:e.callQueueSetup}};BLFItemController.prototype._canShowTelephonyDetail=function(e,t,n){return!!(!e||t||n)};BLFItemController.prototype._setShowTelephonyDetail=function(e,t){var n,r;var o=this._canShowTelephonyDetail(t,(n=e.grantInfo)===null||n===void 0?void 0:n.callPickup,(r=e.grantInfo)===null||r===void 0?void 0:r.callMonitoring);if(e.grantInfo){e.grantInfo.showTelephonyDetail=o}else{e.grantInfo={showTelephonyDetail:o}}};BLFItemController.prototype._canMonitorCall=function(e,t){if(!e||!(t===null||t===void 0?void 0:t.length)){return false}var n=0;t.forEach((function(e){if(e.telephonyStatus===g.TELEPHONY_STATUS.CallConnected){n++}}));if(n!==1){return false}var r=t[0];return!this._isConferenceCall(r)};BLFItemController.prototype._setCallMonitoring=function(e,t){var n=this._canMonitorCall(t,e.callInfos);if(e.grantInfo){e.grantInfo.callMonitoring=n}else{e.grantInfo={callMonitoring:n}}};BLFItemController.prototype._isConferenceCall=function(e){var t;return g.CallUtils.isMultiPartyConfCall(e)||((t=this._conferencePhoneNumbers)===null||t===void 0?void 0:t.some((function(t){return t===e.to||t===e.from})))};BLFItemController.prototype._setIsConferenceCall=function(e){var t=this;if(e===null||e===void 0?void 0:e.length){e.map((function(e){e.isRCConferenceCall=t._isConferenceCall(e)}))}};BLFItemController.prototype._isOnYourBehalf=function(e,t){return!!(t.onBehalfOf&&t.onBehalfOf===e)};BLFItemController.prototype._getUserExtId=function(){var e;if(!this._userExtId){this._userExtId=(e=(0,i.gT)().userConfig.getExtensionId())===null||e===void 0?void 0:e.toString()}return this._userExtId};BLFItemController.prototype._setIsOnYourBehalf=function(e){var t=this;if(e===null||e===void 0?void 0:e.length){var n=this._getUserExtId();e.forEach((function(e){e.isOnYourBehalf=t._isOnYourBehalf(n,e)}))}};BLFItemController.prototype._setIsDelegatorCall=function(e){var t=this._isDelegator(e);var n=e.callInfos;if(n===null||n===void 0?void 0:n.length){n.forEach((function(e){e.isDelegatorCall=t||e.isOnYourBehalf}))}};BLFItemController.prototype._setSourceExtension=function(e){var t=e.callInfos;if(t===null||t===void 0?void 0:t.length){t.forEach((function(t){if(!t.isOnYourBehalf){t.sourceExtension=e.id}}))}};BLFItemController.prototype._getPickUpCallsOnHold=function(){var e;if(!this._pickUpCallsOnHold){this._pickUpCallsOnHold=!!((e=this._rcInfoModule.getLastRCPresence())===null||e===void 0?void 0:e.pickUpCallsOnHold)}return this._pickUpCallsOnHold};BLFItemController.prototype._setPickUpCallsOnHold=function(e){if(e.grantInfo){e.grantInfo.pickUpCallsOnHold=!!(this._getPickUpCallsOnHold()&&e.grantInfo.callPickup)}else{e.grantInfo={pickUpCallsOnHold:false}}};BLFItemController.prototype._setDelegatedType=function(e){e.delegatedType=this._getDelegatedType(e)};BLFItemController.prototype._getDelegatedType=function(e){var t=this._isDelegate(e);if(t){return v.I.DELEGATED}var n=this._isDelegator(e);return n?v.I.DELEGATOR:v.I.NONE};BLFItemController.prototype._isDelegate=function(e){return this._delegateIds.some((function(t){return t===e.id}))};BLFItemController.prototype._isDelegator=function(e){return this._delegatorIds.some((function(t){return t===e.id}))};Object.defineProperty(BLFItemController.prototype,"_delegatorIds",{get:function(){var e=this._delegationAssignmentDataFetchController.getDelegationAssignmentListFromCache();return(e===null||e===void 0?void 0:e.map((function(e){return e.extension.id.toString()})))||[]},enumerable:true,configurable:true});Object.defineProperty(BLFItemController.prototype,"_delegateIds",{get:function(){var e=this._delegateDataFetchController.getDelegateListFromCache();return(e===null||e===void 0?void 0:e.map((function(e){return e.extension.id.toString()})))||[]},enumerable:true,configurable:true});Object.defineProperty(BLFItemController.prototype,"_rcInfoModule",{get:function(){return(0,r.getModule)(l.oF)},enumerable:true,configurable:true});y([o.SingleRequest,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",Promise)],BLFItemController.prototype,"_refreshCache",null);return BLFItemController}();var R=n(228164);var F=_.k.tags("[DelegatedPresenceController]");var S="{delegatorId}";var B="/restapi/v1.0/account/~/extension/"+S+"/delegates/presence?detailedTelephonyState=true&sipData=true";var w=[R.RCSubscriptionKeys.TelephonyDetail,R.RCSubscriptionKeys.LineTelephonyDetailPresence];var P=function(){function DelegatedPresenceController(e,t,n){var r=this;this._delegateDataFetchController=e;this._delegationAssignmentDataFetchController=t;this._blfExtensionPresenceController=n;this._handleDelegateListChange=function(e){F.info("handleDelegateListChange",e.map((function(e){return e.extension.id})));r._onDelegatedInfoChange()};this._handleDelegationAssignmentListChange=function(e){F.info("handleDelegationAssignmentListChange",e.map((function(e){return e.extension.id})));r._onDelegatedInfoChange()}}DelegatedPresenceController.prototype.start=function(){this._delegateDataFetchController.subscribe(this._handleDelegateListChange);this._delegationAssignmentDataFetchController.subscribe(this._handleDelegationAssignmentListChange);this._blfExtensionPresenceController.addDataSource(this)};DelegatedPresenceController.prototype.stop=function(){this._delegateDataFetchController.unsubscribe(this._handleDelegateListChange);this._delegationAssignmentDataFetchController.unsubscribe(this._handleDelegationAssignmentListChange);this._blfExtensionPresenceController.removeDataSource(this)};DelegatedPresenceController.prototype.getEvents=function(){var e=new Set(w);this._delegateIds.length&&e.add(R.RCSubscriptionKeys.DelegateTelephonyDetailPresence);this._delegatorIds.forEach((function(t){e.add(B.replace(S,t))}));return Array.from(e)};DelegatedPresenceController.prototype.getSourceIds=function(){return Array.from(new Set(this._delegateIds.concat(this._delegatorIds,this._delegateOfDelegatorIds)))};DelegatedPresenceController.prototype._onDelegatedInfoChange=function(){this._blfExtensionPresenceController.onEventsUpdate();this._blfExtensionPresenceController.onSourceIdsUpdate()};Object.defineProperty(DelegatedPresenceController.prototype,"_delegateIds",{get:function(){var e=this._delegateDataFetchController.getDelegateListFromCache();return(e===null||e===void 0?void 0:e.map((function(e){return e.extension.id.toString()})))||[]},enumerable:true,configurable:true});Object.defineProperty(DelegatedPresenceController.prototype,"_delegatorIds",{get:function(){var e=this._delegationAssignmentDataFetchController.getDelegationAssignmentListFromCache();return(e===null||e===void 0?void 0:e.map((function(e){return e.extension.id.toString()})))||[]},enumerable:true,configurable:true});Object.defineProperty(DelegatedPresenceController.prototype,"_delegateOfDelegatorIds",{get:function(){var e=this._delegationAssignmentDataFetchController.getDelegationAssignmentListFromCache();if(!e){return[]}var t=[];e.forEach((function(e){e.delegateIds.forEach((function(e){t.push(e)}))}));return t},enumerable:true,configurable:true});return DelegatedPresenceController}();var M=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var N=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var T=_.k.tags("[MonitorPresenceController]");var O=function(){function MonitorPresenceController(e,t){var n=this;this._blfExtensionPresenceController=e;this._monitorExtensionDataFetchController=t;this._sourceIds=[];this._events=[R.RCSubscriptionKeys.TelephonyDetail,R.RCSubscriptionKeys.LineTelephonyDetailPresence];this._handleMonitorListChange=function(e){n._sourceIds=n._getIdListFromExtensionList(e);T.info("handleMonitorListChange",n._sourceIds);n._blfExtensionPresenceController.onSourceIdsUpdate()}}MonitorPresenceController.prototype.start=function(){return M(this,void 0,void 0,(function(){var e,t;return N(this,(function(n){switch(n.label){case 0:this._monitorExtensionDataFetchController.subscribe(this._handleMonitorListChange);n.label=1;case 1:n.trys.push([1,3,,4]);return[4,this._monitorExtensionDataFetchController.getMonitorExtensionList(true)];case 2:e=n.sent();this._sourceIds=this._getIdListFromExtensionList(e||[]);return[3,4];case 3:t=n.sent();T.info("getMonitorExtensionList failed",t);return[3,4];case 4:this._blfExtensionPresenceController.addDataSource(this);return[2]}}))}))};MonitorPresenceController.prototype.stop=function(){this._monitorExtensionDataFetchController.unsubscribe(this._handleMonitorListChange);this._blfExtensionPresenceController.removeDataSource(this);this._sourceIds=[];this._events=[]};MonitorPresenceController.prototype.getEvents=function(){return this._events};MonitorPresenceController.prototype.getSourceIds=function(){return this._sourceIds};MonitorPresenceController.prototype._getIdListFromExtensionList=function(e){var t;var n=(t=(0,i.gT)())===null||t===void 0?void 0:t.userConfig.getExtensionId().toString();var r=new Set(e.map((function(e){return e.extension.id})).filter((function(e){return e!==n})));return Array.from(r)};return MonitorPresenceController}();var A=n(162013);var U=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var G=function(e){U(RCBLFService,e);function RCBLFService(){return e.call(this)||this}RCBLFService.prototype.onStarted=function(){e.prototype.onStarted.call(this);this.rcHUDBootstrapController.start()};RCBLFService.prototype.onStopped=function(){e.prototype.onStopped.call(this);this.rcHUDBootstrapController.stop()};Object.defineProperty(RCBLFService.prototype,"rcHUDBootstrapController",{get:function(){if(!this._rcHUDBootstrapController){this._rcHUDBootstrapController=new u.rX([this.delegatedPresenceController,this.monitorPresenceController,this.monitorRingingSettingController,this.ringingListController,this.blfExtensionCallController])}return this._rcHUDBootstrapController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"blfExtensionCallController",{get:function(){if(!this._blfExtensionCallController){this._blfExtensionCallController=new u.gk(this.ringingListController,this.blfDataController,this.delegationAssignmentDataFetchController)}return this._blfExtensionCallController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"monitorExtensionDataFetchController",{get:function(){if(!this._monitorExtensionDataFetchController){this._monitorExtensionDataFetchController=new u.yA(this.dbConfig)}return this._monitorExtensionDataFetchController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"monitorRingingSettingController",{get:function(){if(!this._monitorRingingSettingController){this._monitorRingingSettingController=new u.v_(this.dbConfig)}return this._monitorRingingSettingController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"blfExtensionPresenceController",{get:function(){if(!this._blfExtensionPresenceController){this._blfExtensionPresenceController=new u.tB}return this._blfExtensionPresenceController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"blfDataController",{get:function(){if(!this._blfDataController){this._blfDataController=new f.n(this.blfItemController,this.monitorExtensionDataFetchController)}return this._blfDataController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"blfItemController",{get:function(){if(!this._blfItemController){this._blfItemController=new D(this.grantExtensionDataFetchController,this.delegateDataFetchController,this.delegationAssignmentDataFetchController,this.blfExtensionPresenceController)}return this._blfItemController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"delegateDataFetchController",{get:function(){if(!this._delegateDataFetchController){this._delegateDataFetchController=new u.Yh(this.dbConfig,this.grantExtensionDataFetchController)}return this._delegateDataFetchController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"delegatedPresenceController",{get:function(){if(!this._delegatedPresenceController){this._delegatedPresenceController=new P(this.delegateDataFetchController,this.delegationAssignmentDataFetchController,this.blfExtensionPresenceController)}return this._delegatedPresenceController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"delegationAssignmentDataFetchController",{get:function(){if(!this._delegationAssignmentDataFetchController){this._delegationAssignmentDataFetchController=new u.Jj(this.dbConfig,this.grantExtensionDataFetchController)}return this._delegationAssignmentDataFetchController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"grantExtensionDataFetchController",{get:function(){if(!this._grantExtensionDataFetchController){this._grantExtensionDataFetchController=new u.hn(this.dbConfig)}return this._grantExtensionDataFetchController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"monitorPresenceController",{get:function(){if(!this._monitorPresenceController){this._monitorPresenceController=new O(this.blfExtensionPresenceController,this.monitorExtensionDataFetchController)}return this._monitorPresenceController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"ringingListController",{get:function(){if(!this._ringingListController){this._ringingListController=new u.hN(this.dbConfig,this.blfDataController)}return this._ringingListController},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"blfSettingManager",{get:function(){if(!this._settingManager){this._settingManager=new A.Du(this)}return this._settingManager},enumerable:true,configurable:true});Object.defineProperty(RCBLFService.prototype,"dbConfig",{get:function(){if(!this._dbConfig){var e=(0,r.getModule)(l.oF);this._dbConfig=new c.nT(e.getDBConfigService())}return this._dbConfig},enumerable:true,configurable:true});return RCBLFService}(r.MicroService);var k=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var j=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var H=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var Y=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var V=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var X=_.k.tags("[RCBLFModule]");var K=(0,o.createLogDecorator)(X.tags("[EXECUTE_LOG]"));var q=function(e){k(RCBLFModule,e);function RCBLFModule(t){var n=e.call(this,t)||this;n.getParticipantAccessByExtensionId=function(e){return n.rcBLFService.delegationAssignmentDataFetchController.getParticipantAccessByExtensionId(e)};X.info("create RCBLFModule");return n}RCBLFModule.prototype.onLoad=function(){var e=this;this._setupNetworkClient();this.rcBLFService.start();this.settingManager.load();this.getHealthController().registerItemMap({BLFMonitorExtensionId:function(){return Y(e,void 0,void 0,(function(){var e;return V(this,(function(t){switch(t.label){case 0:return[4,this.rcBLFService.monitorExtensionDataFetchController.getMonitorExtensionList()];case 1:e=t.sent();return[2,e===null||e===void 0?void 0:e.map((function(e){return e.extension.id}))]}}))}))},RingingExtensionListInCache:function(){return e._service.ringingListController.getRingingExtensionList()}})};RCBLFModule.prototype.onUnload=function(){this.settingManager.unload();this.rcBLFService.stop()};Object.defineProperty(RCBLFModule.prototype,"rcBLFService",{get:function(){if(!this._service){this._service=new G}return this._service},enumerable:true,configurable:true});RCBLFModule.prototype.moduleName=function(){return a.pL};Object.defineProperty(RCBLFModule.prototype,"settingManager",{get:function(){return this.rcBLFService.blfSettingManager},enumerable:true,configurable:true});RCBLFModule.prototype._setupNetworkClient=function(){var e=(0,i.gT)();if(e){s.V.networkClient=e.buildNetworkClient()}};RCBLFModule.prototype.getLocalMonitorExtensions=function(){return this.rcBLFService.blfDataController.getLocalMonitorExtensions()};RCBLFModule.prototype.getExtensionPresenceById=function(e){return this.rcBLFService.blfExtensionPresenceController.getExtensionPresenceById(e)};RCBLFModule.prototype.getMonitorExtensionList=function(e){return this.rcBLFService.monitorExtensionDataFetchController.getMonitorExtensionList(e)};RCBLFModule.prototype.subscribeExtensionPresence=function(e){return this.rcBLFService.blfExtensionPresenceController.subscribe(e)};RCBLFModule.prototype.unsubscribeExtensionPresence=function(e){return this.rcBLFService.blfExtensionPresenceController.unsubscribe(e)};RCBLFModule.prototype.getMaxMonitoredExtensionLimit=function(){return this.rcBLFService.monitorExtensionDataFetchController.getMaxMonitoredExtensionLimit()};RCBLFModule.prototype.subscribeMonitorList=function(e){this.rcBLFService.monitorExtensionDataFetchController.subscribe(e)};RCBLFModule.prototype.unsubscribeMonitorList=function(e){this.rcBLFService.monitorExtensionDataFetchController.unsubscribe(e)};RCBLFModule.prototype.getDelegationAssignmentList=function(e){return this.rcBLFService.delegationAssignmentDataFetchController.getDelegationAssignmentList(e)};RCBLFModule.prototype.getDelegationAssignmentListFromCache=function(){return this.rcBLFService.delegationAssignmentDataFetchController.getDelegationAssignmentListFromCache()};RCBLFModule.prototype.subscribeDelegationAssignmentList=function(e){this.rcBLFService.delegationAssignmentDataFetchController.subscribe(e)};RCBLFModule.prototype.unsubscribeDelegationAssignmentList=function(e){this.rcBLFService.delegationAssignmentDataFetchController.unsubscribe(e)};RCBLFModule.prototype.getDelegateList=function(e){return this.rcBLFService.delegateDataFetchController.getDelegateList(e)};RCBLFModule.prototype.getDelegateListFromCache=function(){return this.rcBLFService.delegateDataFetchController.getDelegateListFromCache()};RCBLFModule.prototype.subscribeDelegateList=function(e){this.rcBLFService.delegateDataFetchController.subscribe(e)};RCBLFModule.prototype.unsubscribeDelegateList=function(e){this.rcBLFService.delegateDataFetchController.unsubscribe(e)};RCBLFModule.prototype.getGrantExtensionList=function(e){return this.rcBLFService.grantExtensionDataFetchController.getGrantExtensionList(e)};RCBLFModule.prototype.subscribeGrantExtensionList=function(e){this.rcBLFService.grantExtensionDataFetchController.subscribe(e)};RCBLFModule.prototype.unsubscribeGrantExtensionList=function(e){this.rcBLFService.grantExtensionDataFetchController.unsubscribe(e)};RCBLFModule.prototype.getCanAddExtensionCount=function(){return this.rcBLFService.blfDataController.getCanAddExtensionCount()};RCBLFModule.prototype.getMonitorExtensionNumberSet=function(){return this.rcBLFService.blfDataController.getMonitorExtensionNumberSet()};RCBLFModule.prototype.requestTelephonyPresences=function(e){return this.rcBLFService.blfExtensionPresenceController.requestTelephonyDetailPresence(e)};RCBLFModule.prototype.updateRingingExtension=function(e,t){return this.rcBLFService.ringingListController.updateRingingExtension(e,t)};RCBLFModule.prototype.getRingingExtensionListIds=function(e){return this.rcBLFService.ringingListController.getRingingExtensionListIds(e)};RCBLFModule.prototype.getRingingExtensionById=function(e){return this.rcBLFService.ringingListController.getRingingExtensionById(e)};RCBLFModule.prototype.getRingingExtensionListByIds=function(e){return this.rcBLFService.ringingListController.getRingingExtensionListByIds(e)};RCBLFModule.prototype.getUsingLevelSettingState=function(e){return this.rcBLFService.ringingListController.getUsingLevelSettingState(e)};RCBLFModule.prototype.getRingingExtensionList=function(){return this.rcBLFService.ringingListController.getRingingExtensionList()};var t,n,r,o,l,u,c,f,d;j([K({call:true,error:true}),H("design:type",Function),H("design:paramtypes",[Boolean]),H("design:returntype",typeof(t=typeof Promise!=="undefined"&&Promise)==="function"?t:Object)],RCBLFModule.prototype,"getMonitorExtensionList",null);j([K({call:true,error:true}),H("design:type",Function),H("design:paramtypes",[Boolean]),H("design:returntype",typeof(n=typeof Promise!=="undefined"&&Promise)==="function"?n:Object)],RCBLFModule.prototype,"getDelegationAssignmentList",null);j([K({call:true,error:true}),H("design:type",Function),H("design:paramtypes",[Boolean]),H("design:returntype",typeof(r=typeof Promise!=="undefined"&&Promise)==="function"?r:Object)],RCBLFModule.prototype,"getDelegateList",null);j([K({call:true,error:true}),H("design:type",Function),H("design:paramtypes",[Boolean]),H("design:returntype",typeof(o=typeof Promise!=="undefined"&&Promise)==="function"?o:Object)],RCBLFModule.prototype,"getGrantExtensionList",null);j([K({call:true}),H("design:type",Function),H("design:paramtypes",[typeof(l=typeof v.GrantExtensionListener!=="undefined"&&v.GrantExtensionListener)==="function"?l:Object]),H("design:returntype",void 0)],RCBLFModule.prototype,"subscribeGrantExtensionList",null);j([K({call:true}),H("design:type",Function),H("design:paramtypes",[typeof(u=typeof v.GrantExtensionListener!=="undefined"&&v.GrantExtensionListener)==="function"?u:Object]),H("design:returntype",void 0)],RCBLFModule.prototype,"unsubscribeGrantExtensionList",null);j([K({call:true}),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",void 0)],RCBLFModule.prototype,"requestTelephonyPresences",null);j([K({call:true,error:true}),H("design:type",Function),H("design:paramtypes",[String,Boolean]),H("design:returntype",typeof(c=typeof Promise!=="undefined"&&Promise)==="function"?c:Object)],RCBLFModule.prototype,"updateRingingExtension",null);j([K({call:true,error:true}),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",typeof(f=typeof Promise!=="undefined"&&Promise)==="function"?f:Object)],RCBLFModule.prototype,"getRingingExtensionListIds",null);j([K({call:true}),H("design:type",Function),H("design:paramtypes",[Array]),H("design:returntype",typeof(d=typeof Promise!=="undefined"&&Promise)==="function"?d:Object)],RCBLFModule.prototype,"getUsingLevelSettingState",null);return RCBLFModule}(r.AbstractModule)},888148:(e,t,n)=>{n.d(t,{V:()=>b});var r=n(298784);var o=n.n(r);var i=n(862926);var s=n(667489);var a=n(652256);var l=n(827027);var u="presence";var c=30;var f="/"+l.API_VERSION+"/account/~/extension/";var d="/"+l.API_VERSION+"/account/~/extension/~/";var h={MONITOR_EXTENSION_LIST:""+d+u+"/line",GRANT_EXTENSION_LIST:d+"grant",DELEGATION_ASSIGNMENT_LIST:d+"delegation-assignments",DELEGATE_LIST:d+"delegates"};var p=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var g=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var _=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],s;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(s)throw s.error}}return i};var v=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e};var b=function(){function RCBLFAPI(){}RCBLFAPI.requestTelephonyDetailPresence=function(e){return p(this,void 0,void 0,(function(){var t,n,r;var l=this;return g(this,(function(d){switch(d.label){case 0:t=s.ArrayUtils.splitArrayToChunks(e,c);n=[];r=t.map((function(e){return function(){return p(l,void 0,void 0,(function(){var t,r,o,s;return g(this,(function(l){switch(l.label){case 0:t=e.join(",");r={path:i.RequestPath.buildRequestPath(""+f+i.FORMAT_MARK+"/"+u+"?detailedTelephonyState="+i.FORMAT_MARK+"&sipData="+i.FORMAT_MARK,t,""+true,""+true),via:i.NETWORK_VIA.HTTP};return[4,RCBLFAPI.networkClient.get(r)];case 1:o=l.sent();if(e.length===1&&typeof o!=="string"){n.push(o)}else{s=(0,a.t)(o).body;n.push.apply(n,v(s))}return[2]}}))}))}}));return[4,(0,i.runInBand)(r)];case 1:d.sent();return[2,o().uniqBy(n,(function(e){var t;return(t=e.extension)===null||t===void 0?void 0:t.id}))]}}))}))};RCBLFAPI.getMonitorExtensionList=function(e){return RCBLFAPI.networkClient.get({authFree:false,via:i.NETWORK_VIA.HTTP,HAPriority:i.HA_PRIORITY.HIGH,path:i.RequestPath.buildRequestPath(h.MONITOR_EXTENSION_LIST),params:e})};RCBLFAPI.updateMonitorExtensionList=function(e){var t={path:i.RequestPath.buildRequestPath(h.MONITOR_EXTENSION_LIST),via:i.NETWORK_VIA.HTTP,method:i.NETWORK_METHOD.PUT,data:e};return RCBLFAPI.networkClient.http(t)};RCBLFAPI.getGrantExtensionList=function(e){return RCBLFAPI.networkClient.get({authFree:false,via:i.NETWORK_VIA.HTTP,HAPriority:i.HA_PRIORITY.HIGH,path:i.RequestPath.buildRequestPath(h.GRANT_EXTENSION_LIST),params:e})};RCBLFAPI.getDelegationAssignmentList=function(){return RCBLFAPI.networkClient.get({via:i.NETWORK_VIA.HTTP,path:i.RequestPath.buildRequestPath(h.DELEGATION_ASSIGNMENT_LIST)})};RCBLFAPI.getDelegateList=function(){return RCBLFAPI.networkClient.get({via:i.NETWORK_VIA.HTTP,path:i.RequestPath.buildRequestPath(h.DELEGATE_LIST)})};return RCBLFAPI}()},671760:(e,t,n)=>{n.d(t,{nT:()=>l,Bo:()=>v,vD:()=>d});var r=n(667489);var o=n(211951);var i=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var s=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var a=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var l=function(e){i(RCBLFUserConfig,e);function RCBLFUserConfig(t){return e.call(this,o.pL,t)||this}RCBLFUserConfig.prototype.get=function(e,t){if(t===void 0){t=false}var n;return s(this,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:return[4,this._configService.get(o.pL,e,t)];case 1:if(!((n=i.sent())!==null&&n!==void 0))return[3,2];r=n;return[3,4];case 2:return[4,this._configService.get("rc_blf",e,t)];case 3:r=i.sent();i.label=4;case 4:return[2,r]}}))}))};RCBLFUserConfig.prototype.setEnableMonitorRinging=function(e){return this.put(o.Bo.ENABLE_MONITOR_RINGING,e)};RCBLFUserConfig.prototype.getEnableMonitorRinging=function(){return this.get(o.Bo.ENABLE_MONITOR_RINGING)};RCBLFUserConfig.prototype.getRingingExtensionList=function(){return this.get(o.Bo.RINGING_EXTENSION_LIST)};RCBLFUserConfig.prototype.setRingingExtensionList=function(e){return this.put(o.Bo.RINGING_EXTENSION_LIST,e)};RCBLFUserConfig.prototype.getMonitorExtensionList=function(){return this.get(o.Bo.MONITOR_EXTENSION_LIST)};RCBLFUserConfig.prototype.setMonitorExtensionList=function(e){return this.put(o.Bo.MONITOR_EXTENSION_LIST,e)};RCBLFUserConfig.prototype.getGrantExtensionList=function(){return this.get(o.Bo.GRANT_EXTENSION_LIST)};RCBLFUserConfig.prototype.setGrantExtensionList=function(e){return this.put(o.Bo.GRANT_EXTENSION_LIST,e)};RCBLFUserConfig.prototype.getDelegateList=function(){return this.get(o.Bo.DELEGATE_LIST)};RCBLFUserConfig.prototype.setDelegateList=function(e){return this.put(o.Bo.DELEGATE_LIST,e)};RCBLFUserConfig.prototype.getDelegationAssignmentList=function(){return this.get(o.Bo.DELEGATION_ASSIGNMENT_LIST)};RCBLFUserConfig.prototype.setDelegationAssignmentList=function(e){return this.put(o.Bo.DELEGATION_ASSIGNMENT_LIST,e)};return RCBLFUserConfig}(r.DBConfig);var u=n(469882);var c=n(963786);var f=n(587040);var d={ENABLE_HUD:"enable_HUD"};var h="rcHUD";var p=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var g=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var _=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var v=function(e){p(RCHUDGlobalConfig,e);function RCHUDGlobalConfig(){return e!==null&&e.apply(this,arguments)||this}RCHUDGlobalConfig.generateStoreKey=function(e){var t=c._Z.getCurrent().getSubAccount(f.oF);return t.userConfig.getExtensionId()+"."+e};RCHUDGlobalConfig.setEnableHUD=function(e){this.put(this.generateStoreKey(d.ENABLE_HUD),e)};RCHUDGlobalConfig.getEnableHUD=function(){var e;return g(this,void 0,Promise,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this.get(this.generateStoreKey(d.ENABLE_HUD))];case 1:return[2,(e=t.sent())!==null&&e!==void 0?e:true]}}))}))};RCHUDGlobalConfig.moduleName=h;return RCHUDGlobalConfig}(u.GlobalConfig)},211951:(e,t,n)=>{n.d(t,{pL:()=>l,Bo:()=>u,pb:()=>c,n9:()=>f,FY:()=>d,E8:()=>h,n3:()=>p,GM:()=>v,PT:()=>g,E:()=>_});var r=n(470033);var o=n(827027);var i=n(295454);var s=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],s;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(s)throw s.error}}return i};var a=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e};var l=i.Lb.RC_BLF;var u={ENABLE_MONITOR_RINGING:"Enable_Monitor_Ringing",MONITOR_EXTENSION_LIST:"MONITOR_EXTENSION_LIST",GRANT_EXTENSION_LIST:"GRANT_EXTENSION_LIST",DELEGATION_ASSIGNMENT_LIST:"delegation_assignment_list",DELEGATE_LIST:"delegate_list",RINGING_EXTENSION_LIST:"Ringing_Extension_List"};var c={MONITOR_EXTENSION_LIST:"MONITOR_EXTENSION_LIST",GRANT_EXTENSION_LIST:"GRANT_EXTENSION_LIST",DELEGATION_ASSIGNMENT_LIST:"DELEGATION_ASSIGNMENT_LIST",DELEGATE_LIST:"DELEGATE_LIST"};var f={EXCEED_MAX_MONITOR_CNT:"EXCEED_MAX_MONITOR_CNT"};var d={ENTITY:{RINGING_EXTENSION:"ENTITY.RINGING_EXTENSION"},RC_BLF_SERVICE:{GRANT_EXTENSION_LIST_CHANGE:"RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE",SELECTIVE_RINGING_LIST:"RC_BLF_SERVICE.SELECTIVE_RINGING_LIST"}};var h=[r.H3.RCExtensionFeaturesId.HUD,r.H3.RCExtensionFeaturesId.WebPhone,r.H3.RCExtensionFeaturesId.VoipCalling];var p=[o.RC_EXTENSION_TYPES.USER,o.RC_EXTENSION_TYPES.DIGITAL_USER,o.RC_EXTENSION_TYPES.FAX_USER,o.RC_EXTENSION_TYPES.VIRTUAL_USER];var g={HUD_INCOMING_CALL:"Jup_Web/DT_hud_incomingCall"};var _;(function(e){e["GROUP_CALL_PICKUP"]="gcp";e["QUEUE_CALL_PICKUP"]="callQueuePickUpMember"})(_||(_={}));var v=a(p,[o.RC_EXTENSION_TYPES.GROUP_CALL_PICKUP,o.RC_EXTENSION_TYPES.DEPARTMENT])},98690:(e,t,n)=>{n.d(t,{n:()=>E});var r=n(298784);var o=n.n(r);var i=n(667489);var s=n(587040);var a=n(831270);var l=n(61165);var u=n(862926);var c=n(211951);var f=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var d=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var h=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],s;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(s)throw s.error}}return i};var p=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e};var g;(function(e){e[e["ADD"]=0]="ADD";e[e["REMOVE"]=1]="REMOVE";e[e["REORDER"]=2]="REORDER"})(g||(g={}));var _=l.k.tags("HUDExtensionListUpdateProcessor");var v=function(){function BLFListUpdateProcessor(e,t){this._monitorExtensionDataFetchController=t;this.historyTasks=[];this.callbacks=[];this.historyTasks.push(e.newTask);this.callbacks.push(e.callback)}BLFListUpdateProcessor.prototype.name=function(){return"MonitorExtensionUpdateT_"+Date.now()};BLFListUpdateProcessor.prototype.addOtherProcessorHistory=function(e,t){var n,r;_.log("add other processor history in tasks");(n=this.historyTasks).unshift.apply(n,p(e));(r=this.callbacks).unshift.apply(r,p(t))};BLFListUpdateProcessor.prototype.process=function(){return f(this,void 0,Promise,(function(){var e,t,n,r,o;var i=this;return d(this,(function(s){switch(s.label){case 0:s.trys.push([0,4,,5]);return[4,this._monitorExtensionDataFetchController.getMonitorExtensionList()];case 1:e=s.sent();t=[];n=[];e===null||e===void 0?void 0:e.forEach((function(e){if(e.notEditableOnHud){t.push({id:e.id,extension:{id:e.extension.id}})}else{n.push({id:"",extension:{id:e.extension.id}})}}));return[4,(0,u.runInBand)(this.historyTasks.map((function(e){return function(){return f(i,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,this._handleListUpdate(n,e,t.length)];case 1:n=r.sent();return[2]}}))}))}})))];case 2:s.sent();r=this._calculateUpdateList(t,n);return[4,this._monitorExtensionDataFetchController.updateMonitorExtensionList(r)];case 3:s.sent();this.callbacks.forEach((function(e){e.resolve()}));return[2,this._notifyTaskSuccess()];case 4:o=s.sent();_.log("update with error",o);return[2,this._notifyTaskFailed(o)];case 5:return[2]}}))}))};BLFListUpdateProcessor.prototype._calculateUpdateList=function(e,t){var n=this;var r=p(e);var o=0;t.forEach((function(t){var i=n._isIndexAvailable(o,e);while(!i){i=n._isIndexAvailable(++o,e)}t.id=(o+1).toString();r.splice(o++,0,t)}));return r};BLFListUpdateProcessor.prototype._isIndexAvailable=function(e,t){return!t.some((function(t){return t.id===(e+1).toString()}))};BLFListUpdateProcessor.prototype._notifyTaskSuccess=function(){_.info("update with success");this.callbacks.forEach((function(e){e.resolve()}));return true};BLFListUpdateProcessor.prototype._notifyTaskFailed=function(e){this.callbacks.forEach((function(t){t.reject(e)}));return true};BLFListUpdateProcessor.prototype._handleListUpdate=function(e,t,n){return f(this,void 0,void 0,(function(){var r,o;return d(this,(function(i){switch(i.label){case 0:r=e.slice();o=t.updateType;switch(o){case g.ADD:return[3,1];case g.REMOVE:return[3,3];case g.REORDER:return[3,4]}return[3,5];case 1:return[4,this._handleAdd(t.addedExtensionIds||[],e,n)];case 2:r=i.sent();return[3,6];case 3:r=this._handleRemove(t.removedExtensionIds||[],e);return[3,6];case 4:r=this._handleReorder(t.reorder,e);return[3,6];case 5:return[3,6];case 6:return[2,r]}}))}))};BLFListUpdateProcessor.prototype._handleAdd=function(e,t,n){return f(this,void 0,void 0,(function(){var r;return d(this,(function(o){switch(o.label){case 0:_.info("handleListUpdate - handleAdd",e);t.unshift.apply(t,p(e.map((function(e){return{id:"",extension:{id:e}}}))));return[4,this._monitorExtensionDataFetchController.getMaxMonitoredExtensionLimit()];case 1:r=o.sent()-n;if(t.length>r){throw new i.JSdkError(c.n9.EXCEED_MAX_MONITOR_CNT,c.n9.EXCEED_MAX_MONITOR_CNT)}return[2,t]}}))}))};BLFListUpdateProcessor.prototype._handleRemove=function(e,t){_.info("handleListUpdate - handleRemove",e);return t.filter((function(t){return!e.includes(t.extension.id)}))};BLFListUpdateProcessor.prototype._handleReorder=function(e,t){var n=e.extensionId,r=e.preExtensionId,o=e.newIndex;_.log("handleListUpdate - handleReorder");if(t.find((function(e){return e.extension.id===n}))){t=t.filter((function(e){return e.extension.id!==n}));var i=t.findIndex((function(e){return e.extension.id===r}));var s=r?i!==-1?i:o:-1;var a=s+1;t.splice(a,0,{id:e.newIndex.toString(),extension:{id:n}})}return t};return BLFListUpdateProcessor}();var b=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var y=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var C=l.k.tags("[BLFDataController]");var E=function(){function BLFDataController(e,t){var n=this;this._blfItemController=e;this._monitorExtensionDataFetchController=t;this._listListeners=[];this._entityListeners=[];this._grantExtensionListener=function(e){C.info("handle grantExtension change",{extensionIds:e});var t=n.getMonitorExtensionsByIds(e);n._blfItemController.assembleGrantPermission(t);n._entityListeners.forEach((function(e){e(t)}))};this._monitorPresenceListener=function(e){C.info("handle monitorPresence change",{extensionIds:e});var t=n.getMonitorExtensionsByIds(e);n._blfItemController.assembleMonitorPresence(t);n._entityListeners.forEach((function(e){e(t)}))};this._callerIdControlPermissionListener=function(){C.info("handle CallerIdControl permission change");if(!n._monitorExtensionEntityList){return}var e=n._blfItemController.getNeedUpdateEntitiesByCallerIdControl(n._monitorExtensionEntityList);if(e.length){n._entityListeners.forEach((function(t){t(e)}))}};this._rcConferenceListener=function(){C.info("handle RCConference change");if(!n._monitorExtensionEntityList){return}var e=n._blfItemController.getNeedUpdateEntitiesByRCConference(n._monitorExtensionEntityList);if(e.length){n._entityListeners.forEach((function(t){t(e)}))}};this._rcPresenceListener=function(){C.info("handle RCPresence change");if(!n._monitorExtensionEntityList){return}n._blfItemController.assemblePickupCallsOnHold(n._monitorExtensionEntityList);n._entityListeners.forEach((function(e){n._monitorExtensionEntityList&&e(n._monitorExtensionEntityList)}))};this._refreshItemListener=function(){C.info("refresh BLF item");if(!n._monitorExtensionEntityList){return}n._monitorExtensionEntityList=n._blfItemController.getAssembledEntities(n._monitorExtensionEntityList);n._entityListeners.forEach((function(e){n._monitorExtensionEntityList&&e(n._monitorExtensionEntityList)}))};this._delegatedInfoListener=function(){C.info("handle delegated info change");if(!n._monitorExtensionEntityList){return}var e=n._blfItemController.getAndUpdateDelegatedTypeNeeded(n._monitorExtensionEntityList);if(e.length){n._entityListeners.forEach((function(t){t(e)}))}};this._handleMonitorExtensionListChange=function(e){var t;C.log("handleMonitorExtensionListChange",{payloadIds:e===null||e===void 0?void 0:e.map((function(e){return e.extension.id}))});if(!e){return}var r=n._getFilteredEntities(e);var i=r.map((function(e){return e.extension.id}));var s=(t=n._monitorExtensionEntityList)===null||t===void 0?void 0:t.map((function(e){return e.extension.id}));if(!o().isEqual(i,s)){n._monitorExtensionEntityList=n._blfItemController.getAssembledEntities(r);n._listListeners.forEach((function(e){n._monitorExtensionEntityList&&e(n._monitorExtensionEntityList)}))}};this._addUpdateBLFListProcessorStrategy=function(e,t){if(e.length){t.addOtherProcessorHistory(o().flatten(e.map((function(e){return e.historyTasks}))),o().flatten(e.map((function(e){return e.callbacks}))))}return[t]}}BLFDataController.prototype.subscribeBLFList=function(e){if(!this._listListeners.includes(e)){C.log("add new list subscriber");if(this._listListeners.length===0&&this._entityListeners.length===0){this.start()}this._listListeners.push(e)}else{C.trace("list listener already exist")}};BLFDataController.prototype.unsubscribeBLFList=function(e){this._listListeners=this._listListeners.filter((function(t){return t!==e}));if(this._listListeners.length===0&&this._entityListeners.length===0){this.stop()}};BLFDataController.prototype.subscribeBLFEntity=function(e){if(!this._entityListeners.includes(e)){C.log("add new entity subscriber");if(this._listListeners.length===0&&this._entityListeners.length===0){this.start()}this._entityListeners.push(e)}else{C.trace("entity listener already exist")}};BLFDataController.prototype.unsubscribeBLFEntity=function(e){this._entityListeners=this._entityListeners.filter((function(t){return t!==e}));if(this._listListeners.length===0&&this._entityListeners.length===0){this.stop()}};BLFDataController.prototype.start=function(){this._monitorExtensionDataFetchController.subscribe(this._handleMonitorExtensionListChange);this._blfItemController.observeBLFItem({grantExtensionListener:this._grantExtensionListener,monitorPresenceListener:this._monitorPresenceListener,callerIdControlListener:this._callerIdControlPermissionListener,rcConferenceListener:this._rcConferenceListener,rcPresenceListener:this._rcPresenceListener,refreshItemListener:this._refreshItemListener,delegatedInfoListener:this._delegatedInfoListener})};BLFDataController.prototype.stop=function(){this._monitorExtensionDataFetchController.unsubscribe(this._handleMonitorExtensionListChange);this._blfItemController.unobserveBLFItem()};BLFDataController.prototype.getMonitorExtensionIdsByFilterKey=function(e){return b(this,void 0,Promise,(function(){var t,n,r;return y(this,(function(o){switch(o.label){case 0:t=e.filterKey,n=e.filterFunc;return[4,this._getMonitorExtensionList()];case 1:r=o.sent();if(n){r=r.filter((function(e){return n(e)}))}if(t){r=this._filterExtensionByKey(t,r)}return[2,r.map((function(e){return e.id}))]}}))}))};BLFDataController.prototype.getMonitorExtensionsByIds=function(e){return this._monitorExtensionEntityList?this._monitorExtensionEntityList.filter((function(t){return e.includes(t.id)})):[]};BLFDataController.prototype.getMonitorExtensionById=function(e){var t;var n=(t=this._monitorExtensionEntityList)===null||t===void 0?void 0:t.find((function(t){return t.id===e}));return n?n:null};BLFDataController.prototype._getRawMonitorExtensionList=function(){var e;return b(this,void 0,void 0,(function(){return y(this,(function(t){switch(t.label){case 0:return[4,(e=this._monitorExtensionDataFetchController)===null||e===void 0?void 0:e.getMonitorExtensionList(true)];case 1:return[2,t.sent()||[]]}}))}))};BLFDataController.prototype._getMonitorExtensionList=function(){return b(this,void 0,void 0,(function(){var e;var t=this;return y(this,(function(n){switch(n.label){case 0:if(!!this._monitorExtensionEntityList)return[3,2];C.info("cache entities are undefined, fetch data from blf module");return[4,this._getRawMonitorExtensionList()];case 1:e=n.sent();this._monitorExtensionEntityList=this._blfItemController.getAssembledEntities(this._getFilteredEntities(e));this._listListeners.forEach((function(e){t._monitorExtensionEntityList&&e(t._monitorExtensionEntityList)}));n.label=2;case 2:return[2,this.getLocalMonitorExtensions()]}}))}))};BLFDataController.prototype.getLocalMonitorExtensions=function(){return this._monitorExtensionEntityList||[]};BLFDataController.prototype._getFilteredEntities=function(e){return this._filterSelfAndNonUserTypeExtension(e).map((function(e){return{id:e.extension.id,extension:e.extension}}))};BLFDataController.prototype.getMonitorExtensionNumberSet=function(){return b(this,void 0,void 0,(function(){var e;return y(this,(function(t){switch(t.label){case 0:return[4,this._getRawMonitorExtensionList()];case 1:e=t.sent();return[2,new Set(e.map((function(e){return e.extension.extensionNumber})))]}}))}))};BLFDataController.prototype.getCanAddExtensionCount=function(){return b(this,void 0,void 0,(function(){var e,t;return y(this,(function(n){switch(n.label){case 0:return[4,this._getRawMonitorExtensionList()];case 1:e=n.sent();return[4,this._monitorExtensionDataFetchController.getMaxMonitoredExtensionLimit()];case 2:t=n.sent()-e.length;return[2,Math.max(t,0)]}}))}))};BLFDataController.prototype._filterSelfAndNonUserTypeExtension=function(e){var t;C.info("filter self and non user type extension",e.map((function(e){return{id:e.extension.id,extNumber:e.extension.extensionNumber}})));var n=(t=(0,s.gT)())===null||t===void 0?void 0:t.userConfig.getExtensionId().toString();return e.filter((function(e){return e.extension.id!==n}))};BLFDataController.prototype._filterExtensionByKey=function(e,t){var n=this;C.info("filter extension by key",e);var r=this._contactModule.getFilter({filterValue:e,skipValidate:true});return t.filter((function(e){var t=n._contactModule.matchContactByExtensionIdSynchronously(e.extension.id);if(t){var o=n._contactModule.getDataByIdSynchronously(t);return o&&r(o)}return false}))};Object.defineProperty(BLFDataController.prototype,"updateListTaskQueue",{get:function(){C.log("update BLF list task queue");if(!this._updateBLFListTaskQueue){this._updateBLFListTaskQueue=new i.SequenceProcessorHandler({name:BLFDataController.constructor.name,addProcessorStrategy:this._addUpdateBLFListProcessorStrategy})}return this._updateBLFListTaskQueue},enumerable:true,configurable:true});BLFDataController.prototype.addMonitorExtension=function(e){return b(this,void 0,void 0,(function(){var t;var n=this;return y(this,(function(r){switch(r.label){case 0:C.info("add monitor extension",e);return[4,Promise.all(e.map((function(e){return n._contactModule.getExtensionIdByContactId(e)})))];case 1:t=r.sent().filter((function(e){return e}));return[2,this._doUpdateInQueue({updateType:g.ADD,addedExtensionIds:t})]}}))}))};BLFDataController.prototype.removeMonitorExtension=function(e){C.info("remove monitor extension",e);var t={updateType:g.REMOVE,removedExtensionIds:e};return this._doUpdateInQueue(t)};BLFDataController.prototype.reorderMonitorExtensionList=function(e,t,n){return b(this,void 0,void 0,(function(){var r,o,i;return y(this,(function(s){switch(s.label){case 0:C.log("reorderMonitorExtensionList",{extensionId:e,newIndex:t,preExtensionId:n});s.label=1;case 1:s.trys.push([1,3,,5]);r={updateType:g.REORDER,reorder:{newIndex:t,extensionId:e,preExtensionId:n}};return[4,this._doUpdateInQueue(r)];case 2:s.sent();return[3,5];case 3:o=s.sent();C.log("reorderMonitorExtensionList with error",o);return[4,this._getMonitorExtensionList()];case 4:i=s.sent();this._listListeners.forEach((function(e){e(i)}));throw o;case 5:return[2]}}))}))};BLFDataController.prototype._doUpdateInQueue=function(e){var t=this;return new Promise((function(n,r){var o=new v({newTask:e,callback:{resolve:n,reject:r}},t._monitorExtensionDataFetchController);t.updateListTaskQueue.addProcessor(o)}))};Object.defineProperty(BLFDataController.prototype,"_contactModule",{get:function(){return(0,i.getModule)(a.MODULE_NAME)},enumerable:true,configurable:true});return BLFDataController}()},70200:(e,t,n)=>{n.d(t,{R7:()=>le,gk:()=>Se,tB:()=>S,Yh:()=>A,Jj:()=>K,hn:()=>ee,yA:()=>E,v_:()=>ye,rX:()=>ie,hN:()=>ge});var r=n(298784);var o=n.n(r);var i=n(862926);var s=n(667489);var a=n(379116);var l=n(827027);var u=n(295454);var c=n(228164);var f=n(831513);var d=n(888148);var h=n(61165);var p=n(211951);var g=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var _=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var v=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var b=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var y=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var C=h.k.tags("[MonitorExtensionListController]");var E=function(e){g(MonitorExtensionDataFetchController,e);function MonitorExtensionDataFetchController(t){var n=e.call(this,{syncInterval:a.qu,jobKey:p.pb.MONITOR_EXTENSION_LIST,executeJOBWhenStarts:true})||this;n._DBConfig=t;n._listeners=[];n._syncDataInDebounce=o().debounce((function(){return b(n,void 0,void 0,(function(){return y(this,(function(e){switch(e.label){case 0:return[4,this._syncData()];case 1:e.sent();return[2]}}))}))}),u.lo.TEN_SECONDS);return n}MonitorExtensionDataFetchController.prototype.subscribe=function(e){if(!this._listeners.includes(e)){C.log("add new subscriber");if(this._listeners.length===0){this.start()}this._listeners.push(e)}else{C.trace("listener already exist")}};MonitorExtensionDataFetchController.prototype.unsubscribe=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}));if(this._listeners.length===0){this.stop()}};MonitorExtensionDataFetchController.prototype.start=function(){e.prototype.start.call(this);C.info("subscribe data change",c.RCSubscriptionKeys.MonitorExtensionList);this._rcNotificationModule.subscribe(c.RCSubscriptionKeys.MonitorExtensionList,this._syncDataInDebounce)};MonitorExtensionDataFetchController.prototype.stop=function(){C.info("unsubscribe data change",c.RCSubscriptionKeys.MonitorExtensionList);this._rcNotificationModule.unsubscribe(c.RCSubscriptionKeys.MonitorExtensionList,this._syncDataInDebounce);e.prototype.stop.call(this)};Object.defineProperty(MonitorExtensionDataFetchController.prototype,"_rcNotificationModule",{get:function(){return(0,s.getModule)(c.RC_NOTIFICATION_MODULE_NAME)},enumerable:true,configurable:true});MonitorExtensionDataFetchController.prototype._syncData=function(){return b(this,void 0,void 0,(function(){var e;return y(this,(function(t){switch(t.label){case 0:return[4,this.fetchData()];case 1:e=t.sent();return[4,this.handleAndSaveData(e)];case 2:t.sent();return[2,e]}}))}))};MonitorExtensionDataFetchController.prototype.fetchData=function(){return b(this,void 0,void 0,(function(){var e;return y(this,(function(t){switch(t.label){case 0:C.log("get monitor extension list from api");t.label=1;case 1:t.trys.push([1,3,,4]);return[4,new l.RCPaginationController({fetchHandler:d.V.getMonitorExtensionList}).getAllPage({page:l.FIRST_PAGE_INDEX,perPage:l.MAX_PER_PAGE})];case 2:return[2,t.sent()];case 3:e=t.sent();C.warn("failed to get monitor extension list",{error:e});throw e;case 4:return[2]}}))}))};MonitorExtensionDataFetchController.prototype.handleAndSaveData=function(e){return b(this,void 0,void 0,(function(){var t;return y(this,(function(n){switch(n.label){case 0:C.log("set monitor extension list to DB and emit change");t=this._sortListById(e);return[4,this._DBConfig.setMonitorExtensionList(t)];case 1:n.sent();this._listeners.forEach((function(t){t(e)}));return[2]}}))}))};MonitorExtensionDataFetchController.prototype._sortListById=function(e){return e.sort((function(e,t){return Number(e.id)-Number(t.id)}))};MonitorExtensionDataFetchController.prototype.getMonitorExtensionList=function(e){return b(this,void 0,Promise,(function(){var t;return y(this,(function(n){switch(n.label){case 0:return[4,this._DBConfig.getMonitorExtensionList()];case 1:t=n.sent();if(!(!t&&e))return[3,3];return[4,this._syncData()];case 2:t=n.sent();n.label=3;case 3:return[2,t]}}))}))};MonitorExtensionDataFetchController.prototype.updateMonitorExtensionList=function(e){return b(this,void 0,void 0,(function(){return y(this,(function(t){switch(t.label){case 0:return[4,d.V.updateMonitorExtensionList(e)];case 1:t.sent();return[4,this._syncData()];case 2:t.sent();return[2]}}))}))};MonitorExtensionDataFetchController.prototype.getMaxMonitoredExtensionLimit=function(){var e;return b(this,void 0,Promise,(function(){var t;return y(this,(function(n){switch(n.label){case 0:return[4,(0,s.getModule)(f.Y0).getAccountInfo()];case 1:t=n.sent();return[2,((e=t===null||t===void 0?void 0:t.limits)===null||e===void 0?void 0:e.maxMonitoredExtensionsPerUser)||0]}}))}))};_([i.SingleRequest,v("design:type",Function),v("design:paramtypes",[]),v("design:returntype",Promise)],MonitorExtensionDataFetchController.prototype,"fetchData",null);return MonitorExtensionDataFetchController}(l.AbstractRCDataSyncController);var L=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var x=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var I=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var m=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var D=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],s;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(s)throw s.error}}return i};var R=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(D(arguments[t]));return e};var F=h.k.tags("[BLFExtensionPresenceController]");var S=function(){function BLFExtensionPresenceController(){var e=this;this._extensionPresenceCache=new Map;this._listeners=[];this._dataSources=new Set;this._subscribedEventSet=new Set;this._throttleRefreshPresenceManually=o().throttle((function(){return I(e,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:F.log("_throttleRefreshPresenceManually triggered");e=this._getSourceIdSet();if(!e.size)return[3,2];return[4,this._refreshPresences(Array.from(e))];case 1:t.sent();t.label=2;case 2:return[2]}}))}))}),u.lo.TEN_SECONDS);this._handleRCNotificationReady=function(t){if(t.includes(c.RCSubscriptionKeys.TelephonyDetail)){F.info("_handleRCNotificationReady");e._throttleRefreshPresenceManually()}};this._handlePresencePayload=function(t){var n;F.log("incoming new payload",{extId:t.extensionId,callLen:(n=t.activeCalls)===null||n===void 0?void 0:n.length});e._setFirstReceiveTime(t.extensionId.toString(),t);e._extensionPresenceCache.set(t.extensionId.toString(),t);e._listeners.forEach((function(e){e(new Map([[t.extensionId.toString(),t]]))}))};this._onNetworkChange=function(t){var n=t.onLine;if(n){e._onNetworkConnected()}else{e._onNetworkDisconnected()}}}BLFExtensionPresenceController.prototype.subscribe=function(e){if(!this._listeners.includes(e)){F.log("add new subscriber");if(this._listeners.length===0){this._initInternal()}this._listeners.push(e)}else{F.trace("listener already exist")}};BLFExtensionPresenceController.prototype.unsubscribe=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}));if(this._listeners.length===0){this._disposeInternal()}};BLFExtensionPresenceController.prototype.getExtensionPresenceById=function(e){return this._extensionPresenceCache.get(e)};BLFExtensionPresenceController.prototype.addDataSource=function(e){F.info("add new data source");this._dataSources.add(e);this.onEventsUpdate();this.onSourceIdsUpdate()};BLFExtensionPresenceController.prototype.removeDataSource=function(e){F.info("remove data source");this._dataSources.delete(e);this.onEventsUpdate();this.onSourceIdsUpdate()};BLFExtensionPresenceController.prototype.onEventsUpdate=function(){this._listeners.length&&this._subscribeEvents()};BLFExtensionPresenceController.prototype.onSourceIdsUpdate=function(){var e=this;var t=this._getSourceIdSet();this._extensionPresenceCache.forEach((function(n,r){!t.has(r)&&e._extensionPresenceCache.delete(r)}));if(this._listeners.length){var n=[];t.forEach((function(t){!e._extensionPresenceCache.has(t)&&n.push(t)}));n.length&&this._refreshPresences(n)}};BLFExtensionPresenceController.prototype._initInternal=function(){F.log("_initInternal");s.notificationCenter.on(s.WINDOW_EVENT.ONLINE,this._onNetworkChange);s.notificationCenter.on(c.RC_NOTIFICATION.EVENT_KEYS.RC_NOTIFICATION_READY,this._handleRCNotificationReady);this._subscribeEvents();this._throttleRefreshPresenceManually()};BLFExtensionPresenceController.prototype._disposeInternal=function(){F.log("_disposeInternal");s.notificationCenter.off(s.WINDOW_EVENT.ONLINE,this._onNetworkChange);s.notificationCenter.off(c.RC_NOTIFICATION.EVENT_KEYS.RC_NOTIFICATION_READY,this._handleRCNotificationReady);this._rcNotificationModule.batchUnsubscribe(Array.from(this._subscribedEventSet),this._handlePresencePayload);this._subscribedEventSet.clear();this._extensionPresenceCache.clear()};BLFExtensionPresenceController.prototype._subscribeEvents=function(){var e=this;var t=this._getEventSet();var n=[];var r=[];t.forEach((function(t){if(!e._subscribedEventSet.has(t)){n.push(t);e._subscribedEventSet.add(t)}}));this._subscribedEventSet.forEach((function(n){if(!t.has(n)){r.push(n);e._subscribedEventSet.delete(n)}}));n.length&&this._rcNotificationModule.batchSubscribe(n,this._handlePresencePayload);r.length&&this._rcNotificationModule.batchUnsubscribe(r,this._handlePresencePayload)};BLFExtensionPresenceController.prototype._getSourceIdSet=function(){var e=new Set;this._dataSources.forEach((function(t){t.getSourceIds().forEach((function(t){return e.add(t)}))}));return e};BLFExtensionPresenceController.prototype._getEventSet=function(){var e=new Set;this._dataSources.forEach((function(t){t.getEvents().forEach((function(t){e.add(t)}))}));return e};BLFExtensionPresenceController.prototype._refreshPresences=function(e){return I(this,void 0,void 0,(function(){var t,n;var r=this;return m(this,(function(o){switch(o.label){case 0:o.trys.push([0,2,,3]);return[4,this.requestTelephonyDetailPresence(e)];case 1:t=o.sent();t.forEach((function(e){r._setFirstReceiveTime(e.extension.id.toString(),e);r._extensionPresenceCache.set(e.extension.id.toString(),e)}));this._listeners.forEach((function(e){e(r._extensionPresenceCache)}));F.log("refreshPreferenceMonitorExtensions done, cache size",this._extensionPresenceCache.size);return[3,3];case 2:n=o.sent();F.warn("refreshPreferenceMonitorExtensions",n);return[3,3];case 3:return[2]}}))}))};BLFExtensionPresenceController.prototype.requestTelephonyDetailPresence=function(e){return d.V.requestTelephonyDetailPresence(e)};BLFExtensionPresenceController.prototype._setFirstReceiveTime=function(e,t){var n;var r=this._extensionPresenceCache.get(e);(n=t.activeCalls)===null||n===void 0?void 0:n.forEach((function(e){var t;var n=(t=r===null||r===void 0?void 0:r.activeCalls)===null||t===void 0?void 0:t.find((function(t){return l.CallUtils.isSameCall(l.CallUtils.activeCall2UniqueCallInfo(e),l.CallUtils.activeCall2UniqueCallInfo(t))&&e.startTime===t.startTime}));e.__firstReceiveTime=(n===null||n===void 0?void 0:n.__firstReceiveTime)||Date.now()}))};BLFExtensionPresenceController.prototype._onNetworkConnected=function(){F.info("_onNetworkConnected");this._throttleRefreshPresenceManually()};BLFExtensionPresenceController.prototype._onNetworkDisconnected=function(){var e=this;F.info("_onNetworkDisconnected");var t=R(this._extensionPresenceCache.values());t.forEach((function(e){e.activeCalls=[];e.telephonyStatus=l.TELEPHONY_STATUS.NoCall}));this._listeners.forEach((function(t){t(e._extensionPresenceCache)}))};Object.defineProperty(BLFExtensionPresenceController.prototype,"_rcNotificationModule",{get:function(){return(0,s.getModule)(c.RC_NOTIFICATION_MODULE_NAME)},enumerable:true,configurable:true});L([i.SingleRequest,x("design:type",Function),x("design:paramtypes",[Array]),x("design:returntype",Promise)],BLFExtensionPresenceController.prototype,"_refreshPresences",null);return BLFExtensionPresenceController}();var B=n(470033);var w=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var P=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var M=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var N=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var T=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var O=h.k.tags("[DelegateDataFetchController]");var A=function(e){w(DelegateDataFetchController,e);function DelegateDataFetchController(t,n){var r=e.call(this,{syncInterval:a.qu,jobKey:p.pb.DELEGATE_LIST,executeJOBWhenStarts:true,permissionRegister:(0,s.generatePermissionRegister)([[B.H3.RCExtensionFeaturesId.CallDelegation]])})||this;r._DBConfig=t;r._grantExtensionDataFetchController=n;r._listeners=[];r._handleGrantListChange=function(e){var t=e.oldData,n=e.newData;if(o().isEqual(n.filter((function(e){return e.callDelegation})),t.filter((function(e){return e.callDelegation})))){O.info("list did not change");return}O.info("handle grant list change:",n.map((function(e){return e.extension.id})));r._syncDataInDebounce()};r._syncDataInDebounce=o().debounce((function(){return N(r,void 0,void 0,(function(){return T(this,(function(e){switch(e.label){case 0:return[4,this._syncData()];case 1:e.sent();return[2]}}))}))}),u.lo.TEN_SECONDS);return r}DelegateDataFetchController.prototype.subscribe=function(e){if(!this._listeners.includes(e)){O.log("add new subscriber");if(this._listeners.length===0){this.start()}this._listeners.push(e)}else{O.trace("listener already exist")}};DelegateDataFetchController.prototype.unsubscribe=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}));if(this._listeners.length===0){this.stop()}};DelegateDataFetchController.prototype.start=function(){e.prototype.start.call(this);s.notificationCenter.on(p.FY.RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE,this._handleGrantListChange)};DelegateDataFetchController.prototype.stop=function(){s.notificationCenter.off(p.FY.RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE,this._handleGrantListChange);e.prototype.stop.call(this)};DelegateDataFetchController.prototype._syncData=function(){return N(this,void 0,void 0,(function(){var e;return T(this,(function(t){switch(t.label){case 0:return[4,this.fetchData()];case 1:e=t.sent();return[4,this.handleAndSaveData(e)];case 2:t.sent();return[2,e]}}))}))};DelegateDataFetchController.prototype.fetchData=function(){return N(this,void 0,void 0,(function(){var e,t;return T(this,(function(n){switch(n.label){case 0:O.log("get delegate list from api");n.label=1;case 1:n.trys.push([1,5,,6]);return[4,this._hasCallDelegationPermission()];case 2:if(!n.sent())return[3,4];return[4,d.V.getDelegateList()];case 3:e=n.sent();return[2,e.records];case 4:return[2,[]];case 5:t=n.sent();O.warn("failed to get delegate list",{error:t});throw t;case 6:return[2]}}))}))};DelegateDataFetchController.prototype.handleAndSaveData=function(e){return N(this,void 0,void 0,(function(){return T(this,(function(t){switch(t.label){case 0:O.log("set delegate list to DB");if(!!o().isEqual(this._cacheList,e))return[3,2];return[4,this._DBConfig.setDelegateList(e)];case 1:t.sent();this._cacheList=e.slice();this._listeners.forEach((function(t){t(e)}));t.label=2;case 2:return[2]}}))}))};DelegateDataFetchController.prototype.getDelegateList=function(e){return N(this,void 0,Promise,(function(){var t;return T(this,(function(n){switch(n.label){case 0:return[4,this._DBConfig.getDelegateList()];case 1:t=n.sent();if(!(!t&&e))return[3,3];return[4,this._syncData()];case 2:t=n.sent();n.label=3;case 3:return[2,t]}}))}))};DelegateDataFetchController.prototype.getDelegateListFromCache=function(){return this._cacheList};DelegateDataFetchController.prototype._hasCallDelegationPermission=function(){return N(this,void 0,void 0,(function(){var e,t,n,r;return T(this,(function(o){switch(o.label){case 0:e=(0,s.getCurrentAccount)().context.entitlement;t=!!e.get(B.H3.RCExtensionFeaturesId.CallDelegation);if(!t)return[3,4];o.label=1;case 1:o.trys.push([1,3,,4]);return[4,this._grantExtensionDataFetchController.getGrantExtensionList(true)];case 2:n=o.sent();return[2,!!(n===null||n===void 0?void 0:n.some((function(e){return e.callDelegation})))];case 3:r=o.sent();O.warn("get grant lis failed",r);return[2,false];case 4:return[2,false]}}))}))};P([i.SingleRequest,M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",Promise)],DelegateDataFetchController.prototype,"fetchData",null);return DelegateDataFetchController}(l.AbstractRCDataSyncController);var U=n(379269);var G=n(749514);var k=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var j=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var H=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var Y=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var V=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var X=h.k.tags("[DelegationAssignmentListController]");var K=function(e){k(DelegationAssignmentDataFetchController,e);function DelegationAssignmentDataFetchController(t,n){var r=e.call(this,{syncInterval:a.qu,jobKey:p.pb.DELEGATION_ASSIGNMENT_LIST,executeJOBWhenStarts:true,permissionRegister:(0,s.generatePermissionRegister)([[B.H3.RCExtensionFeaturesId.CallAssistance]])})||this;r._DBConfig=t;r._grantExtensionDataFetchController=n;r._listeners=[];r._handleGrantListChange=function(e){var t=e.oldData,n=e.newData;if(o().isEqual(n.filter((function(e){return e.callOnBehalfOf})),t.filter((function(e){return e.callOnBehalfOf})))){X.info("list did not change");return}X.info("handle grant list change:",n.map((function(e){return e.extension.id})));r._syncDataInDebounce()};r._syncDataInDebounce=o().debounce((function(){return Y(r,void 0,void 0,(function(){return V(this,(function(e){switch(e.label){case 0:return[4,this._syncData()];case 1:e.sent();return[2]}}))}))}),u.lo.TEN_SECONDS);return r}DelegationAssignmentDataFetchController.prototype.subscribe=function(e){if(!this._listeners.includes(e)){X.log("add new subscriber");if(this._listeners.length===0){this.start()}this._listeners.push(e)}else{X.trace("listener already exist")}};DelegationAssignmentDataFetchController.prototype.unsubscribe=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}));if(this._listeners.length===0){this.stop()}};DelegationAssignmentDataFetchController.prototype.start=function(){e.prototype.start.call(this);s.notificationCenter.on(p.FY.RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE,this._handleGrantListChange)};DelegationAssignmentDataFetchController.prototype.stop=function(){s.notificationCenter.off(p.FY.RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE,this._handleGrantListChange);e.prototype.stop.call(this)};DelegationAssignmentDataFetchController.prototype._syncData=function(){return Y(this,void 0,void 0,(function(){var e;return V(this,(function(t){switch(t.label){case 0:return[4,this.fetchData()];case 1:e=t.sent();return[4,this.handleAndSaveData(e)];case 2:t.sent();return[2,e]}}))}))};DelegationAssignmentDataFetchController.prototype.fetchData=function(){return Y(this,void 0,void 0,(function(){var e,t;return V(this,(function(n){switch(n.label){case 0:X.log("get delegation assignment list from api");n.label=1;case 1:n.trys.push([1,5,,6]);return[4,this._hasCallAssistancePermission()];case 2:if(!n.sent())return[3,4];return[4,d.V.getDelegationAssignmentList()];case 3:e=n.sent();return[2,e.records];case 4:return[2,[]];case 5:t=n.sent();X.warn("failed to get delegation assignment list",{error:t});throw t;case 6:return[2]}}))}))};DelegationAssignmentDataFetchController.prototype.handleAndSaveData=function(e){return Y(this,void 0,void 0,(function(){return V(this,(function(t){switch(t.label){case 0:X.log("set delegation assignment list to DB");if(!!o().isEqual(this._cacheList,e))return[3,2];return[4,this._DBConfig.setDelegationAssignmentList(e)];case 1:t.sent();this._cacheList=e.slice();this._refreshCallerIdList(e);this._listeners.forEach((function(t){t(e)}));t.label=2;case 2:return[2]}}))}))};DelegationAssignmentDataFetchController.prototype._refreshCallerIdList=function(e){var t,n;return Y(this,void 0,void 0,(function(){var r,o;return V(this,(function(i){switch(i.label){case 0:return[4,(t=this._rcInfoModule)===null||t===void 0?void 0:t.getCallerIdList(true)];case 1:r=i.sent();o=e.some((function(e){return!r.find((function(t){var n,r;return String((n=t.extension)===null||n===void 0?void 0:n.id)===String(e.extension.id)&&((r=t.features)===null||r===void 0?void 0:r.includes(G.or.Delegated))}))}));o&&((n=this._rcInfoModule)===null||n===void 0?void 0:n.refreshCallerIdList());return[2]}}))}))};DelegationAssignmentDataFetchController.prototype.getDelegationAssignmentList=function(e){return Y(this,void 0,Promise,(function(){var t;return V(this,(function(n){switch(n.label){case 0:return[4,this._DBConfig.getDelegationAssignmentList()];case 1:t=n.sent();if(!(!t&&e))return[3,3];return[4,this._syncData()];case 2:t=n.sent();n.label=3;case 3:return[2,t]}}))}))};DelegationAssignmentDataFetchController.prototype.getParticipantAccessByExtensionId=function(e){var t;return Y(this,void 0,Promise,(function(){var n;return V(this,(function(r){switch(r.label){case 0:return[4,this.getDelegationAssignmentList()];case 1:n=r.sent();return[2,n&&((t=n.find((function(t){return t.extension.id.toString()===e})))===null||t===void 0?void 0:t.conferenceSettings.participantCode)]}}))}))};Object.defineProperty(DelegationAssignmentDataFetchController.prototype,"_rcInfoModule",{get:function(){return(0,s.getModule)(U.oF)},enumerable:true,configurable:true});DelegationAssignmentDataFetchController.prototype.getDelegationAssignmentListFromCache=function(){return this._cacheList};DelegationAssignmentDataFetchController.prototype._hasCallAssistancePermission=function(){return Y(this,void 0,void 0,(function(){var e,t,n,r;return V(this,(function(o){switch(o.label){case 0:e=(0,s.getCurrentAccount)().context.entitlement;t=!!e.get(B.H3.RCExtensionFeaturesId.CallDelegation);if(!t)return[3,4];o.label=1;case 1:o.trys.push([1,3,,4]);return[4,this._grantExtensionDataFetchController.getGrantExtensionList(true)];case 2:n=o.sent();return[2,!!(n===null||n===void 0?void 0:n.some((function(e){return e.callOnBehalfOf})))];case 3:r=o.sent();X.warn("get grant list failed",r);return[2,false];case 4:return[2,false]}}))}))};j([i.SingleRequest,H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",Promise)],DelegationAssignmentDataFetchController.prototype,"fetchData",null);return DelegationAssignmentDataFetchController}(l.AbstractRCDataSyncController);var q=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var W=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var Q=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var J=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var z=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var $=h.k.tags("[GrantExtensionListController]");var Z=(0,u.Fd)();var ee=function(e){q(GrantExtensionDataFetchController,e);function GrantExtensionDataFetchController(t){var n=e.call(this,{syncInterval:a.qu,jobKey:p.pb.GRANT_EXTENSION_LIST,executeJOBWhenStarts:true})||this;n._DBConfig=t;n._listeners=[];n._handleDataChange=function(){return n._syncDataInDebounce()};return n}GrantExtensionDataFetchController.prototype.subscribe=function(e){if(!this._listeners.includes(e)){$.log("add new subscriber");if(this._listeners.length===0){this.start()}this._listeners.push(e)}else{$.trace("listener already exist")}};GrantExtensionDataFetchController.prototype.unsubscribe=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}));if(this._listeners.length===0){this.stop()}};GrantExtensionDataFetchController.prototype.start=function(){e.prototype.start.call(this);$.info("subscribe data change",c.RCSubscriptionKeys.GrantExtensionList);this._rcNotificationModule.subscribe(c.RCSubscriptionKeys.GrantExtensionList,this._handleDataChange)};GrantExtensionDataFetchController.prototype.stop=function(){$.info("unsubscribe data change",c.RCSubscriptionKeys.GrantExtensionList);this._rcNotificationModule.unsubscribe(c.RCSubscriptionKeys.GrantExtensionList,this._handleDataChange);e.prototype.stop.call(this)};Object.defineProperty(GrantExtensionDataFetchController.prototype,"_rcNotificationModule",{get:function(){return(0,s.getModule)(c.RC_NOTIFICATION_MODULE_NAME)},enumerable:true,configurable:true});GrantExtensionDataFetchController.prototype._syncDataInDebounce=function(){return this._syncData()};GrantExtensionDataFetchController.prototype._syncData=function(){return J(this,void 0,void 0,(function(){var e;return z(this,(function(t){switch(t.label){case 0:return[4,this.fetchData()];case 1:e=t.sent();return[4,this.handleAndSaveData(e)];case 2:t.sent();return[2,e]}}))}))};GrantExtensionDataFetchController.prototype.fetchData=function(){return J(this,void 0,void 0,(function(){var e;return z(this,(function(t){switch(t.label){case 0:$.log("get grant extension list from api");t.label=1;case 1:t.trys.push([1,3,,4]);return[4,new l.RCPaginationController({fetchHandler:d.V.getGrantExtensionList}).getAllPage({page:l.FIRST_PAGE_INDEX,perPage:l.MAX_PER_PAGE})];case 2:return[2,t.sent()];case 3:e=t.sent();$.warn("failed to get grant extension list",{error:e});throw e;case 4:return[2]}}))}))};GrantExtensionDataFetchController.prototype.handleAndSaveData=function(e){return J(this,void 0,void 0,(function(){var t;return z(this,(function(n){switch(n.label){case 0:$.log("get old grant extension list from DB & set new grant extension list to DB ");return[4,this._DBConfig.getGrantExtensionList()];case 1:t=n.sent();return[4,this._DBConfig.setGrantExtensionList(e)];case 2:n.sent();this._listeners.forEach((function(t){t(e)}));if(!o().isEqual(t,e)){$.log("data change, trigger event: "+p.FY.RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE);s.notificationCenter.emit(p.FY.RC_BLF_SERVICE.GRANT_EXTENSION_LIST_CHANGE,{oldData:t,newData:e})}return[2]}}))}))};GrantExtensionDataFetchController.prototype.getGrantExtensionList=function(e){return J(this,void 0,Promise,(function(){var t;return z(this,(function(n){switch(n.label){case 0:return[4,this._DBConfig.getGrantExtensionList()];case 1:t=n.sent();if(!(!t&&e))return[3,3];return[4,this._syncData()];case 2:t=n.sent();n.label=3;case 3:return[2,t]}}))}))};W([Z({minDelayTime:0,increment:u.lo.TWENTY_SECONDS,windowLength:u.lo.TWENTY_SECONDS}),Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",void 0)],GrantExtensionDataFetchController.prototype,"_syncDataInDebounce",null);W([i.SingleRequest,Q("design:type",Function),Q("design:paramtypes",[]),Q("design:returntype",Promise)],GrantExtensionDataFetchController.prototype,"fetchData",null);return GrantExtensionDataFetchController}(l.AbstractRCDataSyncController);var te=n(671760);var ne=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var re=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var oe=h.k.tags("[RCHUDBootstrapController]");var ie=function(){function RCHUDBootstrapController(e){var t=this;this._controllers=e;this._handleEnableHUDChanged=function(){return ne(t,void 0,void 0,(function(){var e;return re(this,(function(t){switch(t.label){case 0:e=this;return[4,te.Bo.getEnableHUD()];case 1:e._enableHUD=t.sent();oe.info("_handleEnableHUDChanged",this._enableHUD);if(this._enableHUD){this._debounceStop.cancel();this._startControllers()}else{this._debounceStop()}return[2]}}))}))};this._stopControllers=function(){if(!t._enableHUD){oe.info("stop controllers");t._controllers.forEach((function(e){return e.stop()}))}};this._debounceStop=o().debounce(this._stopControllers,u.lo.TEN_SECONDS)}RCHUDBootstrapController.prototype.start=function(){return ne(this,void 0,void 0,(function(){var e;return re(this,(function(t){switch(t.label){case 0:te.Bo.on(te.Bo.generateStoreKey(te.vD.ENABLE_HUD),this._handleEnableHUDChanged);e=this;return[4,te.Bo.getEnableHUD()];case 1:e._enableHUD=t.sent();if(this._enableHUD){this._startControllers()}return[2]}}))}))};RCHUDBootstrapController.prototype.stop=function(){te.Bo.off(te.Bo.generateStoreKey(te.vD.ENABLE_HUD),this._handleEnableHUDChanged);this._debounceStop()};RCHUDBootstrapController.prototype._startControllers=function(){oe.info("start controllers");this._controllers.forEach((function(e){return e.start()}))};return RCHUDBootstrapController}();var se=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ae=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var le=function(){function AbstractBLFSectionController(e){var t=this;this.blfDataController=e;this.cacheIds=[];this.filterEntity=function(e){return!!(e.extension.type&&t.enableTypes.includes(e.extension.type))};this.handleBLFListChanged=function(e){var n=e.filter((function(e){return t.filterEntity(e)})).map((function(e){return e.id}));if(!o().isEqual(n,t.cacheIds)){t.logger.info("blf list changes, ids:",n);t.cacheIds=n;s.notificationCenter.emit(t.eventKey,n)}};this.handleBLFEntityChanged=function(e){var n=e.filter((function(e){return t.filterEntity(e)}));s.notificationCenter.emitEntityUpdate(t.entityKey,n)}}AbstractBLFSectionController.prototype.start=function(){this.blfDataController.subscribeBLFList(this.handleBLFListChanged);this.blfDataController.subscribeBLFEntity(this.handleBLFEntityChanged)};AbstractBLFSectionController.prototype.stop=function(){this.blfDataController.unsubscribeBLFList(this.handleBLFListChanged);this.blfDataController.unsubscribeBLFEntity(this.handleBLFEntityChanged)};AbstractBLFSectionController.prototype.getIdsByFilterKey=function(e){return this.blfDataController.getMonitorExtensionIdsByFilterKey({filterKey:e,filterFunc:this.filterEntity})};AbstractBLFSectionController.prototype.getById=function(e){return this.blfDataController.getMonitorExtensionById(e)};AbstractBLFSectionController.prototype.batchGet=function(e){return this.blfDataController.getMonitorExtensionsByIds(e)};AbstractBLFSectionController.prototype.add=function(e){return this.blfDataController.addMonitorExtension(e)};AbstractBLFSectionController.prototype.remove=function(e){return this.blfDataController.removeMonitorExtension(e)};AbstractBLFSectionController.prototype.reorder=function(e,t){return se(this,void 0,void 0,(function(){var n,r;return ae(this,(function(o){switch(o.label){case 0:n=this.cacheIds.findIndex((function(t){return t===e}));if(n===-1){return[2]}r=this._reorderItem(t,n);this.cacheIds=r;s.notificationCenter.emit(this.eventKey,r);return[4,this.blfDataController.reorderMonitorExtensionList(e,t,r[t-1])];case 1:o.sent();return[2]}}))}))};AbstractBLFSectionController.prototype._reorderItem=function(e,t){if(this.cacheIds.length){var n=this.cacheIds.slice();var r=n.splice(t,1)[0];n.splice(e,0,r);return n}return[]};return AbstractBLFSectionController}();var ue=n(840009);var ce=n(831270);var fe=undefined&&undefined.__assign||function(){fe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return fe.apply(this,arguments)};var de=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var he=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var pe=h.k.tags("[RingingListController]");var ge=function(){function RingingListController(e,t){var n=this;this._blfDBConfig=e;this._blfDataController=t;this._debounceCalculateRingingExtensionList=o().debounce((function(){return n._calculateRingingExtensionList()}),u.lo.ONE_SECOND);this._debounceHandleExtensionContactChange=o().debounce((function(e){return de(n,void 0,void 0,(function(){return he(this,(function(t){switch(t.label){case 0:return[4,this._handleExtensionContactChange(e)];case 1:t.sent();return[2]}}))}))}),u.lo.FIVE_SECOND);this._calculateRingingExtensionList=function(){return de(n,void 0,Promise,(function(){var e,t,n,r,i;return he(this,(function(a){switch(a.label){case 0:e=[];return[4,this._getEnableMonitoringRing()];case 1:if(!a.sent()){s.notificationCenter.emit(p.FY.RC_BLF_SERVICE.SELECTIVE_RINGING_LIST,[]);return[2,e]}a.label=2;case 2:a.trys.push([2,7,,8]);t=function(){var t,r,i;return he(this,(function(s){switch(s.label){case 0:return[4,n._blfModule.getGrantExtensionList()];case 1:t=s.sent();r=[];t===null||t===void 0?void 0:t.forEach((function(e){var t;if(e.callPickup&&((t=e.extension)===null||t===void 0?void 0:t.type)&&p.GM.includes(e.extension.type)){r.push(e.extension.id)}}));if(!r.length){return[2,"break"]}return[4,n._blfDataController.getMonitorExtensionIdsByFilterKey({})];case 2:i=s.sent();r=o().intersection(r,i);if(!r.length){return[2,"break"]}return[4,n._updateRingingListByCanPickUpData(r,t)];case 3:e=s.sent();return[4,n._fillRingingExtensionListName(e)];case 4:e=s.sent();return[2]}}))};n=this;a.label=3;case 3:return[5,t()];case 4:r=a.sent();if(r==="break")return[3,6];a.label=5;case 5:if(false){}a.label=6;case 6:return[3,8];case 7:i=a.sent();pe.info("calculateRingingExtensionList error",i);return[3,8];case 8:return[4,this._updateRingingExtensionList(e)];case 9:a.sent();return[2,e]}}))}))};this._sortRingingExtensionList=function(e,t){return s.SortUtils.compareString(e.lowercaseDisplayName,t.lowercaseDisplayName)}}RingingListController.prototype.start=function(){this._blfDBConfig.on(p.Bo.ENABLE_MONITOR_RINGING,this._debounceCalculateRingingExtensionList);s.notificationCenter.on(ue.ML.EXTENSION_IDS_CHANGED_BY_CONTACT,this._debounceHandleExtensionContactChange);this._blfDataController.subscribeBLFList(this._debounceCalculateRingingExtensionList);this._blfModule.subscribeGrantExtensionList(this._debounceCalculateRingingExtensionList)};RingingListController.prototype.stop=function(){this._blfDBConfig.off(p.Bo.ENABLE_MONITOR_RINGING,this._debounceCalculateRingingExtensionList);s.notificationCenter.off(ue.ML.EXTENSION_IDS_CHANGED_BY_CONTACT,this._debounceHandleExtensionContactChange);this._blfDataController.unsubscribeBLFList(this._debounceCalculateRingingExtensionList);this._blfModule.unsubscribeGrantExtensionList(this._debounceCalculateRingingExtensionList)};RingingListController.prototype.getRingingExtensionList=function(){var e;return de(this,void 0,Promise,(function(){var t,n;return he(this,(function(r){switch(r.label){case 0:t=[];return[4,this._getEnableMonitoringRing()];case 1:if(!r.sent())return[3,6];return[4,this._blfDBConfig.getRingingExtensionList()];case 2:if(!((e=r.sent())!==null&&e!==void 0))return[3,3];n=e;return[3,5];case 3:return[4,this._calculateRingingExtensionList()];case 4:n=r.sent();r.label=5;case 5:t=n;r.label=6;case 6:return[2,t]}}))}))};RingingListController.prototype._updateRingingListByCanPickUpData=function(e,t){return de(this,void 0,Promise,(function(){var n,r;return he(this,(function(o){switch(o.label){case 0:n=[];return[4,this._blfDBConfig.getRingingExtensionList()];case 1:r=o.sent();e.forEach((function(e){var o,i;var s=r===null||r===void 0?void 0:r.find((function(t){return t.id===e}));var a=t===null||t===void 0?void 0:t.find((function(t){return t.extension.id===e}));a&&n.push({id:a.extension.id,extensionNumber:a.extension.extensionNumber,enable:(o=s===null||s===void 0?void 0:s.enable)!==null&&o!==void 0?o:true,type:a.extension.type,lowercaseDisplayName:(i=s===null||s===void 0?void 0:s.lowercaseDisplayName)!==null&&i!==void 0?i:""})}));return[2,n]}}))}))};RingingListController.prototype._handleExtensionContactChange=function(e){return de(this,void 0,void 0,(function(){var t,n;var r=this;return he(this,(function(o){switch(o.label){case 0:pe.log("update when extension contact change");return[4,this.getRingingExtensionList()];case 1:t=o.sent();n=t.filter((function(t){return e.includes(t.id)}));if(n.length<=0)return[2];return[4,(0,i.runInPool)(n.map((function(e){return function(){return de(r,void 0,void 0,(function(){var t,n;var r;return he(this,(function(o){switch(o.label){case 0:return[4,this._getContactIdByExtensionId(e.id)];case 1:t=o.sent();if(!t)return[3,3];return[4,this._contactModule.getContactById(t)];case 2:n=o.sent();e.lowercaseDisplayName=(r=n===null||n===void 0?void 0:n.displayName)!==null&&r!==void 0?r:"";o.label=3;case 3:return[2]}}))}))}})))];case 2:o.sent();t.sort(this._sortRingingExtensionList);return[4,this._updateRingingExtensionList(t)];case 3:o.sent();return[2]}}))}))};RingingListController.prototype._fillRingingExtensionListName=function(e){return de(this,void 0,Promise,(function(){var t;var n=this;return he(this,(function(r){switch(r.label){case 0:t=[];return[4,(0,i.runInPool)(e.map((function(e){return function(){return de(n,void 0,void 0,(function(){var n,r,o;var i;return he(this,(function(s){switch(s.label){case 0:n=e.lowercaseDisplayName;if(!!e.lowercaseDisplayName)return[3,3];return[4,this._getContactIdByExtensionId(e.id)];case 1:r=s.sent();if(!r)return[3,3];return[4,this._contactModule.getContactById(r)];case 2:o=s.sent();n=(i=o===null||o===void 0?void 0:o.displayName)!==null&&i!==void 0?i:"";s.label=3;case 3:t.push(fe(fe({},e),{lowercaseDisplayName:n}));return[2]}}))}))}})))];case 1:r.sent();return[2,t.sort(this._sortRingingExtensionList)]}}))}))};Object.defineProperty(RingingListController.prototype,"_contactModule",{get:function(){return(0,s.getModule)(ce.MODULE_NAME)},enumerable:true,configurable:true});Object.defineProperty(RingingListController.prototype,"_extensionIdContactModule",{get:function(){return(0,s.getModule)(ue.DN)},enumerable:true,configurable:true});RingingListController.prototype._getContactIdByExtensionId=function(e){return de(this,void 0,Promise,(function(){var t;return he(this,(function(n){switch(n.label){case 0:t=this._extensionIdContactModule.getContactByExtensionIdFromCache(e);if(t){return[2,t.matchedUnifiedContactId]}return[4,this._contactModule.matchContactByExtensionId(e)];case 1:return[2,n.sent()]}}))}))};RingingListController.prototype._updateRingingExtensionList=function(e){return de(this,void 0,Promise,(function(){var t,n;return he(this,(function(r){switch(r.label){case 0:n=(t=o()).isEqual;return[4,this._blfDBConfig.getRingingExtensionList()];case 1:if(!!n.apply(t,[r.sent(),e]))return[3,3];return[4,this._blfDBConfig.setRingingExtensionList(e)];case 2:r.sent();r.label=3;case 3:s.notificationCenter.emit(p.FY.RC_BLF_SERVICE.SELECTIVE_RINGING_LIST,e.map((function(e){return e.id})));return[2]}}))}))};RingingListController.prototype.getRingingExtensionListIds=function(e){return de(this,void 0,Promise,(function(){var t;return he(this,(function(n){switch(n.label){case 0:return[4,this._getRingingExtensionListByTypes(e)];case 1:t=n.sent();return[2,t.map((function(e){return e.id}))]}}))}))};RingingListController.prototype.getRingingExtensionById=function(e){return de(this,void 0,Promise,(function(){var t,n;return he(this,(function(r){switch(r.label){case 0:return[4,this.getRingingExtensionList()];case 1:t=r.sent();n=t.find((function(t){return t.id===e}));return[2,n!==null&&n!==void 0?n:null]}}))}))};RingingListController.prototype.getRingingExtensionListByIds=function(e){return de(this,void 0,Promise,(function(){var t;return he(this,(function(n){switch(n.label){case 0:return[4,this.getRingingExtensionList()];case 1:t=n.sent();return[2,t.filter((function(t){return e.includes(t.id)}))]}}))}))};RingingListController.prototype.updateRingingExtension=function(e,t){return de(this,void 0,Promise,(function(){var n,r,i,a;return he(this,(function(l){switch(l.label){case 0:i=(r=o()).cloneDeep;return[4,this.getRingingExtensionList()];case 1:n=i.apply(r,[l.sent()]);a=n.find((function(t){return t.id===e}));if(a){a.enable=t}return[4,this._updateRingingExtensionList(n)];case 2:l.sent();a&&s.notificationCenter.emitEntityUpdate(p.FY.ENTITY.RINGING_EXTENSION,[a]);pe.log("update ringing extension level, id, enable => ",e,t);return[2]}}))}))};RingingListController.prototype.getUsingLevelSettingState=function(e){return de(this,void 0,Promise,(function(){var t,n;return he(this,(function(r){switch(r.label){case 0:return[4,this._getRingingExtensionListByTypes(e)];case 1:t=r.sent();n=t.filter((function(e){return e.enable})).length;return[2,n>0&&n<t.length]}}))}))};RingingListController.prototype._getRingingExtensionListByTypes=function(e){return de(this,void 0,Promise,(function(){var t;return he(this,(function(n){switch(n.label){case 0:t=[];if(!e)return[3,2];return[4,this.getRingingExtensionList()];case 1:t=n.sent().filter((function(t){return(t===null||t===void 0?void 0:t.type)&&e.includes(t.type)}));return[3,4];case 2:return[4,this.getRingingExtensionList()];case 3:t=n.sent();n.label=4;case 4:return[2,t]}}))}))};RingingListController.prototype._getEnableMonitoringRing=function(){var e;return(e=this._blfDBConfig.getEnableMonitorRinging())!==null&&e!==void 0?e:true};Object.defineProperty(RingingListController.prototype,"_blfModule",{get:function(){return(0,s.getModule)(p.pL)},enumerable:true,configurable:true});return RingingListController}();var _e=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ve=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var be=h.k.tags("[MonitorRingingSettingController]");var ye=function(){function MonitorRingingSettingController(e){var t=this;this._dbConfig=e;this._updateMonitorRingingQueue=new i.AsyncQueue;this._updateMonitorRinging=function(){return t._updateMonitorRingingQueue.execute((function(){return _e(t,void 0,Promise,(function(){var e,t;var n;return ve(this,(function(r){switch(r.label){case 0:e=this._rcInfoModule.getLastRCPresence();t=(n=e===null||e===void 0?void 0:e.ringOnMonitoredCall)!==null&&n!==void 0?n:true;return[4,this._getRawEnableMonitoringRing()];case 1:if(!(r.sent()!==t))return[3,3];return[4,this._dbConfig.setEnableMonitorRinging(t)];case 2:r.sent();be.log("update EnableMonitorRinging in user config, ringOnMonitorCall =>",t);r.label=3;case 3:return[2]}}))}))}))}}MonitorRingingSettingController.prototype.start=function(){this._updateMonitorRinging();s.notificationCenter.on(U.FY.RC_INFO.RC_PRESENCE,this._updateMonitorRinging)};MonitorRingingSettingController.prototype.stop=function(){s.notificationCenter.off(U.FY.RC_INFO.RC_PRESENCE,this._updateMonitorRinging)};Object.defineProperty(MonitorRingingSettingController.prototype,"enableMonitorListTaskQueue",{get:function(){if(!this._enableMonitorListHandler){this._enableMonitorListHandler=new s.SequenceProcessorHandler({name:"enableMonitorListTaskQueue",addProcessorStrategy:function(e,t){if(e.length){e.forEach((function(e){var t;return(t=e===null||e===void 0?void 0:e.cancel)===null||t===void 0?void 0:t.call(e)}))}return[t]}})}return this._enableMonitorListHandler},enumerable:true,configurable:true});MonitorRingingSettingController.prototype.addEnableInQueue=function(e){var t=this;return new Promise((function(n,r){var sendEnableMonitor=function(e){return _e(t,void 0,void 0,(function(){return ve(this,(function(t){switch(t.label){case 0:return[4,this.setEnableMonitoringRing(e)];case 1:t.sent();return[2]}}))}))};var o=new(function(){function class_1(){}class_1.prototype.process=function(){return _e(this,void 0,void 0,(function(){var t,o;return ve(this,(function(i){switch(i.label){case 0:i.trys.push([0,2,,3]);return[4,sendEnableMonitor(e)];case 1:t=i.sent();n(t);return[2,true];case 2:o=i.sent();r(o);return[2,false];case 3:return[2]}}))}))};class_1.prototype.name=function(){return Date.now().toString()};return class_1}());t.enableMonitorListTaskQueue.addProcessor(o)}))};MonitorRingingSettingController.prototype.setEnableMonitoringRing=function(e){return _e(this,void 0,Promise,(function(){var t;return ve(this,(function(n){switch(n.label){case 0:t=e;return[4,this._getRawEnableMonitoringRing()];case 1:if(t===n.sent()){return[2]}return[4,this._rcInfoModule.setUserPresence({ringOnMonitoredCall:e})];case 2:n.sent();return[4,this._dbConfig.setEnableMonitorRinging(e)];case 3:n.sent();be.log("update EnableMonitorRinging in api, ringOnMonitorCall =>",e);return[2]}}))}))};MonitorRingingSettingController.prototype.getEnableMonitoringRing=function(){var e;return _e(this,void 0,Promise,(function(){return ve(this,(function(t){switch(t.label){case 0:return[4,this._getRawEnableMonitoringRing()];case 1:return[2,(e=t.sent())!==null&&e!==void 0?e:true]}}))}))};MonitorRingingSettingController.prototype.hasMonitoringRingSynced=function(){return _e(this,void 0,Promise,(function(){return ve(this,(function(e){switch(e.label){case 0:return[4,this._getRawEnableMonitoringRing()];case 1:return[2,e.sent()!==undefined]}}))}))};MonitorRingingSettingController.prototype._getRawEnableMonitoringRing=function(){return this._dbConfig.getEnableMonitorRinging()};Object.defineProperty(MonitorRingingSettingController.prototype,"_rcInfoModule",{get:function(){return(0,s.getModule)(U.oF)},enumerable:true,configurable:true});return MonitorRingingSettingController}();var Ce=n(98690);var Ee=n(360758);var Le=n(968006);var xe=undefined&&undefined.__assign||function(){xe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return xe.apply(this,arguments)};var Ie=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var me=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var De=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],s;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(s)throw s.error}}return i};var Re=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(De(arguments[t]));return e};var Fe=h.k.tags("[BLFExtensionCallController]");var Se=function(){function BLFExtensionCallController(e,t,n){var r=this;this._ringingListController=e;this._blfDataController=t;this._delegationAssignmentDataFetchController=n;this._hasSubscribed=false;this._ringingCallMap=new Map;this._updateSubscribeOnMonitorEntity=function(){return Ie(r,void 0,void 0,(function(){var e,t,n;var r;return me(this,(function(o){switch(o.label){case 0:return[4,this._getEnabledRingingExtensionList()];case 1:e=o.sent().size;t=this._hasSubscribed&&!e&&((r=this._telephonyModule)===null||r===void 0?void 0:r.getAllCallCount())===0;if(t){Fe.info("unsubscribe monitor call change");this._unsubscribeBLFEntity()}n=!this._hasSubscribed&&e;if(n){Fe.info("subscribe monitor call change");this._blfDataController.subscribeBLFEntity(this._handleHUDExtensionUpdate);this._hasSubscribed=true}return[2]}}))}))};this._handleHUDExtensionUpdate=function(e){return Ie(r,void 0,void 0,(function(){var t,n,r;return me(this,(function(i){switch(i.label){case 0:t=e.filter((function(e){return e.extension.type&&p.GM.includes(e.extension.type)}));this._trackGCPIncomingCallEvent(t,o().cloneDeep(this._ringingCallMap));this._handleNotificationMissedRingingCalls(t);r=t.length;if(!r)return[3,2];return[4,this._filterShouldEmitEntities(t)];case 1:r=i.sent();i.label=2;case 2:n=r||[];if(n.length){Fe.info("_handleHUDExtensionUpdate, emit new BLF call",{ringingCallInfos:n});s.notificationCenter.emit(Ee.FY.RC_NOTIFICATION_INCOMING_CALL,n);this._debounceUpdateSubscribeOnMonitorEntity()}return[2]}}))}))};this._debounceUpdateSubscribeOnMonitorEntity=o().debounce((function(){return r._updateSubscribeOnMonitorEntity()}),u.lo.FIVE_SECOND)}BLFExtensionCallController.prototype.start=function(){s.notificationCenter.on(p.FY.RC_BLF_SERVICE.SELECTIVE_RINGING_LIST,this._updateSubscribeOnMonitorEntity);s.notificationCenter.on(p.FY.ENTITY.RINGING_EXTENSION,this._updateSubscribeOnMonitorEntity);this._updateSubscribeOnMonitorEntity()};BLFExtensionCallController.prototype.stop=function(){s.notificationCenter.off(p.FY.RC_BLF_SERVICE.SELECTIVE_RINGING_LIST,this._updateSubscribeOnMonitorEntity);s.notificationCenter.off(p.FY.ENTITY.RINGING_EXTENSION,this._updateSubscribeOnMonitorEntity);this._unsubscribeBLFEntity()};BLFExtensionCallController.prototype._unsubscribeBLFEntity=function(){this._blfDataController.unsubscribeBLFEntity(this._handleHUDExtensionUpdate);this._hasSubscribed=false};BLFExtensionCallController.prototype._handleNotificationMissedRingingCalls=function(e){var t=this;e.forEach((function(e){var n=t._ringingCallMap.get(e.id);if(!(n===null||n===void 0?void 0:n.length)){return}var r=n.filter((function(t){var n;return!((n=e.callInfos)===null||n===void 0?void 0:n.some((function(e){return e.id===t.id})))})).map((function(e){return xe(xe({},e),{telephonyStatus:l.TELEPHONY_STATUS.NoCall})}));if(r.length){s.notificationCenter.emit(Ee.FY.RC_NOTIFICATION_INCOMING_CALL,r)}t._ringingCallMap.delete(e.id)}))};BLFExtensionCallController.prototype._filterShouldEmitEntities=function(e){var t;return Ie(this,void 0,void 0,(function(){var n,r;var o=this;return me(this,(function(i){switch(i.label){case 0:return[4,this._delegationAssignmentDataFetchController.getDelegationAssignmentList()];case 1:n=(t=i.sent())===null||t===void 0?void 0:t.map((function(e){return e.extension.id.toString()}));r=[];return[4,Promise.all(e.map((function(e){return Ie(o,void 0,void 0,(function(){var t,o;var i=this;var s;return me(this,(function(a){switch(a.label){case 0:if(!((s=e.callInfos)===null||s===void 0?void 0:s.length))return[3,2];return[4,Promise.all(e.callInfos.map((function(t){return Ie(i,void 0,void 0,(function(){return me(this,(function(n){switch(n.label){case 0:return[4,this._shouldEmitCall(e.id,t)];case 1:return[2,n.sent()]}}))}))})))];case 1:t=a.sent();o=e.callInfos.filter((function(e,n){return t[n]})).map((function(t){return xe(xe({},t),{sourceExtension:e.id,isDelegatorCall:n===null||n===void 0?void 0:n.includes(e.id)})}));o.length&&r.push.apply(r,Re(o));a.label=2;case 2:return[2]}}))}))})))];case 2:i.sent();return[2,r]}}))}))};BLFExtensionCallController.prototype._isFromOrToConference=function(e){var t;return Ie(this,void 0,void 0,(function(){var n;return me(this,(function(r){switch(r.label){case 0:return[4,this._rcInfoModule.getRCConferenceLocally()];case 1:n=(t=r.sent())===null||t===void 0?void 0:t.phoneNumbers.some((function(t){return t.phoneNumber===(e===null||e===void 0?void 0:e.from)||t.phoneNumber===(e===null||e===void 0?void 0:e.to)}));n&&Fe.log("should not emit call to/from conference number",e);return[2,n]}}))}))};BLFExtensionCallController.prototype._shouldEmitCall=function(e,t){return Ie(this,void 0,void 0,(function(){var n,r,o,i,s;return me(this,(function(a){switch(a.label){case 0:return[4,this._isInboundNonCurrentUserCall(t)];case 1:n=a.sent();return[4,this._getEnabledRingingExtensionList()];case 2:r=a.sent().has(e);o=t.telephonyStatus===l.TELEPHONY_STATUS.Ringing;if(n&&o){i=this._ringingCallMap.get(e);if(i){i.push(t)}else{this._ringingCallMap.set(e,[t])}}s=t.sipData&&n&&(o&&r||!o);if(!s)return[3,4];return[4,this._isFromOrToConference(t)];case 3:s=!a.sent();a.label=4;case 4:return[2,s]}}))}))};BLFExtensionCallController.prototype._trackGCPIncomingCallEvent=function(e,t){var n=this;return Promise.all(e.map((function(e){return Ie(n,void 0,void 0,(function(){var n;var r=this;var o;return me(this,(function(i){switch(i.label){case 0:n=e.extension.type===l.RC_EXTENSION_TYPES.GROUP_CALL_PICKUP?p.E.GROUP_CALL_PICKUP:e.extension.type===l.RC_EXTENSION_TYPES.DEPARTMENT?p.E.QUEUE_CALL_PICKUP:undefined;if(!n||!((o=e.callInfos)===null||o===void 0?void 0:o.length)){return[2]}return[4,Promise.all(e.callInfos.map((function(o){return Ie(r,void 0,void 0,(function(){var r,i;var s;return me(this,(function(a){switch(a.label){case 0:r=(s=t.get(e.id))===null||s===void 0?void 0:s.some((function(e){return e.id===o.id}));i=o.telephonyStatus===l.TELEPHONY_STATUS.Ringing&&!r;if(!i)return[3,2];return[4,this._isInboundNonCurrentUserCall(o)];case 1:i=a.sent();a.label=2;case 2:if(i){Le.s6.track(p.PT.HUD_INCOMING_CALL,{callType:n})}return[2]}}))}))})))];case 1:i.sent();return[2]}}))}))})))};BLFExtensionCallController.prototype._isInboundNonCurrentUserCall=function(e){return Ie(this,void 0,void 0,(function(){var t;return me(this,(function(n){switch(n.label){case 0:t=e.direction===l.CALL_DIRECTION.INBOUND;if(!t)return[3,2];return[4,Ee.tV.isCurrentUserCall(e)];case 1:t=!n.sent();n.label=2;case 2:return[2,t]}}))}))};BLFExtensionCallController.prototype._getEnabledRingingExtensionList=function(){return Ie(this,void 0,void 0,(function(){var e;return me(this,(function(t){switch(t.label){case 0:return[4,this._ringingListController.getRingingExtensionList()];case 1:e=t.sent();return[2,this._convertToRingingExtensionSet(e)]}}))}))};BLFExtensionCallController.prototype._convertToRingingExtensionSet=function(e){return new Set(e.filter((function(e){return e===null||e===void 0?void 0:e.enable})).map((function(e){return e.id})))};Object.defineProperty(BLFExtensionCallController.prototype,"_telephonyModule",{get:function(){return(0,s.getModule)(Ee.oF)},enumerable:true,configurable:true});Object.defineProperty(BLFExtensionCallController.prototype,"_rcInfoModule",{get:function(){return(0,s.getModule)(U.oF)},enumerable:true,configurable:true});return BLFExtensionCallController}()},61165:(e,t,n)=>{n.d(t,{k:()=>a});var r=n(862926);var o=n.n(r);var i=n(827027);var s="[RC_BLF_MODULE][CORE]";var a=r.ModuleLogger.getLogger(s,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),i.PHONE_EVENT_DATA_FEATURE_KEY)},601999:(e,t,n)=>{n.d(t,{D:()=>h});var r=n(696206);var o=n(90704);var i=n(671760);var s=n(4875);var a=n(211951);var l=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var u=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var c=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var f=function(e){l(MonitorRingingSettingItemProvider,e);function MonitorRingingSettingItemProvider(t){var n=e.call(this,{id:s.W.Monitor_Ringing})||this;n._rcBLFService=t;n._handleEnableHUDUpdate=function(){n.getStateProvider().notifyChange();n.getValueProvider().notifyChange()};return n}MonitorRingingSettingItemProvider.prototype.buildValueProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return u(e,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._rcBLFService.monitorRingingSettingController.getEnableMonitoringRing()];case 1:return[2,e.sent()]}}))}))},setter:function(t){return u(e,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,this._rcBLFService.monitorRingingSettingController.addEnableInQueue(t)];case 1:e.sent();return[2]}}))}))}})};MonitorRingingSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return u(e,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this._rcBLFService.monitorRingingSettingController.hasMonitoringRingSynced()];case 1:e=t.sent();if(!e)return[3,3];return[4,i.Bo.getEnableHUD()];case 2:e=t.sent();t.label=3;case 3:return[2,e?r.ESettingItemState.ENABLE:r.ESettingItemState.INVISIBLE]}}))}))}})};MonitorRingingSettingItemProvider.prototype.onLoad=function(){var e=this;this.addSubscription((function(){e.BLFUserConfig.on(a.Bo.ENABLE_MONITOR_RINGING,e._handleEnableHUDUpdate);i.Bo.on(i.Bo.generateStoreKey(i.vD.ENABLE_HUD),e._handleEnableHUDUpdate);return function(){e.BLFUserConfig.off(a.Bo.ENABLE_MONITOR_RINGING,e._handleEnableHUDUpdate);i.Bo.off(i.Bo.generateStoreKey(i.vD.ENABLE_HUD),e._handleEnableHUDUpdate)}}))};Object.defineProperty(MonitorRingingSettingItemProvider.prototype,"BLFUserConfig",{get:function(){return this._rcBLFService.dbConfig},enumerable:true,configurable:true});return MonitorRingingSettingItemProvider}(r.BaseSettingItemProvider);var d=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var h=function(e){d(RCBLFSettingManager,e);function RCBLFSettingManager(t){var n=e.call(this)||this;n._rcBLFService=t;return n}RCBLFSettingManager.prototype.getProviderMap=function(){var e;if(!this.rcHUDSettingProvider){this.rcHUDSettingProvider=(e={},e[s.W.Enable_HUD]=new o.W,e[s.W.Monitor_Ringing]=new f(this._rcBLFService),e)}return this.rcHUDSettingProvider};return RCBLFSettingManager}(r.AbstractModuleSettingProviderManager)},90704:(e,t,n)=>{n.d(t,{W:()=>f});var r=n(963786);var o=n(696206);var i=n(671760);var s=n(4875);var a=n(211951);var l=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var u=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var c=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var f=function(e){l(EnableHUDSettingItemProvider,e);function EnableHUDSettingItemProvider(){var t=e.call(this,{id:s.W.Enable_HUD})||this;t._handleSettingUpdate=function(){t.getValueProvider().notifyChange();t.getStateProvider().notifyChange()};return t}EnableHUDSettingItemProvider.prototype.buildValueProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return u(e,void 0,void 0,(function(){return c(this,(function(e){return[2,i.Bo.getEnableHUD()]}))}))},setter:function(t){return u(e,void 0,void 0,(function(){return c(this,(function(e){return[2,i.Bo.setEnableHUD(t)]}))}))}})};EnableHUDSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return u(e,void 0,void 0,(function(){return c(this,(function(e){return[2,this._getEnableHUDSettingState()]}))}))}})};EnableHUDSettingItemProvider.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this);a.E8.forEach((function(e){t.onEntitlement(e,t._handleSettingUpdate)}))};EnableHUDSettingItemProvider.prototype._getEnableHUDSettingState=function(){var e=(0,r.x6)().context.entitlement.isAllEnable(a.E8);return e?o.ESettingItemState.ENABLE:o.ESettingItemState.INVISIBLE};return EnableHUDSettingItemProvider}(o.BaseSettingItemProvider)},547659:(e,t,n)=>{n.d(t,{I:()=>r});var r;(function(e){e[e["NONE"]=0]="NONE";e[e["DELEGATED"]=1]="DELEGATED";e[e["DELEGATOR"]=2]="DELEGATOR"})(r||(r={}))},360758:(e,t,n)=>{n.d(t,{MI:()=>r.MI,FY:()=>i.FY,oF:()=>i.oF,K5:()=>i.K5,VM:()=>i.VM,q$:()=>s.q$,Gh:()=>s.Gh,HI:()=>s.HI,Jn:()=>s.Jn,WL:()=>s.WL,tP:()=>s.tP,hr:()=>a.hr,O0:()=>a.O0,tV:()=>l.t,UV:()=>c.RTC_REPLY_MSG_PATTERN,mo:()=>c.RTC_REPLY_MSG_TIME_UNIT});var r=n(446875);var o=n(649002);var i=n(147877);var s=n(266800);var a=n(439126);var l=n(226417);var u=n(306587);var c=n(343398)}}]);