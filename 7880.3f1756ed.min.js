(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[7880],{231820:(e,t,n)=>{"use strict";n.d(t,{S9:()=>r.S9,oF:()=>r.oF,zD:()=>i.z,Hr:()=>a.H,MO:()=>o.M,HU:()=>r.HU,ZE:()=>r.ZE,KP:()=>sensitiveMeetingEntity});var r=n(812490);var i=n(403301);var o=n(138171);var a=n(260666);var s=n(862926);function sensitiveMeetingEntity(e){return(0,s.sanitize)(e,{$exclude:["password","calendar_url"],$deep:{start_url:{$queryFilter:["pw","code"]},join_url:{$queryFilter:["pw","code"]}}})}var l=n(215285)},376271:(e,t,n)=>{"use strict";n.d(t,{m:()=>v});var r=n(298784);var i=n.n(r);var o=n(696206);var a=n(260666);var s=n(461197);var l=n(370040);var u=n(960782);var c=n(204285);var d=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var f=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var p=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var h={ON:"On"};var _="[DirectShare SettingItem]";var v=function(e){d(DirectShareSettingItemProvider,e);function DirectShareSettingItemProvider(t){var n=e.call(this,{id:t})||this;n._logger=l.k.tags(_).tags("["+t+"]");n._initSettingFlagLogFlag=true;return n}DirectShareSettingItemProvider.prototype.buildValueProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return e._getValue()},setter:function(t){return e._setValue(t)}})};DirectShareSettingItemProvider.prototype._getInitialValue=function(){return f(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this._getDeprecatedSettingValue()];case 1:e=t.sent();this._logger.info("deprecatedSettingValue: ",e);return[2,e===h.ON]}}))}))};DirectShareSettingItemProvider.prototype._getDeprecatedSettingValue=function(){return f(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this._getProfileValueByKey(c.PROFILE_SETTING_KEYS.SHOW_DIRECT_SHARE_BUTTON)]}))}))};DirectShareSettingItemProvider.prototype._getProfileValueByKey=function(e){var t;return f(this,void 0,void 0,(function(){var n,r;return p(this,(function(i){switch(i.label){case 0:return[4,this._getProfileSettingAction()];case 1:return[4,(t=i.sent())===null||t===void 0?void 0:t.get([e])];case 2:r=i.sent();if(r===null||r===void 0?void 0:r.length){n=r[0]}return[2,n]}}))}))};DirectShareSettingItemProvider.prototype._getProfileSettingAction=function(){var e,t;return(t=(e=this._getKeyActionService())===null||e===void 0?void 0:e.get(u.ACTION_KEY.PROFILE_SETTINGS))===null||t===void 0?void 0:t.getAction()};DirectShareSettingItemProvider.prototype._getKeyActionService=function(){var e;return(e=(0,s.getModule)(u.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService()};DirectShareSettingItemProvider.prototype.onLoad=function(){var e=this;var handleUpdate=function(){e.getStateProvider().notifyChange();e.getValueProvider().notifyChange()};this.onSettingUpdate(a.H.Video_Service,handleUpdate);var profileSettingObserverDisposer=function(){};var observeProfileSettingChange=function(){var t;profileSettingObserverDisposer();(t=e._getProfileSettingAction())===null||t===void 0?void 0:t.then((function(t){var n=t.observe;profileSettingObserverDisposer=n(e._profileSettingKey,handleUpdate)}))};observeProfileSettingChange();var t=this._getKeyActionService();if(t){t.on(u.ACTION_KEY.PROFILE_SETTINGS,(function(){return f(e,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:observeProfileSettingChange();handleUpdate();if(!this._initSettingFlagLogFlag)return[3,2];this._initSettingFlagLogFlag=false;return[4,this._getValue()];case 1:e=t.sent();this._trackInitialState(e);t.label=2;case 2:return[2]}}))}))}))}};DirectShareSettingItemProvider.prototype._getValue=function(){return f(this,void 0,void 0,(function(){var e,t,n;return p(this,(function(i){switch(i.label){case 0:return[4,this._getProfileValueByKey(this._profileSettingKey)];case 1:e=i.sent();return[4,this._getInitialValue()];case 2:t=i.sent();this._logger.log("profile value: ",e,"initial value: ",t);if(!(0,r.isUndefined)(e))return[3,4];return[4,this._getValueOverride(t)];case 3:n=i.sent();return[2,Promise.resolve(n)];case 4:return[2,Promise.resolve(!!e)]}}))}))};DirectShareSettingItemProvider.prototype._setValue=function(e){var t;return f(this,void 0,void 0,(function(){var n;return p(this,(function(r){switch(r.label){case 0:n=this._trackDirectShareSettingValue;return[4,this._getValue()];case 1:n.apply(this,[r.sent(),e]);return[4,this._getProfileSettingAction()];case 2:return[4,(t=r.sent())===null||t===void 0?void 0:t.set([{key:this._profileSettingKey,value:e}])];case 3:r.sent();return[2]}}))}))};DirectShareSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return f(e,void 0,void 0,(function(){return p(this,(function(e){return[2,this._getState()]}))}))}})};return DirectShareSettingItemProvider}(o.BaseSettingItemProvider)},721974:(e,t,n)=>{"use strict";n.d(t,{H:()=>r.H});var r=n(260666)},403301:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var r=function(){function MeetCounter(){this._startMeetCount=0;this._joinMeetCount=0;this._startMeetFailCount=0;this._joinMeetFailCount=0}MeetCounter.prototype.increaseStartMeetCount=function(){this._startMeetCount++};MeetCounter.prototype.getStartMeetCount=function(){return this._startMeetCount};MeetCounter.prototype.increaseJoinMeetCount=function(){this._joinMeetCount++};MeetCounter.prototype.getJoinMeetCount=function(){return this._joinMeetCount};MeetCounter.prototype.increaseStartMeetFailCount=function(){this._startMeetFailCount++};MeetCounter.prototype.getStartMeetFailCount=function(){return this._startMeetFailCount};MeetCounter.prototype.increaseJoinMeetFailCount=function(){this._joinMeetFailCount++};MeetCounter.prototype.getJoinMeetFailCount=function(){return this._joinMeetFailCount};return MeetCounter}()},138171:(e,t,n)=>{"use strict";n.d(t,{M:()=>r});var r=function(){function MeetingUtils(){}MeetingUtils.getTime=function(){return Date.now().toString()};return MeetingUtils}()},902114:(e,t,n)=>{"use strict";n.d(t,{gv:()=>r.g,Xv:()=>a.Xv,VQ:()=>a.VQ});var r=n(470437);var i=n(419088);var o=n(715213);var a=n(358198)},495979:(e,t,n)=>{"use strict";n.d(t,{oF:()=>i,FY:()=>o,cw:()=>l,Ps:()=>u,nx:()=>d,J0:()=>f,FL:()=>p,aZ:()=>h});var r=n(295454);var i=r.Lb.RCV_SWITCHOVER;var o={MEET_SWITCH:"MEET_SWITCH",HAS_ACTIVE_RCV:"HAS_ACTIVE_RCV"};var a={FETCH_RCV_DELEGATE_USER_LIST:"MEET.FETCH_RCV_DELEGATE_USER_LIST",FETCH_RCV_DEFAULT_BRIDGES:"MEET.FETCH_RCV_DEFAULT_BRIDGES",FETCH_RCV_PREFERENCE:"MEET.FETCH_RCV_PREFERENCE"};var s=107;var l="mas";var u=30*1e3;var c="QUERY_RCV_MEET";var d=10*1e3;var f=2*60*1e3;var p=30*60*1e3;var h=960*1e3},218932:(e,t,n)=>{"use strict";n.d(t,{oF:()=>r.oF,RCV_AUDIO_STATUS:()=>o.E});var r=n(495979);var i=n(120085);if(n.o(i,"RCV_AUDIO_STATUS"))n.d(t,{RCV_AUDIO_STATUS:function(){return i.RCV_AUDIO_STATUS}});var o=n(71796)},43551:()=>{},684967:()=>{},120085:(e,t,n)=>{"use strict";var r=n(684967);var i=n.n(r);if(n.o(r,"IRCVSwitchOverDelegate"))n.d(t,{IRCVSwitchOverDelegate:function(){return r.IRCVSwitchOverDelegate}});if(n.o(r,"RCV_AUDIO_STATUS"))n.d(t,{RCV_AUDIO_STATUS:function(){return r.RCV_AUDIO_STATUS}});var o=n(43551);var a=n.n(o);if(n.o(o,"IRCVSwitchOverDelegate"))n.d(t,{IRCVSwitchOverDelegate:function(){return o.IRCVSwitchOverDelegate}});if(n.o(o,"RCV_AUDIO_STATUS"))n.d(t,{RCV_AUDIO_STATUS:function(){return o.RCV_AUDIO_STATUS}})},71796:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});var r;(function(e){e[e["NONE"]=0]="NONE";e[e["INTERNET_AUDIO"]=1]="INTERNET_AUDIO";e[e["CELL_PHONE"]=2]="CELL_PHONE";e[e["DONT_JOIN_AUDIO"]=3]="DONT_JOIN_AUDIO"})(r||(r={}))},537880:(e,t,n)=>{"use strict";n.r(t);n.d(t,{RCVEModule:()=>N});var r=n(667489);var i=n(587040);var o=n(882756);var a=n(34670);var s=n(522178);var l=n(686221);var u=n(521924);var c=n(35306);var d=n(298784);var f=n(913161);var p=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var h=function(e){p(RCVEResponseParser,e);function RCVEResponseParser(){var t=e!==null&&e.apply(this,arguments)||this;t.name="CommonResponseParser";return t}RCVEResponseParser.prototype.parse=function(t){var n=(0,d.get)(t,"data.error.code");var r=(0,d.get)(t,"data.error.message");var i;switch(n){case u.FL:{i=new f.TJ("this meeting has not started yet");break}case u.n$:{i=new f.o$("password is invalid");break}case u.nU:{i=new f.oc("this is a meeting with waiting room");break}case u.wG:{i=new f.bd("you don't have permission to join this waiting room");break}case u.xY:{return new f.wU(r||"the meeting is not existed.")}case u.vK:{i=new f.sv("the meeting is locked");break}default:{if(u.E$[n]){return new u.E$[n](r,(0,d.get)(t,"data"))}break}}if(i)return i;return e.prototype.parse.call(this,t)};return RCVEResponseParser}(c.I);var _=n(469882);var v={CALL_RECORDS:"CALL_RECORDS",LAST_CALL_RECORD:"LAST_CALL_RECORD",REMEMBER_NUMBER:"REMEMBER_NUMBER",DEFAULT_COUNTRY:"DEFAULT_COUNTRY"};var g=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var y=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var m=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var S=function(e){g(RCVEUserConfig,e);function RCVEUserConfig(t){return e.call(this,o.el,t)||this}RCVEUserConfig.prototype.get=function(e,t){if(t===void 0){t=false}var n;return y(this,void 0,void 0,(function(){var r;return m(this,(function(i){switch(i.label){case 0:return[4,this._configService.get(o.el,e,t)];case 1:if(!((n=i.sent())!==null&&n!==void 0))return[3,2];r=n;return[3,4];case 2:return[4,this._configService.get("rcve",e,t)];case 3:r=i.sent();i.label=4;case 4:return[2,r]}}))}))};RCVEUserConfig.prototype._withPrefix=function(e,t){return e+"."+t};RCVEUserConfig.prototype.getCallRecords=function(e){return this.get(this._withPrefix(e,v.CALL_RECORDS))};RCVEUserConfig.prototype.setCallRecords=function(e,t){return this.put(this._withPrefix(e,v.CALL_RECORDS),t)};RCVEUserConfig.prototype.getLastCallRecord=function(e){return this.get(this._withPrefix(e,v.LAST_CALL_RECORD))};RCVEUserConfig.prototype.setLastCallRecord=function(e,t){return this.put(this._withPrefix(e,v.LAST_CALL_RECORD),t)};RCVEUserConfig.prototype.getRememberNumber=function(e){return this.get(this._withPrefix(e,v.REMEMBER_NUMBER))};RCVEUserConfig.prototype.setRememberNumber=function(e,t){return this.put(this._withPrefix(e,v.REMEMBER_NUMBER),t)};RCVEUserConfig.prototype.getDefaultCountry=function(e){return this.get(this._withPrefix(e,v.DEFAULT_COUNTRY))};RCVEUserConfig.prototype.setDefaultCountry=function(e,t){return this.put(this._withPrefix(e,v.DEFAULT_COUNTRY),t)};return RCVEUserConfig}(_.DBConfig);var gen=function(e,t,n){if(e===void 0){e="id"}if(t===void 0){t=[]}return{unique:e,indices:t,onUpgrade:n}};var C={name:"RCVE",version:1,schema:{1:{userConfigs:gen("key")}}};const E=C;var b=n(313242);var I=n(379269);var M=n(922742);var R=n(81787);var T=n(902114);var O=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var A=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var P=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var N=function(e){O(RCVEModule,e);function RCVEModule(t){var n=e.call(this,t)||this;n._handleRCLogin=function(e){return A(n,void 0,void 0,(function(){var t,n,i,o;var s,l,u,c,d;return P(this,(function(f){switch(f.label){case 0:if(!e.success)return[3,5];return[4,this._userConfig.getDefaultCountry(b.rf.CallMe)];case 1:t=f.sent();return[4,this._userConfig.getDefaultCountry(b.rf.CallOut)];case 2:n=f.sent();if(!(!t||!n))return[3,4];return[4,(0,r.getModule)(I.oF).getRCAccountInfo()];case 3:i=f.sent();if(!((l=(s=i===null||i===void 0?void 0:i.regionalSettings)===null||s===void 0?void 0:s.homeCountry)===null||l===void 0?void 0:l.id)){M.k.log("No home contry found. skip set default country");return[2]}o=(u=R.find((function(e){var t,n;return e.id===((n=(t=i===null||i===void 0?void 0:i.regionalSettings)===null||t===void 0?void 0:t.homeCountry)===null||n===void 0?void 0:n.id)})))===null||u===void 0?void 0:u.isoCode;if(!o){M.k.log("isoCode for id "+((d=(c=i===null||i===void 0?void 0:i.regionalSettings)===null||c===void 0?void 0:c.homeCountry)===null||d===void 0?void 0:d.id)+" not found. skip set default country");return[2]}!t&&this._userConfig.setDefaultCountry(b.rf.CallMe,o);!n&&this._userConfig.setDefaultCountry(b.rf.CallOut,o);f.label=4;case 4:T.gv.setNetworkClient(a.RCVEApi.networkClient);f.label=5;case 5:return[2]}}))}))};return n}RCVEModule.prototype.getSchema=function(){return E};RCVEModule.prototype.getMeetingService=function(){if(!this._meetingService){this._meetingService=new s.J(this._userConfig)}return this._meetingService};RCVEModule.prototype.onLoad=function(){var e;this._setupNetworkClient();this.getSettingManager().load();(e=(0,i.gT)())===null||e===void 0?void 0:e.onLoginResult(this._handleRCLogin);this._userConfig=new S(this.getDaoManager().getDBConfigService())};RCVEModule.prototype.onUnload=function(){this.getSettingManager().unload()};RCVEModule.prototype.moduleName=function(){return o.el};RCVEModule.prototype._setupNetworkClient=function(){var e=(0,i.gT)();if(e){var t=e.getNetworkHandlerConfig(i.vm.RCV);if(t){var n={server:""+r.apiConfiguration.getConfig()["rcv"].server};var o=new r.ResponseParser;o.register(new h);a.RCVEApi.networkClient=e.buildNetworkClient(n,t,o)}}};RCVEModule.prototype.getSettingManager=function(){if(!this._settingManager){this._settingManager=new l.V(this._context)}return this._settingManager};return RCVEModule}(r.AbstractModule)},61190:(e,t,n)=>{"use strict";n.d(t,{y:()=>l});var r=n(862926);var i=n.n(r);var o=n(521924);var a=undefined&&undefined.__assign||function(){a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return a.apply(this,arguments)};var s=undefined&&undefined.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var l=function(){function RCVEApi(){}RCVEApi.createBridge=function(e){var t={data:e,authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(""+o.yF.API_BRIDGES)};return this._executeRequest(t)};RCVEApi.getBridge=function(e){var t={params:e,authFree:false,method:r.NETWORK_METHOD.GET,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(""+o.yF.API_BRIDGES)};return this._executeRequest(t)};RCVEApi.createMeeting=function(e){var t={data:e,authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings",e.bridgeId?e.bridgeId:"")};return this._executeRequest(t)};RCVEApi.getMeeting=function(e,t){var n={authFree:false,method:r.NETWORK_METHOD.GET,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK,e,t)};return this._executeRequest(n)};RCVEApi.updateMeeting=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.PATCH,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"")};return this._executeRequest(n)};RCVEApi.endMeeting=function(e){var t={data:{},authFree:false,method:r.NETWORK_METHOD.DELETE,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK,e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"")};return this._executeRequest(t)};RCVEApi.createStream=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/streams",t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"")};return this._executeRequest(n)};RCVEApi.updateStream=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.PATCH,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/streams/"+r.FORMAT_MARK,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"",t.streamId?t.streamId:"")};return this._executeRequest(n)};RCVEApi.deleteStream=function(e,t){var n={data:{},authFree:false,method:r.NETWORK_METHOD.DELETE,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/streams/"+r.FORMAT_MARK,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"",e)};return this._executeRequest(n)};RCVEApi.createParticipant=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants",t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"")};return this._executeRequest(n)};RCVEApi.updateParticipant=function(e,t,n){var i=Object.assign({},e,e.waitingRoomStatus?{waitingRoomStatus:parseInt(e.waitingRoomStatus,10)}:{});var a={data:i,params:{code:n},authFree:false,method:r.NETWORK_METHOD.PATCH,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"")};return this._executeRequest(a)};RCVEApi.deleteParticipant=function(e){var t={data:{},authFree:false,method:r.NETWORK_METHOD.DELETE,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK,e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"",e.participantId?e.participantId:"")};return this._executeRequest(t)};RCVEApi.createSession=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/sessions",t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"")};return this._executeRequest(n)};RCVEApi.updateSession=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.PATCH,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/sessions/"+r.FORMAT_MARK,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"",t.sessionId?t.sessionId:"")};return this._executeRequest(n)};RCVEApi.deleteSession=function(e){var t={data:{},authFree:false,method:r.NETWORK_METHOD.DELETE,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/sessions/"+r.FORMAT_MARK,e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"",e.participantId?e.participantId:"",e.sessionId?e.sessionId:"")};return this._executeRequest(t)};RCVEApi.pingSession=function(e,t){var n={data:{},authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,timeout:t,retryCount:2,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/sessions/"+r.FORMAT_MARK+"/pong",e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"",e.participantId?e.participantId:"",e.sessionId?e.sessionId:"")};return this._executeRequest(n)};RCVEApi.call=function(e){var t={data:e.calleeId?{calleeId:e.calleeId,number:e.number,shouldPlayWelcomePrompt:true}:{number:e.number,shouldPlayWelcomePrompt:true},authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/dials",e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"",e.participantId?e.participantId:"")};return this._executeRequest(t)};RCVEApi.deleteCall=function(e){var t={authFree:false,method:r.NETWORK_METHOD.DELETE,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/dials/"+r.FORMAT_MARK,e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"",e.participantId?e.participantId:"",e.dialId?e.dialId:"")};return this._executeRequest(t)};RCVEApi.createDemand=function(e){var t=e.meetingId,n=s(e,["meetingId"]);var i={data:a(a({},n),{callId:t}),authFree:false,method:r.NETWORK_METHOD.POST,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/demands",e.bridgeId?e.bridgeId:"",e.meetingId?e.meetingId:"",e.participantId?e.participantId:"")};return this._executeRequest(i)};RCVEApi.deleteDemand=function(e,t){var n={data:{},authFree:false,method:r.NETWORK_METHOD.DELETE,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/demands/"+e,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"",e)};return this._executeRequest(n)};RCVEApi.updateDemand=function(e,t){var n={data:e,authFree:false,method:r.NETWORK_METHOD.PATCH,HAPriority:r.HA_PRIORITY.HIGH,path:r.RequestPath.buildRequestPath(o.yF.API_BRIDGES+"/"+r.FORMAT_MARK+"/meetings/"+r.FORMAT_MARK+"/participants/"+r.FORMAT_MARK+"/demands/"+r.FORMAT_MARK,t.bridgeId?t.bridgeId:"",t.meetingId?t.meetingId:"",t.participantId?t.participantId:"",e.id)};return this._executeRequest(n)};RCVEApi._executeRequest=function(e,t){var n=Date.now().toString();var i=a({requuid:n},e.params);e.priority=r.REQUEST_PRIORITY.HIGH;e.params=i;return RCVEApi.networkClient.http(e,t)};return RCVEApi}()},521924:(e,t,n)=>{"use strict";n.d(t,{E$:()=>f,yF:()=>o,FL:()=>a,n$:()=>s,nU:()=>l,wG:()=>u,xY:()=>d,vK:()=>c});var r=n(913161);var i="v1";var o={API_BRIDGES:"/rcvideo/"+i+"/bridges",API_DIAL_IN_NUMBERS:"/rcvideo/"+i+"/dial-in-numbers"};var a="f128a1b3-940b-4b1a-bdbf-4b7a02ba6c9c";var s="c283d8cb-81ac-4cbd-a09d-07871577c7a1";var l="b8c643e0-1be2-43e8-8a19-3cf86f821725";var u="6f01ebb2-1a6f-4b36-82af-b87cb708c415";var c="c898e3ac-816d-46b7-97fc-0d66fb09cdd2";var d="103";var f={"465ee289-809d-46f2-840c-e8c1d8ad8662":r.iw.NL,"c7e3be39-9583-4133-9754-5695e01728f9":r.iw.hk,"960b4933-d07f-40fe-841b-f41d52ae2b14":r.iw.mI,"d60e878c-06d4-4425-9497-1c02858c1467":r.iw.mI}},34670:(e,t,n)=>{"use strict";n.d(t,{RCVEApi:()=>r.y});var r=n(61190)},882756:(e,t,n)=>{"use strict";n.d(t,{oZ:()=>u,FY:()=>a,el:()=>o,J2:()=>l,yZ:()=>p,xW:()=>h,Ls:()=>c,Ie:()=>d,d:()=>getPubNubUrl,MH:()=>_,Up:()=>s,ug:()=>f});var r=n(424843);var i=n(295454);var o=i.Lb.RCVE;var a={ENTITY:{MEETING_INFO:"ENTITY.MEETING_INFO",BRIDGE_INFO:"ENTITY.BRIDGE_INFO",PARTICIPANT_INFO:"ENTITY.PARTICIPANT_INFO",SESSION_INFO:"ENTITY.SESSION_INFO",STREAM_INFO:"ENTITY.STREAM_INFO",MEDIA_STREAM:"ENTITY.MEDIA_STREAM",MEETING_STATUS:"ENTITY.MEETING_STATUS",SESSION_NETWORK_STATUS:"ENTITY.SESSION_NETWORK_STATUS",SESSION_CONNECTIVITY:"ENTITY.SESSION_CONNECTIVITY",DIAL_INFO:"ENTITY.DIAL_INFO",DEMAND_INFO:"ENTITY.DEMAND_INFO",LOCAL_STATE:"ENTITY.LOCAL_STATE"},EVENT:{USING_PHONE_AUDIO:"EVENT.USING_PHONE_AUDIO",DIAL_SUCCESS:"EVENT.DIAL_SUCCESS",DIAL_FAIL:"EVENT.DIAL_FAIL"},MEETING_ACTION:{MEETING_LOCKED:"MEETING_ACTION.LOCKED_BY_MODERATOR",MEETING_UNLOCKED:"MEETING_ACTION.UNLOCKED_BY_MODERATOR",MEETING_ONLY_MODERATOR_SHARING:"MEETING_ACTION.ONLY_MODERATOR_SHARING",MEETING_EVERYONE_SHARING:"MEETING_ACTION.EVERYONE_SHARING"},PARTICIPANT_ACTION:{MUTED_BY_MODERATOR:"PARTICIPANT_ACTION.MUTED_BY_MODERATOR",MUTED_VIDEO_BY_MODERATOR:"PARTICIPANT_ACTION.MUTED_VIDEO_BY_MODERATOR",MODERATOR_GRANTED:"PARTICIPANT_ACTION.MODERATOR_GRANTED",MODERATOR_REVOKED:"PARTICIPANT_ACTION.MODERATOR_REVOKED",TEMPORARY_MODERATOR_GRANTED:"PARTICIPANT_ACTION.TEMPORARY_MODERATOR_GRANTED",TEMPORARY_MODERATOR_REVOKED:"PARTICIPANT_ACTION.TEMPORARY_MODERATOR_REVOKED"},MEETING_DELETED:"MEETING_DELETED",SCREEN_SHARING_ENDED:"SCREEN_SHARING_ENDED",REQUEST_MEDIA_PERMISSION_FAIL:"REQUEST_MEDIA_PERMISSION_FAIL"};var s="ended";var l;(function(e){e["DATA"]="data";e["PING"]="ping";e["INVALIDATE"]="invalidate"})(l||(l={}));var u;(function(e){e["AUDIO"]="audio";e["VIDEO"]="video"})(u||(u={}));var c;(function(e){e["MAIN"]="main";e["SCREENSHARING"]="screensharing";e["OTHER"]="other"})(c||(c={}));var d;(function(e){e["MAIN"]="video/main";e["SCREENSHARING"]="video/screensharing"})(d||(d={}));var f;(function(e){e["GALLERY"]="GALLERY";e["FILMSTRIP"]="FILMSTRIP";e["ACTIVE"]="ACTIVE"})(f||(f={}));var p={web:"rcv/web/0.10",electron:"rcv/desktop/0.10"};var h={mac:"macos",win:"win"};var getPubNubUrl=function(){return r.apiConfiguration.getConfig().rc.pubnub};var _;(function(e){e[e["MEETING_LOCKED"]=-12]="MEETING_LOCKED";e[e["INVALID_MEETING"]=-11]="INVALID_MEETING";e[e["EXCLUDED_FROM_WAITING_ROOM"]=-10]="EXCLUDED_FROM_WAITING_ROOM";e[e["IN_WAITING_ROOM"]=-9]="IN_WAITING_ROOM";e[e["NOT_ALLOW_JOIN_BEFORE_HOST"]=-8]="NOT_ALLOW_JOIN_BEFORE_HOST";e[e["WS_SERVER_ERROR"]=-7]="WS_SERVER_ERROR";e[e["CREATE_CALL_NO_MEDIA_DEVICES"]=-6]="CREATE_CALL_NO_MEDIA_DEVICES";e[e["CREATE_CALL_NO_MEDIA_PERMISSION"]=-5]="CREATE_CALL_NO_MEDIA_PERMISSION";e[e["CREATE_CALL_USER_MEDIA_FAILED"]=-4]="CREATE_CALL_USER_MEDIA_FAILED";e[e["RECOVERY_LIMIT_HIT"]=-3]="RECOVERY_LIMIT_HIT";e[e["CREATE_VIDEO_CALL_ERROR"]=-2]="CREATE_VIDEO_CALL_ERROR";e[e["FAILED_TO_GET_MEETING_INFO"]=-1]="FAILED_TO_GET_MEETING_INFO";e[e["UNKNOWN"]=0]="UNKNOWN";e[e["END_CONFERENCE_CALL_FOR_ALL"]=1]="END_CONFERENCE_CALL_FOR_ALL";e[e["FORCE_DISCONNECT_FROM_HOST"]=2]="FORCE_DISCONNECT_FROM_HOST";e[e["SESSION_TIMEOUT"]=3]="SESSION_TIMEOUT";e[e["PARTICIPANT_NO_ANSWER"]=4]="PARTICIPANT_NO_ANSWER";e[e["CALL_NO_ANSWER"]=5]="CALL_NO_ANSWER";e[e["CALL_FINISHED"]=6]="CALL_FINISHED";e[e["CONFERENCE_DURATION_LIMIT_HIT"]=20]="CONFERENCE_DURATION_LIMIT_HIT"})(_||(_={}))},725579:(e,t,n)=>{"use strict";n.d(t,{_b:()=>r._b,hj:()=>r.hj,Uf:()=>r.Uf,cZ:()=>r.cZ,nO:()=>r.nO,XU:()=>r.XU,ro:()=>r.ro});var r=n(396484)},396484:(e,t,n)=>{"use strict";n.d(t,{_b:()=>r,hj:()=>i,nO:()=>o,XU:()=>a,ro:()=>s,cZ:()=>l,Uf:()=>u});var r;(function(e){e[e["MEETING"]=0]="MEETING";e[e["CALL"]=1]="CALL"})(r||(r={}));var i;(function(e){e["INIT"]="INIT";e["CONNECTING"]="CONNECTING";e["CONNECTED"]="CONNECTED";e["RECONNECTING"]="RECONNECTING";e["DISCONNECTED"]="DISCONNECTED";e["TERMINATING"]="TERMINATING";e["TERMINATED"]="TERMINATED"})(i||(i={}));var o;(function(e){e["INIT"]="INIT";e["START"]="START";e["FAIL"]="FAIL"})(o||(o={}));var a;(function(e){e["CALL_ME"]="0";e["CALL_OUT"]="1"})(a||(a={}));var s;(function(e){e["DENIED"]="0";e["ALLOW"]="1";e["WAITING"]="2";e["LEFT"]="3"})(s||(s={}));var l;(function(e){e["UNMUTE_DEMAND"]="unmute";e["UNMUTE_VIDEO_DEMAND"]="unmute_video";e["CONTROL_DEMAND"]="control";e["ANNOTATE_DEMAND"]="annotate"})(l||(l={}));var u;(function(e){e["NEW"]="new";e["APPROVE"]="approve";e["REJECT"]="reject";e["CANCEL"]="cancel"})(u||(u={}))},777363:(e,t,n)=>{"use strict";n.d(t,{A:()=>s,b:()=>l});var r=n(862926);var i=n.n(r);var o=n(727243);var a=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var s=function(e){a(RCVEError,e);function RCVEError(t,n,r){if(n===void 0){n=o.r.GENERAL}return e.call(this,o.w,n,t,r)||this}return RCVEError}(r.JError);var l=function(e){a(RCVEServerError,e);function RCVEServerError(t,n,r){if(n===void 0){n=o.r.SERVER}return e.call(this,o.w,n,t,r)||this}return RCVEServerError}(r.JError)},788935:(e,t,n)=>{"use strict";n.d(t,{iw:()=>r,K$:()=>g,bd:()=>M,cn:()=>f,oc:()=>I,WA:()=>h,sv:()=>R,wU:()=>m,Y8:()=>b,vu:()=>p,TJ:()=>E,Sj:()=>S,o$:()=>C,qJ:()=>v,nB:()=>_,P6:()=>y});var r={};n.r(r);n.d(r,{hk:()=>u,NL:()=>c,mI:()=>l});var i=n(777363);var o=n(727243);var a=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var s=function(e){a(CallError,e);function CallError(t,n,r){return e.call(this,t,n,r)||this}return CallError}(i.b);var l=function(e){a(NumberFormatError,e);function NumberFormatError(t,n){return e.call(this,t,o.r.NUMBER_FORMAT_ERROR,n)||this}return NumberFormatError}(s);var u=function(e){a(CountryCallingCodeError,e);function CountryCallingCodeError(t,n){return e.call(this,t,o.r.COUNTRY_CALLING_CODE_ERROR,n)||this}return CountryCallingCodeError}(s);var c=function(e){a(InvalidNumberError,e);function InvalidNumberError(t,n){return e.call(this,t,o.r.INVALID_NUMBER_ERROR,n)||this}return InvalidNumberError}(s);var d=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var f=function(e){d(GetStreamError,e);function GetStreamError(t,n){return e.call(this,t,o.r.GET_STREAM_ERROR,n)||this}return GetStreamError}(i.A);var p=function(e){d(NoMediaDeviceError,e);function NoMediaDeviceError(t,n){return e.call(this,t,o.r.NO_MEDIA_DEVICE,n)||this}return NoMediaDeviceError}(i.A);var h=function(e){d(MediaPermissionError,e);function MediaPermissionError(t,n){return e.call(this,t,o.r.MEDIA_PERMISSION_ERROR,n)||this}return MediaPermissionError}(i.A);var _=function(e){d(ScreenSharingSystemPermissionError,e);function ScreenSharingSystemPermissionError(t,n){return e.call(this,t,o.r.SCREEN_SYSTEM_PERMISSION_ERROR,n)||this}return ScreenSharingSystemPermissionError}(i.A);var v=function(e){d(ScreenShareUserCancelError,e);function ScreenShareUserCancelError(t,n){return e.call(this,t,o.r.SCREEN_SHARE_USER_CANCEL,n)||this}return ScreenShareUserCancelError}(i.A);var g=function(e){d(EmptyParticipantIdError,e);function EmptyParticipantIdError(t,n){return e.call(this,t,o.r.EMPTY_PARTICIPANT_ID,n)||this}return EmptyParticipantIdError}(i.A);var y=function(e){d(TargetParticipantNotExistError,e);function TargetParticipantNotExistError(t,n){return e.call(this,t,o.r.TARGET_PARTICIPANT_NOT_EXIST,n)||this}return TargetParticipantNotExistError}(i.A);var m=function(e){d(MeetingNotExistError,e);function MeetingNotExistError(t,n){return e.call(this,t,o.r.MEETING_NOT_EXIST,n)||this}return MeetingNotExistError}(i.A);var S=function(e){d(ObtainMeetingInfoPipelineDisposed,e);function ObtainMeetingInfoPipelineDisposed(t,n){return e.call(this,t,o.r.OBTAIN_MEETING_INFO_DISPOSED,n)||this}return ObtainMeetingInfoPipelineDisposed}(i.A);var C=function(e){d(PasswordInvalidError,e);function PasswordInvalidError(t,n){return e.call(this,t,o.r.PASSWORD_INVALID,n)||this}return PasswordInvalidError}(i.A);var E=function(e){d(NotAllowJoinBeforeHostError,e);function NotAllowJoinBeforeHostError(t,n){return e.call(this,t,o.r.NOT_ALLOW_JOIN_BEFORE_HOST,n)||this}return NotAllowJoinBeforeHostError}(i.A);var b=function(e){d(MeetingTerminatedError,e);function MeetingTerminatedError(t,n){return e.call(this,t,o.r.MEETING_TERMINATED,n)||this}return MeetingTerminatedError}(i.A);var I=function(e){d(InWaitingRoom,e);function InWaitingRoom(t,n){return e.call(this,t,o.r.IN_WAITING_ROOM,n)||this}return InWaitingRoom}(i.A);var M=function(e){d(ExcludedFromWaitingRoom,e);function ExcludedFromWaitingRoom(t,n){return e.call(this,t,o.r.EXCLUDED_FROM_WAITING_ROOM,n)||this}return ExcludedFromWaitingRoom}(i.A);var R=function(e){d(MeetingLocked,e);function MeetingLocked(t,n){return e.call(this,t,o.r.MEETING_LOCKED,n)||this}return MeetingLocked}(i.A)},913161:(e,t,n)=>{"use strict";n.d(t,{iw:()=>o.iw,K$:()=>o.K$,Kp:()=>C,bd:()=>o.bd,cn:()=>o.cn,oc:()=>o.oc,WA:()=>o.WA,sv:()=>o.sv,wU:()=>o.wU,Y8:()=>o.Y8,TJ:()=>o.TJ,Sj:()=>o.Sj,B6:()=>v,o$:()=>o.o$,Au:()=>r.A,rB:()=>i.r,wY:()=>i.w,qJ:()=>o.qJ,P6:()=>o.P6,$T:()=>convertMediaErrorToDeleteReason});var r=n(777363);var i=n(727243);var o=n(788935);var a="Permission denied by system";var s="NotAllowedError";var l="NotFoundError";var u="NotReadableError";var c="user cancel";var d="permission denied";var f="get stream error";var p="no available media device";var h="need screen share permission";var _="unknown error";var v;(function(e){e[e["MEDIA"]=0]="MEDIA";e[e["BROWSER_SHARE"]=1]="BROWSER_SHARE";e[e["ELECTRON_SHARE"]=2]="ELECTRON_SHARE"})(v||(v={}));var g=function(){function RCVEMediaErrorParser(){}RCVEMediaErrorParser.prototype.parse=function(e){if(e.name===s||e.name===u){return new o.WA(e.message)}if(e.name===l){return new o.vu(p)}return new o.cn(f)};return RCVEMediaErrorParser}();var y=function(){function RCVEElectronShareErrorParser(){}RCVEElectronShareErrorParser.prototype.parse=function(e){if(e.message.trim()===c){return new o.qJ(c)}if(e.message.trim()===d){return new o.nB(h)}return new o.cn(f)};return RCVEElectronShareErrorParser}();var m=function(){function RCVEBrowserShareErrorParser(){}RCVEBrowserShareErrorParser.prototype.parse=function(e){if(e.name.trim()===s&&e.message.trim()!==a){return new o.qJ(c)}if(e.name===s&&e.message.trim()===a){return new o.nB(h)}return new o.cn(f)};return RCVEBrowserShareErrorParser}();var S=function(){function RCVEErrorParser(){this._parserMap=new Map;this._parserMap.set(v.MEDIA,new g);this._parserMap.set(v.BROWSER_SHARE,new m);this._parserMap.set(v.ELECTRON_SHARE,new y)}RCVEErrorParser.prototype.parse=function(e,t){var n=this._parserMap.get(t);return n?n.parse(e):new r.A(_)};return RCVEErrorParser}();var C=new S;var E=n(882756);function convertMediaErrorToDeleteReason(e){switch(e.code){case i.r.MEDIA_PERMISSION_ERROR:return E.MH.CREATE_CALL_NO_MEDIA_PERMISSION;case i.r.NO_MEDIA_DEVICE:return E.MH.CREATE_CALL_NO_MEDIA_DEVICES;case i.r.NOT_ALLOW_JOIN_BEFORE_HOST:return E.MH.NOT_ALLOW_JOIN_BEFORE_HOST;case i.r.IN_WAITING_ROOM:return E.MH.IN_WAITING_ROOM;case i.r.EXCLUDED_FROM_WAITING_ROOM:return E.MH.EXCLUDED_FROM_WAITING_ROOM;case i.r.MEETING_NOT_EXIST:return E.MH.INVALID_MEETING;case i.r.MEETING_LOCKED:return E.MH.MEETING_LOCKED;default:return E.MH.CREATE_CALL_USER_MEDIA_FAILED}}},727243:(e,t,n)=>{"use strict";n.d(t,{w:()=>r,r:()=>i});var r="RCVE_ERROR";var i;(function(e){e["GENERAL"]="GENERAL";e["SERVER"]="SERVER";e["GET_STREAM_ERROR"]="GET_STREAM_ERROR";e["NO_MEDIA_DEVICE"]="NO_MEDIA_DEVICE";e["MEDIA_PERMISSION_ERROR"]="MEDIA_PERMISSION_ERROR";e["SCREEN_SYSTEM_PERMISSION_ERROR"]="SCREEN_SYSTM_PERMISSION_ERROR";e["SCREEN_SHARE_USER_CANCEL"]="SCREEN_SHARE_USER_CANCEL";e["MEETING_NOT_EXIST"]="MEETING_NOT_EXIST";e["OBTAIN_MEETING_INFO_DISPOSED"]="OBTAIN_MEETING_INFO_DISPOSED";e["PASSWORD_INVALID"]="PASSWORD_INVALID";e["NOT_ALLOW_JOIN_BEFORE_HOST"]="NOT_ALLOW_JOIN_BEFORE_HOST";e["MEETING_TERMINATED"]="MEETING_TERMINATED";e["IN_WAITING_ROOM"]="IN_WAITING_ROOM";e["EXCLUDED_FROM_WAITING_ROOM"]="EXCLUDE_FROM_WAITING_ROOM";e["EMPTY_PARTICIPANT_ID"]="EMPTY_PARTICIPANT_ID";e["TARGET_PARTICIPANT_NOT_EXIST"]="TARGET_PARTICIPANT_NOT_EXIST";e["MEETING_LOCKED"]="MEETING_LOCKED";e["NUMBER_FORMAT_ERROR"]="NUMBER_FORMAT_ERROR";e["INVALID_NUMBER_ERROR"]="INVALID_NUMBER_ERROR";e["COUNTRY_CALLING_CODE_ERROR"]="COUNTRY_CALLING_CODE_ERROR"})(i||(i={}))},922742:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});var r=n(862926);var i=n.n(r);var o=n(204285);var a="[CORE][RCVE]";var s=r.ModuleLogger.getLogger(a,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),o.VIDEO_EVENT_DATA_FEATURE_KEY)},44923:()=>{},522178:(e,t,n)=>{"use strict";n.d(t,{J:()=>oa});var r=n(922742);var i=n(34670);var o=n(667489);var a=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var s=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var l=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var u=function(e){a(AbstractMeetingEntityController,e);function AbstractMeetingEntityController(t,n){var r=e.call(this)||this;r._localIdentifier=t;r._entityKey=n;return r}Object.defineProperty(AbstractMeetingEntityController.prototype,"entityKey",{get:function(){return this._entityKey},enumerable:true,configurable:true});Object.defineProperty(AbstractMeetingEntityController.prototype,"localIdentifier",{get:function(){return this._localIdentifier},enumerable:true,configurable:true});AbstractMeetingEntityController.prototype.extractHandleData=function(e,t,n){if(t===void 0){t=false}if(n===void 0){n=false}return null};AbstractMeetingEntityController.prototype.onHandleData=function(e,t,n){return null};AbstractMeetingEntityController.prototype.handleData=function(e,t,n){if(t===void 0){t=false}if(n===void 0){n=false}var r=this.extractHandleData(e,t,n);if(r){this.emitEntityUpdate(this.onHandleData(r,t,n))}};AbstractMeetingEntityController.prototype.extractNeedProcessBody=function(e){if(this.needProcessSocketEvents.includes(e.event)){return e.body}return undefined};Object.defineProperty(AbstractMeetingEntityController.prototype,"needProcessSocketEvents",{get:function(){return[]},enumerable:true,configurable:true});AbstractMeetingEntityController.prototype.onHandleSocketData=function(e){return null};AbstractMeetingEntityController.prototype.onHandleMeetingStatusData=function(e){return null};AbstractMeetingEntityController.prototype.handleSocketData=function(e){var t=this.extractNeedProcessBody(e);if(t){this.emitEntityUpdate(this.onHandleSocketData(t))}};AbstractMeetingEntityController.prototype.handleMediaData=function(e,t){if(this.needHandleMediaData()){this.emitEntityUpdate(this.onHandleMediaData(e,t))}};AbstractMeetingEntityController.prototype.handleMeetingStatusData=function(e){var t=this.onHandleMeetingStatusData(e);if(t){this.emitEntityUpdate(t)}};AbstractMeetingEntityController.prototype.onHandleMediaData=function(e,t){return null};AbstractMeetingEntityController.prototype.needHandleMediaData=function(){return false};AbstractMeetingEntityController.prototype.emitEntityUpdate=function(e){if(Array.isArray(e)){if(e.length>0)this.emitEntityUpdateInternal(e)}else if(e){this.emitEntityUpdateInternal([e])}};AbstractMeetingEntityController.prototype.emitEntityUpdateInternal=function(e){r.k.log("emitEntityUpdate",this.entityKey+"."+this.localIdentifier);o.notificationCenter.emitEntityUpdateSynchronously(this.entityKey+"."+this.localIdentifier,e)};AbstractMeetingEntityController.prototype.getEntityNotificationKey=function(){return this.entityKey+"."+this.localIdentifier};AbstractMeetingEntityController.prototype.notifyAllEntityDelete=function(){return s(this,void 0,void 0,(function(){var e,t;return l(this,(function(n){switch(n.label){case 0:return[4,this.getAll()];case 1:e=n.sent();t=e.map((function(e){return e.id}));o.notificationCenter.emitEntityDelete(this.entityKey+"."+this.localIdentifier,t);return[2]}}))}))};AbstractMeetingEntityController.prototype.notifyDeleteAndClear=function(){return s(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this.notifyAllEntityDelete()];case 1:e.sent();return[4,this.clear()];case 2:e.sent();return[2]}}))}))};return AbstractMeetingEntityController}(o.EntityCacheController);var c=n(882756);var d=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var f=function(e){d(BridgeInfoEntityController,e);function BridgeInfoEntityController(t){return e.call(this,t,c.FY.ENTITY.BRIDGE_INFO)||this}BridgeInfoEntityController.prototype.saveBridgeInfo=function(e){this.putSync(e)};BridgeInfoEntityController.prototype.onHandleData=function(e,t){r.k.log(e,t);return null};return BridgeInfoEntityController}(u);var p=n(396484);var h=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var _=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e};var v=["id"];var g=function(){function MergeUtil(){}MergeUtil.mergeCollectionData=function(e,t,n,r){e.forEach((function(e){var i=t(e);if(i===undefined){n(e)}else{MergeUtil.mergeCommonFieldsFromPartialObject(i,e,false);r&&r(i,e)}}))};MergeUtil.mergeCommonFieldsFromPartialObject=function(e,t,n,r){if(r===void 0){r=v}if(!t){return}Object.keys(t).forEach((function(i){if(r.some((function(e){return e===i}))){return}if(Array.isArray(e[i])||Array.isArray(t[i])){e[i]=t[i]}else if(e[i]===undefined||typeof e[i]!=="object"){e[i]=t[i]}else if(!n&&typeof e[i]==="object"&&typeof t[i]==="object"){MergeUtil.mergeCommonFieldsFromPartialObject(e[i],t[i],false)}}))};MergeUtil.mergeArrayIdFieldsFromPartialObject=function(e,t,n,r){var i;if(!r[t]){return}var o=n[e]||[];var a=(i=r[t])===null||i===void 0?void 0:i.map((function(e){return e.id}));var s=_(new Set(_(o,a)));n[e]=s};MergeUtil.mergeArrayIdFields=function(e,t,n){var r=e[n]||[];var i=t[n]||[];var o=_(new Set(_(r,i)));e[n]=o};return MergeUtil}();var y=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var m=undefined&&undefined.__assign||function(){m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return m.apply(this,arguments)};var S=undefined&&undefined.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var C=function(e){y(MeetingInfoEntityController,e);function MeetingInfoEntityController(t){var n=e.call(this,t,c.FY.ENTITY.MEETING_INFO)||this;n._meetingId="";n._shortId="";return n}Object.defineProperty(MeetingInfoEntityController.prototype,"meetingId",{get:function(){return this._meetingId},enumerable:true,configurable:true});Object.defineProperty(MeetingInfoEntityController.prototype,"shortId",{set:function(e){this._shortId=e},enumerable:true,configurable:true});MeetingInfoEntityController.prototype.extractHandleData=function(e){return e};MeetingInfoEntityController.prototype.onHandleData=function(e,t){var n=null;if(this._meetingId.length===0){var r=e._id||e.id;if(!r){if(e.bridgeInfo){this._bridgeInfo=e.bridgeInfo}return}this._meetingId=r;var i=e.participants,o=S(e,["participants"]);var a=(i===null||i===void 0?void 0:i.map((function(e){return e.id})))||[];var s=this._meetingId;var l=m(m({},o),{participantIDs:a,_id:s});if(this._bridgeInfo){l.bridgeInfo=this._bridgeInfo;delete this._bridgeInfo}this.putSync(l);n=l}else{var u=this.getSynchronously(this.meetingId);g.mergeCommonFieldsFromPartialObject(u,e,false,["id","participants"]);g.mergeArrayIdFieldsFromPartialObject("participantIDs","participants",u,e);n=u}if(t){n&&(n.shortId=this._shortId)}return n};return MeetingInfoEntityController}(u);var E;(function(e){e["ERROR"]="ERROR";e["CLOSE"]="CLOSE";e["MESSAGE"]="MESSAGE";e["CONNECTED"]="CONNECTED"})(E||(E={}));var b;(function(e){e[e["CONNECTING"]=0]="CONNECTING";e[e["OPEN"]=1]="OPEN";e[e["CLOSING"]=2]="CLOSING";e[e["CLOSED"]=3]="CLOSED"})(b||(b={}));var I;(function(e){e["CREATE_REQ"]="create_req";e["CREATE_RES"]="create_resp";e["CREATE_ACK"]="create_ack";e["DESTROY_REQ"]="destroy_req";e["DESTROY_RES"]="destroy_resp";e["UPDATE_REQ"]="update_req";e["UPDATE_RES"]="update_resp";e["UPDATE_ACK"]="update_ack";e["STATUS_REQ"]="status_req";e["STATUS_RES"]="status_resp";e["UNBIND_REQ"]="unbind_req";e["UNBIND_RES"]="unbind_resp";e["UPDATE_PARTICIPANT_REQ"]="update_participant_req";e["UPDATE_PARTICIPANT_RES"]="update_participant_resp";e["DESTROY_PARTICIPANT_REQ"]="destroy_participant_req";e["DESTROY_PARTICIPANT_RES"]="destroy_participant_resp";e["UPDATE_STREAM_REQ"]="update_stream_req";e["UPDATE_STREAM_RES"]="update_stream_resp";e["DESTROY_STREAM_REQ"]="destroy_stream_req";e["DESTROY_STREAM_RES"]="destroy_stream_resp";e["UPDATE_CHANNEL_REQ"]="update_channel_req";e["UPDATE_CHANNEL_RES"]="update_channel_resp";e["DESTROY_CHANNEL_REQ"]="destroy_channel_req";e["DESTROY_CHANNEL_RES"]="destroy_channel_resp";e["UPDATE_RECORDING_REQ"]="update_recording_req";e["UPDATE_RECORDING_RES"]="update_recording_resp";e["DESTROY_RECORDING_REQ"]="destroy_recording_req";e["DESTROY_RECORDING_RES"]="destroy_recording_resp";e["ICE_REQ"]="ice_req";e["ICE_RES"]="ice_resp";e["NO_MORE_ICE_REQ"]="no_more_ice_req";e["NO_MORE_ICE_RES"]="no_more_ice_resp";e["ACTIVE_SPEAKERS_REPORT_REQ"]="as_report_req";e["ACTIVE_SPEAKERS_REPORT_RES"]="as_report_resp";e["MEDIA_STAT_REQ"]="media_stat_req";e["MEDIA_STAT_RES"]="media_stat_resp";e["INFO_REQ"]="info_req";e["INFO_RES"]="info_resp";e["PSTN_AS_REPORT_INFO"]="pstn_as_report_info";e["PSTN_AS_REPORT_REQ"]="pstn_as_report_req";e["PSTN_AS_REPORT_RES"]="pstn_as_report_resp";e["KEEP_ALIVE_REQ"]="keep_alive_req";e["KEEP_ALIVE_RES"]="keep_alive_resp";e["SET_NETWORK_CONDITIONS_REQ"]="set_network_conditions_req";e["SET_NETWORK_CONDITIONS_RES"]="set_network_conditions_resp";e["ADD_PEER_REQ"]="add_peer_req";e["ADD_PEER_RES"]="add_peer_resp";e["GET_PEERS_REQ"]="get_peers_req";e["GET_PEERS_RES"]="get_peers_resp";e["REMOVE_PEER_REQ"]="remove_peer_req";e["REMOVE_PEER_RES"]="remove_peer_resp";e["SET_VOLUME_REQ"]="set_volume_req";e["SET_VOLUME_RES"]="set_volume_resp";e["SET_MUTE_REQ"]="set_mute_req";e["SET_MUTE_RES"]="set_mute_resp";e["GET_STATUS_REQ"]="get_status_req";e["GET_STATUS_RES"]="get_status_resp";e["SET_SLOTS_REQ"]="set_slots_req";e["SET_SLOTS_RES"]="set_slots_resp";e["ADD_STREAM_REQ"]="add_stream_req";e["ADD_STREAM_RES"]="add_stream_resp";e["REMOVE_STREAM_REQ"]="remove_stream_req";e["REMOVE_STREAM_RES"]="remove_stream_resp";e["REGISTER_REQ"]="register_req";e["REGISTER_RES"]="register_resp";e["DESTROY_SFU"]="destroy_sfu";e["NETWORK_STATUS_REQ"]="network_status_req";e["NETWORK_STATUS_RES"]="network_status_resp"})(I||(I={}));var M;(function(e){e[e["MAX_RETRY_ERROR"]=-1]="MAX_RETRY_ERROR";e[e["BAD_ARGUMENTS"]=1]="BAD_ARGUMENTS";e[e["CANNOT_GENERATE_ANSWER"]=2]="CANNOT_GENERATE_ANSWER";e[e["CANNOT_ADD_PEER_TO_HUB"]=3]="CANNOT_ADD_PEER_TO_HUB";e[e["CANNOT_UPDATE_PEER_PREFERENCES"]=4]="CANNOT_UPDATE_PEER_PREFERENCES";e[e["CANNOT_SET_REMOTE_DESCRIPTION"]=5]="CANNOT_SET_REMOTE_DESCRIPTION";e[e["SESSION_ALREADY_EXISTS"]=6]="SESSION_ALREADY_EXISTS";e[e["SESSION_NOT_FOUND"]=7]="SESSION_NOT_FOUND";e[e["OFFER_REJECTED"]=8]="OFFER_REJECTED";e[e["CANNOT_SET_REMOTE_NICE"]=9]="CANNOT_SET_REMOTE_NICE";e[e["INTERNAL_ERROR"]=10]="INTERNAL_ERROR";e[e["CONFERENCE_NOT_FOUND"]=11]="CONFERENCE_NOT_FOUND";e[e["MEDIA_DISCONNECTED"]=12]="MEDIA_DISCONNECTED";e[e["CONFERENCE_ALREADY_EXISTS"]=17]="CONFERENCE_ALREADY_EXISTS";e[e["INVALID_TOKEN"]=18]="INVALID_TOKEN";e[e["SESSION_REMOVED"]=19]="SESSION_REMOVED"})(M||(M={}));var R;(function(e){e["BAD_ARGUMENTS"]="Bad arguments";e["CANNOT_GENERATE_ANSWER"]="Cannot generate answer";e["CANNOT_ADD_PEER_TO_HUB"]="Cannot add peer to hub";e["CANNOT_UPDATE_PEER_PREFERENCES"]="Cannot update peer preferences";e["CANNOT_SET_REMOTE_DESCRIPTION"]="Cannot set remote description";e["SESSION_ALREADY_EXISTS"]="Session with this id is already exists";e["SESSION_NOT_FOUND"]="Session with this id not found";e["OFFER_REJECTED"]="Offer from client rejected because of pending server offer (SDP Glare)";e["CANNOT_SET_REMOTE_NICE"]="Cannot set remote nice";e["INTERNAL_ERROR"]="Internal Error";e["CONFERENCE_NOT_FOUND"]="Conference with this id not found";e["MEDIA_DISCONNECTED"]="Media disconnected";e["CONFERENCE_ALREADY_EXISTS"]="Conference already exists";e["INVALID_TOKEN"]="Invalid token";e["SESSION_REMOVED"]="Session removed from the conference"})(R||(R={}));var T;(function(e){e["SESSION"]="session";e["CONFERENCE"]="conference";e["CONNECTION"]="connection"})(T||(T={}));var O;(function(e){e["DEVICES"]="devices";e["USER_ACTION"]="user_action";e["STATE_UPDATE"]="state_update";e["NET_QUALITY"]="net_quality";e["PERFORMANCE"]="performance";e["NET_TYPE"]="net_type"})(O||(O={}));var A=new Map;var P=new Map;Object.keys(I).forEach((function(e){if(e.match(/_REQ$/)){var t=e.replace("_REQ","_RES");var n=I[e];var r=I[t];var i=e.replace("_REQ","_ACK");var o=I[i];if(r){P.set(n,r)}if(o){A.set(r,o)}}}));var N=n(44923);var w=function(){function SocketResponse(e){this._msg=JSON.parse(e)}Object.defineProperty(SocketResponse.prototype,"seq",{get:function(){return this._msg.req_seq.toString()},enumerable:true,configurable:true});Object.defineProperty(SocketResponse.prototype,"event",{get:function(){return this._msg.event},enumerable:true,configurable:true});Object.defineProperty(SocketResponse.prototype,"msg",{get:function(){return this._msg},enumerable:true,configurable:true});return SocketResponse}();var D=n(879321);var k=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var L=r.k.tags("[SocketRequestHelper]");var F=function(){function SocketRequestHelper(e){this._delegate=e;this.emitter=new D.EventEmitter2;this.requestTimerMap=new Map}SocketRequestHelper.prototype.newRequest=function(e){var t=this;return new Promise((function(n,r){t._registerRequestListener(e.seq,n);t._setRequestTimer(e,r)}))};SocketRequestHelper.prototype.newResponse=function(e){var t=new w(e);if(t.seq){var n=t.seq;var r=this.requestTimerMap.get(n);if(r){this._removeRequestTimer(n);this._handleRegisteredRequest(n,t)}else{L.info("emit message to upper",t.msg);this._delegate.message(t.msg)}}};SocketRequestHelper.prototype._registerRequestListener=function(e,t){L.info("[Socket]: register request:",e);this.emitter.once(e,t)};SocketRequestHelper.prototype._handleRegisteredRequest=function(e,t){L.info("[Socket]: Handle request:"+e);this.emitter.emit(e,t)};SocketRequestHelper.prototype._setRequestTimer=function(e,t){var r=this;var i=n.g.setTimeout((function(){r._onRequestTimeout(e.seq,t)}),e.timeout);this.requestTimerMap.set(e.seq,{timerId:i,request:e,reject:t})};SocketRequestHelper.prototype._removeRequestTimer=function(e){var t=this.requestTimerMap.get(e);if(t){window.clearTimeout(t.timerId);this.requestTimerMap.delete(e)}};SocketRequestHelper.prototype._onRequestTimeout=function(e,t){L.info("[Socket]: request timeout");var n=this.requestTimerMap.get(e);t(new Error("socket request timeout: "+n))};SocketRequestHelper.prototype.onSocketDisconnect=function(){var e,t;L.debug("socket disconnected");try{for(var n=k(this.requestTimerMap.keys()),r=n.next();!r.done;r=n.next()){var i=r.value;L.info("[Socket]: socket disconnect, return SOCKET_DISCONNECTED error for request id:"+i);var o=this.requestTimerMap.get(i);if(o){this._removeRequestTimer(i);o&&o.reject(new Error("socket disconnected error"))}}}catch(t){e={error:t}}finally{try{if(r&&!r.done&&(t=n.return))t.call(n)}finally{if(e)throw e.error}}};return SocketRequestHelper}();const V=F;var U=r.k.tags("[SocketClient]");var j="vcvas";var x=function(){function SocketClient(e,t){var n=this;this._isReady=false;this._isClosed=false;this.socketRequestHelper=new V(t);this.socket=new WebSocket(e,[j]);this.socket.onmessage=function(e){n.socketRequestHelper.newResponse(e.data)};this.socket.onclose=function(){U.info("socket client there is an close event");n.socketRequestHelper.onSocketDisconnect();!n._isClosed&&t.recovery&&t.recovery()};this.socket.onerror=function(e){U.warn("socket client there is an error:",e);t.recovery&&t.recovery()}}SocketClient.prototype.request=function(e){U.info("send request:",e);if(!this.socket){return Promise.reject(new Error("socket is empty"))}this.send(e.msg);return this.socketRequestHelper.newRequest(e)};SocketClient.prototype.send=function(e){this.socket.send(JSON.stringify(e))};SocketClient.prototype.setIsReady=function(e){this._isReady=e};SocketClient.prototype.isReady=function(){return this._isReady};SocketClient.prototype.isConnected=function(){return this.socket.readyState===b.OPEN};SocketClient.prototype.isClientAvailable=function(){return this.socket&&this.isConnected()&&this._isReady};SocketClient.prototype.stop=function(){U.info("closing socket");this._isClosed=true;this.socket.close()};return SocketClient}();var H=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var G=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(H(arguments[t]));return e};var B=function(){function EventChannelController(e,t){this._emitter=e;this._channelName=t;this._statusListeners=[]}EventChannelController.prototype.emit=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}this._emitter.emit(this._channelName,{event:e,args:t})};EventChannelController.prototype.forwardChannelEventsTo=function(e,t){var forwardFn=function(e){return function(){var n=[];for(var r=0;r<arguments.length;r++){n[r]=arguments[r]}t.emit.apply(t,G([e],n))}};var n={};e.forEach((function(e){return n[e]=forwardFn(e)}));this.on(n)};EventChannelController.prototype.on=function(e){var listener=function(t){if(e[t.event]){e[t.event].apply(e,G(t.args))}};this._statusListeners.push(listener);this._emitter.on(this._channelName,listener)};EventChannelController.prototype.onAny=function(e){var listener=function(t){e.apply(void 0,G([t.event],t.args))};this._statusListeners.push(listener);this._emitter.on(this._channelName,listener)};EventChannelController.prototype.clear=function(){var e=this;this._statusListeners.forEach((function(t){return e._emitter.off(e._channelName,t)}));this._statusListeners=[]};return EventChannelController}();var q=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Y=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var K=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Q=function(e){q(Socket,e);function Socket(t,n){var r=e.call(this)||this;r._serverUrl=t;r._socketDelegate=n;r.latestPongTime=0;r.isManualStopped=false;r._startTimeout=8e3;r._statusChannel=new B(r,"socket");return r}Socket.prototype.start=function(e){var t=this;if(e===void 0){e=false}this._statusChannel.emit(e?p.hj.RECONNECTING:p.hj.CONNECTING);if(this._socketClient){this.stop(true)}this._statusChannel.emit(p.hj.CONNECTING);this._socketClient=new x(this._serverUrl,this._socketDelegate);return new Promise((function(e,n){t._startTimer=setTimeout((function(){t._statusChannel.emit(p.hj.DISCONNECTED);t.stop();n(new Error("websocket open timeout"))}),t._startTimeout);if(t._socketClient){t._socketClient.socket.onopen=function(){t._statusChannel.emit(p.hj.CONNECTED);t.setIsReady(true);clearTimeout(t._startTimer);e(t)};t._socketClient.socket.onerror=function(){t._statusChannel.emit(p.hj.DISCONNECTED);t.stop();t._socketDelegate.recovery&&t._socketDelegate.recovery();n(new Error("websocket connect error"))}}}))};Socket.prototype.isConnected=function(){return this._socketClient&&this._socketClient.isConnected()};Socket.prototype.setIsReady=function(e){this._socketClient&&this._socketClient.setIsReady(e)};Socket.prototype.isReady=function(){return this._socketClient&&this._socketClient.isReady()};Socket.prototype.stop=function(e){if(e===void 0){e=false}!e&&this._statusChannel.emit(p.hj.TERMINATING);clearTimeout(this._startTimer);this._socketClient&&this._socketClient.stop();!e&&this._statusChannel.emit(p.hj.TERMINATED)};Socket.prototype.request=function(e){return Y(this,void 0,void 0,(function(){var t;return K(this,(function(n){switch(n.label){case 0:return[4,this._socketClient.request(e)];case 1:t=n.sent();if(t.msg.err_code||t.msg.err_message){return[2,Promise.reject(t.msg)]}return[2,t.msg]}}))}))};Socket.prototype.respond=function(e){return this._socketClient.send(e.msg)};Socket.prototype.getStatusController=function(){return this._statusChannel};Socket.EVENTS={STATUS:p.hj};return Socket}(D.EventEmitter2);var W=undefined&&undefined.__assign||function(){W=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return W.apply(this,arguments)};var J="webcli";var z=function(){function SocketRequest(e,t,n){this._timeout=1e4;this._isResponse=false;this._isAck=false;this._msg=W({},e);this._isResponse=n;this._isAck=t;this._init()}SocketRequest.prototype._init=function(){if(this._isResponse){var e=this._msg.event;this._msg.event=P.get(e)||e;this._msg.success=true}else if(this._isAck){var e=this._msg.event;this._msg.event=A.get(e)||e;this._msg.success=true}else{this._msg.req_src=J;this._msg.version=this._msg.version?this._msg.version:1}};Object.defineProperty(SocketRequest.prototype,"seq",{get:function(){return this._msg.req_seq.toString()},enumerable:true,configurable:true});Object.defineProperty(SocketRequest.prototype,"timeout",{get:function(){return this._timeout},enumerable:true,configurable:true});Object.defineProperty(SocketRequest.prototype,"msg",{get:function(){return this._msg},enumerable:true,configurable:true});SocketRequest.prototype.isResponse=function(){return this._isAck||this._isResponse};return SocketRequest}();var $=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var X=undefined&&undefined.__assign||function(){X=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return X.apply(this,arguments)};var Z=undefined&&undefined.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var ee=function(e){$(ParticipantInfoEntityController,e);function ParticipantInfoEntityController(t){return e.call(this,t,c.FY.ENTITY.PARTICIPANT_INFO)||this}ParticipantInfoEntityController.prototype.extractHandleData=function(e){return e===null||e===void 0?void 0:e.participants};ParticipantInfoEntityController.prototype.onHandleData=function(e,t){var n=this;var r=[];e.forEach((function(e){var t,i,o,a;var s=n.getEntitySynchronously(e.id);if(s){g.mergeCommonFieldsFromPartialObject(s,e,false,["id","sessionIDs","streamIDs","dialIDs","sessions","streams","dials","demandIDs","demands"]);g.mergeArrayIdFieldsFromPartialObject("sessionIDs","sessions",s,e);g.mergeArrayIdFieldsFromPartialObject("streamIDs","streams",s,e);g.mergeArrayIdFieldsFromPartialObject("dialIDs","dials",s,e);g.mergeArrayIdFieldsFromPartialObject("demandIDs","demands",s,e)}else{var l=e.streams,u=e.sessions,c=e.dials,d=e.demands,f=Z(e,["streams","sessions","dials","demands"]);var p=((t=e.streams)===null||t===void 0?void 0:t.map((function(e){return e.id})))||[];var h=((i=e.sessions)===null||i===void 0?void 0:i.map((function(e){return e.id})))||[];var _=((o=e.dials)===null||o===void 0?void 0:o.map((function(e){return e.id})))||[];var v=((a=e.demands)===null||a===void 0?void 0:a.map((function(e){return e.id})))||[];s=X(X({},f),{streamIDs:p,sessionIDs:h,dialIDs:_,demandIDs:v})}if(s.justCreated===true){s.isSelf=true}r.push(s)}));this.bulkPutSync(r);return r};Object.defineProperty(ParticipantInfoEntityController.prototype,"needProcessSocketEvents",{get:function(){return[I.PSTN_AS_REPORT_REQ]},enumerable:true,configurable:true});ParticipantInfoEntityController.prototype.onHandleSocketData=function(e){var t;if(!this._isPSTNActiveSpeakerReport(e)){return}var n=this.getAllSync();n.forEach((function(e){return e.isPSTNSpeaking=false}));(t=e.active_speakers)===null||t===void 0?void 0:t.forEach((function(e){n.forEach((function(t){if(t.id===e){t.isPSTNSpeaking=true}}))}));return n};ParticipantInfoEntityController.prototype._isPSTNActiveSpeakerReport=function(e){return e.active_speakers!==undefined};ParticipantInfoEntityController.prototype.getSelfParticipant=function(){return this.getEntitiesSync((function(e){return e.isSelf===true}))[0]};return ParticipantInfoEntityController}(u);var te=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var ne=undefined&&undefined.__assign||function(){ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return ne.apply(this,arguments)};var re=function(e){te(StreamInfoEntityController,e);function StreamInfoEntityController(t){return e.call(this,t,c.FY.ENTITY.STREAM_INFO)||this}StreamInfoEntityController.prototype.extractHandleData=function(e){var t=this;var n=[];var r=e.participants;r===null||r===void 0?void 0:r.forEach((function(e){var r=e.streams,i=e.sessions;if(r){r.forEach((function(t){return t.participantId=e.id}));n=n.concat(r)}if(i){var o=i.filter((function(e){return e.deleted}));o.forEach((function(e){var r=t.getEntitiesSync((function(t){return t.sessionId===e.id}));r.forEach((function(t){var r=n.find((function(e){return e.id===t.id}));if(r){r.deleted=e.deleted}else{n.push({id:t.id,deleted:e.deleted})}}))}))}}));return n};StreamInfoEntityController.prototype.onHandleData=function(e,t){var n=this;var r=[];e.forEach((function(e){var t=n.getSynchronously(e.id);if(t)g.mergeCommonFieldsFromPartialObject(t,e,false);else{t=e}r.push(t)}));this.bulkPutSync(r);return r};Object.defineProperty(StreamInfoEntityController.prototype,"needProcessSocketEvents",{get:function(){return[I.ACTIVE_SPEAKERS_REPORT_REQ]},enumerable:true,configurable:true});StreamInfoEntityController.prototype.onHandleSocketData=function(e){var t=this;if(!this._isActiveSpeakerReport(e)){return}var n=e.remote_streams?e.remote_streams:[];if(n.length<=0){return}var r=[];n.forEach((function(e){var n=t.getSynchronously(e.id);if(n){var i=(e.v||0)>0;var o=e.q===0&&((e.desired_q||0)<=0||(e.available_q||0)>0);n.noDataTransmitting=o;n.isSpeaking=i;r.push(n)}}));return r};StreamInfoEntityController.prototype._isActiveSpeakerReport=function(e){return e.remote_streams!==undefined||e.local_streams!==undefined};StreamInfoEntityController.prototype.handleRecoveryChanges=function(e,t){var n=this.batchGetSync(e).filter((function(e){return!e.recovery!==!t})).map((function(e){return ne(ne({},e),{recovery:t})}));if(n===null||n===void 0?void 0:n.length){this.bulkPutSync(n);this.emitEntityUpdate(n)}};StreamInfoEntityController.prototype.needHandleMediaData=function(){return true};StreamInfoEntityController.prototype.onHandleMediaData=function(e,t){if(!e.inactive){r.k.log("[NQICore] onHandleMediaData !data.inactive");this.handleRecoveryChanges([t],false)}return null};return StreamInfoEntityController}(u);var ie=n(298784);var oe=n.n(ie);var ae=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var se=undefined&&undefined.__assign||function(){se=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return se.apply(this,arguments)};var le=r.k.tags("[active speaker]");var ue=function(e){ae(SessionInfoEntityController,e);function SessionInfoEntityController(t){var n=e.call(this,t,c.FY.ENTITY.SESSION_INFO)||this;n._currentActiveSessionId=undefined;n.resetActiveSession=function(e,t){var r=[];if((e===null||e===void 0?void 0:e.id)===(t===null||t===void 0?void 0:t.id)){le.log("same active session, no need to change.");return r}if(t){t.isActive=undefined;r.push(t)}if(e){e.isActive=true;r.push(e);n._currentActiveSessionId=e.id}else{n._currentActiveSessionId=undefined}le.log("change active session to ",n._currentActiveSessionId);return r};return n}SessionInfoEntityController.prototype.extractHandleData=function(e,t,n){var r=this;var i=[];var o=[];var a=e.participants;a===null||a===void 0?void 0:a.forEach((function(e){var a=e.sessions,s=e.streams;if(a){a.forEach((function(t){return t.participantId=e.id}));i=i.concat(a);if(t||n){var l=r.getEntitiesSync((function(t){return t.participantId===e.id}))||[];var u=oe().differenceWith(l,a,(function(e,t){return e.id===t.id})).map((function(e){return se(se({},e),{deleted:true})}));if(u===null||u===void 0?void 0:u.length){i=i.concat(u)}}}if(s){o=o.concat(s)}}));o.forEach((function(e){if(!e.sessionId){return}var t=false;var n=i.find((function(t){return t.id===e.sessionId}));if(!n){n={id:e.sessionId};t=true}var r=n.streamIds||[];r.push(e.id);n.streamIds=r;t&&i.push(n)}));return i};SessionInfoEntityController.prototype.onHandleData=function(e,t){var n=this;var r=[];e.forEach((function(e){var t=n.getSynchronously(e.id);if(t){g.mergeCommonFieldsFromPartialObject(t,e,false,["id","streamIds"]);g.mergeArrayIdFields(t,e,"streamIds")}else{t=e}if(e.justCreated===true){t.isSelf=true}r.push(t)}));this.bulkPutSync(r);return r};Object.defineProperty(SessionInfoEntityController.prototype,"needProcessSocketEvents",{get:function(){return[I.ACTIVE_SPEAKERS_REPORT_REQ,I.PSTN_AS_REPORT_REQ]},enumerable:true,configurable:true});SessionInfoEntityController.prototype.onHandleSocketData=function(e){var t=this.resetActiveSession(e.active_session?this.getSynchronously(e.active_session):undefined,this.getSynchronously(this._currentActiveSessionId||""));return t};return SessionInfoEntityController}(u);var ce=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var de="mixed_audio_stream";var fe=function(e){ce(MediaStreamController,e);function MediaStreamController(t){var n=e.call(this,t,c.FY.ENTITY.MEDIA_STREAM)||this;n._mixedAudioStreamId=de+"."+t;return n}Object.defineProperty(MediaStreamController.prototype,"mixedAudioStreamId",{get:function(){return this._mixedAudioStreamId},enumerable:true,configurable:true});MediaStreamController.prototype.needHandleMediaData=function(){return true};MediaStreamController.prototype.onHandleMediaData=function(e,t){var n=t.indexOf("mix")>=0?this._mixedAudioStreamId:t;var i=e.stream,o=e.inactive;var a=this.getSynchronously(n);if(a){r.k.log("media stream updated, id=",n," deleted=",o," msid=",i?i.id:"no");i&&(a.mediaStream=i);a.inactive=o||false}else if(i){r.k.log("new media stream received and ready to notify, id=",n," msid=",i.id);a={id:n,mediaStream:i}}a&&this.putSync(a);return a};return MediaStreamController}(u);var pe=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var he=undefined&&undefined.__assign||function(){he=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return he.apply(this,arguments)};var _e=function(e){pe(MeetingStatusEntityController,e);function MeetingStatusEntityController(t){return e.call(this,t,c.FY.ENTITY.MEETING_STATUS)||this}MeetingStatusEntityController.prototype.onHandleMeetingStatusData=function(e){var t=he({id:this.localIdentifier},e);this.putSync(t);return t};return MeetingStatusEntityController}(u);var ve=n(725579);var ge=n(626896);var ye=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var me=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ye(arguments[t]));return e};var Se=function(){function LocalDataHandler(){this._logger=r.k.tags("["+LocalDataHandler.name+"]");this._remoteSelfMeetingEntityIds={};this._bridgeType=ve._b.MEETING;this._participantWithLocalStub=[];this._localMeetingIdentifier=(0,ge.DO)()}Object.defineProperty(LocalDataHandler.prototype,"localMeetingIdentifier",{get:function(){return this._localMeetingIdentifier},enumerable:true,configurable:true});Object.defineProperty(LocalDataHandler.prototype,"localSelfMeetingEntityIds",{get:function(){return this._localSelfMeetingEntityIds},enumerable:true,configurable:true});Object.defineProperty(LocalDataHandler.prototype,"remoteSelfMeetingEntityIds",{get:function(){return this._remoteSelfMeetingEntityIds||{}},enumerable:true,configurable:true});Object.defineProperty(LocalDataHandler.prototype,"bridgeType",{set:function(e){this._bridgeType=e},enumerable:true,configurable:true});LocalDataHandler.prototype.buildInitialLocalMeetingData=function(e){var t=this._buildInitialLocalMeetingDataInternal(e),n=t.data,r=t.ids;this._localSelfMeetingEntityIds=r;return n};LocalDataHandler.prototype.buildInitialLocalState=function(){return{media:{audioMute:true,videoMute:true,audioJoined:false}}};LocalDataHandler.prototype.prehandleMeetingData=function(e,t){this._mapRemoteIdToLocalId(e,t);this._needProcessLocalStubStream()&&this._processLocalStubStream(e,t);return e};LocalDataHandler.prototype.prehandleMediaStreamTapId=function(e){if(this._remoteSelfMeetingEntityIds&&this._localSelfMeetingEntityIds&&e===this._remoteSelfMeetingEntityIds.streamId){return this._localSelfMeetingEntityIds.streamId}return e};LocalDataHandler.prototype._mapRemoteIdToLocalId=function(e,t){if(t){var n=this._storeNewRemoteEntityIds(e);this._markPreviousSelfEntitiesAsDeleted(e,n)}this._replaceRemoteEntityIdsToLocalIds(e)};LocalDataHandler.prototype._processLocalStubStream=function(e,t){var n=this;var r;(r=e.participants)===null||r===void 0?void 0:r.forEach((function(e){var r,i;if(t&&e.id&&e.ringing===true&&(((r=e.sessions)===null||r===void 0?void 0:r.length)||0)===0&&(((i=e.streams)===null||i===void 0?void 0:i.length)||0)===0){var o={id:n._localStubStreamId(e.id),sessionId:n._localStubSessionId(e.id),type:"video/main",participantId:e.id,localStubStream:true};e.streams=[o];n._participantWithLocalStub.push(e.id)}else if(n._participantWithLocalStub.some((function(t){return t===e.id}))){if(e.id&&(e.streams&&e.streams.length>0||!!e.rejectTime||!!e.noanswerTime)){var a=e.streams||[];e.streams=me(a,[{id:n._localStubStreamId(e.id),deleted:true}]);n._participantWithLocalStub=n._participantWithLocalStub.filter((function(t){return t!==e.id}))}}}))};LocalDataHandler.prototype._buildInitialLocalMeetingDataInternal=function(e){var t=this._localMeetingIdentifier+".meeting";var n=this._localMeetingIdentifier+".participant";var r=this._localMeetingIdentifier+".session";var i=this._localMeetingIdentifier+".mainStream";var o={id:t,participants:[{id:n,displayName:e,justCreated:true,streams:[{id:i,sessionId:r,justCreated:true,type:"video/main",selfLocalStream:true,audio:{isActiveIn:false,isActiveOut:false}}],sessions:[{id:r,justCreated:true,localMuteVideo:true}],dials:[]}]};return{data:o,ids:{meetingInfoId:t,participantId:n,sessionId:r,streamId:i}}};LocalDataHandler.prototype._storeNewRemoteEntityIds=function(e){var t;this._remoteSelfMeetingEntityIds.meetingInfoId=e.id;var n=(t=e.participants)===null||t===void 0?void 0:t.find((function(e){return e.justCreated}));n&&(this._remoteSelfMeetingEntityIds.participantId=n===null||n===void 0?void 0:n.id);var r={};r.sessionId=this._resetRemoteSelfEntityId("sessionId",n===null||n===void 0?void 0:n.sessions);r.streamId=this._resetRemoteSelfEntityId("streamId",n===null||n===void 0?void 0:n.streams);return r};LocalDataHandler.prototype._replaceRemoteEntityIdsToLocalIds=function(e){var t=this;if(!this._remoteSelfMeetingEntityIds||!e.participants||!this._localSelfMeetingEntityIds){return}e.participants.forEach((function(e){var n,r;if(e.id===t._remoteSelfMeetingEntityIds.participantId){e.id=t._localSelfMeetingEntityIds.participantId;(n=e.sessions)===null||n===void 0?void 0:n.forEach((function(e){if(e.id===t._remoteSelfMeetingEntityIds.sessionId){e.id=t._localSelfMeetingEntityIds.sessionId}}));(r=e.streams)===null||r===void 0?void 0:r.forEach((function(e){if(e.id===t._remoteSelfMeetingEntityIds.streamId){e.id=t._localSelfMeetingEntityIds.streamId}if(e.sessionId===t._remoteSelfMeetingEntityIds.sessionId){e.sessionId=t._localSelfMeetingEntityIds.sessionId;e.selfLocalStream=true}}))}}))};LocalDataHandler.prototype._needProcessLocalStubStream=function(){return this._bridgeType===ve._b.CALL};LocalDataHandler.prototype._localStubStreamId=function(e){return e+"-local-stub-stream"};LocalDataHandler.prototype._localStubSessionId=function(e){return e+"-local-stub-session"};LocalDataHandler.prototype._markPreviousSelfEntitiesAsDeleted=function(e,t){var n=this;var r;var i=(r=e.participants)===null||r===void 0?void 0:r.find((function(e){return e.id===n._remoteSelfMeetingEntityIds.participantId}));this._addDeletedEntityById(i===null||i===void 0?void 0:i.sessions,t.sessionId);this._addDeletedEntityById(i===null||i===void 0?void 0:i.streams,t.streamId)};LocalDataHandler.prototype._addDeletedEntityById=function(e,t){if(e&&t){this._logger.info("set old entity deleted, oldId:",t);e.push({id:t,deleted:true})}};LocalDataHandler.prototype._resetRemoteSelfEntityId=function(e,t){var n=t===null||t===void 0?void 0:t.find((function(e){return e.justCreated}));var r=this._remoteSelfMeetingEntityIds[e];if(n&&r!==n.id){this._logger.info("change remote "+e+" from oldId:"+r+" to newId:"+n.id);this._remoteSelfMeetingEntityIds[e]=n.id;return r}return undefined};return LocalDataHandler}();var Ce=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ee=function(e){Ce(SessionNetworkStatusEntityController,e);function SessionNetworkStatusEntityController(t){return e.call(this,t,c.FY.ENTITY.SESSION_NETWORK_STATUS)||this}SessionNetworkStatusEntityController.prototype.handleRemoteNetworkQualityUpdate=function(e){var t=this;var n=e.filter((function(e){var n=t.getSynchronously(e.id);return(n===null||n===void 0?void 0:n.quality)!==e.quality}));if(n===null||n===void 0?void 0:n.length){this.bulkPutSync(n);this.emitEntityUpdate(n)}};SessionNetworkStatusEntityController.prototype.handleLocalNetworkQualityUpdate=function(e){this.putSync(e);this.emitEntityUpdate([e])};return SessionNetworkStatusEntityController}(u);var be=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ie=function(e){be(SessionConnectivityEntityController,e);function SessionConnectivityEntityController(t){return e.call(this,t,c.FY.ENTITY.SESSION_CONNECTIVITY)||this}SessionConnectivityEntityController.prototype.handleSessionStatusUpdate=function(e){this.putSync(e);this.emitEntityUpdate(e)};return SessionConnectivityEntityController}(u);var Me=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Re=function(e){Me(DialInfoEntityController,e);function DialInfoEntityController(t){return e.call(this,t,c.FY.ENTITY.DIAL_INFO)||this}DialInfoEntityController.prototype.extractHandleData=function(e){var t=[];var n=e.participants;n===null||n===void 0?void 0:n.forEach((function(e){var n=e.dials;if(n){t=t.concat(n)}}));return t};DialInfoEntityController.prototype.onHandleData=function(e,t){var n=this;var r=[];e.forEach((function(e){var t=n.getSynchronously(e.id);if(t){g.mergeCommonFieldsFromPartialObject(t,e,false)}else{t=e}r.push(t)}));this.bulkPutSync(r);return r};return DialInfoEntityController}(u);var Te=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Oe=r.k.tags("[DemandInfoEntityController]");var Ae=function(e){Te(DemandInfoEntityController,e);function DemandInfoEntityController(t){return e.call(this,t,c.FY.ENTITY.DEMAND_INFO)||this}Object.defineProperty(DemandInfoEntityController.prototype,"preHandleData",{set:function(e){Oe.log("set preHandleData");this._preHandleData=e},enumerable:true,configurable:true});Object.defineProperty(DemandInfoEntityController.prototype,"currentParticipantId",{set:function(e){Oe.log("set participantId, participantId: ",e);this._currentParticipantId=e},enumerable:true,configurable:true});DemandInfoEntityController.prototype.extractHandleData=function(e){var t=this;var n=[];var r=e.participants;r===null||r===void 0?void 0:r.forEach((function(e){var t=e.demands;if(t){n=n.concat(t)}}));n.forEach((function(e){var n,r,i;if(e.deleted){return}if(e.decisions){return}if((e===null||e===void 0?void 0:e.status)===p.Uf.NEW){if(((n=e===null||e===void 0?void 0:e.resource)===null||n===void 0?void 0:n.participantId)&&((r=e===null||e===void 0?void 0:e.resource)===null||r===void 0?void 0:r.participantId)!==t._currentParticipantId){e.isSelf=false}else if(((i=e.info)===null||i===void 0?void 0:i.participantId)===t._currentParticipantId){e.isSelf=false}else{e.isSelf=true}}if(!(e===null||e===void 0?void 0:e.resource)){e.isSelfOnly=false}else{e.isSelfOnly=e.isSelf}Oe.log("receive demand, demand: "+e.id+", isSelf: "+e.isSelf+", isSelfOnly: "+e.isSelfOnly)}));return n};DemandInfoEntityController.prototype.onHandleData=function(e,t){var n=[];if(this._preHandleData){n=n.concat(this._preHandleData(e,t))}this.bulkPutSync(n);return n};DemandInfoEntityController.prototype.handleDemandDeleted=function(e){var t=this.getSynchronously(e);var n=t===null||t===void 0?void 0:t.type;var r=[];if(n){var i=this.getEntitiesSync((function(e){return e.type===n&&!e.deleted}));i.forEach((function(e){e.deleted=true}));r=i.map((function(e){return e.id}));this.bulkPutSync(i);this.emitEntityUpdate(i)}return r};return DemandInfoEntityController}(u);var Pe=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ne=undefined&&undefined.__assign||function(){Ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Ne.apply(this,arguments)};var we=r.k.tags("[local state]");var De=function(e){Pe(LocalStateEntityController,e);function LocalStateEntityController(t){return e.call(this,t,c.FY.ENTITY.LOCAL_STATE)||this}LocalStateEntityController.prototype.handleNewLocalState=function(e){we.log("new local state:",e);var t=this.getSynchronously(this.localIdentifier);var n;if(t){n=(0,ie.merge)(t,e)}else{n=Ne(Ne({},e),{id:this.localIdentifier})}this.putSync(n);this.emitEntityUpdate([n])};return LocalStateEntityController}(u);var ke=undefined&&undefined.__assign||function(){ke=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return ke.apply(this,arguments)};var Le=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Fe=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Ve=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var Ue=function(){function MeetingDataProvider(){this.PSTN_USER_AGENT="rcv/pstn";this._controllerMap=new Map;this._bridgeId="";this._localIdentifier="";this._localDataHandler=new Se;this._localIdentifier=this._localDataHandler.localMeetingIdentifier;this._initEntityController(new f(this._localIdentifier));this._initEntityController(new C(this._localIdentifier));this._initEntityController(new ee(this._localIdentifier));this._initEntityController(new re(this._localIdentifier));this._initEntityController(new ue(this._localIdentifier));this._initEntityController(new fe(this._localIdentifier));this._initEntityController(new _e(this._localIdentifier));this._initEntityController(new Ee(this._localIdentifier));this._initEntityController(new Ie(this._localIdentifier));this._initEntityController(new Re(this._localIdentifier));this._initEntityController(new Ae(this._localIdentifier));this._initEntityController(new De(this._localIdentifier))}MeetingDataProvider.prototype.clean=function(){return Le(this,void 0,void 0,(function(){return Fe(this,(function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._controllerMap).map((function(e){var t=Ve(e,2),n=t[1];n.notifyDeleteAndClear()})))];case 1:e.sent();this._controllerMap.clear();delete this._controllerMap;return[2]}}))}))};MeetingDataProvider.prototype.getEntityControllerByEntityKey=function(e){return this._controllerMap.get(e)};MeetingDataProvider.prototype.hasValidBridge=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.BRIDGE_INFO);var t=e.getEntitiesSync();return t.length===1};MeetingDataProvider.prototype.initLocalMeetingInfo=function(e){var t=this._localDataHandler.buildInitialLocalMeetingData(e);this.handleData(t,false);var n=this._localDataHandler.buildInitialLocalState();this.handleNewLocalState(n)};MeetingDataProvider.prototype.handleData=function(e,t,n){if(t===void 0){t=false}if(n===void 0){n=false}var r=this._localDataHandler.prehandleMeetingData(e,t);this._controllerMap.forEach((function(e){e.handleData(r,t,n)}))};MeetingDataProvider.prototype.handleSocketData=function(e){this._controllerMap.forEach((function(t){t.handleSocketData(e)}))};MeetingDataProvider.prototype.handleMediaData=function(e,t){var n=this._localDataHandler.prehandleMediaStreamTapId(t);this._controllerMap.forEach((function(t){return t.handleMediaData(e,n)}))};MeetingDataProvider.prototype.localIdentifier=function(){return this._localIdentifier};MeetingDataProvider.prototype.handleMeetingStatusData=function(e){r.k.log("handleMeetingStatusData: ",e);this._controllerMap.forEach((function(t){return t.handleMeetingStatusData(e)}))};MeetingDataProvider.prototype.bridgeId=function(){return this._bridgeId};MeetingDataProvider.prototype.remoteSelfMeetingEntityIds=function(){return this._localDataHandler.remoteSelfMeetingEntityIds};MeetingDataProvider.prototype.localSelfMeetingEntityIds=function(){return this._localDataHandler.localSelfMeetingEntityIds};MeetingDataProvider.prototype.localSession=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_INFO);return e.getEntitiesSync((function(e){return e.isSelf===true}))[0]};MeetingDataProvider.prototype.meetingInfo=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.MEETING_INFO);return e.getEntitiesSync()[0]};MeetingDataProvider.prototype.handleBridgeInfo=function(e){this._bridgeId=e.id;var t=this.getEntityControllerByEntityKey(c.FY.ENTITY.BRIDGE_INFO);t.saveBridgeInfo(e);var n=this.getEntityControllerByEntityKey(c.FY.ENTITY.MEETING_INFO);n.shortId=e.shortId;this._localDataHandler.bridgeType=e.type||p._b.MEETING;n.handleData({bridgeInfo:e})};MeetingDataProvider.prototype.handleRemoteNetworkQualityUpdate=function(e){var t=this.getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_NETWORK_STATUS);t===null||t===void 0?void 0:t.handleRemoteNetworkQualityUpdate(e)};MeetingDataProvider.prototype.handleLocalNetworkQualityUpdate=function(e){var t=this.getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_NETWORK_STATUS);t===null||t===void 0?void 0:t.handleLocalNetworkQualityUpdate(ke({id:this._localDataHandler.localSelfMeetingEntityIds.sessionId},e))};MeetingDataProvider.prototype.handleSessionStatusUpdate=function(e){var t=e.media,n=e.streams;var r=this.getEntityControllerByEntityKey(c.FY.ENTITY.STREAM_INFO);var i=this.getEntityControllerByEntityKey(c.FY.ENTITY.MEDIA_STREAM);r.handleRecoveryChanges(n.filter((function(e){return!!i.getSynchronously(e)})),!t);var o=this.getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_CONNECTIVITY);o===null||o===void 0?void 0:o.handleSessionStatusUpdate(e)};MeetingDataProvider.prototype.handleNewLocalState=function(e){var t=this.getEntityControllerByEntityKey(c.FY.ENTITY.LOCAL_STATE);t.handleNewLocalState(e)};MeetingDataProvider.prototype.getLocalParticipantInfo=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.PARTICIPANT_INFO);var t=e.getEntitiesSync((function(e){return!!e.isSelf&&!e.deleted}));return t.length===0?null:t[0]};MeetingDataProvider.prototype.getLocalSessionInfo=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_INFO);var t=e.getEntitiesSync((function(e){return!!e.isSelf&&!e.deleted}));if(t.length<1){return null}return t[0]};MeetingDataProvider.prototype.getLocalParticipantPSTNSessionInfo=function(){var e=this;var t;var n=(t=this._localDataHandler.localSelfMeetingEntityIds)===null||t===void 0?void 0:t.participantId;if(!n){return null}var r=this.getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_INFO);var i=r.getEntitiesSync((function(e){return!e.deleted&&(e===null||e===void 0?void 0:e.participantId)===n}));if(i.length<1){return null}var o=null;i.forEach((function(t){if(e._hasSessionIsActivePSTN(t)){o=t}}));return o};MeetingDataProvider.prototype.getLocalStreamInfo=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.STREAM_INFO);var t=e.getEntitiesSync((function(e){return!!e.selfLocalStream}));if(t.length<1){return null}return t[0]};MeetingDataProvider.prototype.getLocalState=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.LOCAL_STATE);return e.getSynchronously(this._localIdentifier)};MeetingDataProvider.prototype._hasSessionIsActivePSTN=function(e){return!e.deleted&&e.userAgent===this.PSTN_USER_AGENT};MeetingDataProvider.prototype.getSelfParticipantEntity=function(){var e=this.getEntityControllerByEntityKey(c.FY.ENTITY.PARTICIPANT_INFO);return e.getSelfParticipant()};MeetingDataProvider.prototype.getRemoteMeetingIds=function(){return this.remoteSelfMeetingEntityIds()};MeetingDataProvider.prototype._initEntityController=function(e){this._controllerMap.set(e.entityKey,e)};MeetingDataProvider.prototype.addMeetingEntityController=function(e){this._initEntityController(e)};return MeetingDataProvider}();var je=n(313242);var xe;(function(e){e["VIDEO"]="video";e["AUDIO"]="audio";e["DATA"]="application"})(xe||(xe={}));var He;(function(e){e["OPUS"]="OPUS/48000/2";e["VP8"]="VP8/90000";e["VP9"]="VP9/90000";e["G722"]="G722/8000";e["PCMU"]="PCMU/8000";e["PCMA"]="PCMA/8000";e["H264"]="H264/90000";e["CN8000"]="CN/8000";e["CN16000"]="CN/16000";e["CN32000"]="CN/32000";e["ULPFEC"]="ULPFEC/90000";e["RED"]="RED/90000";e["FLEXFEC_03"]="FLEXFEC-03/90000";e["RTX"]="RTX/90000"})(He||(He={}));var Ge;(function(e){e["REMOTE_STREAM_ADDED"]="remote_stream_added";e["REMOTE_STREAM_BEFORE_REMOVE"]="remote_stream_before_remove";e["REMOTE_STREAM_REMOVED"]="remote_stream_removed";e["LOCAL_STREAM_ADDED"]="local_stream_added";e["LOCAL_STREAM_REMOVED"]="local_stream_removed";e["LOCAL_CANDIDATE"]="local_candidate";e["END_OF_LOCAL_CANDIDATES"]="end_of_candidates";e["ICE_STATE_CHANGED"]="nice_state_changed";e["SFU_STAT_RECEIVED"]="sfu_stat_received";e["CONSUMERS_UPDATED"]="consumers_updated";e["NEW_REMOTE_SESSION_ID"]="new_remote_session_id";e["NO_INCOMING_DATA_TIMEOUT"]="no_incoming_data_timeout";e["CONTROL_CHANNEL_CLOSED_UNEXPECTEDLY"]="control_channel_closed_unexpectedly";e["MIX_AUDIO_MODE_STATE_CHANGED"]="mix_audio_mode_state_changed";e["NEGOTIATE_VIDEO_MODE_STATE_CHANGED"]="negotiate_video_mode_state_changed";e["NETWORK_TYPE_CHANGED"]="network_type_changed";e["CONNECTED"]="connected";e["BEFORE_CLOSE"]="before_close";e["CLOSED"]="closed"})(Ge||(Ge={}));var Be;(function(e){e["NONE"]="none";e["NEW"]="new";e["CHECKING"]="checking";e["CONNECTED"]="connected";e["COMPLETED"]="completed";e["DISCONNECTED"]="disconnected";e["FAILED"]="failed";e["CLOSED"]="closed"})(Be||(Be={}));var qe;(function(e){e["ALWAYS"]="always";e["NEVER"]="never";e["AUTO"]="auto"})(qe||(qe={}));var Ye;(function(e){e["ALWAYS"]="always";e["NEVER"]="never";e["AUTO"]="auto"})(Ye||(Ye={}));var Ke;(function(e){e["version"]="v";e["media"]="m";e["attribute"]="a";e["bandwidth"]="b";e["origin"]="o";e["time"]="t";e["name"]="s";e["connection"]="c"})(Ke||(Ke={}));var Qe;(function(e){e["VIDEO"]="video";e["AUDIO"]="audio";e["DATA"]="application"})(Qe||(Qe={}));function getSDPAttribute(e,t){if(!e.attributes){return[]}return getAttributeProperty(e.attributes,t)}function setSDPAttribute(e,t,n){e.attributes=e.attributes||{};addAttributeProperty(e.attributes,t,n)}function deleteSDPAttribute(e,t){e.attributes&&delete e.attributes[t]}function addAttributeProperty(e,t,n){if(typeof n==="undefined"){n=true}var r=e[t];if(typeof r==="undefined"){e[t]=n}else if(Array.isArray(r)){if(Array.isArray(n)){e[t]=r.concat(n)}else if(r.length===0){e[t]=n}else{e[t].push(n)}}else if(Array.isArray(n)){e[t]=[r].concat(n)}else{e[t]=[r,n]}}function getAttributeProperty(e,t){var n=e[t];if(typeof n==="undefined"){return[]}if(Array.isArray(n)){return n}return[n]}var We=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Je=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var ze=function(){function SDPParser(e){var t;this._parseMap=(t={},t[Ke.attribute]=this._parseAttribute,t[Ke.media]=this._parseMedia,t[Ke.bandwidth]=this._parseBandwidth,t[Ke.connection]=this._parseConnection,t[Ke.name]=this._parseSessionName,t[Ke.origin]=this._parseSDPOrigin,t[Ke.version]=this._parseSDPVersion,t[Ke.time]=this._parseTime,t);this._parseSuccess=false;this._sdp={attributes:{},media:[],name:"",origin:{},version:"0"};this._parseSDPString(e)}Object.defineProperty(SDPParser.prototype,"parseSuccess",{get:function(){return this._parseSuccess},enumerable:true,configurable:true});SDPParser.prototype.setSessionAttribute=function(e,t){setSDPAttribute(this._sdp,e,t)};SDPParser.prototype.getSessionAttribute=function(e){return getSDPAttribute(this._sdp,e)};SDPParser.prototype.getMedia=function(e){if(!e){return this._sdp.media||[]}return this._sdp.media.filter((function(t){return t.media===e}))};SDPParser.prototype.getFirstMediaAttribute=function(e,t){var n=this.getMediaAttributes(e,t);return n[0]};SDPParser.prototype.getMediaAttributes=function(e,t){return getAttributeProperty(e.attributes||{},t)};SDPParser.prototype.toString=function(){var e=this;var t=[];t.push("v="+(this._sdp.version||"0"));this._sdp.origin&&t.push("o="+[this._sdp.origin.username,this._sdp.origin.sessionId,this._sdp.origin.sessionVersion,this._sdp.origin.netType,this._sdp.origin.addrType,this._sdp.origin.unicastAddress].join(" "));this._sdp.name&&t.push("s="+this._sdp.name);var n=this._sdp.time;n&&t.push("t="+n.start+" "+n.stop);var r=this._generateConnectionLine(this._sdp);r&&t.push(r);var i=this._sdp.bandwidth;i&&t.push("b="+i.bwtype+":"+i.bandwidth);t=t.concat(this._generateAttributeLines(this._sdp));var o=this._sdp.media||[];o.forEach((function(n){t.push("m="+[n.media,n.port,n.proto,n.format].join(" "));var r=e._generateConnectionLine(n);r&&t.push(r);var i=n.bandwidth;i&&t.push("b="+i.bwtype+":"+i.bandwidth);t=t.concat(e._generateAttributeLines(n))}));t.push("");return t.join("\r\n")};SDPParser.prototype._parseSDPString=function(e){var t,n;this._parseContext=this._sdp;var r=e.replace(/\r\n/g,"\n").split("\n");try{for(var i=We(r),o=i.next();!o.done;o=i.next()){var a=o.value;var s=a.match(/^([a-zA-Z])=(.*)$/);if(s){var l=Je(s,3),u=l[1],c=l[2];var d=this._parseMap[u];if(d){d.bind(this)(c)}else{throw new Error("Unknown sdp section line type.")}}}}catch(e){t={error:e}}finally{try{if(o&&!o.done&&(n=i.return))n.call(i)}finally{if(t)throw t.error}}delete this._parseContext;this._parseSuccess=true};SDPParser.prototype._parseSessionName=function(e){if(!this._sdp.name||this._sdp.name===""){this._sdp.name=e}else{throw new Error("Bad session name. (duplicate)")}};SDPParser.prototype._parseSDPVersion=function(e){if(e==="0"){this._sdp.version="0"}else{throw new Error("Version "+e+" of SDP is not supported")}};SDPParser.prototype._parseSDPOrigin=function(e){var t=e.trim().split(" ");if(t.length===6){this._sdp.origin={username:t[0],sessionId:t[1],sessionVersion:t[2],netType:t[3],addrType:t[4],unicastAddress:t[5]}}else{throw new Error("Bad origin. Cannot parse ("+e+")")}};SDPParser.prototype._parseMedia=function(e){var t=e.match(/^(\S+) (\S+) (\S+) (.*)$/);var n={};if(t){n={media:t[1],port:t[2],proto:t[3],format:t[4],attributes:{}};this._sdp.media.push(n);this._parseContext=n}else{throw new Error("Bad media line. Cannot parse ("+e+")")}};SDPParser.prototype._parseTime=function(e){var t=e.match(/^(\S+) (\S+)$/);if(t){var n={start:t[1],stop:t[2]};this._sdp.time=n}else{throw new Error("Bad time line. Cannot parse ("+e+")")}};SDPParser.prototype._parseBandwidth=function(e){var t=e.match(/^([^:]+):(.*)$/);if(t){var n=t[1];var r=t[2];this._parseContext.bandwidth={bwtype:n,bandwidth:r}}else{throw new Error("Bad bandwidth line. Cannot parse ("+e+")")}};SDPParser.prototype._parseConnection=function(e){var t=e.trim().split(" ");if(t.length===3){var n={netType:t[0],addrType:t[1],connectionAddress:t[2]};this._parseContext.connectionData=n}else{throw new Error("Bad connection data line. Cannot parse ("+e+")")}};SDPParser.prototype._parseAttribute=function(e){var t;var n;var r=e.match(/^([^:]+):(.*)$/);if(r){t=r[1];n=r[2]}else{t=e;n=undefined}setSDPAttribute(this._parseContext,t,n)};SDPParser.prototype._generateConnectionLine=function(e){if(typeof e.connectionData!=="undefined"){var t=e.connectionData;return"c="+[t.netType,t.addrType,t.connectionAddress].join(" ")}return undefined};SDPParser.prototype._generateAttributeLines=function(e){var t=[];var _loop_1=function(n){if(Object.prototype.hasOwnProperty.call(e.attributes,n)){var r=getSDPAttribute(e,n);r.forEach((function(e){if(typeof e==="boolean"&&e===true){t.push("a="+n)}else if(typeof e==="string"||typeof e==="number"){t.push("a="+n+":"+e)}else{throw new Error("Unexpected attribute value (name="+n+" typeof value="+typeof e+")")}}))}};for(var n in e.attributes){_loop_1(n)}return t};return SDPParser}();var $e=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var Xe=4294967295;function makePlanBSimulcastSSRCs(e){var t=_extractMediaSSRCInfo(e),n=t.mediaMsId,r=t.videoTracksInfo;deleteSDPAttribute(e,"ssrc");deleteSDPAttribute(e,"ssrc-group");_injectSimulcastSSRCGroups(e,n,r)}function _extractMediaSSRCInfo(e){var t={};var n={};var r=getSDPAttribute(e,"ssrc");var i="";r.forEach((function(e){var r=e.match(/^(\d+) (.*)/);if(r){var o=$e(r,3),a=o[1],s=o[2];n[a]=n[a]||{};r=s.match(/cname:(.*)/);if(r){n[a].cname=r[1]}r=s.match(/msid:([^ ]+) (.*)/);if(r){n[a].trackId=r[2];var l=r[1];i===""&&(i=l);t[l]=t[l]||{info:{},ssrcs:[]};t[l].info=n[a];t[l].ssrcs.push(a)}}}));var o=getSDPAttribute(e,"ssrc-group");o.forEach((function(e){var n=e.match(/(FID|SIM) (.*)/);if(n){var r=n[1];var i=n[2].split(" ");for(var o in t){if(Object.prototype.hasOwnProperty.call(t,o)){if(t[o].ssrcs.indexOf(i[0])>-1){if(r==="FID"){t[o][r]=t[o][r]||[];t[o][r].push(i)}else if(r==="SIM"){t[o][r]=i}break}}}}}));return{mediaMsId:i,videoTracksInfo:t}}function _injectSimulcastSSRCGroups(e,t,n){var r=_isRTXEnabledForMedia(e);var i=n[t];if(!i){return}if(!i.SIM){i.ssrcs=[];i.SIM=[0,0,0].map((function(){var e=Math.floor(Math.random()*Xe);i.ssrcs.push(e);return e}));i.FID=i.SIM.map((function(e){var t=Math.floor(Math.random()*Xe);i.ssrcs.push(t);return[e,t]}))}else if(!i.FID){var o=i.ssrcs;i.FID=o.map((function(e){var t=Math.floor(Math.random()*Xe);i.ssrcs.push(t);return[e,t]}))}i.ssrcs.forEach((function(n){if(i.FID&&!!i.FID.find((function(e){return e[1]===n}))&&!r){return}setSDPAttribute(e,"ssrc",n+" cname:"+i.info.cname);setSDPAttribute(e,"ssrc",n+" msid:"+t+" "+i.info.trackId);setSDPAttribute(e,"ssrc",n+" mslabel:"+t);setSDPAttribute(e,"ssrc",n+" label:"+i.info.trackId)}));if(i.SIM){setSDPAttribute(e,"ssrc-group","SIM "+i.SIM.join(" "))}if(i.FID&&r){i.FID.forEach((function(t){setSDPAttribute(e,"ssrc-group","FID "+t.join(" "))}))}}function _isRTXEnabledForMedia(e){var t=getSDPAttribute(e,"rtpmap");return t.some((function(e){return typeof e==="string"&&(e.indexOf("rtx/90000")>=0||e.indexOf("RTX/90000")>=0)}))}var Ze="extmap";function filterInvalidRTPExtensions(e,t){var n=getSDPAttribute(t,Ze).map((function(e){return e.split(" ")[1]})).filter((function(e){return e!==undefined}));var r=getSDPAttribute(e,Ze);var i=r.filter((function(e){return n.some((function(t){return e.indexOf(t)>-1}))}));deleteSDPAttribute(e,Ze);setSDPAttribute(e,Ze,i)}var et=n(302186);var tt=function(){var e=navigator.userAgent;var t=e.match(/Chrom(e|ium)\/(\d+)\./);var n=!!t;var i=0;if(t){i=Number(t[2])}t=e.match(/Firefox\/(\d+)\./);var o=0;if(t){o=Number(t[1])}var a=!!t;t=e.match(/Version\/([\d.]+) Safari/);var s=!!t;var l=0;if(t){l=Number(t[1])}var u={chromeCompatible:n,fireFoxCompatible:a,sdpPlanB:n||s,sdpUnifiedPlan:a,p2p:n,chromeLikeStat:n,firefoxLikeStat:a,safariLikeStat:s,simulcast:n||a||s,transportCCForAudio:n,googFlags:n||s,transceivers:a&&o>=59,rollbackRTCDescription:a&&o>=59,encodingsQ1toQ3:n||s,encodingsQ3toQ1:a,chromeLikeSimulcast:n||s,firefoxLikeSimulcast:a,rotationExtensionSupport:n||s,dedicatedControlChannels:a,incorrectPlanBMSIDs:s&&l>=12.1,chromeStandardLikeStat:n&&i>77};if(u.chromeStandardLikeStat){isPreWebRCT1ChromeStatStillSupported().then((function(e){if(e){u.chromeStandardLikeStat=false;r.k.log("Old webrtc stat is still supported. Will use it")}else{r.k.log("Old webrtc stat is not supported. Keep using standard")}}))}return u;function isPreWebRCT1ChromeStatStillSupported(){return new Promise((function(e){var t=new RTCPeerConnection;try{t.getStats((function(n){t.close();try{if(n&&Object.prototype.toString.call(n)==="[object RTCStatsResponse]"){e(true)}else{e(false)}}catch(t){e(false)}}))}catch(t){e(false)}}))}}();var nt=function(){function RCVEClientCapability(){}RCVEClientCapability.remoteRTPExtensionValidationMediaTypes=function(){var e=et.Pal.instance.getPlatformUtils();if(e.isFireFox()){return["audio"]}return[]};RCVEClientCapability.supportSimulcast=function(){var e=et.Pal.instance.getPlatformUtils();if(e.isChromeBasedBrowser()||e.isElectron()){return true}return false};RCVEClientCapability.mustHaveAudio=function(){return et.Pal.instance.getPlatformUtils().isSafari()};Object.defineProperty(RCVEClientCapability,"mediaStatType",{get:function(){return{firefoxLikeStat:tt.firefoxLikeStat,chromeStandardLikeStat:tt.chromeStandardLikeStat,chromeLikeStat:tt.chromeLikeStat,safariLikeStat:tt.safariLikeStat}},enumerable:true,configurable:true});Object.defineProperty(RCVEClientCapability,"chromeCompatible",{get:function(){return tt.chromeCompatible},enumerable:true,configurable:true});Object.defineProperty(RCVEClientCapability,"fireFoxCompatible",{get:function(){return tt.fireFoxCompatible},enumerable:true,configurable:true});Object.defineProperty(RCVEClientCapability,"encodingsQ3toQ1",{get:function(){return tt.encodingsQ3toQ1},enumerable:true,configurable:true});Object.defineProperty(RCVEClientCapability,"encodingsQ1toQ3",{get:function(){return tt.encodingsQ1toQ3},enumerable:true,configurable:true});Object.defineProperty(RCVEClientCapability,"supportNQIDetails",{get:function(){var e=et.Pal.instance.getPlatformUtils();return e.isChromeBasedBrowser()||e.isElectron()},enumerable:true,configurable:true});return RCVEClientCapability}();var rt=function(){function PacketLossFractionCalculator(){this._lastUpdate=undefined;this._totalPackets=0;this._totalLost=0;this._fractionLost=0;this._minInterval=3e3}PacketLossFractionCalculator.prototype.update=function(e){var t=e.totalPackets,n=e.totalLost;var r=Date.now();if(typeof this._lastUpdate==="undefined"){this._totalLost=n;this._totalPackets=t;this._lastUpdate=r}else{var i=r-this._lastUpdate;if(i>=this._minInterval){if(t<this._totalPackets){this._totalPackets=0;this._totalLost=0}if(this._totalLost>n){this._totalLost=n}var o=t-this._totalPackets;var a=Math.min(n-this._totalLost,o);if(o<=0){this._fractionLost=0}else{this._fractionLost=a/o}this._lastUpdate=r;this._totalPackets=t;this._totalLost=n}}};PacketLossFractionCalculator.prototype.getFractionLost=function(){return this._fractionLost};return PacketLossFractionCalculator}();function getKBPerSecond(e,t,n,r){if(e===void 0){e=0}if(t===void 0){t=0}if(n===void 0){n=0}if(r===void 0){r=0}if(t<e){return-1}var i=r-n;var o=t-e;return i>0?Math.round(o/(i/1e3)/1024*1e3)/1e3:-1}function getValuePerSecond(e,t,n,r){if(e===void 0){e=0}if(t===void 0){t=0}if(n===void 0){n=0}if(r===void 0){r=0}var i=r-n;var o=t-e;return i>0?Math.round(o/(i/1e3)):0}function getPrefferedCodecNameBySSRC(e,t){var n;if(!e){return""}var r=new ze(e);var i=new RegExp("^"+t+" ");var o=r.getMedia().find((function(e){var t=r.getMediaAttributes(e,"ssrc");return!!t.find((function(e){return e.match(i)}))}));if(o){var a=(n=o.format)===null||n===void 0?void 0:n.split(" ")[0];if(a){var s=r.getMediaAttributes(o,"rtpmap");var l=new RegExp("^"+a+" ([^/]+)/");for(var u=0;u<s.length;u++){var c=s[u];var d=c.match(l);if(d){return d[1]}}}}return""}var it=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ot=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var at=function(){function ChromePeerStatCalculator(){this._videoBwe={}}ChromePeerStatCalculator.prototype.calculate=function(e,t){if(t===void 0){t={}}return it(this,void 0,Promise,(function(){var n,r,i,o,a,s,l,u,c;var d=this;return ot(this,(function(f){switch(f.label){case 0:if(!e)return[2,{}];return[4,e.getStats()];case 1:n=f.sent();r=Date.now();i={};o={};a={};s={};l=[];c={};n.forEach((function(e){if(e.type==="codec"){s[e.id]=e.mimeType.split("/")[1]}if(e.type==="inbound-rtp"||e.type==="outbound-rtp"){var n=e.id.match(/^RTC(Outbound|Inbound)RTP(Audio|Video)Stream_(\d+)$/);if(n){var f=n[2].toLowerCase();var p=n[3];var h=t[p]||{};var _=h.lastUpdate;var v=h.bytes;var g=Number(e.bytesReceived)||Number(e.bytesSent);var y=Number(e.packetsReceived)||Number(e.packetsSent);var m=Number(e.packetsLost)||0;var S=h["_fractionLostCalculator"]||new rt;S.update({totalPackets:y,totalLost:m});i[p]=Object.assign(i[p]||{},{bytes:g,speed:getKBPerSecond(v,g,_,r),codecName:"N/A",codecId:e.codecId,lastUpdate:r,packets:y,packetsLost:m,packetsLostFraction:S.getFractionLost(),_fractionLostCalculator:S});if(f==="video"){i[p]=Object.assign(i[p]||{},{limResCpu:e.qualityLimitationReason==="cpu",limResBw:e.googBandwidthLimitedResolution==="bandwidth",firs:e.firCount||0,plis:e.pliCount||0,nacks:e.nackCount||0})}var C=e.trackId;if(typeof C==="string"){o[C]=p;a[C]=f}}}else if(e.type==="track"){l.push(e)}else if(e.type==="candidate-pair"){if(e.state==="succeeded"&&e.nominated){d._videoBwe.semb=e.availableOutgoingBitrate;u=e.localCandidateId}}else if(e.type==="local-candidate"){c[e.id]=e}}));if(u&&typeof c[u]==="object"){}l.forEach((function(e){var n=o[e.id];if(typeof n==="string"){var s=t[n]||{};var l=s.lastUpdate;var u=a[e.id];var c=s.jitterBufferEmittedCount||0;var d=e.jitterBufferEmittedCount||0;var f=s.jitterBufferDelay||0;var p=e.jitterBufferDelay||0;var h=d-c;var _=void 0;if(h>0){var v=p-f;_=v/h;_=Math.floor(_*1e3)}else{_=0}i[n].jitterBufferDelay=p;i[n].jitterBufferEmittedCount=d;i[n].jitter=_;i[n].currentDelay=_;if(u==="audio"){i[n]=i[n]||{};i[n].level=e.audioLevel}else if(u==="video"){i[n]=Object.assign(i[n]||{},{frameWidth:e.frameWidth,frameHeight:e.frameHeight,frameRateOut:getValuePerSecond(s.framesDecoded,e.framesDecoded,l,r),framesDecoded:e.framesDecoded})}}}));Object.keys(i).forEach((function(e){var t=i[e];var n=t.codecId;t.codecName=s[n]}));return[2,i]}}))}))};return ChromePeerStatCalculator}();var st={MIN:0,MAX:100};var lt=function(){function Stat(e){this._statType=e;this._prevUpdate=null;this.stat={};this.deltas={}}Stat.prototype.calc=function(e){var t=Date.now();var n=this._prevUpdate;var r=this.stat;var i=Stat.adjust(e);var o=(t-n)/1e3;if(n===null||o<=0){return{stat:i,now:t}}var a={};var s={};Object.keys(i).forEach((function(e){if(typeof i[e]==="number"&&typeof r[e]==="number"){a[e]=i[e]-r[e];s[e]=a[e]/o}}));return{stat:i,deltas:a,rates:s,now:t,interval:o}};Stat.prototype.update=function(e){var t=e.stat,n=e.now;this._prevUpdate=n;this.stat=t;return true};Stat.adjust=function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n];switch(typeof e[n]){case"number":break;case"string":{var r=parseInt(e[n],10);if(!oe().isNaN(r)){t[n]=r}break}default:break}}));return t};Stat.median=function(e){var t=[].concat(e).sort((function(e,t){return e-t}));if(t.length%2===1){return t[Math.floor(t.length/2)]}var n=t.length/2;return(t[n-1]+t[n])/2};Stat.limit=function(e){return Math.max(1,Math.min(st.MAX,e))};return Stat}();var ut=function(){function AudioNetQuality(e){this._audioPpsThreshold=10;this._minPacketsThreshold=50;this._ratingsHistSize=5;this._stat=new lt(e);this._ratings=[];this._netQ=100;this._details={id:"",type:"audio",codec:"",packetLoss:undefined,rtt:undefined,jitter:undefined}}AudioNetQuality.prototype.update=function(e,t){var n,r,i;if(Object.prototype.hasOwnProperty.call(e,"packetsReceived")){return null}if(t!=="connected"){return st.MIN}var o=this._stat.calc(e);this._details.codec=o.stat.googCodecName;this._details.rtt=o.stat.googRtt;this._details.jitter=o.stat.googJitterReceived;if(!Object.prototype.hasOwnProperty.call(o,"rates")||!Object.prototype.hasOwnProperty.call(o.deltas,"packetsLost")){this._stat.update(o);return this._netQ}if(((n=o.deltas)===null||n===void 0?void 0:n.packetsSent)!==undefined&&o.deltas.packetsSent<this._minPacketsThreshold){return this._netQ}this._stat.update(o);if(((r=o.rates)===null||r===void 0?void 0:r.packetsSent)!==undefined&&o.rates.packetsSent<this._audioPpsThreshold){this._netQ=this._netQ+(100-this._netQ)/8;this._details.packetLoss=0;return this._netQ}var a=0;if(((i=o.deltas)===null||i===void 0?void 0:i.packetsLost)!==undefined&&o.deltas.packetsSent){a=o.deltas.packetsLost/o.deltas.packetsSent;this._ratings.push(AudioNetQuality.audioCodecRating(o.stat.googCodecName,a))}while(this._ratings.length>this._ratingsHistSize){this._ratings.shift()}var s=lt.median(this._ratings);this._details.packetLoss=a;this._netQ=lt.limit(Math.floor(s));return this._netQ};AudioNetQuality.prototype.details=function(){return this._details};AudioNetQuality.audioCodecRating=function(e,t){switch(e){case"OPUS":{var n=.1;var r=.4;return AudioNetQuality.audioRating(t,n,r)}default:{var n=.05;var r=.2;return AudioNetQuality.audioRating(t,n,r)}}};AudioNetQuality.audioRating=function(e,t,n){if(e<t){return st.MAX}if(e>n){return st.MIN}return st.MAX-(e-t)*(st.MAX-st.MIN)/(n-t)};return AudioNetQuality}();var ct=function(){function VideoNetQuality(e){this._stat=new lt(e);this._minPacketsThreshold=50;this._minInterval=1;this._ploss=[];this._rtt=[];this._plossHistSize=5;this._netQ=100;this._rttHistSize=5;this._netQhist=[];this._netQhistLen=5;this._details={id:"",type:"video",codec:"",packetLoss:undefined,rtt:undefined,jitter:undefined}}VideoNetQuality.prototype.update=function(e,t){var n,r;if(Object.prototype.hasOwnProperty.call(e,"packetsReceived")){return null}if(t!=="connected"){return st.MIN}var i=this._stat.calc(e);if(!Object.prototype.hasOwnProperty.call(i,"rates")||!Object.prototype.hasOwnProperty.call(i.deltas,"packetsLost")){this._stat.update(i);return this._netQ}if(((n=i.deltas)===null||n===void 0?void 0:n.packetsSent)!==undefined&&i.deltas.packetsSent<this._minPacketsThreshold){return this._netQ}if(i.interval!==undefined&&i.interval<this._minInterval){return this._netQ}this._stat.update(i);if(((r=i.deltas)===null||r===void 0?void 0:r.packetsLost)!==undefined&&i.deltas.packetsSent){var o=i.deltas.packetsLost/i.deltas.packetsSent;this._ploss.push(o)}while(this._ploss.length>this._plossHistSize){this._ploss.shift()}var a=lt.median(this._ploss);if(a<0)a=0;this._details.packetLoss=a;var s=i.stat.googRtt;this._rtt.push(s);while(this._rtt.length>this._rttHistSize){this._rtt.shift()}var l=lt.median(this._rtt);this._details.rtt=l;this._details.codec=i.stat.googCodecName;var u=VideoNetQuality.thresholds(i.stat.googContentType),c=u.pMin,d=u.pMax,f=u.rttMin,p=u.rttMax;var h;if(a<c-l*c/f){h=st.MAX}else if(a<d-l*d/f){h=st.MAX*(l/f*(c/(c-d))-a/(d-c)+d/(d-c))}else if(a<d-l*d/p){h=st.MAX*(l/(f-p)-a/d*p/(p-f)+p/(p-f))}else{h=st.MIN}h=lt.limit(h);this._netQhist.push(Math.floor(h));while(this._netQhist.length>this._netQhistLen){this._netQhist.shift()}this._netQ=lt.median(this._netQhist);return this._netQ};VideoNetQuality.prototype.details=function(){return this._details};VideoNetQuality.thresholds=function(e){switch(e){case"screen":return{pMin:.1,pMax:.25,rttMin:200,rttMax:1500};default:return{pMin:.05,pMax:.2,rttMin:200,rttMax:1500}}};return VideoNetQuality}();var dt=function(){function FakeNetQuality(){}FakeNetQuality.prototype.update=function(){return null};FakeNetQuality.prototype.details=function(){return{}};FakeNetQuality.prototype.getFractionLost=function(){};return FakeNetQuality}();function createNetQualityCalculator(e,t){switch(t){case"audio":return new ut(e);case"video":return new ct(e);default:return new dt}}var ft=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var pt=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var ht=r.k.tags("[PeerStatCalculator][ChromeLike]");var _t=function(){function ChromeLikePeerStatCalculator(){}ChromeLikePeerStatCalculator.prototype.calculate=function(e,t){if(t===void 0){t={}}return ft(this,void 0,Promise,(function(){var n,r,i,o;return pt(this,(function(a){if(!e)return[2,{}];n=Date.now();r={};o={};return[2,new Promise((function(a){e.getStats((function(s){s.result().forEach((function(a){if(a.type==="ssrc"){var s=a.stat("ssrc");if(s){var l=t[s]||{};var u=l.lastUpdate;var c=l.bytes;var d=Number(a.stat("bytesReceived"))||Number(a.stat("bytesSent"));var f=Number(a.stat("packetsReceived"))||Number(a.stat("packetsSent"));var p=Number(a.stat("packetsLost"));var h=l["_fractionLostCalculator"]||new rt;h.update({totalPackets:f,totalLost:p});var _=l["_nqCalculator"]||createNetQualityCalculator("chromeLikeStat",a.stat("mediaType"));var v=a.names().reduce((function(e,t){e[t]=a.stat(t);return e}),{});var g=_.update(v,e.connectionState);r[s]={bytes:d,packets:f,speed:getKBPerSecond(c,d,u,n),codecName:a.stat("googCodecName"),lastUpdate:n,encodeUsage:a.stat("googEncodeUsagePercent"),packetsLost:p,packetsLostFraction:h.getFractionLost(),currentDelay:Number(a.stat("googCurrentDelayMs")),netQuality:g,nqiDetails:_.details(),_fractionLostCalculator:h,_nqCalculator:_};var y=a.stat("mediaType");if(y==="audio"){r[s].level=Number(a.stat("audioInputLevel"))||Number(a.stat("audioOutputLevel"));r[s].jitter=Number(a.stat("googJitterReceived"))||0}else if(y==="video"){r[s]=Object.assign(r[s],{jitter:0,limResCpu:a.stat("googCpuLimitedResolution")==="true",limResBw:a.stat("googBandwidthLimitedResolution")==="true",firs:Number(a.stat("googFirsReceived"))||Number(a.stat("googFirsSent"))||0,plis:Number(a.stat("googPlisReceived"))||Number(a.stat("googPlisSent"))||0,nacks:Number(a.stat("googNacksReceived"))||Number(a.stat("googNacksSent"))||0,frameWidth:Number(a.stat("googFrameWidthReceived"))||Number(a.stat("googFrameWidthSent"))||0,frameHeight:Number(a.stat("googFrameHeightReceived"))||Number(a.stat("googFrameHeightSent"))||0,frameRateOut:Number(a.stat("googFrameRateReceived"))||Number(a.stat("googFrameRateInput"))||0,frameRateIn:Number(a.stat("googFrameRateSent"))||Number(a.stat("googFrameRateOutput"))||0})}}}else if(a.type==="VideoBwe"){}else if(a.type==="googCandidatePair"){if(a.stat("googActiveConnection")==="true"){i=a.stat("localCandidateId");ht.log("connectedLocalCandidateId: ",i)}}else if(a.type==="localcandidate"){o[a.id]=a}}));a(r)}))}))]}))}))};return ChromeLikePeerStatCalculator}();var vt=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var gt=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var yt=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var mt=r.k.tags("[PeerStatCalculator][FireFox]");var St=function(){function FirefoxPeerStatCalculator(e){this._getVideoStreamsWithSSRC=e}FirefoxPeerStatCalculator.prototype.calculate=function(e,t){if(t===void 0){t={}}return vt(this,void 0,Promise,(function(){var n,r,i,o,a,s,l,u,l,c;var d,f;var p=this;return gt(this,(function(h){switch(h.label){case 0:if(!e)return[2,{}];n={};h.label=1;case 1:h.trys.push([1,3,,4]);return[4,e.getStats(null)];case 2:r=h.sent();i=Date.now();o=[];if(typeof r["values"]==="function"){try{for(a=yt(r["values"]()),s=a.next();!s.done;s=a.next()){l=s.value;o.push(l)}}catch(e){d={error:e}}finally{try{if(s&&!s.done&&(f=a.return))f.call(a)}finally{if(d)throw d.error}}}else{for(u in r){if(r.hasOwnProperty(u)){l=r["get"](u);o.push(l)}}}o.forEach((function(r){var o;var a=r.ssrc;if(typeof a!=="undefined"&&r.type==="inbound-rtp"&&typeof r.bytesReceived==="number"){a=String(a);var s=t[a]||{};var l=Number(r.bytesReceived);var u=s.bytes;var c=s.lastUpdate;var d=getKBPerSecond(u,l,c,i);var f=r.jitter;var p=Number(r.packetsReceived)||Number(r.packetsSent);var h=r.packetsLost;var _=s["_fractionLostCalculator"]||new rt;_.update({totalPackets:p,totalLost:h});n[a]={bytes:l,codecName:getPrefferedCodecNameBySSRC((o=e.remoteDescription)===null||o===void 0?void 0:o.sdp,a),frameRateOut:typeof r.framerateMean!=="undefined"?Math.round(Number(r.framerateMean)):30,speed:d,lastUpdate:i,packetsLost:h,packets:p,packetsLostFraction:_.getFractionLost(),currentDelay:f,jitter:f,firs:Number(r.firCount)||0,plis:Number(r.pliCount)||0,nacks:Number(r.nackCount)||0,_fractionLostCalculator:_}}}));Array.prototype.slice.call(document.querySelectorAll("video")).forEach((function(e){p._getVideoStreamsWithSSRC().forEach((function(t){var r=t.stream,i=t.ssrc;if(r===e.srcObject){n[i]=n[i]||{};n[i].frameWidth=e.videoWidth;n[i].frameHeight=e.videoHeight}}))}));return[3,4];case 3:c=h.sent();mt.warn("calculate failed.",c);return[3,4];case 4:return[2,n]}}))}))};return FirefoxPeerStatCalculator}();var Ct=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Et=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var bt=function(){function SafariPeerStatCalculator(){}SafariPeerStatCalculator.prototype.calculate=function(e,t){if(t===void 0){t={}}return Ct(this,void 0,Promise,(function(){var n,r,i,o,a,s;return Et(this,(function(l){switch(l.label){case 0:if(!e)return[2,{}];return[4,e.getStats()];case 1:n=l.sent();r=Date.now();i={};o={};a={};s=[];n.forEach((function(n){var l;if(n.type==="inbound-rtp"||n.type==="outbound-rtp"){var u=n.id.match(/^RTC(Outbound|Inbound)RTP(Audio|Video)Stream_(\d+)$/);if(u){var c=u[2].toLowerCase();var d=u[3];var f=t[d]||{};var p=f.lastUpdate;var h=f.bytes;var _=Number(n.bytesReceived)||Number(n.bytesSent);var v=Number(n.packetsReceived)||Number(n.packetsSent);var g=Number(n.packetsLost);var y=n.jitter*1e3||0;var m=f["_fractionLostCalculator"]||new rt;m.update({totalPackets:v,totalLost:g});i[d]=Object.assign(i[d]||{},{bytes:_,speed:getKBPerSecond(h,_,p,r),codecName:getPrefferedCodecNameBySSRC((l=e.remoteDescription)===null||l===void 0?void 0:l.sdp,d),lastUpdate:r,packetsLost:n.packetsLost,packets:v,packetsLostFraction:m.getFractionLost(),currentDelay:y,jitter:y,_fractionLostCalculator:m});if(c==="video"){i[d]=Object.assign(i[d]||{},{firs:n.firCount||0,plis:n.pliCount||0,nacks:n.nackCount||0})}var S=n.trackId;if(typeof S==="string"){o[S]=d;a[S]=c}}}else if(n.type==="track"){var u=n.id.match(/^RTCMediaStreamTrack_remote_(audio|video)_(.*)_(\d+)$/);if(u){var d=u[3];var f=t[d]||{};var p=f.lastUpdate;var c=u[1];if(c==="audio"){i[d]=i[d]||{};i[d].level=n.audioLevel}else if(c==="video"){i[d]=Object.assign(i[d]||{},{frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameRateOut:getValuePerSecond(f.framesDecoded,n.framesDecoded,p,r),framesDecoded:n.framesDecoded})}}else{s.push(n)}}}));s.forEach((function(e){var n=o[e.id];if(typeof n==="string"){var s=t[n]||{};var l=s.lastUpdate;var u=a[e.id];if(u==="audio"){i[n]=i[n]||{};i[n].level=e.audioLevel}else if(u==="video"){i[n]=Object.assign(i[n]||{},{frameWidth:e.frameWidth,frameHeight:e.frameHeight,frameRateOut:getValuePerSecond(s.framesDecoded,e.framesDecoded,l,r),framesDecoded:e.framesDecoded})}}}));return[2,i]}}))}))};return SafariPeerStatCalculator}();var It=n(862926);var Mt=undefined&&undefined.__assign||function(){Mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Mt.apply(this,arguments)};var Rt=800*1e3;var getDefaultNQIDetail=function(e,t,n){if(n===void 0){n={}}return Mt(Mt({codec:"",packetLoss:undefined,rtt:undefined,jitter:undefined},n),{id:e,type:t})};var Tt=function(){function LocalStream(e,t,n){this._type=e;this.id=t;this._mediaStream=n;this._desiredQuality=-1;this._lastBitrateOnQualityIncrease=Rt;this._minVideoBitrate=150*1e3}LocalStream.prototype.hasVideo=function(){var e=this._mediaStream.getVideoTracks();if(e.length===0){return false}var t=e[0];return!(t.enabled===false||t.muted===true||t.readyState==="ended")};LocalStream.prototype.hasAudio=function(){return this._mediaStream.getAudioTracks().length>0};LocalStream.prototype.getMediaStream=function(){return this._mediaStream};LocalStream.prototype.getVideoDesiredQuality=function(){return this._desiredQuality};LocalStream.prototype.setVideoDesiredQuality=function(e,t){if(e===void 0){e=-1}if(this._desiredQuality===e){return false}var n=e>this._desiredQuality;if(n){this._lastTimeDesiredQualityIncreased=Date.now()}this._desiredQuality=e;if(!this._mediaStream){return false}var r=this._mediaStream.getVideoTracks()[0];if(!r){return false}if(n){var i=t;this._lastBitrateOnQualityIncrease=i&&typeof i.speed==="number"&&i.speed>=0?i.speed*1024*8:Rt}return true};LocalStream.prototype._getPacketLossQuality=function(e){var t=100;var n;if(e&&typeof e==="object"&&typeof e.packetsLostFraction==="number"&&!Number.isNaN(e.packetsLostFraction)){n=e.packetsLostFraction}else{n=0}if(n<=.02){t=100}else if(n<=.04){t=70}else if(n<=.06){t=50}else if(n<=.08){t=30}else if(n<=.12){t=10}else{t=0}return t};LocalStream.prototype._getVideoQuality=function(e,t){var n=100;var r=0;var i;var o=this._type===c.Ls.SCREENSHARING?"screen":"video";i=getDefaultNQIDetail(this.id,o);if(this._desiredQuality===0){return{quality:n,detail:i}}if(e&&Object.prototype.hasOwnProperty.call(e,"netQuality")&&e.netQuality!==undefined){i=getDefaultNQIDetail(this.id,o,e.nqiDetails);return{quality:e.netQuality,detail:i}}if(t){r=t;var a=Date.now()-this._lastTimeDesiredQualityIncreased;if(a<6e4){r=Math.min(r,Math.max(this._lastBitrateOnQualityIncrease,this._minVideoBitrate)*Math.pow(1.08,a/1e3))}}if(r){var s=void 0;if(e&&typeof e.speed==="number"){s=e.speed*1024*8;if(s<0){s=r}}else{s=r}var l=void 0;if(e&&typeof e.packetsLostFraction==="number"){l=e.packetsLostFraction}else{l=0}n=100*s/r;if(l>=.1){n=Math.min(n,30)}n=Math.min(Math.max(n,0),100);return{quality:n,detail:i}}n=this._getPacketLossQuality(e);n=Math.min(Math.max(n,0),100);return{quality:n,detail:i}};LocalStream.prototype._getAudioQuality=function(e){var t=100;var n="audio";var r=getDefaultNQIDetail(this.id,n);if(e&&Object.prototype.hasOwnProperty.call(e,"netQuality")&&e.netQuality!==undefined){r=getDefaultNQIDetail(this.id,n,e.nqiDetails);return{quality:e.netQuality,detail:r}}t=this._getPacketLossQuality(e);t=Math.min(Math.max(t,0),100);return{quality:t,detail:r}};LocalStream.prototype.getSendQuality=function(e,t){var n=[];if(this._type===c.Ls.SCREENSHARING){n.push(this._getVideoQuality(e.video,t));return n}if(this.hasAudio()){n.push(this._getAudioQuality(e.audio))}if(this.hasVideo()){n.push(this._getVideoQuality(e.video,t))}return n};return LocalStream}();var Ot=function(){function ControlChannel(e,t){this._pingCount=0;this._sendMediaPingTimeout=1e3;this._controlChannelLabel="controlChannel";this._peerConnection=e;this._logger=r.k.tags(ControlChannel.name+"_"+t);this._init()}ControlChannel.prototype.close=function(){clearTimeout(this._controlChannelPingTimer);this._controlDataChannel.close()};ControlChannel.prototype._init=function(){var e=this;this._controlDataChannel=this._peerConnection.createDataChannel(this._controlChannelLabel);this._controlDataChannel.onopen=function(){e._logger.info("controlChannel.onopen");e._startPingTimer()};this._controlDataChannel.onclose=function(){e._logger.info("controlChannel.onclose");clearTimeout(e._controlChannelPingTimer)};this._controlDataChannel.onmessage=function(t){e._logger.debug("controlChannel received: "+t.data)}};ControlChannel.prototype._sendControlChannelPing=function(){try{this._pingCount++;this._controlDataChannel.send("ping "+this._pingCount);this._logger.debug("Sent ping "+this._pingCount)}catch(e){this._logger.error("Failed to send ping "+this._pingCount)}this._startPingTimer()};ControlChannel.prototype._startPingTimer=function(){var e=this;clearTimeout(this._controlChannelPingTimer);this._controlChannelPingTimer=setTimeout((function(){return e._sendControlChannelPing()}),this._sendMediaPingTimeout)};return ControlChannel}();var At=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Pt=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Nt=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var wt=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var Dt=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(wt(arguments[t]));return e};var kt=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Lt=window.RTCPeerConnection||window.webkitRTCPeerConnection;var Ft=[150*1e3,500*1e3,1300*1e3];var Vt=1500*1e3;var Ut=function(e){At(SFUPeerClient,e);function SFUPeerClient(t,n,i){var o=e.call(this)||this;o._SFUDelegate=i;o._iceServers=[{urls:"stun:stun.l.google.com:19302"}];o._remoteStreamsById=new Map;o._remoteStreamsTapIdById=new Map;o._localStreams=new Map;o._remoteRTCSessionId="";o._localStreamsTapIdToMsid=new Map;o._videoSSRCbyLocalStreamId={};o._audioSSRCbyLocalStreamId={};o._videoSSRCbyStreamId={};o._audioSSRCbyStreamId={};o._statBySSRC={};o._maxBitrateByVideoTrackId=new Map;o._handleICECandidateEvent=function(e){o._localIceCandidateBarrier.open();o._logger.info("onicecandidate:",e.candidate);if(e.candidate){if(e.candidate.candidate.match(/fe80|tcptype/)){return}o._SFUDelegate.handleLocalCandidate(e,o._localRTCSessionId)}else{o._logger.info("End of candidates.");o._SFUDelegate.handleEndOfLocalCandidate(o._localRTCSessionId)}};o._handleICECandidateError=function(e){o._logger.warn("local ice candidate error:",e.errorCode," reason=",e.errorText," host candidate=",e.hostCandidate," url=",e.url)};o._iceServers=t;o._type=n;o._peerConnection=o._getPeerConnection();var a=(new Date).getTime();var s="["+o.getRcvPcRoleString()+"]["+a+"]";o._initControlChannel(s);o._logger=r.k.tags("[SFUPeerClient]"+s);if(nt.mediaStatType.firefoxLikeStat){o._peerStatCalculator=new St((function(){var e=o.getLocalStreams().filter((function(e){return!!o._videoSSRCbyLocalStreamId[e.id]})).map((function(e){return{stream:e,ssrc:o._videoSSRCbyLocalStreamId[e.id]}}));var t=o.getRemoteStreams().filter((function(e){return!!o._videoSSRCbyStreamId[e.id]})).map((function(e){return{stream:e,ssrc:o._videoSSRCbyStreamId[e.id]}}));return Dt(e,t)}))}else if(nt.mediaStatType.chromeStandardLikeStat||It.DebugUtils.isFeatureMode("UseChromeStandardLikeStat")){o._peerStatCalculator=new at}else if(nt.mediaStatType.chromeLikeStat){o._peerStatCalculator=new _t}else if(nt.mediaStatType.safariLikeStat){o._peerStatCalculator=new bt}o._logger.info("_peerStatCalculator: ",o._peerStatCalculator);o._logger.info("ClientCapabilities: ",nt.mediaStatType);o._localIceCandidateBarrier=new It.Barrier;return o}SFUPeerClient.prototype.muteVideo=function(){this._removeSenderTracks("video")};SFUPeerClient.prototype.unmuteVideo=function(e,t){this.switchVideo(e,t)};SFUPeerClient.prototype.leaveAudio=function(){this._removeSenderTracks("audio")};SFUPeerClient.prototype._removeSenderTracks=function(e){var t=this;this._peerConnection.getSenders().forEach((function(n){if(n.track&&n.track.kind===e){t._peerConnection.removeTrack(n)}}))};SFUPeerClient.prototype.getLocalRTCSessionId=function(){return this._localRTCSessionId};SFUPeerClient.prototype.getRemoteRTCSessionId=function(){return this._remoteRTCSessionId};SFUPeerClient.prototype.connected=function(){return this._peerConnection.connectionState!=="closed"&&this._peerConnection.connectionState!=="failed"&&this._peerConnection.connectionState!=="disconnected"};SFUPeerClient.prototype._getPeerConnection=function(){var e=this;var t={iceServers:this._iceServers,sdpSemantics:"plan-b"};var n=new Lt(t);n.onicecandidate=this._handleICECandidateEvent;n.onicecandidateerror=this._handleICECandidateError;n.ontrack=function(t){e._logger.info("ontrack id="+t.track.id+", kind="+t.track.kind+", label="+t.track.label);var n=t.streams;if(n.length>0){var r=t.streams[0];e._addRemoteStreamById(r)}};n.onnegotiationneeded=function(){e._logger.info("onnegotiationneeded signal state="+n.signalingState+" ice state="+n.iceConnectionState+" gathering state="+n.iceGatheringState);e._onIceConnectStateChange()};n.oniceconnectionstatechange=function(){e._logger.info("oniceconnectionstatechange signal state="+n.signalingState+" ice state="+n.iceConnectionState+" gathering state="+n.iceGatheringState);e._onIceConnectStateChange()};n.onsignalingstatechange=function(){e._logger.info("onsignalingstatechange signal state="+n.signalingState+" ice state="+n.iceConnectionState+" gathering state="+n.iceGatheringState);e._onIceConnectStateChange()};n.ondatachannel=function(t){e._logger.info("pc.ondatachannel",t)};return n};SFUPeerClient.prototype._onIceConnectStateChange=function(){this.emit(Ge.ICE_STATE_CHANGED)};SFUPeerClient.prototype._addRemoteStreamById=function(e,t){if(t===void 0){t=e.id}this._remoteStreamsById.set(e.id,e);var n=this._remoteStreamsTapIdById.get(e.id);n||this._logger.error("cannot find tapid for:",t);this._logger.info("REMOTE_STREAM_ADDED id",t,n);n&&this._SFUDelegate.addStream(n,e)};SFUPeerClient.prototype.updatePeerStat=function(){return Pt(this,void 0,void 0,(function(){var e;return Nt(this,(function(t){switch(t.label){case 0:if(!this._peerConnection)return[2];e=this;return[4,this._peerStatCalculator.calculate(this._peerConnection,this._statBySSRC)];case 1:e._statBySSRC=t.sent();return[2]}}))}))};SFUPeerClient.prototype.getLocalPeerStats=function(){var e,t;var n=[];try{for(var r=kt(this._localStreams),i=r.next();!i.done;i=r.next()){var o=wt(i.value,2),a=o[0],s=o[1];var l=s.getMediaStream();var u=this._videoSSRCbyLocalStreamId[l.id];var c=this._audioSSRCbyLocalStreamId[l.id];this._logger.log("local ssrc:",{videossrc:u,audiossrc:c});n.push({tapId:a,videossrc:u,audiossrc:c,stream:l,p2p:false,audio:this._statBySSRC[c],video:this._statBySSRC[u]})}}catch(t){e={error:t}}finally{try{if(i&&!i.done&&(t=r.return))t.call(r)}finally{if(e)throw e.error}}return n};SFUPeerClient.prototype.getRemotePeerStats=function(){var e,t;var n=[];try{for(var r=kt(this._remoteStreamsById),i=r.next();!i.done;i=r.next()){var o=wt(i.value,2),a=o[0],s=o[1];var l=this._videoSSRCbyStreamId[s.id];var u=this._audioSSRCbyStreamId[s.id];this._logger.log("remote ssrc:",l,u);n.push({tapId:a,videossrc:l,audiossrc:u,stream:s,p2p:false,audio:this._statBySSRC[u],video:this._statBySSRC[l]})}}catch(t){e={error:t}}finally{try{if(i&&!i.done&&(t=r.return))t.call(r)}finally{if(e)throw e.error}}return n};SFUPeerClient.prototype.updateRemoteStreamMapping=function(e){var t,n;var r=this;var i=[];var _loop_1=function(t,n){if(!e.some((function(e){return e.id===n}))){i.push(t)}};try{for(var o=kt(this._remoteStreamsTapIdById),a=o.next();!a.done;a=o.next()){var s=wt(a.value,2),l=s[0],u=s[1];_loop_1(l,u)}}catch(e){t={error:e}}finally{try{if(a&&!a.done&&(n=o.return))n.call(o)}finally{if(t)throw t.error}}e.forEach((function(e){r._remoteStreamsTapIdById.set(e.msid,e.id)}));i.length>0&&this._removeRemoteStreams(i)};SFUPeerClient.prototype._removeRemoteStreams=function(e){var t=this;this._logger.log("removed stream msids:",e);var n=[];e.forEach((function(e){var r=t._remoteStreamsTapIdById.get(e);r&&n.push(r);t._remoteStreamsTapIdById.delete(e);t._remoteStreamsById.delete(e)}));this._logger.log("removed stream tapIds:",n);this._SFUDelegate.removeRemoteStream(n)};SFUPeerClient.prototype.addLocalStream=function(e,t){var n=this;this._logger.log("addLocalStream tapId: "+e+", localStream: ",t);this._localStreams.forEach((function(e){return e.getMediaStream().getTracks().forEach((function(e){return e.stop()}))}));this._localStreams.set(e,new Tt(this._type,e,t));this._localStreamsTapIdToMsid.set(e,t.id);t.getTracks().forEach((function(e){return n._peerConnection.addTrack(e,t)}));this._SFUDelegate.addStream(e,t);return t.id};SFUPeerClient.prototype.generateTapIdToMsidMappingArray=function(){var e=this;var t=[];this._localStreamsTapIdToMsid.forEach((function(n,r){if(e._isPlaceHolderStream(r)){return}t.push({id:r,msid:n,type:"video/"+e._type})}));this._logger.info("generateTapIdToMsidMappingArray:",t);return t};SFUPeerClient.prototype.switchAudio=function(e,t){this._switchLocalStreamMediaTrack(e,t,(function(e){return e.getAudioTracks()}))};SFUPeerClient.prototype.switchVideo=function(e,t){this._switchLocalStreamMediaTrack(e,t,(function(e){return e.getVideoTracks()}))};SFUPeerClient.prototype.createOffer=function(){var e;return Pt(this,void 0,void 0,(function(){var t,n;return Nt(this,(function(r){switch(r.label){case 0:if(!this._peerConnection){throw new Error("Cannot create offer, because peer connection closed")}return[4,this._peerConnection.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true})];case 1:t=r.sent();this._logger.debug("creatOffer: origin sdp:",t.sdp);n=(e=t.sdp)===null||e===void 0?void 0:e.match(/o=[^ ]+ ([^ ]+)/);if(n){this._localRTCSessionId=n[1]}return[2,t]}}))}))};SFUPeerClient.prototype.setLocalDescription=function(e){var t=this;return this._peerConnection.setLocalDescription(e).then((function(){t._updateLocalStreamIdToSSRCMapping()}))};SFUPeerClient.prototype._updateLocalStreamIdToSSRCMapping=function(){var e=this;this._logger.log("[_updateLocalStreamIdToSSRCMapping]");this._videoSSRCbyLocalStreamId={};this._audioSSRCbyLocalStreamId={};if(this._peerConnection){var t=(this._peerConnection.localDescription||{sdp:""}).sdp;var n=new ze(t);var r=n.getMedia();var i=[];r.forEach((function(t){var r=t.media;if(r===Qe.DATA){return}var o=n.getFirstMediaAttribute(t,"msid");var a;if(typeof o==="string"){a=o.match(/^[^ ]+/)[0]}if(r===Qe.VIDEO){n.getMediaAttributes(t,"ssrc-group").forEach((function(e){var t=e.match(/(FID|FEC-FR) [^ ]+ ([^ ]+)/);if(t){i.push(t[2])}}));n.getMediaAttributes(t,"ssrc").reverse().forEach((function(t){var n=t.match(/(\d+) msid:([^ ]+)/);if(n){var r=n[1];if(i.indexOf(r)<0){e._videoSSRCbyLocalStreamId[n[2]]=r}}else if(a){var r=t.match(/^\d+/)[0];if(r&&i.indexOf(r)<0){e._videoSSRCbyLocalStreamId[a]=r}}}))}else if(r===Qe.AUDIO){n.getMediaAttributes(t,"ssrc").forEach((function(t){var n=t.match(/(\d+) msid:([^ ]+)/);if(n){e._audioSSRCbyLocalStreamId[n[2]]=n[1]}else if(a){var r=t.match(/^\d+/)[0];if(r&&i.indexOf(r)<0){e._audioSSRCbyLocalStreamId[a]=r}}}))}}))}this._logger.debug("ssrc info-",this._videoSSRCbyLocalStreamId,this._audioSSRCbyLocalStreamId)};SFUPeerClient.prototype._updateRemoteStreamIdToSSRCMapping=function(){var e;this._logger.log("[_updateRemoteStreamIdToSSRCMapping]");this._videoSSRCbyStreamId={};this._audioSSRCbyStreamId={};var t=new ze((e=this._peerConnection.remoteDescription)===null||e===void 0?void 0:e.sdp);var n=t.getMedia();var _loop_2=function(e){var i=n[e];var o=i.media;var a=o==="video"?r._videoSSRCbyStreamId:r._audioSSRCbyStreamId;var s=[];t.getMediaAttributes(i,"ssrc-group").forEach((function(e){var t=e.match(/(FID|FEC-FR) [^ ]+ ([^ ]+)/);if(t){s.push(t[2])}}));var l=void 0;var u=t.getMediaAttributes(i,"ssrc");for(var c=0;c<u.length;c++){var d=u[c];var f=d.match(/^([^ ]+) msid:([^ \r\n]+)/);if(f){var p=f[1];if(s.indexOf(p)<0){l=f[2];a[l]=p}}}};var r=this;for(var i=0;i<n.length;i++){_loop_2(i)}};SFUPeerClient.prototype.getLocalDescription=function(){return this._peerConnection.localDescription};SFUPeerClient.prototype.addIceCandidate=function(e){return Pt(this,void 0,void 0,(function(){return Nt(this,(function(t){switch(t.label){case 0:if(this._closed){return[2,Promise.resolve()]}return[4,this._localIceCandidateBarrier.wait()];case 1:t.sent();this._logger.log("add remote ice candidate "+JSON.stringify(e));return[2,!this._closed&&this._peerConnection.addIceCandidate(e)]}}))}))};SFUPeerClient.prototype.handleRemoteAnswer=function(e){var t=this;if(this._closed){return Promise.resolve()}if(this._peerConnection.signalingState!=="have-local-offer"){this._logger.warn("receive remote answer but pc is not in exchange state");return Promise.resolve()}this._logger.log("handle remote answer:",e.sdp);var n=e.sdp.match(/o=[^ \n\r]+ ([^ \n\r]+) /);if(n){this._remoteRTCSessionId=n[1]}return this._peerConnection.setRemoteDescription(e).then((function(){t._updateRemoteStreamIdToSSRCMapping()}))};SFUPeerClient.prototype.addTrack=function(e,t){this._peerConnection.addTrack(e,t)};SFUPeerClient.prototype.handleRemoteOffer=function(e){return Pt(this,void 0,void 0,(function(){var t,n;return Nt(this,(function(r){switch(r.label){case 0:t=e.sdp.match(/o=[^ \n\r]+ ([^ \n\r]+) /);if(t){this._remoteRTCSessionId=t[1]}this._logger.log("handle remote offer",e.sdp);return[4,this._peerConnection.setRemoteDescription(e)];case 1:r.sent();this._updateRemoteStreamIdToSSRCMapping();return[4,this._peerConnection.createAnswer()];case 2:n=r.sent();return[4,this._peerConnection.setLocalDescription(n)];case 3:r.sent();return[2,n]}}))}))};SFUPeerClient.prototype.removeAllRemoteStreams=function(){var e,t;this._SFUDelegate.removeRemoteStream(Dt(this._remoteStreamsTapIdById.values()));try{for(var n=kt(this._remoteStreamsById.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.getTracks().forEach((function(e){return e.stop()}))}}catch(t){e={error:t}}finally{try{if(r&&!r.done&&(t=n.return))t.call(n)}finally{if(e)throw e.error}}};SFUPeerClient.prototype.close=function(){this._logger.log("closing sfu client");this._closed=true;!this._localIceCandidateBarrier.isOpen()&&this._localIceCandidateBarrier.open();this._peerConnection.close();this._controlChannel.close();this.removeAllRemoteStreams();delete this._SFUDelegate;this._logger.info("closed sfu client")};SFUPeerClient.prototype.getRcvPcRoleString=function(){return this._type===c.Ls.MAIN?"main":"additional"};SFUPeerClient.prototype.getSFUPeerClientType=function(){return this._type};SFUPeerClient.prototype.getPCIceState=function(){return this._peerConnection.iceConnectionState};SFUPeerClient.prototype.hasLocalStream=function(e){return this._localStreams.has(e)};SFUPeerClient.prototype.hasRTPSender=function(e){var t,n;var r;var i=this._peerConnection.getSenders();if(!i||i.length<1){return false}try{for(var o=kt(i),a=o.next();!a.done;a=o.next()){var s=a.value;if(((r=s===null||s===void 0?void 0:s.track)===null||r===void 0?void 0:r.kind)===e){return true}}}catch(e){t={error:e}}finally{try{if(a&&!a.done&&(n=o.return))n.call(o)}finally{if(t)throw t.error}}return false};SFUPeerClient.prototype.hasRemoteStream=function(e){var t=false;this._remoteStreamsById.forEach((function(n){if(n===e){t=true}}));return t};SFUPeerClient.prototype.getLocalStreams=function(){var e=[];this._localStreams.forEach((function(t){e.push(t.getMediaStream())}));return e};SFUPeerClient.prototype.getRemoteStreams=function(){var e=[];this._remoteStreamsById.forEach((function(t){e.push(t)}));return e};SFUPeerClient.prototype.onLocalStreamActivityReport=function(e){var t=this._localStreams.get(e.id);if(!t){return}if(e.desired_q===undefined){return}var n=this._videoSSRCbyLocalStreamId[e.id];var r=this._statBySSRC[n];var i=t.setVideoDesiredQuality(e.desired_q,r);if(i){this.adjustRTPSenderState(e.id,e.desired_q)}};SFUPeerClient.prototype.getSendQualities=function(){var e,t;var n;var r=[];try{for(var i=kt(this._localStreams),o=i.next();!o.done;o=i.next()){var a=wt(o.value,2),s=a[1];var l=s.getMediaStream();var u=this._videoSSRCbyLocalStreamId[l.id];var c=this._audioSSRCbyLocalStreamId[l.id];s.getSendQuality({audio:this._statBySSRC[c],video:this._statBySSRC[u]},this._maxBitrateByVideoTrackId.get((n=l.getVideoTracks()[0])===null||n===void 0?void 0:n.id)).forEach((function(e){return r.push(e)}))}}catch(t){e={error:t}}finally{try{if(o&&!o.done&&(t=i.return))t.call(i)}finally{if(e)throw e.error}}return r};SFUPeerClient.prototype._switchLocalStreamMediaTrack=function(e,t,n){var r=this;var i;var o=(i=this._localStreams.get(e))===null||i===void 0?void 0:i.getMediaStream();if(!o){this._logger.warn("Not find localStream by "+e);return}var a=oe().groupBy(this._peerConnection.getSenders(),(function(e){var t;return(t=e.track)===null||t===void 0?void 0:t.kind}));n(t).forEach((function(e){var n=a[e.kind];r._logger.debug("switch media: sender:",n,t);if(n&&n.length>0){n.forEach((function(t){return t.replaceTrack(e)}))}else{r._peerConnection.addTrack(e,o)}}))};SFUPeerClient.prototype._isPlaceHolderStream=function(e){var t;var n=(t=this._localStreams.get(e))===null||t===void 0?void 0:t.getMediaStream();return!n||!n.getTracks()||n.getTracks().length<1};SFUPeerClient.prototype._initControlChannel=function(e){if(!this._peerConnection){this._logger.warn("No peerConnection!");return}this._controlChannel=new Ot(this._peerConnection,e)};SFUPeerClient.prototype.containTapStream=function(e){return this._localStreams.has(e)};SFUPeerClient.prototype.adjustRTPSenderState=function(e,t){var n;return Pt(this,void 0,void 0,(function(){var r,i,o,a,s,l;return Nt(this,(function(u){switch(u.label){case 0:r=(n=this._localStreams.get(e))===null||n===void 0?void 0:n.getMediaStream().getVideoTracks()[0];i=this._peerConnection.getSenders().find((function(e){return e.track===r}));if(!i||typeof i.getParameters!=="function"){this._logger.log("no video senders or sender parameters not supported, abort adjusting sender state");return[2]}o=i.getParameters();a=o.encodings;if(!a||a.length===0){this._logger.log("no video sender encodings, abort adjusting sender state");return[2]}this._logger.log("start adjust RTP sender state, desired quality=",t);s=0;if(a.length>1){a.forEach((function(e,n){var r=n+1;e.active=t>=r;if(e.active){e.maxBitrate=Ft[n];s+=e.maxBitrate||0}}))}else{l=a[0];l.active=t>0;if(l.active){l.maxBitrate=Vt;s+=l.maxBitrate||0}}this._logger.log("update current max bitrate to ",s);r&&this._maxBitrateByVideoTrackId.set(r.id,s);if(!(typeof i.setParameters==="function"))return[3,2];return[4,i.setParameters(o)];case 1:u.sent();u.label=2;case 2:return[2]}}))}))};return SFUPeerClient}(D.EventEmitter2);var jt=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var xt=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Ht=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Gt=r.k.tags("[PeerController]");var Bt=500;var qt=function(e){jt(PeerController,e);function PeerController(t,n,r){var i=e.call(this)||this;i._iceServers=t;i._delegate=n;i._isFirstConnect=r;i._SFUPeerClients=[];i._statusController=new B(i,"status");i._lastUpdateStatTime=0;i._onPCIceStateChanged=function(){var e=i._SFUPeerClients.map((function(e){return e.getPCIceState()}));Gt.log("on pc ice state changed, states=",e);if(oe().every(e,(function(e){return[Be.COMPLETED,Be.CONNECTED].includes(e)}))){Gt.log("ice state connected.");i._statusController.emit(ve.hj.CONNECTED)}else if(e.some((function(e){return e===Be.DISCONNECTED}))){Gt.log("ice state disconnected detected, show as reconnect");i._statusController.emit(ve.hj.RECONNECTING)}else if(e.some((function(e){return e===Be.FAILED}))){Gt.log("ice state failed detected, try to recovery media");i._SFUPeerClients.forEach((function(e){return e.removeAllRemoteStreams()}));i._delegate.recovery&&i._delegate.recovery()}};Gt.log("new peer controller created, first time=",i._isFirstConnect);return i}PeerController.prototype.switch=function(e,t){if(t===void 0){t=true}var n,r;var i=t?(n=this._mainSFUPeerClient)===null||n===void 0?void 0:n.switchAudio:(r=this._mainSFUPeerClient)===null||r===void 0?void 0:r.switchVideo;return i&&i(this._mainTapStreamId,e)};PeerController.prototype.switchAudio=function(e){var t;return(t=this._mainSFUPeerClient)===null||t===void 0?void 0:t.switchAudio(this._mainTapStreamId,e)};PeerController.prototype.switchVideo=function(e){var t;return(t=this._mainSFUPeerClient)===null||t===void 0?void 0:t.switchVideo(this._mainTapStreamId,e)};PeerController.prototype.connected=function(){var e;return(e=this._mainSFUPeerClient)===null||e===void 0?void 0:e.connected()};PeerController.prototype.muteVideo=function(){var e;(e=this._mainSFUPeerClient)===null||e===void 0?void 0:e.muteVideo()};PeerController.prototype.leaveAudio=function(){var e;(e=this._mainSFUPeerClient)===null||e===void 0?void 0:e.leaveAudio()};PeerController.prototype.unmuteVideo=function(e){var t;(t=this._mainSFUPeerClient)===null||t===void 0?void 0:t.unmuteVideo(this._mainTapStreamId,e)};PeerController.prototype.applyNewLocalStream=function(e,t,n){Gt.log("add new sfu peer client using local stream:",e," type:",n);if(this._SFUPeerClients.length===0){this._statusController.emit(this._isFirstConnect?ve.hj.CONNECTING:ve.hj.RECONNECTING)}var r=new Ut(this._iceServers,n,this._delegate);this._SFUPeerClients.push(r);r.addLocalStream(e,t);r.on(Ge.ICE_STATE_CHANGED,this._onPCIceStateChanged);if(n===c.Ls.MAIN){this._mainSFUPeerClient=r;this._mainTapStreamId=e}return r};PeerController.prototype.getSFUPeerClientByRemoteDescription=function(e){var t="";var n="";var r=e.match(/o=[^ ]+ ([^ ]+)/);if(r){t=r[1]}var i=e.match(/a=rcv-remote-session:([^ \n\r]+)/);if(i){n=i[1]}Gt.log("trying to find sfu client by remote sdp, extracted remote rtc session=",t," local session id=",n);return this._SFUPeerClients.find((function(e){return e.getLocalRTCSessionId()===n||e.getRemoteRTCSessionId()===t}))};PeerController.prototype.getSFUPeerClientByRemoteRTCSessionId=function(e){Gt.log("trying to find sfu client by remote rtc session id",e);return this._SFUPeerClients.find((function(t){return t.getRemoteRTCSessionId()===e}))};PeerController.prototype.getSFUPeerClientByLocalRTCSessionId=function(e){Gt.log("trying to find sfu client by local rtc session id",e);return this._SFUPeerClients.find((function(t){return t.getLocalRTCSessionId()===e}))};PeerController.prototype.getSFUPeerClientByTapStreamId=function(e){Gt.log("trying to find sfu client by tap id:",e);return this._SFUPeerClients.find((function(t){return t.containTapStream(e)}))};PeerController.prototype.stopScreenSharingSFUPeerClient=function(){var e=this._SFUPeerClients.find((function(e){return e.getSFUPeerClientType()===c.Ls.SCREENSHARING}));if(e){e.close();this._SFUPeerClients=this._SFUPeerClients.filter((function(e){return e.getSFUPeerClientType()!==c.Ls.SCREENSHARING}))}};PeerController.prototype.maybeUpdatePeerStats=function(){return xt(this,void 0,void 0,(function(){var e;return Ht(this,(function(t){switch(t.label){case 0:e=Date.now();if(!(e-this._lastUpdateStatTime>Bt))return[3,2];this._lastUpdateStatTime=e;return[4,this.updatePeerStats()];case 1:t.sent();t.label=2;case 2:return[2]}}))}))};PeerController.prototype.updatePeerStats=function(){return xt(this,void 0,void 0,(function(){return Ht(this,(function(e){switch(e.label){case 0:return[4,(0,It.runInPool)(this._SFUPeerClients.map((function(e){return function(){return e.updatePeerStat()}})))];case 1:e.sent();return[2]}}))}))};PeerController.prototype.getPeerStats=function(){var e=[];var t=[];this._SFUPeerClients.forEach((function(n){var r=n.getLocalPeerStats();var i=n.getRemotePeerStats();if(r.length){e=e.concat(r)}if(i.length){t=t.concat(i)}}));return{localPeerStats:e,remotePeerStats:t}};PeerController.prototype.onActiveSpeakerReport=function(e){var t=e.local_streams,n=t===void 0?[]:t;this._SFUPeerClients.forEach((function(e){n.forEach((function(t){e.hasLocalStream(t.id)&&e.onLocalStreamActivityReport(t)}))}))};PeerController.prototype.removeAllRemoteStreams=function(){this._SFUPeerClients.forEach((function(e){return e.removeAllRemoteStreams()}))};PeerController.prototype.close=function(){this._statusController.emit(ve.hj.TERMINATING);this._SFUPeerClients&&this._SFUPeerClients.forEach((function(e){return e.close()}));this._SFUPeerClients=[];this._statusController.emit(ve.hj.TERMINATED);this._statusController.clear();delete this._mainSFUPeerClient;delete this._iceServers;delete this._delegate};PeerController.prototype.ableToSendMedia=function(e){if(!this._mainSFUPeerClient){Gt.warn("ableToSendMedia: No mainSFUPeerClient to judge.");return false}return this._mainSFUPeerClient.hasRTPSender(e)};PeerController.prototype.getStatusController=function(){return this._statusController};PeerController.prototype.getSendQualities=function(){return this._SFUPeerClients.map((function(e){return e.getSendQualities()})).flatMap((function(e){return e}))};Object.defineProperty(PeerController.prototype,"mainSFUPeerClient",{get:function(){return this._mainSFUPeerClient},enumerable:true,configurable:true});PeerController.EVENTS={STATUS:ve.hj};return PeerController}(D.EventEmitter2);var Yt=undefined&&undefined.__assign||function(){Yt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Yt.apply(this,arguments)};var Kt=function(){function StreamPreferenceController(e){var t=this;this._sendUpdateReqFunction=e;this._maxRemoteAudio=0;this.updateNewestPreferenceToSFU=function(){if(!t._waitingStatus||t._committingStatus){r.k.log("[quality control] wait to update newest preference to sfu since waiting=",t._waitingStatus!==undefined," is updating=",t._committingStatus!==undefined);return}r.k.log("[quality control] start updating new preference to SFU.");t._committingStatus=t._waitingStatus;t._waitingStatus=undefined;if(t._serverStatus&&oe().isEqual(t._committingStatus,t._serverStatus)){r.k.log("[quality control] preference not changed, skip updating to sfu,");t._finishCommitPreference();return}var e=t.generateRemoteStreamStatusDiff(t._committingStatus);var n=e.length===0?{max_remote_audio:t._committingStatus.maxRemoteAudio}:{max_remote_video:t._committingStatus.maxRemoteVideo,max_remote_audio:t._committingStatus.maxRemoteAudio,remote_streams:e};r.k.log("[quality control] ready to update new preference difference, is",n);t._sendUpdateReqFunction(n,(function(){r.k.log("[quality control] stream preference update success.");t._finishCommitPreference(true)}),(function(){r.k.error("[quality control] stream preference update failed.");t._finishCommitPreference()}))};this._finishCommitPreference=function(e){if(e===void 0){e=false}e&&(t._serverStatus=t._committingStatus);t._committingStatus=undefined;t._checkQueuedPreference()};this._checkQueuedPreference=function(){if(t._waitingStatus){t.updateNewestPreferenceToSFU()}}}StreamPreferenceController.prototype.close=function(){this._serverStatus=undefined;this._committingStatus=undefined;this._waitingStatus=undefined};StreamPreferenceController.prototype.commit=function(e){r.k.log("[quality control] preference status committed.");e.maxRemoteAudio=this._maxRemoteAudio;this._waitingStatus=e;this.updateNewestPreferenceToSFU()};StreamPreferenceController.prototype.setMaxRemoteAudio=function(e,t){if(t===void 0){t=true}r.k.log("[audio control] set max remote audio=",e);this._maxRemoteAudio=e;if(t){var n=Yt(Yt({},this._waitingStatus||this._committingStatus||this._serverStatus),{maxRemoteAudio:this._maxRemoteAudio});this.commit(n)}};StreamPreferenceController.prototype.maxRemoteAudio=function(){return this._maxRemoteAudio};StreamPreferenceController.prototype.generateRemoteStreamStatusDiff=function(e){var t=this;var n=[];var r=this._serverStatePinnedStreams||[];var i=e.pinnedStreams||[];var o=r.filter((function(e){return!i.includes(e)}));n=n.concat(o.map((function(e){return{id:e,pinned:false,quality:{min:0,max:0}}})));var a=i.filter((function(e){return!r.includes(e)}));n=n.concat(a.map((function(t){var n;return{id:t,pinned:true,quality:((n=e.qualityRangeMap)===null||n===void 0?void 0:n.get(t))||{min:1,max:1}}})));var s=r.filter((function(e){return i.includes(e)}));s.forEach((function(r){var i;var o=t._serverStatus&&t._serverStatus.qualityRangeMap?t._serverStatus.qualityRangeMap.get(r):{min:0,max:0};var a=((i=e.qualityRangeMap)===null||i===void 0?void 0:i.get(r))||{min:1,max:1};if(a&&(!o||o.min!==a.min||o.max!==a.max)){n.push({id:r,pinned:true,quality:a})}}));return n};Object.defineProperty(StreamPreferenceController.prototype,"_serverStatePinnedStreams",{get:function(){return this._serverStatus?this._serverStatus.pinnedStreams:[]},enumerable:true,configurable:true});return StreamPreferenceController}();function stopStream(e,t){e===null||e===void 0?void 0:e.getTracks().forEach((function(e){if(t){e.dispatchEvent(new Event(t))}e.stop()}))}function replaceStreamTracks(e,t,n){var r=[];getTracksOfKind(e,n).forEach((function(t){e.removeTrack(t);r.push(t)}));getTracksOfKind(t,n).forEach((function(t){e.addTrack(t)}));r.forEach((function(e){e.enabled=false;e.stop()}))}function changeTracksEnableState(e,t,n){getTracksOfKind(e,t).forEach((function(e){return e.enabled=n}))}function stopAndRemoveTrackByKind(e,t){getTracksOfKind(e,t).forEach((function(t){e.removeTrack(t);t.enabled=false;t.stop()}))}function getTracksOfKind(e,t){return e.getTracks().filter((function(e){return e.kind===t}))}var Qt=r.k.tags("[MediaActionController]");var Wt=function(){function MediaActionController(){}Object.defineProperty(MediaActionController.prototype,"peerController",{set:function(e){this._peerController=e},enumerable:true,configurable:true});MediaActionController.prototype.switchAudio=function(e){Qt.info("switchAudio()");this._peerController&&this._peerController.switchAudio(e)};MediaActionController.prototype.switchVideo=function(e){Qt.info("switchVideo()");this._peerController&&this._peerController.switchVideo(e)};MediaActionController.prototype.unmuteVideo=function(e){this._peerController&&this._peerController.unmuteVideo(e)};MediaActionController.prototype.muteVideo=function(){this._peerController&&this._peerController.muteVideo()};return MediaActionController}();function getRetryRandomTime(e){var t=2*e*1e3/2;var n=Math.ceil(t*.1);var r=t+Math.floor(Math.random()*Math.floor(n));return r}var Jt=undefined&&undefined.__assign||function(){Jt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Jt.apply(this,arguments)};var zt=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var $t=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Xt=10;var Zt=r.k.tags("[SocketManager]");var en=function(){function SocketManager(e,t,n,r){var i=this;this._closeMeeting=r;this._isRecovering=false;this._recoveryCount=0;this._closed=false;this._keepAliveInterval=3e3;this._keepAliveCount=0;this._id=(Math.floor(Math.random()*4026531840)+268435456).toString(16);this._reqSeq=0;this._version=1;this._startConnection=function(){if(i._isRecovering){Zt.info("last recovery process is not finishing");return}i._isRecovering=true;i._version++;i._recoveryCount++;if(i._recoveryCount>Xt){Zt.info("reach max recovery count,",Xt);i._closeMeeting(M.MAX_RETRY_ERROR);return}i._recoverTimer&&clearTimeout(i._recoverTimer);var e=getRetryRandomTime(i._recoveryCount);Zt.info("start reconnection after:",e,i._recoveryCount);i._recoverTimer=setTimeout((function(){return zt(i,void 0,void 0,(function(){return $t(this,(function(e){switch(e.label){case 0:Zt.info("start reconnection");return[4,this.start()];case 1:e.sent();this._isRecovering=false;return[2]}}))}))}),e)};this.restartConnection=function(){Zt.info("start detect connection");if(i._closed){Zt.info("cannot restart connection because connection is closed");return}clearInterval(i._keepAliveTimer);i._startConnection()};this._mediaOptions=e;this._socketDelegate=Jt(Jt({},t),{recovery:this.restartConnection});this._startPeerConn=n;this._socket=new Q(this._mediaOptions.wsConnectionUrl,this._socketDelegate)}Object.defineProperty(SocketManager.prototype,"socketConnection",{get:function(){return this._socket},enumerable:true,configurable:true});SocketManager.prototype.start=function(){return zt(this,void 0,void 0,(function(){var e,t;return $t(this,(function(n){switch(n.label){case 0:n.trys.push([0,4,,5]);return[4,this._socket.start(this._isRecovering)];case 1:n.sent();e=this._startPeerConn;if(!e)return[3,3];return[4,this._startPeerConn(this.restartConnection)];case 2:e=n.sent();n.label=3;case 3:e;this._finished();return[3,5];case 4:t=n.sent();Zt.debug("start error:",t);this._isRecovering=false;this.restartConnection();return[3,5];case 5:return[2]}}))}))};SocketManager.prototype._finished=function(){this._keepAliveCount=0;this._keepAlive();this._isRecovering=false;this._recoveryCount=0;this._recoverTimer&&clearTimeout(this._recoverTimer)};SocketManager.prototype._keepAlive=function(){var e=this;this._keepAliveInterval&&clearInterval(this._keepAliveTimer);if(this._keepAliveInterval>0){this._keepAliveTimer=setInterval((function(){return zt(e,void 0,void 0,(function(){var e,t;return $t(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,this.request({body:{},event:I.KEEP_ALIVE_REQ,id:this._id,type:T.CONNECTION})];case 1:e=n.sent();this._keepAliveCount=0;Zt.info("keep alive resp:",e);return[3,3];case 2:t=n.sent();Zt.warn("keep alive error:",t,this._keepAliveCount);this._keepAliveCount++;if(this._keepAliveCount>2){this._keepAliveCount=0;this.restartConnection()}return[3,3];case 3:return[2]}}))}))}),this._keepAliveInterval)}};SocketManager.prototype.request=function(e){return zt(this,void 0,void 0,(function(){var t,n;return $t(this,(function(r){switch(r.label){case 0:t=new z({id:e.id?e.id:this._mediaOptions.sessionId,type:e.type?e.type:T.SESSION,body:e.body,event:e.event,req_seq:this._reqSeq++,version:this._version},false,false);return[4,this._socket.request(t)];case 1:n=r.sent();if(n.err_code||n.err_message){return[2,Promise.reject(n)]}return[2,n]}}))}))};SocketManager.prototype.respondOK=function(e){var t=new z(e,false,true);return this._socket.respond(t)};SocketManager.prototype.respondAckOK=function(e){var t=new z(e,true,false);return this._socket.respond(t)};SocketManager.prototype.close=function(){this._closed=true;clearTimeout(this._recoverTimer);clearInterval(this._keepAliveTimer);delete this._socketDelegate;delete this._closeMeeting;this._socket&&this._socket.stop()};return SocketManager}();var tn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var nn=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var rn=r.k.tags("[MediaStats]");var on=["bytes","speed","lost","packets","delay","jitter","readyState","enabled","muted","fir","pli","nack","width","height","fps"];var an={bytes:"bytes",speed:"speed",lost:"packetsLost",delay:"currentDelay",packets:"packets",jitter:"jitter",fir:"firs",pli:"plis",nack:"nacks",width:"frameWidth",height:"frameHeight",fps:"frameRateOut"};var sn=["bytes","speed","lost","delay","jitter","packets","fir","pli","nack","width","height","fps"];var ln=["bytes","speed","lost","delay","jitter","packets"];var un=function(){function MediaStatsController(e){this.delegate=e}MediaStatsController.prototype._peerStatToMediaStat=function(e){return{id:e.stream.id,htmlElement:{},p2p:e.p2p,audio:peerStatForMediaTypeToMediaStatArray(e.audio,on,an,ln),video:peerStatForMediaTypeToMediaStatArray(e.video,on,an,sn)};function peerStatForMediaTypeToMediaStatArray(e,t,n,r){var i=[];if(!e){return i}r.forEach((function(r){var o=n[r];var a=e[o];var s=t.indexOf(r);i[s]=a}));return i}};MediaStatsController.prototype._setTrackStateFieldsInMediaStat=function(e){var t=this;var n=e.mediaStat,r=e.mediaStatFormat,i=e.stream;var o=i.getAudioTracks();var a=i.getVideoTracks();var s=["readyState","enabled","muted"];s.forEach((function(e){t._setTrackStateFieldInMediaStat({mediaStat:n,mediaStatFormat:r,mediaType:"audio",trackStateFieldName:e,tracks:o});t._setTrackStateFieldInMediaStat({mediaStat:n,mediaStatFormat:r,mediaType:"video",trackStateFieldName:e,tracks:a})}));return n};MediaStatsController.prototype._setTrackStateFieldInMediaStat=function(e){var t=e.mediaStat,n=e.mediaStatFormat,r=e.mediaType,i=e.tracks,o=e.trackStateFieldName;var a;if(i&&i.length>0){a=i[0][o]}else{return}var s;if(o==="readyState"){switch(a){case"live":s=1;break;case"ended":s=0;break;default:s=2}}else if(["enabled","muted"].includes(o)){s=a===true?1:0}else{rn.warn("Unknown trackStateFieldName="+o)}var l=n.indexOf(o);if(l>-1&&s){t[r][l]=s}};MediaStatsController.prototype._removeEmptyArraysInMediaStat=function(e){["audio","video"].forEach((function(t){var n=e[t];var r=!n.find((function(e){return typeof e==="number"&&e>0}));if(r){e[t]=[]}}));return e};MediaStatsController.prototype._getMediaStatForStream=function(e){var t=e.peerStat;var n=t.stream,r=t.tapId;var i=this._peerStatToMediaStat(t);i=this._setTrackStateFieldsInMediaStat({mediaStat:i,stream:n,mediaStatFormat:on});i=this._removeEmptyArraysInMediaStat(i);i.id=r;i.htmlElement={};return i};MediaStatsController.prototype.start=function(){var e=this;if(nt.mediaStatType.firefoxLikeStat){return}if(this.delegate.mediaStatInterval<0){return}this._interval=setInterval((function(){return tn(e,void 0,void 0,(function(){var e,t;return nn(this,(function(n){switch(n.label){case 0:return[4,this.getMediaStats()];case 1:e=n.sent();n.label=2;case 2:n.trys.push([2,4,,5]);return[4,this.delegate.request({event:I.MEDIA_STAT_REQ,body:e})];case 3:n.sent();return[3,5];case 4:t=n.sent();rn.error("cannot upload stat info:",t);return[3,5];case 5:return[2]}}))}))}),this.delegate.mediaStatInterval)};MediaStatsController.prototype.stop=function(){clearInterval(this._interval)};MediaStatsController.prototype.getMediaStats=function(){return tn(this,void 0,void 0,(function(){var e,t,n,r,i,o,a;var s=this;return nn(this,(function(l){switch(l.label){case 0:e=this.delegate.peerController();if(!e){return[2,{localMediaStats:[],remoteMediaStats:[]}]}return[4,e.maybeUpdatePeerStats()];case 1:l.sent();t=[];n=[];r=e.getPeerStats(),i=r.localPeerStats,o=r.remotePeerStats;a=Array.from(document.querySelectorAll("video,audio"));i.forEach((function(e){t.push(s._getMediaStatForStream({peerStat:e,htmlElements:a,kind:"output"}))}));o.forEach((function(e){n.push(s._getMediaStatForStream({peerStat:e,htmlElements:a,kind:"input"}))}));return[2,{p2p:false,format:on,local:t,remote:n}]}}))}))};return MediaStatsController}();var cn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var dn=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var fn=r.k.tags("[LocalNetworkStatusController]");var pn=function(){function LocalNetworkStatusController(e,t){this._peerController=e;this._commitFunction=t}LocalNetworkStatusController.prototype._updateSendQuality=function(){var e;return cn(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,l;return dn(this,(function(u){switch(u.label){case 0:t=this._peerController();if(!t){return[2]}return[4,t.maybeUpdatePeerStats()];case 1:u.sent();n=t.getSendQualities();r=100;if(n===null||n===void 0?void 0:n.length){r=oe().minBy(n,(function(e){return e.quality})).quality}i=nt.supportNQIDetails?n.map((function(e){return e.detail})).filter((function(e){return!!e})):undefined;if(!(r!==undefined))return[3,5];o=this._lastQuality!==r;a=!oe().isEqual(this._lastDetails,i);s=!oe().isEqual((e=this._lastDetails)===null||e===void 0?void 0:e.length,i===null||i===void 0?void 0:i.length);s&&fn.debug("sendQuality count change.",{pre:{quality:this._lastQuality,details:this._lastDetails},cur:{quality:r,details:i}});this._lastQuality=r;this._lastDetails=i;u.label=2;case 2:u.trys.push([2,4,,5]);return[4,this._commitFunction(r,i,o,a)];case 3:u.sent();return[3,5];case 4:l=u.sent();fn.warn("commit LocalNetworkStatus failed.",l);return[3,5];case 5:return[2]}}))}))};LocalNetworkStatusController.prototype.getSendQuality=function(){return this._lastQuality};LocalNetworkStatusController.prototype.getNQIDetails=function(){return this._lastDetails};LocalNetworkStatusController.prototype.start=function(){var e=this;fn.log("localNetworkStatus start.");this.stop();this._intervalId=setInterval((function(){return e._updateSendQuality()}),1e3)};LocalNetworkStatusController.prototype.stop=function(){fn.log("localNetworkStatus stop.");clearInterval(this._intervalId)};return LocalNetworkStatusController}();var hn=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var _n=undefined&&undefined.__assign||function(){_n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return _n.apply(this,arguments)};var vn=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var gn=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var yn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var mn=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Sn=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Cn=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var En=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Cn(arguments[t]));return e};var bn=r.k.tags("[MediaController]");var In=3;var Mn=0;var Rn=function(e){hn(MediaController,e);function MediaController(t,n){var r=e.call(this)||this;r._delegate=n;r._isClosing=false;r._screenSharingVideoTapStreamId="";r._localStreamMap=new Map;r._iceCandidateCache=new Map;r._signalStatusController=new B(r,"signalStatus");r._peerStatusController=new B(r,"peerStatus");r._audioJoined=false;r._pendingRenegotiation=false;r._startPeerConnection=function(e){return yn(r,void 0,void 0,(function(){var t,n,r,i,o,a,s,l,u,c,d,f;var p,h;var _=this;return mn(this,(function(v){switch(v.label){case 0:return[4,this._socketManager.request({event:I.CREATE_REQ,body:this._getCreateReq()})];case 1:t=v.sent();if(!t){bn.error("cannot receive create response");throw new Error("cannot receive create response")}this._respondAckOK(t);n=t&&t.body.ice_servers;r=t&&t.body.media_exists;i=t&&t.body.media_stat_interval;if(!!r)return[3,10];o=this._peerController===undefined;this._peerController&&this._peerController.close();this._mediaStatsController&&this._mediaStatsController.stop();this._peerController=new qt(n,_n(_n({},this._getSFUDelegate()),{recovery:e}),o);this._actionController.peerController=this._peerController;this._peerController.getStatusController().forwardChannelEventsTo(Object.keys(qt.EVENTS.STATUS),this._peerStatusController);this._initStreamPreferenceController();this._mediaStatsController=new un({mediaStatInterval:i,peerController:function(){return _._peerController},request:this._sendMediaStatRequest});this._mediaStatsController.start();v.label=2;case 2:v.trys.push([2,7,8,9]);a=Sn(this._localStreamMap),s=a.next();v.label=3;case 3:if(!!s.done)return[3,6];l=Cn(s.value,2),u=l[0],c=l[1];d=this._peerController.applyNewLocalStream(u,c,this._getLocalStreamTypeByTapId(u));return[4,this._connectMediaForSFUClient(d)];case 4:v.sent();v.label=5;case 5:s=a.next();return[3,3];case 6:return[3,9];case 7:f=v.sent();p={error:f};return[3,9];case 8:try{if(s&&!s.done&&(h=a.return))h.call(a)}finally{if(p)throw p.error}return[7];case 9:this._pendingRenegotiation=false;return[3,12];case 10:if(!this._pendingRenegotiation)return[3,12];return[4,this._triggerRenegotiateMedia()];case 11:v.sent();v.label=12;case 12:return[2]}}))}))};r._handleLocalCandidate=function(e,t){if(e.candidate){bn.info("Sending the ice candidate to the remote peer, origin=",t," ice=",JSON.stringify(e.candidate));r._request({event:I.ICE_REQ,body:{candidate:e.candidate.candidate,mid:e.candidate.sdpMid,mline_index:0,origin:t}})}};r._handleEndOfLocalCandidate=function(e){r._request({event:I.NO_MORE_ICE_REQ,body:{origin:e}})};r._handleAnswer=function(e,t){return yn(r,void 0,void 0,(function(){var n,r,i,o;return mn(this,(function(a){switch(a.label){case 0:if(!t||!t.body||!t.body.sdp||!this._peerController){return[2]}n=this._peerController.getSFUPeerClientByRemoteDescription(t.body.sdp);if(!n)return[3,4];return[4,n.setLocalDescription(e)];case 1:a.sent();bn.log("handle answer from remote, peer type=",n.getSFUPeerClientType());r=t.body.streams;n.updateRemoteStreamMapping(r);i=this._mungeRemoteSDP(t.body.sdp,n);o=new RTCSessionDescription({type:"answer",sdp:i});return[4,n.handleRemoteAnswer(o)];case 2:a.sent();return[4,this._applyCachedIceCandidates(n.getRemoteRTCSessionId())];case 3:a.sent();return[3,5];case 4:bn.error("can not get proper sfu client when handle answer from sfu!");a.label=5;case 5:this._socketManager.respondAckOK(t);return[2]}}))}))};r._processMessage=function(e){if(r._isClosing){bn.warn("media controller receive socket push after close() be called.");return}if(e.err_code){bn.warn("server return err",e);if(r._shouldBeClosed(e)){bn.info("start close");r._closeSocketTimer=setTimeout((function(){return r._delegate.closeMeeting}),e.err_code,5e3);return}if(r._shouldBeRecovery(e)){bn.info("recovery from:",e);r._socketManager.restartConnection();return}}switch(e.event){case I.UPDATE_REQ:r._onUpdateSessionReq(e);break;case I.UPDATE_RES:break;case I.ICE_REQ:r._onRemoteICE(e);break;case I.NO_MORE_ICE_REQ:r._onNoMoreRemoteIce(e);r._respondOK(e);break;case I.STATUS_REQ:r._respondOK(e);r._delegate.onSessionStatusUpdate(e);break;case I.PSTN_AS_REPORT_REQ:r._onPSTNActiveSpeakersReportReq(e);break;case I.ICE_RES:case I.NO_MORE_ICE_RES:case I.UPDATE_ACK:case I.SET_NETWORK_CONDITIONS_RES:case I.UNBIND_RES:if(!e.success){bn.error(e.err_code,e.err_message)}break;case I.ACTIVE_SPEAKERS_REPORT_REQ:r._onActiveSpeakersReportReq(e);break;case I.NETWORK_STATUS_REQ:r._respondOK(e);r._delegate.onRemoteNetworkStatusUpdate(e);break;default:if(!e.success){bn.warn("Unknown event for session ",e)}}};r._initStreamPreferenceController=function(){r._streamPreferenceController=new Kt(r._sendPreferenceRequest);r._streamPreferenceController.setMaxRemoteAudio(r._currentRemoteAudioCount(),false)};r._sendMediaStatRequest=function(e){return r._request(e)};r._sendPreferenceRequest=function(e,t,n){return yn(r,void 0,void 0,(function(){var r;return mn(this,(function(i){switch(i.label){case 0:return[4,this._request({event:I.UPDATE_REQ,body:e})];case 1:r=i.sent();if(!r||r.err_code||r.err_message){n()}else{t()}return[2]}}))}))};r._audioJoined=t.joinAudio;r._mediaOptions=t;r._socketManager=new en(t,r._getSocketDelegate(),r._startPeerConnection,r._delegate.closeMeeting);r._socketManager.socketConnection.getStatusController().forwardChannelEventsTo(Object.keys(Q.EVENTS.STATUS),r._signalStatusController);r._actionController=new Wt;r._localNetworkStatusController=new pn((function(){return r._peerController}),(function(e,t,n,i){return yn(r,void 0,void 0,(function(){var r;return mn(this,(function(o){switch(o.label){case 0:if(n||i){this._delegate.onLocalNetworkStatusUpdate({quality:e,details:t})}r=n;if(!r)return[3,2];return[4,this._request({event:I.INFO_REQ,body:{type:O.NET_QUALITY,value:{quality:e}}})];case 1:r=o.sent();o.label=2;case 2:r;return[2]}}))}))}));return r}MediaController.prototype._getLocalStreamById=function(e){var t=this._localStreamMap.get(e);if(!t){bn.info("cannot find local stream by id:",e,this._localStreamMap);return}return t};MediaController.prototype.joinAudio=function(e){bn.info("join audio: get new stream:",e);this.setAudioJoinedState(true);return this._switchMedia(e,xe.AUDIO,true)};MediaController.prototype.switchAudio=function(e){bn.info("switch audio: get new stream:",e);return this._switchMedia(e,xe.AUDIO)};MediaController.prototype.switchVideo=function(e){bn.info("switch video: for new stream:",e);return this._switchMedia(e,xe.VIDEO)};MediaController.prototype.muteVideo=function(){return yn(this,void 0,void 0,(function(){return mn(this,(function(e){switch(e.label){case 0:this._actionController.muteVideo();return[4,this._triggerRenegotiateMedia()];case 1:e.sent();return[2]}}))}))};MediaController.prototype.unmuteVideo=function(e){return this.switchVideo(e)};MediaController.prototype.connect=function(e){var t=this;var n;this._localStreamMap.set(this._mediaOptions.streamId,e);if(((n=this._delegate.getMeetingStatusController().meetingStatus)===null||n===void 0?void 0:n.peerStatus)===ve.hj.CONNECTED){this._localNetworkStatusController.start()}else{var r=this._delegate.getMeetingStatusController().subscribeMeetingStatus((function(e){if(e.peerStatus===ve.hj.CONNECTED){t._localNetworkStatusController.start();r()}}))}return this._socketManager.start()};MediaController.prototype.startScreenSharing=function(e,t){return yn(this,void 0,void 0,(function(){var n;return mn(this,(function(r){switch(r.label){case 0:this._screenSharingVideoTapStreamId=t;this._localStreamMap.set(t,e);n=this._peerController.applyNewLocalStream(t,e,c.Ls.SCREENSHARING);return[4,this._connectMediaForSFUClient(n)];case 1:r.sent();return[2]}}))}))};MediaController.prototype.stopScreenSharing=function(){if(this._screenSharingVideoTapStreamId===""||!this._peerController){return}this._peerController.stopScreenSharingSFUPeerClient();this._deleteLocalStream(this._screenSharingVideoTapStreamId,true);this._screenSharingVideoTapStreamId=""};MediaController.prototype.setPreference=function(e){this._streamPreferenceController&&this._streamPreferenceController.commit(e)};MediaController.prototype._deleteLocalStream=function(e,t){t&&stopStream(this._localStreamMap.get(e),c.Up);this._localStreamMap.delete(e)};MediaController.prototype._getCreateReq=function(){return{conference_id:this._mediaOptions.meetingId,max_remote_audio:this._currentRemoteAudioCount(),max_remote_video:[{quality:3,slots:16}],token:this._mediaOptions.sessionToken,meta:{meeting_id:this._mediaOptions.shortId,username:this._mediaOptions.username,user_agent:navigator.userAgent,x_user_agent:et.Pal.instance.getPlatformUtils().buildUserAgentForHttp()}}};MediaController.prototype._connectMediaForSFUClient=function(e){return yn(this,void 0,void 0,(function(){var t,n,r,i,o;return mn(this,(function(a){switch(a.label){case 0:return[4,e.createOffer()];case 1:t=a.sent();if(!t||!t.sdp||!t.type){return[2]}n=this._mungeLocalSDP(t.sdp,e);r=new RTCSessionDescription({type:t.type,sdp:n});bn.info("Sending the offer to the remote peer");return[4,this._request({event:I.UPDATE_REQ,body:{sdp:n,streams:e.generateTapIdToMsidMappingArray()}})];case 2:i=a.sent();o=i;if(!o)return[3,4];return[4,this._handleAnswer(r,i)];case 3:o=a.sent();a.label=4;case 4:o;return[2]}}))}))};MediaController.prototype.close=function(){var e=this;this._isClosing=true;this._localNetworkStatusController.stop();this._socketManager.close();this._peerStatusController.clear();this._signalStatusController.clear();this._iceCandidateCache.clear();this._peerController&&this._peerController.close();this._mediaStatsController&&this._mediaStatsController.stop();delete this._delegate;setTimeout((function(){e._localStreamMap.forEach((function(t,n){n===e._screenSharingVideoTapStreamId&&stopStream(t,c.Up)}));e._localStreamMap.clear()}));clearTimeout(this._closeSocketTimer)};MediaController.prototype._mungeRemoteSDP=function(e,t){var n;var r=nt.remoteRTPExtensionValidationMediaTypes();if(r.length===0){bn.log("no need to munge remote sdp.");return e}var i=(n=t.getLocalDescription())===null||n===void 0?void 0:n.sdp;if(!i){bn.warn("try to munge remote SDP without local SDP");return e}var o=new ze(e);var a=new ze(i);r.forEach((function(e){var t=a.getMedia(e);var n=o.getMedia(e);if(t.length!==n.length){bn.error("local media section does not consistent with remote, skip validating");return}for(var r=0;r<t.length;r++){filterInvalidRTPExtensions(n[r],t[r])}}));return o.toString()};MediaController.prototype._shouldBeClosed=function(e){return[M.INVALID_TOKEN,M.SESSION_REMOVED,M.CONFERENCE_NOT_FOUND,M.SESSION_NOT_FOUND].some((function(t){return t===e.err_code}))};MediaController.prototype._shouldBeRecovery=function(e){return[M.INTERNAL_ERROR,M.MEDIA_DISCONNECTED].some((function(t){return t===e.err_code}))};MediaController.prototype._onActiveSpeakersReportReq=function(e){this._respondOK(e);this._peerController.onActiveSpeakerReport(e.body);this._delegate.activeSpeaker(e)};MediaController.prototype._onPSTNActiveSpeakersReportReq=function(e){this._respondOK(e);this._delegate.activeSpeaker(e)};MediaController.prototype._onRemoteICE=function(e){return yn(this,void 0,void 0,(function(){var t,n,r,i;return mn(this,(function(o){switch(o.label){case 0:t=new RTCIceCandidate({candidate:e.body.candidate,sdpMLineIndex:e.body.mline_index,sdpMid:e.body.mid});n=e.body.origin;if(!this._peerController)return[3,3];r=this._peerController.getSFUPeerClientByRemoteRTCSessionId(n);if(!r)return[3,2];return[4,r.addIceCandidate(t)];case 1:o.sent();return[3,3];case 2:i=this._iceCandidateCache.get(n)||[];i.push(t);this._iceCandidateCache.set(n,i);o.label=3;case 3:this._respondOK(e);return[2]}}))}))};MediaController.prototype._onNoMoreRemoteIce=function(e){return yn(this,void 0,void 0,(function(){var t;return mn(this,(function(n){switch(n.label){case 0:if(!e||!e.body||!e.body.origin){return[2]}t=e.body.origin;bn.log("no more remote ice candidate for peer remote session id=",t);return[4,this._applyCachedIceCandidates(t)];case 1:n.sent();return[2]}}))}))};MediaController.prototype._applyCachedIceCandidates=function(e){return yn(this,void 0,void 0,(function(){var t,n,r,i,o,a;var s,l;return mn(this,(function(u){switch(u.label){case 0:t=this._iceCandidateCache.get(e);if(!(t&&t.length>0))return[3,2];bn.log("apply cached ice candidates for pc with remote rtc session id=",e);n=this._peerController.getSFUPeerClientByRemoteRTCSessionId(e);if(!n)return[3,2];r=[];try{for(i=Sn(t),o=i.next();!o.done;o=i.next()){a=o.value;r.push(n.addIceCandidate(a))}}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(l=i.return))l.call(i)}finally{if(s)throw s.error}}return[4,Promise.all(r)];case 1:u.sent();u.label=2;case 2:return[2]}}))}))};MediaController.prototype._onUpdateSessionReq=function(e){var t;return yn(this,void 0,void 0,(function(){var n,r,i,o,a,s;return mn(this,(function(l){switch(l.label){case 0:n=e.body;r=n.sdp;if(!this._peerController){return[2]}i=this._peerController.getSFUPeerClientByRemoteDescription(r);if(!i)return[3,2];bn.log("update_req received, peer type=",i.getSFUPeerClientType());o=n.streams;i.updateRemoteStreamMapping(o);a=this._mungeRemoteSDP(r,i);s=new RTCSessionDescription({type:"offer",sdp:a});return[4,i.handleRemoteOffer(s)];case 1:l.sent();this._respondOK(_n(_n({},e),{body:{sdp:this._mungeLocalSDP(((t=i.getLocalDescription())===null||t===void 0?void 0:t.sdp)||"",i),streams:i.generateTapIdToMsidMappingArray()}}),true);return[3,3];case 2:bn.error("can not find proper sfu client to handle remote offer.");l.label=3;case 3:return[2]}}))}))};MediaController.prototype._mungeLocalSDP=function(e,t){var n=e;try{n=this._mungeSDPviaParser(e,t)}catch(r){bn.error("munge SDP via parser failed, try munge via string",r);n=this._mungeSDPByString(e,t)}return n};MediaController.prototype._mungeSDPviaParser=function(e,t){var n=new ze(e);t.getRemoteRTCSessionId()!==""&&n.setSessionAttribute("rcv-remote-session",t.getRemoteRTCSessionId());n.setSessionAttribute("rcv-pc-role",t.getRcvPcRoleString());n.setSessionAttribute("rcv-mix-audio","recv-mode=auto");n.setSessionAttribute("rcv-negotiate-video","recv-mode=always");n.setSessionAttribute("rcv-denoise","enabled=1");var r=t.generateTapIdToMsidMappingArray();if(r.length>0){n.setSessionAttribute("rcv-stream",r[0].id+" "+r[0].msid)}if(nt.supportSimulcast()&&t.getSFUPeerClientType()===c.Ls.MAIN){var i=n.getMedia("video");if(i.length>0){makePlanBSimulcastSSRCs(i[0])}}return n.toString()};MediaController.prototype._mungeSDPByString=function(e,t){var n=e.split("\r\n");var r=[];for(var i=0;i<n.length;i++){var o=n[i];r.push(o);if(o.indexOf("a=msid-semantic")>=0){t.getRemoteRTCSessionId()!==""&&r.push("a=rcv-remote-session:"+t.getRemoteRTCSessionId());r.push("a=rcv-pc-role:"+t.getRcvPcRoleString());r.push("a=rcv-mix-audio:recv-mode=auto");r.push("a=rcv-negotiate-video:recv-mode=always");var a=t.generateTapIdToMsidMappingArray();if(a.length>0){r.push("a=rcv-stream:"+a[0].id+" "+a[0].msid)}r.push("a=rcv-denoise:enabled=1");r.push.apply(r,En(n.slice(i+1,-1)));break}}return r.join("\r\n")+"\r\n"};MediaController.prototype._getLocalStreamTypeByTapId=function(e){if(e===this._mediaOptions.streamId){return c.Ls.MAIN}if(e===this._screenSharingVideoTapStreamId){return c.Ls.SCREENSHARING}return c.Ls.OTHER};MediaController.prototype._getSFUDelegate=function(){return{handleLocalCandidate:this._handleLocalCandidate,handleEndOfLocalCandidate:this._handleEndOfLocalCandidate,addStream:this._delegate.addStream,removeRemoteStream:this._delegate.removeRemoteStream}};MediaController.prototype._getSocketDelegate=function(){return{message:this._processMessage}};MediaController.prototype._needRenegotiateMedia=function(e,t){if(!this._peerController){return false}var n=e.getTracks().some((function(e){return e.kind===t&&e.readyState==="ended"}));return n||!this._peerController.ableToSendMedia(t)};MediaController.prototype._switchMedia=function(e,t,n){return yn(this,void 0,void 0,(function(){var r,i;return mn(this,(function(o){switch(o.label){case 0:r=this._getLocalStreamById(this._mediaOptions.streamId);if(!r||!e){bn.warn("No localSteam or newStream to switch.");return[2]}bn.info("switch media: mediaType: "+t+", localStream:",r);i=n||this._needRenegotiateMedia(r,t);if(xe.VIDEO===t){this._actionController.switchVideo(e)}else if(xe.AUDIO===t){this._actionController.switchAudio(e)}else{bn.warn("No expected mediaType:"+t);return[2]}if(!i)return[3,2];bn.info("Need renegotiate media for newStream",e);return[4,this._triggerRenegotiateMedia()];case 1:o.sent();o.label=2;case 2:return[2]}}))}))};MediaController.prototype._renegotiateMedia=function(){return yn(this,void 0,void 0,(function(){return mn(this,(function(e){switch(e.label){case 0:if(!this._peerController||!this._peerController.mainSFUPeerClient){bn.warn("No mainSFUPeerClient to renegotiate.");return[2]}if(!this._socketManager.socketConnection.isConnected()){bn.warn("try to re-negotiate media but signaling channel not connected, wait for reconnect.");this._pendingRenegotiation=true;return[2]}return[4,this._connectMediaForSFUClient(this._peerController.mainSFUPeerClient)];case 1:e.sent();this._pendingRenegotiation=false;return[2]}}))}))};MediaController.prototype._request=function(e){return yn(this,void 0,void 0,(function(){var t;return mn(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,this._socketManager.request(e)];case 1:return[2,n.sent()];case 2:t=n.sent();bn.warn("request error:",e,t);return[2];case 3:return[2]}}))}))};MediaController.prototype._respondOK=function(e,t){if(t===void 0){t=false}var n=_n(_n({},e),{body:t?e.body:{}});return this._socketManager.respondOK(n)};MediaController.prototype._respondAckOK=function(e,t){if(t===void 0){t=false}var n=_n(_n({},e),{body:t?e.body:{}});return this._socketManager.respondAckOK(n)};MediaController.prototype._currentRemoteAudioCount=function(){return this._audioJoined?In:Mn};MediaController.prototype.setAudioJoinedState=function(e,t){if(t===void 0){t=true}this._audioJoined=e;this._streamPreferenceController&&this._streamPreferenceController.setMaxRemoteAudio(this._currentRemoteAudioCount(),t)};MediaController.prototype.getSignalStatusController=function(){return this._signalStatusController};MediaController.prototype.getPeerStatusController=function(){return this._peerStatusController};MediaController.prototype.leaveAudio=function(){return yn(this,void 0,void 0,(function(){return mn(this,(function(e){switch(e.label){case 0:this.setAudioJoinedState(false);if(!this._peerController)return[3,3];this._peerController.leaveAudio();return[4,this._renegotiateMedia()];case 1:e.sent();this._peerController.leaveAudio();return[4,this._triggerRenegotiateMedia()];case 2:e.sent();e.label=3;case 3:return[2]}}))}))};MediaController.prototype._triggerRenegotiateMedia=function(){return yn(this,void 0,void 0,(function(){var e;return mn(this,(function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,this._renegotiateMedia()];case 1:t.sent();return[3,3];case 2:e=t.sent();if(!(e instanceof It.JCancelError)){bn.error("re-negotiate media failed!")}return[3,3];case 3:return[2]}}))}))};MediaController.EVENTS={SIGNAL:Q.EVENTS.STATUS,PEER:qt.EVENTS.STATUS};vn([(0,It.TakeLastRequest)(),gn("design:type",Function),gn("design:paramtypes",[]),gn("design:returntype",Promise)],MediaController.prototype,"_renegotiateMedia",null);return MediaController}(D.EventEmitter2);var Tn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var On=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var An=function(){function SessionPingController(e){var t=this;this._pingInfo=e;this._pingErrCount=0;this._startPing=function(){return Tn(t,void 0,void 0,(function(){var e;return On(this,(function(t){switch(t.label){case 0:r.k.info("start ping:",this._pingInfo);t.label=1;case 1:t.trys.push([1,3,,4]);return[4,i.RCVEApi.pingSession(this._pingInfo,this._pingInfo.pingInterval)];case 2:t.sent();this._pingErrCount=0;return[3,4];case 3:e=t.sent();this._pingErrCount+=1;r.k.error("_startPing: pingMeeting, err:"+JSON.stringify(e)+", count:"+this._pingErrCount);return[3,4];case 4:return[2]}}))}))};this.ping()}SessionPingController.prototype.ping=function(){clearInterval(this._pingTimer);if(this._pingInfo.pingInterval>0){this._pingTimer=setInterval(this._startPing,this._pingInfo.pingInterval)}};SessionPingController.prototype.stop=function(){this._pingTimer&&clearInterval(this._pingTimer)};return SessionPingController}();var Pn;(function(e){e[e["PUBNUB"]=0]="PUBNUB";e[e["SIGNALING"]=1]="SIGNALING";e[e["MEDIA"]=2]="MEDIA";e[e["MEETING_STATUS"]=3]="MEETING_STATUS"})(Pn||(Pn={}));var Nn=undefined&&undefined.__assign||function(){Nn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Nn.apply(this,arguments)};var wn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Dn=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var kn=function(){function MeetingUpdateController(e,t){var n=this;this._dataProvider=e;this._meetingStatusController=t;this._dataHandlers=[];this._updatePrehandlers=[];this.onMediaStreamReceived=function(e,t){n.handleIncomingData({source:Pn.MEDIA,data:{media:t,tapId:e}})};this.onMediaStreamRemoved=function(e){e.forEach((function(e){n.handleIncomingData({source:Pn.MEDIA,data:{tapId:e,inactive:true}})}))};this._meetingStatusDisposer=this._meetingStatusController.subscribeMeetingStatus((function(e){return n.handleIncomingData({source:Pn.MEETING_STATUS,data:e})}))}MeetingUpdateController.prototype.stop=function(){this._dataHandlers.forEach((function(e){return e.clean()}));this._dataHandlers=[];this._updatePrehandlers.forEach((function(e){return e.clean()}));this._updatePrehandlers=[];this._meetingStatusDisposer&&this._meetingStatusDisposer();delete this._meetingStatusDisposer};MeetingUpdateController.prototype.handleIncomingData=function(e){this._updatePrehandlers.forEach((function(t){return t.doPreHandle(e)}));this._dataHandlers.forEach((function(t){if(t.isAbleToHandleSource(e.source)){t.handleIncomingData(e.data)}}))};MeetingUpdateController.prototype.addDataHandler=function(e){var t=this._dataHandlers.filter((function(t){return t!==e}));t.push(e);this._dataHandlers=t};MeetingUpdateController.prototype.removeDataHandler=function(e){this._dataHandlers=this._dataHandlers.filter((function(t){return t!==e}))};MeetingUpdateController.prototype.addPrehandler=function(e){var t=this._updatePrehandlers.filter((function(t){return t!==e}));t.push(e);this._updatePrehandlers=t};MeetingUpdateController.prototype.removePrehandler=function(e){this._updatePrehandlers=this._updatePrehandlers.filter((function(t){return t!==e}))};MeetingUpdateController.prototype.sendLocalEntityPartialChange=function(e,t,n){return wn(this,void 0,void 0,(function(){var r,i,a,s,l,u;var c=this;return Dn(this,(function(d){switch(d.label){case 0:r=this._dataProvider.getEntityControllerByEntityKey(t);i=r.getSynchronously(e.id);if((n===null||n===void 0?void 0:n.initialWhenNotExist)&&!i){r.putSync(e);o.notificationCenter.emitEntityUpdate(r.getEntityNotificationKey(),[e]);return[2]}a=new o.PartialModifyController(r);s=(n===null||n===void 0?void 0:n.preHandlePartialEntity)?n===null||n===void 0?void 0:n.preHandlePartialEntity:function(t){return Nn(Nn({},t),e)};l=function(e){return wn(c,void 0,void 0,(function(){return Dn(this,(function(t){switch(t.label){case 0:return[4,e];case 1:return[2,t.sent()]}}))}))};u=e.id||"";return[4,a.updatePartially({preHandlePartialEntity:s,doUpdateEntity:l,entityId:u,doPartialNotify:function(e,t){o.notificationCenter.emitEntityUpdate(r.getEntityNotificationKey(),t)}})];case 1:d.sent();return[2]}}))}))};MeetingUpdateController.prototype.notifyMeetingDeleted=function(e){var t=this._dataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.MEETING_INFO).getEntitiesSync()[0];if(!t){return}t.deleted=true;t.deleteReason=e;var n=this._dataProvider.localIdentifier();setTimeout((function(){o.notificationCenter.emitEntityUpdate(c.FY.ENTITY.MEETING_INFO+"."+n,[t])}),0)};MeetingUpdateController.prototype.onRemoteNetworkStatusUpdate=function(e){var t=this;var n=e.body;var i=[];var _loop_1=function(e){if(n[e]){var o=e.match(/^s(\d{1,3})/);if(o){var a=Number(o[1]);var s=n[e];if(Array.isArray(s)){s.filter((function(e){return e!==t._sessionId})).forEach((function(e){i.push({id:e,quality:a})}))}else{r.k.warn("expect networkStauts body."+e+" to be an array, but receive: ",s)}}}};for(var o in n){_loop_1(o)}!oe().isEmpty(i)&&this._dataProvider.handleRemoteNetworkQualityUpdate(i)};MeetingUpdateController.prototype.onMeetingConnected=function(){this._dataHandlers.forEach((function(e){return e.onMeetingConnected()}))};MeetingUpdateController.prototype.onStartMeetingRecover=function(){this._dataHandlers.forEach((function(e){return e.onStartMeetingRecover()}))};MeetingUpdateController.prototype.onLocalNetworkStatusUpdate=function(e){this._dataProvider.handleLocalNetworkQualityUpdate(e)};MeetingUpdateController.prototype.onSessionStatusUpdate=function(e){var t=e.body;this._dataProvider.handleSessionStatusUpdate(t)};Object.defineProperty(MeetingUpdateController.prototype,"meetingDataProvider",{get:function(){return this._dataProvider},enumerable:true,configurable:true});Object.defineProperty(MeetingUpdateController.prototype,"_sessionId",{get:function(){var e,t;return(t=(e=this._meetingStatusController)===null||e===void 0?void 0:e.meetingIdInfo)===null||t===void 0?void 0:t.sessionId},enumerable:true,configurable:true});return MeetingUpdateController}();var Ln=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Fn,Vn;var Un=r.k.tags("[quality control]");var jn;(function(e){e[e["Q1"]=1]="Q1";e[e["Q2"]=2]="Q2";e[e["Q3"]=3]="Q3"})(jn||(jn={}));var xn=[jn.Q3,jn.Q2,jn.Q1];var Hn=(Fn={},Fn[jn.Q1]=0,Fn[jn.Q2]=480*270,Fn[jn.Q3]=960*540,Fn);var Gn=16;var Bn=(Vn={},Vn[jn.Q3]=1,Vn[jn.Q2]=9,Vn[jn.Q1]=Gn,Vn);var qn=function(){function StreamQualityController(e){var t=this;this._dependency=e;this._streamStatusMap=new Map;this._maxRemoteAudio=3;this._currentLayout=c.ug.GALLERY;this.updateStreamDisplayStatus=function(e){Un.log("update stream display status",e);var n=t._validStreams();var r=e.filter((function(e){return n.some((function(t){return t.id===e.streamId}))}));var i=r.length>0;t._streamStatusMap.forEach((function(e,r){if(!n.some((function(e){return e.id===r}))){i=true;t._streamStatusMap.delete(r)}}));var o=t._generateUpdateTimestamp();r.forEach((function(e){var r=t._streamStatusMap.get(e.streamId);if(r){oe().merge(r.displayStatus,e);r.lastUpdateTime=o}else{var i=n.find((function(t){return t.id===e.streamId}));r={displayStatus:e,lastUpdateTime:o,isScreenShare:i.type==="video/screensharing"}}r.totalPixels=t._totalPixels(r.displayStatus);t._streamStatusMap.set(e.streamId,r)}));i&&t._setPreference()};this._validStreams=function(){var e;var n=(e=t._dependency)===null||e===void 0?void 0:e.getDataProvider();if(!n){return[]}var r=n.getEntityControllerByEntityKey(c.FY.ENTITY.STREAM_INFO);return r.getEntitiesSync((function(e){return!e.deleted&&!e.localStubStream&&!e.selfLocalStream&&(e.type==="video/main"||e.type==="video/screensharing")}))}}StreamQualityController.prototype.close=function(){this._streamStatusMap.clear();delete this._streamStatusMap;delete this._dependency};StreamQualityController.prototype.updateMaxRemoteAudio=function(e){this._maxRemoteAudio=e;this._setPreference()};StreamQualityController.prototype.updateActiveSession=function(e){if(!e){return}var t=this._visibleActiveVideoStreamId(e);if(t!==this._currentVisibleActiveStreamId){Un.log("update current active stream id to ",t);this._currentVisibleActiveStreamId=t;this._currentLayout!==c.ug.GALLERY&&this._prefetchActiveStream()}};StreamQualityController.prototype.setCurrentLayout=function(e){Un.log("update current layout to ",e);this._currentLayout=e;this._setPreference()};StreamQualityController.prototype.setPinnedStream=function(e){Un.log("update pinned stream to ",e);this._pinnedStreamId=e;this._setPreference()};StreamQualityController.prototype._prefetchActiveStream=function(){if(!this._currentVisibleActiveStreamId){return}var e=this._streamStatusMap.get(this._currentVisibleActiveStreamId);if(!e){this._streamStatusMap.set(this._currentVisibleActiveStreamId,{displayStatus:{streamId:this._currentVisibleActiveStreamId},lastUpdateTime:this._generateUpdateTimestamp()})}this._setPreference()};StreamQualityController.prototype._setPreference=function(){var e=this;var t;if(!this._readyToCommitPreference()){return}var n=this._inferVideoQuality();var r={maxRemoteAudio:0,maxRemoteVideo:[],pinnedStreams:[],qualityRangeMap:new Map};xn.forEach((function(t){var i=Gn-r.pinnedStreams.length;var o=e._pickStreamsToPin(t,n,i);o.forEach((function(e){r.pinnedStreams.push(e);r.qualityRangeMap.set(e,{min:jn.Q1,max:t})}));o.length>0&&r.maxRemoteVideo.push({quality:t,slots:o.length})}));r.pinnedStreams.sort();r.maxRemoteAudio=this._maxRemoteAudio;Un.log("ready to update preference status to:",r);(t=this._dependency.getMediaController())===null||t===void 0?void 0:t.setPreference(r)};StreamQualityController.prototype._inferVideoQuality=function(){var e=this;var t=new Map;this._streamStatusMap.forEach((function(n){if(!n.displayStatus.isDisplaying&&n.displayStatus.streamId!==e._currentVisibleActiveStreamId){return}var r=e._inferVideoQualityByStatus(n);var i=t.get(r)||[];i.push(n);t.set(r,i)}));return t};StreamQualityController.prototype._inferVideoQualityByStatus=function(e){if(this._isPinnedStream(e)){return jn.Q3}if(e.isScreenShare){return jn.Q3}if(!this._pinnedStreamId&&this._currentLayout!==c.ug.GALLERY&&this._isActiveStream(e)){return jn.Q3}return this._inferVideoQualityBySize(e.totalPixels||1)};StreamQualityController.prototype._inferVideoQualityBySize=function(e){var t,n;try{for(var r=Ln(xn),i=r.next();!i.done;i=r.next()){var o=i.value;if(e>=Hn[o]){return o}}}catch(e){t={error:e}}finally{try{if(i&&!i.done&&(n=r.return))n.call(r)}finally{if(t)throw t.error}}return jn.Q1};StreamQualityController.prototype._pickStreamsToPin=function(e,t,n){var r=this;var i=Math.min(n,Bn[e]);var o=t.get(e)||[];if(o.length<=i){return o.map((function(e){return e.displayStatus.streamId}))}o.sort((function(e,t){if(r._isPinnedStream(e)||r._isPinnedStream(t)){return r._isPinnedStream(e)?-1:1}if(e.isScreenShare!==t.isScreenShare){return e.isScreenShare?-1:1}if(r._isActiveStream(e)||r._isActiveStream(t)){return r._isActiveStream(e)?-1:1}if(e.lastUpdateTime!==t.lastUpdateTime){return e.lastUpdateTime>t.lastUpdateTime?-1:1}if(e.totalPixels!==t.totalPixels){return(e.totalPixels||1)>(t.totalPixels||1)?-1:1}return e.displayStatus.streamId>t.displayStatus.streamId?-1:1}));if(e-1>=jn.Q1){var a=o.slice(i);var s=t.get(e-1)||[];t.set(e-1,s.concat(a))}var l=o.slice(0,i);t.set(e,l);return l.map((function(e){return e.displayStatus.streamId}))};StreamQualityController.prototype._generateUpdateTimestamp=function(){return(new Date).getTime()};StreamQualityController.prototype._totalPixels=function(e){return(e.width||1)*(e.height||1)};StreamQualityController.prototype._visibleActiveVideoStreamId=function(e){var t;var n=(t=this._dependency)===null||t===void 0?void 0:t.getDataProvider();if(!n){return undefined}var r=n.getEntityControllerByEntityKey(c.FY.ENTITY.STREAM_INFO);var i=r.getEntitiesSync((function(t){return t.sessionId===e&&!t.deleted&&t.type==="video/main"})).map((function(e){return e.id}));return i.length===0?undefined:i[0]};StreamQualityController.prototype._readyToCommitPreference=function(){return!!this._dependency&&!!this._dependency.getDataProvider()&&!!this._dependency.getMediaController()};StreamQualityController.prototype._isPinnedStream=function(e){return e.displayStatus.streamId===this._pinnedStreamId};StreamQualityController.prototype._isActiveStream=function(e){return e.displayStatus.streamId===this._currentVisibleActiveStreamId};return StreamQualityController}();var Yn=n(913161);var Kn=undefined&&undefined.__assign||function(){Kn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Kn.apply(this,arguments)};var Qn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Wn=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Jn=undefined&&undefined.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var zn=r.k.tags("[MeetingActionController]");var $n=function(){function MeetingActionController(e,t,n,r,i){this._meetingUpdateController=e;this._mediaController=t;this._statusController=n;this._requestMediaController=r;this._meetingDataProvider=i;this._localSessionStatus={};this._isClosed=false}MeetingActionController.prototype.close=function(){this._isClosed=true;delete this._meetingUpdateController;delete this._mediaController;delete this._statusController};Object.defineProperty(MeetingActionController.prototype,"localSessionStatus",{get:function(){return this._localSessionStatus},enumerable:true,configurable:true});MeetingActionController.prototype.getSelfParticipantEntity=function(){return this._meetingDataProvider.getSelfParticipantEntity()};MeetingActionController.prototype.hangupPSTNSession=function(){return Qn(this,void 0,Promise,(function(){var e,t;return Wn(this,(function(n){switch(n.label){case 0:e=this._statusController.meetingIdInfo;t=this._meetingDataProvider.getLocalParticipantPSTNSessionInfo();if(t===null){zn.warn("[leave phone audio] No PSTN session need to leave!");return[2]}if(!e.bridgeId||!e.meetingId||!e.participantId){zn.warn("[leave phone audio] No meeting to leave! meetingIdInfo:",e);return[2]}zn.debug("[leave phone audio] hand up the PSTN session.");return[4,i.RCVEApi.deleteSession(Kn(Kn({},e),{sessionId:t.id}))];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype.mutePhone=function(e){return Qn(this,void 0,void 0,(function(){var t,n,r;var i=this;return Wn(this,(function(o){switch(o.label){case 0:t=this._meetingDataProvider.getLocalParticipantPSTNSessionInfo();if(t===null){zn.warn("[mute phone][unmute phone] No PSTN session need to mute!, mute:",e);return[2]}return[4,this._updatePSTNSessionServerMute(t.id,e)];case 1:o.sent();n={serverMute:e};r=Kn(Kn({},this._statusController.meetingIdInfo),{sessionId:t.id});return[4,this._updateSessionByIds(n,r,(function(){return Qn(i,void 0,void 0,(function(){var n;return Wn(this,(function(r){switch(r.label){case 0:n=!e;zn.warn("[mute phone][unmute phone] error for update pstn session, rollback local data to mute value:"+n);return[4,this._updatePSTNSessionServerMute(t.id,n)];case 1:r.sent();return[2]}}))}))}))];case 2:o.sent();return[2]}}))}))};MeetingActionController.prototype.muteParticipant=function(e){return Qn(this,void 0,void 0,(function(){return Wn(this,(function(t){switch(t.label){case 0:if(!e||e.length===0){throw new Yn.K$(Yn.rB.EMPTY_PARTICIPANT_ID)}zn.log("send mute participant audio request,id: "+e);return[4,i.RCVEApi.updateParticipant(this._buildParticipantUpdatePayload({serverMute:true}),this._buildParticipantMeetingIdInfo(this._statusController.meetingIdInfo,e))];case 1:return[2,t.sent()]}}))}))};MeetingActionController.prototype.muteParticipantVideo=function(e){return Qn(this,void 0,void 0,(function(){return Wn(this,(function(t){switch(t.label){case 0:if(!e||e.length===0){throw new Yn.K$(Yn.rB.EMPTY_PARTICIPANT_ID)}zn.log("send mute participant video request,id:"+e);return[4,i.RCVEApi.updateParticipant(this._buildParticipantUpdatePayload({serverMuteVideo:true}),this._buildParticipantMeetingIdInfo(this._statusController.meetingIdInfo,e))];case 1:return[2,t.sent()]}}))}))};MeetingActionController.prototype.updateWaitingRoomStatus=function(e,t){return Qn(this,void 0,void 0,(function(){var n,r;var i=this;return Wn(this,(function(o){switch(o.label){case 0:if(!e||e.length===0){throw new Yn.K$(Yn.rB.EMPTY_PARTICIPANT_ID)}zn.log("send update participant waiting room status,id: "+e+" waiting room status: "+t);return[4,this._getSpecificParticipant(e)];case 1:n=o.sent();n=n;r=n.waitingRoomStatus;if(!r){throw new Yn.P6(Yn.rB.TARGET_PARTICIPANT_NOT_EXIST)}return[4,this._updateParticipantLocal(e,{waitingRoomStatus:t})];case 2:o.sent();return[4,this._updateParticipant(e,{waitingRoomStatus:t},(function(){return Qn(i,void 0,void 0,(function(){return Wn(this,(function(t){switch(t.label){case 0:return[4,this._updateParticipantLocal(e,{waitingRoomStatus:r})];case 1:t.sent();return[2]}}))}))}))];case 3:return[2,o.sent()]}}))}))};MeetingActionController.prototype.startScreenSharing=function(){return Qn(this,void 0,void 0,(function(){var e,t;return Wn(this,(function(n){switch(n.label){case 0:zn.log("start screen sharing");if(this._statusController.isInScreenSharing){return[2]}return[4,this._requestMediaController.requestDisplayMedia()];case 1:e=n.sent();if(!e){zn.log("user cancel when pick window");return[2]}if(this._isClosed){zn.log("screen share stream retrieved after meeting terminated, stop it.");stopStream(e,c.Up);throw new Yn.Y8("ended")}zn.log("display media stream retrieved, start sharing");this._registerScreenSharingHook(e);return[4,this._createScreenSharingStream(this._statusController.meetingIdInfo,(function(){return stopStream(e,c.Up)}))];case 2:t=n.sent();this._statusController.setScreenSharingId(t.id);return[4,this._mediaController.startScreenSharing(e,t.id)];case 3:n.sent();return[2]}}))}))};MeetingActionController.prototype.stopScreenSharing=function(e){if(e===void 0){e=false}var t,n,r,i;return Qn(this,void 0,void 0,(function(){var o;var a=this;return Wn(this,(function(s){switch(s.label){case 0:if(!((t=this._statusController)===null||t===void 0?void 0:t.isInScreenSharing)){return[2]}zn.log("stop screen sharing");return[4,this._updateLocalScreenShareStream(true)];case 1:s.sent();o=!e&&((n=this._statusController)===null||n===void 0?void 0:n.meetingIdInfo);if(!o)return[3,3];return[4,this._deleteScreenSharingStream(this._statusController.meetingIdInfo,(function(){return a._updateLocalScreenShareStream(false)}))];case 2:o=s.sent();s.label=3;case 3:o;(r=this._statusController)===null||r===void 0?void 0:r.setScreenSharingId(undefined);(i=this._mediaController)===null||i===void 0?void 0:i.stopScreenSharing();return[2]}}))}))};MeetingActionController.prototype.muteSelfParticipantAudio=function(){return Qn(this,void 0,void 0,(function(){var e;return Wn(this,(function(t){switch(t.label){case 0:e=this._statusController.meetingIdInfo.participantId;if(!e){zn.warn("[leave phone audio] Not find self participantId to mute.");return[2]}zn.debug("[leave phone audio] mute self participant, participantId:",e);return[4,this.muteParticipant(e)];case 1:t.sent();return[2]}}))}))};MeetingActionController.prototype.unmuteParticipantAudio=function(e){return Qn(this,void 0,void 0,(function(){var t,n,r,o;return Wn(this,(function(a){switch(a.label){case 0:t={serverMute:false,allowUnmute:true};n=this._statusController.meetingIdInfo,r=n.participantId,o=Jn(n,["participantId"]);zn.log("request to unmute participant audio, participantId="+e+", option="+JSON.stringify(t));return[4,i.RCVEApi.updateParticipant(t,Kn({participantId:e},o))];case 1:a.sent();return[2]}}))}))};MeetingActionController.prototype.unmuteParticipantVideo=function(e){return Qn(this,void 0,void 0,(function(){var t,n,r,o;return Wn(this,(function(a){switch(a.label){case 0:t={serverMuteVideo:false,allowUnmuteVideo:true};n=this._statusController.meetingIdInfo,r=n.participantId,o=Jn(n,["participantId"]);zn.log("request to unmute participant audio, participantId="+e+", option="+JSON.stringify(t));return[4,i.RCVEApi.updateParticipant(t,Kn({participantId:e},o))];case 1:a.sent();return[2]}}))}))};MeetingActionController.prototype.allowJoin=function(e){return Qn(this,void 0,void 0,(function(){var t;return Wn(this,(function(n){switch(n.label){case 0:t={allowJoin:e};zn.log("set allowJoin = "+e);return[4,i.RCVEApi.updateMeeting(t,this._statusController.meetingIdInfo)];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype.muteAllAudio=function(e){return Qn(this,void 0,void 0,(function(){var t;return Wn(this,(function(n){switch(n.label){case 0:t={allowUnmute:e,mute:true};zn.log("request to mute all participants, option = "+JSON.stringify(t));return[4,i.RCVEApi.updateMeeting(t,this._statusController.meetingIdInfo)];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype.muteAllVideo=function(e){return Qn(this,void 0,void 0,(function(){var t;return Wn(this,(function(n){switch(n.label){case 0:t={allowUnmuteVideo:e,muteVideo:true};zn.log("request to muteVideo all participants, option = "+JSON.stringify(t));return[4,i.RCVEApi.updateMeeting(t,this._statusController.meetingIdInfo)];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype.unmuteAllAudio=function(){return Qn(this,void 0,void 0,(function(){var e;return Wn(this,(function(t){switch(t.label){case 0:e={mute:false,allowUnmute:true};zn.log("request to unmute all participants, option="+JSON.stringify(e));return[4,i.RCVEApi.updateMeeting(e,this._statusController.meetingIdInfo)];case 1:t.sent();return[2]}}))}))};MeetingActionController.prototype.unmuteAllVideo=function(){return Qn(this,void 0,void 0,(function(){var e;return Wn(this,(function(t){switch(t.label){case 0:e={muteVideo:false,allowUnmuteVideo:true};zn.log("request to unmuteVideo all participants, option="+JSON.stringify(e));return[4,i.RCVEApi.updateMeeting(e,this._statusController.meetingIdInfo)];case 1:t.sent();return[2]}}))}))};MeetingActionController.prototype.allowScreenSharing=function(e){return Qn(this,void 0,void 0,(function(){var t;return Wn(this,(function(n){switch(n.label){case 0:t={allowScreenSharing:e};zn.log("request to set permission for screensharing, option="+JSON.stringify(t));return[4,i.RCVEApi.updateMeeting(t,this._statusController.meetingIdInfo)];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype.assignModerator=function(e,t,n){return Qn(this,void 0,void 0,(function(){var r,o,a,s;return Wn(this,(function(l){switch(l.label){case 0:r={moderator:t};o=this._statusController.meetingIdInfo,a=o.participantId,s=Jn(o,["participantId"]);zn.log("change participant's moderator role, participantId="+e+", option="+JSON.stringify(r));return[4,i.RCVEApi.updateParticipant(r,Kn({participantId:e},s),n)];case 1:l.sent();return[2]}}))}))};MeetingActionController.prototype.hangUp=function(e){return Qn(this,void 0,void 0,(function(){var t,n,r;return Wn(this,(function(o){switch(o.label){case 0:t=this._statusController.meetingIdInfo,n=t.participantId,r=Jn(t,["participantId"]);zn.log("hangUp participant, participantId="+e);return[4,i.RCVEApi.deleteParticipant(Kn({participantId:e},r))];case 1:o.sent();return[2]}}))}))};MeetingActionController.prototype._getSpecificParticipant=function(e){var t=this._meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.PARTICIPANT_INFO);return t.get(e)};MeetingActionController.prototype._updateParticipant=function(e,t,n){return Qn(this,void 0,void 0,(function(){var r,o;return Wn(this,(function(a){switch(a.label){case 0:a.trys.push([0,2,,5]);return[4,i.RCVEApi.updateParticipant(this._buildParticipantUpdatePayload(t),this._buildParticipantMeetingIdInfo(this._statusController.meetingIdInfo,e))];case 1:a.sent();return[3,5];case 2:r=a.sent();zn.error("update participant request failed, err code=",r.code);o=n;if(!o)return[3,4];return[4,n()];case 3:o=a.sent();a.label=4;case 4:o;throw r;case 5:return[2]}}))}))};MeetingActionController.prototype._updateParticipantLocal=function(e,t){return Qn(this,void 0,void 0,(function(){return Wn(this,(function(n){switch(n.label){case 0:t.id=e;return[4,this._meetingUpdateController.sendLocalEntityPartialChange(t,c.FY.ENTITY.PARTICIPANT_INFO)];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype._updateSessionByIds=function(e,t,n){return Qn(this,void 0,void 0,(function(){var r,o;return Wn(this,(function(a){switch(a.label){case 0:a.trys.push([0,2,,5]);return[4,i.RCVEApi.updateSession(e,t)];case 1:a.sent();return[3,5];case 2:r=a.sent();zn.error("update session request failed, err code=",r.code);o=n;if(!o)return[3,4];return[4,n()];case 3:o=a.sent();a.label=4;case 4:o;throw r;case 5:return[2]}}))}))};MeetingActionController.prototype._createScreenSharingStream=function(e,t){return Qn(this,void 0,void 0,(function(){var n;return Wn(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,i.RCVEApi.createStream(this._buildScreenSharingStreamPayload(e),e)];case 1:return[2,r.sent()];case 2:n=r.sent();zn.error("create screen sharing request failed, err code=",n.code);t&&t();throw n;case 3:return[2]}}))}))};MeetingActionController.prototype._updateLocalScreenShareStream=function(e){return Qn(this,void 0,void 0,(function(){return Wn(this,(function(t){switch(t.label){case 0:return[4,this._meetingUpdateController.sendLocalEntityPartialChange({id:this._statusController.meetingIdInfo.screenSharingStreamId||"",deleted:e},c.FY.ENTITY.STREAM_INFO)];case 1:t.sent();return[2]}}))}))};MeetingActionController.prototype._registerScreenSharingHook=function(e){var t=this;e.getVideoTracks().forEach((function(e){var onEnded=function(){zn.log("screen sharing stopped by the browser, notify to stop the sharing");e.removeEventListener(c.Up,onEnded);return t.stopScreenSharing()};e.addEventListener(c.Up,onEnded)}))};MeetingActionController.prototype._deleteScreenSharingStream=function(e,t){return Qn(this,void 0,void 0,(function(){var n,r;return Wn(this,(function(o){switch(o.label){case 0:o.trys.push([0,2,,5]);return[4,i.RCVEApi.deleteStream(e.screenSharingStreamId||"",e)];case 1:o.sent();return[3,5];case 2:n=o.sent();zn.error("delete screen sharing request failed, err code=",n.code);r=t;if(!r)return[3,4];return[4,t()];case 3:r=o.sent();o.label=4;case 4:r;throw n;case 5:return[2]}}))}))};MeetingActionController.prototype._buildParticipantUpdatePayload=function(e){var t=this._statusController.meetingIdInfo.sessionId||"";return Kn({id:t},e)};MeetingActionController.prototype._buildScreenSharingStreamPayload=function(e){return{audio:{isActiveIn:false,isActiveOut:false},bridgeId:e.bridgeId,callId:e.meetingId,participantId:e.participantId,sessionId:e.sessionId,subtype:"screen",type:c.Ie.SCREENSHARING}};MeetingActionController.prototype._updatePSTNSessionServerMute=function(e,t){return Qn(this,void 0,void 0,(function(){return Wn(this,(function(n){switch(n.label){case 0:zn.debug("[mute phone][unmute phone] update PSTN session serverMute:",t);return[4,this._meetingUpdateController.sendLocalEntityPartialChange({id:e,serverMute:t},c.FY.ENTITY.SESSION_INFO)];case 1:n.sent();return[2]}}))}))};MeetingActionController.prototype._buildParticipantMeetingIdInfo=function(e,t){var n={bridgeId:e.bridgeId,meetingId:e.meetingId,participantId:t};return n};return MeetingActionController}();var Xn=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Zn=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var er=r.k.tags("[MeetingReconnectionController]");var tr=10;var nr=function(){function MeetingReconnectionController(e,t,n){var r=this;this.cleanOldData=e;this.joinMeeting=t;this.closeMeeting=n;this._isReJoining=false;this._reJoinCount=0;this._isClosed=false;this.reJoin=function(){return Xn(r,void 0,void 0,(function(){var e;return Zn(this,(function(t){switch(t.label){case 0:if(this._isClosed){er.info("reJoin process is closed");return[2]}if(this._isReJoining){er.info("last reJoin process is not finishing");return[2]}this._isReJoining=true;if(this._reJoinCount>tr){er.info("reach max reJoin count,",tr);this._isClosed=true;this.closeMeeting();return[2]}er.info("start reJoin, count:",this._reJoinCount);return[4,this.cleanOldData()];case 1:t.sent();return[4,this.sleep()];case 2:t.sent();this._reJoinCount++;e=!this._isClosed;if(!e)return[3,4];return[4,this.joinMeeting()];case 3:e=t.sent();t.label=4;case 4:e;return[2]}}))}))};this.sleep=function(){var e=getRetryRandomTime(r._reJoinCount);er.info("start reJoin sleep:",e);return new Promise((function(t){return setTimeout(t,e)}))}}MeetingReconnectionController.prototype.afterConnected=function(){er.info("connect successfully, reset rejoin count");this._isReJoining=false;this._reJoinCount=0};MeetingReconnectionController.prototype.reset=function(){this._isReJoining=false};MeetingReconnectionController.prototype.stop=function(){this._isClosed=true};return MeetingReconnectionController}();var rr;(function(e){e["START_VIDEO_CALL"]="rcve_start_video_call";e["OBTAIN_BRIDGE_INFO"]="rcve_obtain_bridge_info";e["OBTAIN_MEETING_INFO"]="rcve_obtain_meeting_info";e["MEETING_TOTAL_CONNECT_TIME"]="rcve_meeting_total_connect_time";e["SIGNALING_CONNECT_TIME"]="rcve_signaling_connect_time";e["PEER_CONNECT_TIME"]="rcve_peer_connect_time";e["MEETING_RECONNECT_TIME"]="rcve_meeting_reconnect_time"})(rr||(rr={}));var ir=n(204285);function RCVETracer(e,t){var n=t?t:(0,ie.uniqueId)("rcve_tracer_");return(0,ir.videoPerformanceTracer)(n,e)}var or=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var ar=r.k.tags("[MeetingStatus]");var sr=function(){function MeetingStatusController(e){this._meetingIdInfo=e;this._meetingStatus={status:p.hj.INIT,request:p.hj.INIT,signalStatus:p.hj.INIT,peerStatus:p.hj.INIT,localMedia:p.hj.INIT};this._localSelfEntityIds={};this._isVideoCaller=false;this._meetingStartTime=0;this._observableController=new o.ObservableController;this._startMeetingTracer=RCVETracer(ar);this._logger=ar.tags("["+this._meetingIdInfo.shortId+"]")}MeetingStatusController.prototype.close=function(){this._meetingStatus={status:p.hj.TERMINATED,request:p.hj.TERMINATED,signalStatus:p.hj.TERMINATED,peerStatus:p.hj.TERMINATED,localMedia:p.hj.TERMINATED};this._observableController.removeAllObserver();delete this._observableController;delete this._meetingIdInfo;delete this._startMeetingTracer;delete this._reconnectTracer;delete this._signalingConnectionTracer;delete this._peerConnectionTracer};Object.defineProperty(MeetingStatusController.prototype,"meetingStatus",{get:function(){return this._meetingStatus},enumerable:true,configurable:true});MeetingStatusController.prototype.setMeetingStatus=function(e,t){var n=this;var r;if(t instanceof Function){r=t(this._meetingStatus[e])}else{r=t}this._logger.log("setMeetingStatus: ",r," for type=",e);if(r!==this._meetingStatus[e]){this._meetingStatus[e]=r;this._calculateStatus();this._handlePerformanceTracer(e);this._logger.log("update to new meetingStatus: ",this.meetingStatus);this._observableController.notifyObserver4Changes((function(e){return e(n._meetingStatus)}))}};MeetingStatusController.prototype.subscribeMeetingStatus=function(e){var t=this;this._observableController.addObserver(e);e(this._meetingStatus);return function(){return t._observableController.removeObserver(e)}};MeetingStatusController.prototype.unSubscribeMeetingStatus=function(e){this._observableController.removeObserver(e)};Object.defineProperty(MeetingStatusController.prototype,"meetingIdInfo",{get:function(){return this._meetingIdInfo},enumerable:true,configurable:true});MeetingStatusController.prototype.setMeetingIdInfo=function(e){g.mergeCommonFieldsFromPartialObject(this._meetingIdInfo,e,true)};Object.defineProperty(MeetingStatusController.prototype,"isInScreenSharing",{get:function(){return this._meetingIdInfo.screenSharingStreamId!==undefined},enumerable:true,configurable:true});MeetingStatusController.prototype.setScreenSharingId=function(e){this._meetingIdInfo.screenSharingStreamId=e};MeetingStatusController.prototype._calculateStatus=function(){var e=this._meetingStatus;var t=[e.signalStatus,e.peerStatus,e.request];var n=[[p.hj.CONNECTED,"all"],[p.hj.TERMINATED,"oneOf"],[p.hj.TERMINATING,"oneOf"],[p.hj.DISCONNECTED,"oneOf"],[p.hj.RECONNECTING,"oneOf"],[p.hj.CONNECTING,"oneOf"],[p.hj.INIT,"oneOf"]];var r=n.reduce((function(e,n){if(e){return e}var r=or(n,2),i=r[0],o=r[1];if(o==="all"){return t.filter((function(e){return e!==i})).length===0?i:undefined}return t.find((function(e){return e===i}))}),undefined);this._meetingStatus.status=r};MeetingStatusController.prototype.setLocalSelfEntityIds=function(e){this._localSelfEntityIds=e};Object.defineProperty(MeetingStatusController.prototype,"localSelfEntityIds",{get:function(){return this._localSelfEntityIds},enumerable:true,configurable:true});MeetingStatusController.prototype.setRemoteSelfMeetingEntityIds=function(e){this._remoteSelfMeetingEntityIds=e};Object.defineProperty(MeetingStatusController.prototype,"remoteSelfMeetingEntityIds",{get:function(){return this._remoteSelfMeetingEntityIds},enumerable:true,configurable:true});Object.defineProperty(MeetingStatusController.prototype,"isVideoCaller",{get:function(){return this._isVideoCaller},enumerable:true,configurable:true});MeetingStatusController.prototype.setIsVideoCaller=function(e){this._isVideoCaller=e};MeetingStatusController.prototype.getMeetingStartTime=function(){return this._meetingStartTime};MeetingStatusController.prototype.setMeetingStartTime=function(e){this._meetingStartTime=e};MeetingStatusController.prototype._handlePerformanceTracer=function(e){e==="signalStatus"&&this._handleSignalingTracer();e==="peerStatus"&&this._handlePeerTracer();this._handleOverallStatusTracer()};MeetingStatusController.prototype._handleSignalingTracer=function(){if(this._meetingStatus.signalStatus===p.hj.CONNECTING){this._signalingConnectionTracer=RCVETracer(ar)}if(this._signalingConnectionTracer&&this._meetingStatus.signalStatus===p.hj.CONNECTED){this._signalingConnectionTracer.end({key:rr.SIGNALING_CONNECT_TIME,level:It.LOG_CONTROL_LEVEL.NORMAL});this._signalingConnectionTracer=undefined}};MeetingStatusController.prototype._handlePeerTracer=function(){if(this._meetingStatus.peerStatus===p.hj.CONNECTING){this._peerConnectionTracer=RCVETracer(ar)}if(this._peerConnectionTracer&&this._meetingStatus.peerStatus===p.hj.CONNECTED){this._peerConnectionTracer.end({key:rr.PEER_CONNECT_TIME,level:It.LOG_CONTROL_LEVEL.NORMAL});this._peerConnectionTracer=undefined}};MeetingStatusController.prototype._handleOverallStatusTracer=function(){if(this._startMeetingTracer&&this._meetingStatus.status===p.hj.CONNECTED){this._startMeetingTracer.end({key:rr.MEETING_TOTAL_CONNECT_TIME,level:It.LOG_CONTROL_LEVEL.NORMAL});this._startMeetingTracer=undefined}if(!this._reconnectTracer&&this._meetingStatus.status===p.hj.RECONNECTING){this._reconnectTracer=RCVETracer(ar)}if(this._reconnectTracer&&this._meetingStatus.status===p.hj.CONNECTED){this._reconnectTracer.end({key:rr.MEETING_RECONNECT_TIME,level:It.LOG_CONTROL_LEVEL.NORMAL});this._reconnectTracer=undefined}};return MeetingStatusController}();var lr=n(217939);var ur=n.n(lr);var cr=function(){function PubNubChannelSubscriber(e){var t=this;this._messageListeners=[];this._statusListeners=[];this.onMessageEvent=function(e){t._messageListeners.forEach((function(t){return t(e)}))};this.onStatusEvent=function(e){t._statusListeners.forEach((function(t){return t(e)}))};this._pubnub=new(ur())(e);this._pubnub.addListener({message:this.onMessageEvent,status:this.onStatusEvent})}PubNubChannelSubscriber.prototype.subscribeChannel=function(e){this._pubnub.subscribe({channels:e})};PubNubChannelSubscriber.prototype.unsubscribeChannel=function(e){this._pubnub.unsubscribe({channels:e})};PubNubChannelSubscriber.prototype.unsubscribeAllChannels=function(){this._pubnub.unsubscribeAll()};PubNubChannelSubscriber.prototype.addMessageListener=function(e){var t=this._messageListeners.filter((function(t){return t!==e}));t.push(e);this._messageListeners=t};PubNubChannelSubscriber.prototype.removeEventListener=function(e){var t=this._messageListeners.filter((function(t){return t!==e}));this._messageListeners=t};PubNubChannelSubscriber.prototype.addStatusListener=function(e){var t=this._statusListeners.filter((function(t){return t!==e}));t.push(e);this._statusListeners=t};PubNubChannelSubscriber.prototype.removeStatusListener=function(e){var t=this._statusListeners.filter((function(t){return t!==e}));this._statusListeners=t};PubNubChannelSubscriber.prototype.clean=function(){this._statusListeners=[];this._messageListeners=[];this.unsubscribeAllChannels();this._pubnub.stop();delete this._pubnub};return PubNubChannelSubscriber}();var dr=n(696206);var fr=n(306502);var pr={defaultUserMediaConstraints:{video:{height:{min:180,ideal:360},width:{min:320,ideal:640},aspectRatio:{ideal:1.7777777777777777},frameRate:{ideal:24}},hdVideo:{height:{min:180,ideal:720},width:{min:320,ideal:1280},aspectRatio:{ideal:1.7777777777777777},frameRate:{ideal:24,max:24}},audio:true},defaultBrowserScreenShareConstraints:{video:{frameRate:5},audio:false},defaultElectronScreenShareConstraints:{frameRate:5}};var hr=undefined&&undefined.__assign||function(){hr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return hr.apply(this,arguments)};var _r=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var vr=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var gr=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var yr=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var mr=r.k.tags("[RequestMediaController]");var Sr=(0,It.createLogDecorator)(mr);var Cr;(function(e){e[e["CAMERA"]=0]="CAMERA";e[e["SCREEN"]=1]="SCREEN";e[e["SWITCH_VIDEO"]=2]="SWITCH_VIDEO";e[e["SWITCH_AUDIO"]=3]="SWITCH_AUDIO"})(Cr||(Cr={}));var Er=function(){function RequestMediaController(){this._isEnabledHD=false}Object.defineProperty(RequestMediaController.prototype,"isEnableHD",{set:function(e){this._isEnabledHD=e},enumerable:true,configurable:true});RequestMediaController.prototype.getCurrentUserMediaConstraint=function(){return this._constraints||{}};RequestMediaController.prototype.requestDisplayMedia=function(e){return gr(this,void 0,void 0,(function(){var t,n,r,i,o,a,i;return yr(this,(function(s){switch(s.label){case 0:if(!window["jupiterElectron"])return[3,6];s.label=1;case 1:s.trys.push([1,3,4,5]);n=window["jupiterElectron"].getScreenSharing();this._releaseScreenSharing=function(){return n.stopSharing()};return[4,n.startScreenSharing(pr.defaultElectronScreenShareConstraints)];case 2:t=s.sent();return[3,5];case 3:r=s.sent();i=Yn.Kp.parse(r,Yn.B6.ELECTRON_SHARE);if(!(i instanceof Yn.qJ)){mr.error("request electron display media failed, err=",i.code,r);throw i}return[3,5];case 4:this._releaseScreenSharing=null;return[7];case 5:return[2,t];case 6:o=navigator.mediaDevices;s.label=7;case 7:s.trys.push([7,9,,10]);return[4,o.getDisplayMedia(e||this._defaultMediaConstraint(Cr.SCREEN))];case 8:t=s.sent();return[3,10];case 9:a=s.sent();i=Yn.Kp.parse(a,Yn.B6.BROWSER_SHARE);if(!(i instanceof Yn.qJ)){mr.error("request browser display media failed, err=",i.code);throw i}return[3,10];case 10:return[2,t]}}))}))};RequestMediaController.prototype.requestUserAudioMedia=function(e,t){return gr(this,void 0,Promise,(function(){var n;return yr(this,(function(r){switch(r.label){case 0:if(!e){mr.debug("request user media: not need to join audio, return empty mediaStream.");return[2,new MediaStream]}mr.debug("[join audio] request user media audio.");return[4,this.requestUserMedia(Cr.SWITCH_AUDIO)];case 1:n=r.sent();if(t){mr.debug("[join audio] options.mute is true, mute audio.");n.getAudioTracks().forEach((function(e){e.enabled=false}))}return[2,n]}}))}))};RequestMediaController.prototype.requestInitAudioMedia=function(e,t,n){return gr(this,void 0,void 0,(function(){var r;return yr(this,(function(i){switch(i.label){case 0:i.trys.push([0,2,,3]);return[4,this.requestUserAudioMedia(e,t)];case 1:return[2,i.sent()];case 2:r=i.sent();mr.warn("request user media error for audio:",r);n&&n(r);if(nt.mustHaveAudio()){mr.warn("request user media throw error for safari.");throw r}return[2,new MediaStream];case 3:return[2]}}))}))};RequestMediaController.prototype.requestInitVideoMedia=function(e){return gr(this,void 0,Promise,(function(){var t;return yr(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,this.requestUserMedia(Cr.SWITCH_VIDEO)];case 1:return[2,n.sent()];case 2:t=n.sent();mr.warn("request user media error for video:",t);e&&e(t);return[2,new MediaStream];case 3:return[2]}}))}))};RequestMediaController.prototype.requestUserMedia=function(e,t){return gr(this,void 0,void 0,(function(){var n,r,i,o;return yr(this,(function(a){switch(a.label){case 0:a.trys.push([0,3,,4]);return[4,this._initConstrainsIfNeeded()];case 1:a.sent();n=e===Cr.CAMERA?this._constraints:t;r=this._mergeUserMediaDefaultConstraints(n||this._defaultMediaConstraint(e));mr.debug("request user media: constrains:",r);return[4,this._getUserMedia(r)];case 2:return[2,a.sent()];case 3:i=a.sent();o=Yn.Kp.parse(i,Yn.B6.MEDIA);mr.warn("request user media failed, err:"+o.code+", msg:"+o.message);throw o;case 4:return[2]}}))}))};RequestMediaController.prototype._getUserMedia=function(e){return gr(this,void 0,void 0,(function(){return yr(this,(function(t){switch(t.label){case 0:if(!e.audio&&!e.video){return[2,new Promise((function(e){e(new MediaStream)}))]}return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return[2,t.sent()]}}))}))};RequestMediaController.prototype._initConstrainsIfNeeded=function(){return gr(this,void 0,void 0,(function(){var e,t,n;return yr(this,(function(r){switch(r.label){case 0:e=(0,o.getModule)(dr.oF);return[4,e.getSettingItemValue(fr.AudioSettingIds.VideoSource)];case 1:t=r.sent();return[4,e.getSettingItemValue(fr.AudioSettingIds.Phone_MicrophoneSource)];case 2:n=r.sent();this._constraints={video:t&&t.deviceId?{deviceId:{exact:t.deviceId}}:true,audio:n&&n.deviceId?{deviceId:{exact:n.deviceId}}:true};return[2]}}))}))};RequestMediaController.prototype._defaultMediaConstraint=function(e){var t,n;switch(e){case Cr.SCREEN:return this._defaultScreenShareConstraint();case Cr.SWITCH_VIDEO:return{video:((t=this._constraints)===null||t===void 0?void 0:t.video)||true};case Cr.SWITCH_AUDIO:return{audio:((n=this._constraints)===null||n===void 0?void 0:n.audio)||true};case Cr.CAMERA:default:return this._constraints||{video:true,audio:true}}};RequestMediaController.prototype._mergeUserMediaDefaultConstraints=function(e){var t={};!!e.video&&(t.video=hr(hr({},this._defaultVideoConstraint()),e.video===true?{}:e.video));!!e.audio&&(t.audio=e.audio);return t};RequestMediaController.prototype._defaultVideoConstraint=function(){return this._isEnabledHD?pr.defaultUserMediaConstraints.hdVideo:pr.defaultUserMediaConstraints.video};RequestMediaController.prototype._defaultScreenShareConstraint=function(){return pr.defaultBrowserScreenShareConstraints};RequestMediaController.prototype.close=function(){if(this._releaseScreenSharing){this._releaseScreenSharing();this._releaseScreenSharing=null}};var e,t;_r([Sr({cost:true}),vr("design:type",Function),vr("design:paramtypes",[typeof(e=typeof MediaStreamConstraints!=="undefined"&&MediaStreamConstraints)==="function"?e:Object]),vr("design:returntype",Promise)],RequestMediaController.prototype,"requestDisplayMedia",null);_r([Sr({cost:true}),vr("design:type",Function),vr("design:paramtypes",[Number,typeof(t=typeof MediaStreamConstraints!=="undefined"&&MediaStreamConstraints)==="function"?t:Object]),vr("design:returntype",Promise)],RequestMediaController.prototype,"requestUserMedia",null);return RequestMediaController}();var br=function(){function AbstractMeetingDataHandler(e){this._dataProvider=e}AbstractMeetingDataHandler.prototype.clean=function(){delete this._dataProvider};AbstractMeetingDataHandler.prototype.onMeetingConnected=function(){};AbstractMeetingDataHandler.prototype.onStartMeetingRecover=function(){};return AbstractMeetingDataHandler}();var Ir=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Mr=function(e){Ir(MediaDataHandler,e);function MediaDataHandler(){return e!==null&&e.apply(this,arguments)||this}MediaDataHandler.prototype.isAbleToHandleSource=function(e){return e===Pn.MEDIA};MediaDataHandler.prototype.handleIncomingData=function(e){var t=e,n=t.media,i=t.tapId,o=t.inactive;if(!i||!n&&!o){r.k.error("at least one of, can not handle.")}r.k.log("going to handle new arrived media stream");this._dataProvider.handleMediaData({stream:n,inactive:o},i)};return MediaDataHandler}(br);var Rr=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Tr=[I.ACTIVE_SPEAKERS_REPORT_REQ,I.PSTN_AS_REPORT_REQ];var Or=function(e){Rr(SignalingDataHandler,e);function SignalingDataHandler(){var t=e!==null&&e.apply(this,arguments)||this;t._needHandleSocketMessage=function(e){return Tr.some((function(t){return t===(e&&e.event||"")}))};return t}SignalingDataHandler.prototype.isAbleToHandleSource=function(e){return e===Pn.SIGNALING};SignalingDataHandler.prototype.handleIncomingData=function(e){if(this._needHandleSocketMessage(e)){this._dataProvider.handleSocketData(e)}};return SignalingDataHandler}(br);var Ar=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Pr=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Nr=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var wr=5*1e3;var Dr=60*1e3;var kr=function(e){Ar(PubNubDataHandler,e);function PubNubDataHandler(t,n,r,o){var a=e.call(this,t)||this;a._dataProvider=t;a._endMeeting=n;a._reJoin=r;a._timeoutRejoin=o;a._notificationMap=new Map;a._isRecovering=false;a._lastScheduleVersionCheckTime=Number.MAX_VALUE;a._versionCheckInterval=Dr;a._stopped=true;a._checkVersion=function(e){return Pr(a,void 0,void 0,(function(){var t,n,r;var o,a;return Nr(this,(function(s){switch(s.label){case 0:t=((o=this._dataProvider.meetingInfo())===null||o===void 0?void 0:o.version)||0;if(!(!this._isRecovering&&e>=t))return[3,5];this._logger.log("start to recover meeting data, previous version",e," currentVersion=",t);this._isRecovering=true;n=void 0;s.label=1;case 1:s.trys.push([1,3,,4]);return[4,i.RCVEApi.getMeeting(this._dataProvider.bridgeId(),this._dataProvider.remoteSelfMeetingEntityIds().meetingInfoId||"")];case 2:n=s.sent();return[3,4];case 3:r=s.sent();this._logger.log("recover failed, rejoin meeting, error:"+JSON.stringify(r));this._isRecovering=false;this._reJoin();return[2];case 4:if(this._stopped){this._logger.log("version recover after update handling stopped, no need to process");return[2]}n&&this._dataProvider.handleData(n,false,true);this._clearNotificationMap(((a=this._dataProvider.meetingInfo())===null||a===void 0?void 0:a.version)||0);this._isRecovering=false;return[3,6];case 5:this._logger.log("version updated, no need to recover.");s.label=6;case 6:this._lastScheduleVersionCheckTime=Number.MAX_VALUE;this._startVersionCheck(this._versionCheckInterval);return[2]}}))}))};a._clearNotificationMap=function(e){a._notificationMap.forEach((function(t,n){if(n<=e){a._notificationMap.delete(n)}}))};a._checkMeetingTermination=function(e){if(e.deleted===true){var t=e.deleteReason||c.MH.UNKNOWN;a._logger.log("[end meeting] meeting deleted detected",e);a._endMeeting(t);return true}return false};a._checkSessionDeleted=function(e){var t,n;var r=(t=e.participants)===null||t===void 0?void 0:t.find((function(e){return e.id===a._dataProvider.remoteSelfMeetingEntityIds().participantId}));var i=(n=r===null||r===void 0?void 0:r.sessions)===null||n===void 0?void 0:n.find((function(e){return e.id===a._dataProvider.remoteSelfMeetingEntityIds().sessionId}));if((i===null||i===void 0?void 0:i.deleted)===true){var o=i.deleteReason||c.MH.UNKNOWN;a._logger.warn("[end meeting] receive session deleted from pubnub, end meeting first, reason=",o);if(o===c.MH.SESSION_TIMEOUT&&a._timeoutRejoin){a._reJoin();return true}a._endMeeting(o);return true}return false};return a}PubNubDataHandler.prototype.clean=function(){this._stopHandleNewVersion();e.prototype.clean.call(this)};PubNubDataHandler.prototype.onMeetingConnected=function(){var e;this._stopped=false;var t=this._dataProvider.meetingInfo();var n=(((e=t.channelInfo)===null||e===void 0?void 0:e.pingInterval)||Dr)*1.2;this._versionCheckInterval=n;this._startVersionCheck(this._versionCheckInterval)};PubNubDataHandler.prototype.onStartMeetingRecover=function(){this._stopHandleNewVersion()};PubNubDataHandler.prototype.isAbleToHandleSource=function(e){return e===Pn.PUBNUB};PubNubDataHandler.prototype.handleIncomingData=function(e){var t=e;if(!t.message||!t.message.type){this._logger.warn("received corrupted payload, ignore.");return}this._logger.log("receive pubnub data",t);switch(t.message.type){case c.J2.DATA:case c.J2.PING:{var n=t.message.body;if(n&&!this._checkMeetingTermination(n)&&!this._checkSessionDeleted(n)){this.addNotification(n)}break}case c.J2.INVALIDATE:{this._logger.log("invalidate received. ReJoin meeting");this._reJoin();break}default:this._logger.warn("unknown type received")}};PubNubDataHandler.prototype.addNotification=function(e){this._logger.log("add notification, version",e.version);e.version&&this._notificationMap.set(e.version,e);this.applyChanges()};PubNubDataHandler.prototype.applyChanges=function(){var e;if(this._isRecovering||this._stopped){this._logger.log("skip notification due to recover or stopped");return}var t=0;while(this._notificationMap.size>0){var n=this._dataProvider.meetingInfo();var r=n.version?n.version+1:-1;var i=this._notificationMap.get(r);if(!i){this._logger.log("can not find matched version of notification, skip, want version=",r);break}this._logger.log("apply notification change, version=",r);this._dataProvider.handleData(i);this._notificationMap.delete(r);this._logger.log("notification applied, map size=",this._notificationMap.size);t++}if(t<=0){this._startVersionCheck(wr)}else{this._clearNotificationMap(((e=this._dataProvider.meetingInfo())===null||e===void 0?void 0:e.version)||0)}};PubNubDataHandler.prototype._startVersionCheck=function(e){var t=this;var n;var r=this._getTimestamp();if(this._isRecovering||this._lastScheduleVersionCheckTime>r&&this._lastScheduleVersionCheckTime-r<=e){this._logger.log("skip schedule new version check current time= ",r," last scheduled time=",this._lastScheduleVersionCheckTime,"is recovering=",this._isRecovering);return}if(this._versioncheckTimer){clearTimeout(this._versioncheckTimer)}this._lastScheduleVersionCheckTime=r+e;var i=((n=this._dataProvider.meetingInfo())===null||n===void 0?void 0:n.version)||0;this._logger.log("recover scheduled, interval=",e," version=",i," time=",r);this._versioncheckTimer=setTimeout((function(){t._checkVersion(i)}),e)};PubNubDataHandler.prototype._stopHandleNewVersion=function(){this._stopped=true;this._versioncheckTimer&&clearTimeout(this._versioncheckTimer);this._versioncheckTimer=undefined;this._notificationMap.clear();this._lastScheduleVersionCheckTime=Number.MAX_VALUE};PubNubDataHandler.prototype._getTimestamp=function(){return(new Date).getTime()};Object.defineProperty(PubNubDataHandler.prototype,"_logger",{get:function(){return r.k.tags("[Meeting Update]["+this._remoteMeetingId+"]")},enumerable:true,configurable:true});Object.defineProperty(PubNubDataHandler.prototype,"_remoteMeetingId",{get:function(){if(!this._shortMeetingId){this._shortMeetingId=this._dataProvider.meetingInfo().shortId}return this._shortMeetingId},enumerable:true,configurable:true});return PubNubDataHandler}(br);var Lr=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Fr=function(e){Lr(MeetingStatusDataHandler,e);function MeetingStatusDataHandler(){return e!==null&&e.apply(this,arguments)||this}MeetingStatusDataHandler.prototype.isAbleToHandleSource=function(e){return e===Pn.MEETING_STATUS};MeetingStatusDataHandler.prototype.handleIncomingData=function(e){this._dataProvider.handleMeetingStatusData(e)};return MeetingStatusDataHandler}(br);var Vr=n(218932);var Ur=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var jr=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var xr=function(){function RCVMeetingScheduleController(){}RCVMeetingScheduleController.prototype.createBridge=function(e){if(e===void 0){e=ve._b.MEETING}return Ur(this,void 0,void 0,(function(){var t;return jr(this,(function(n){switch(n.label){case 0:return[4,i.RCVEApi.createBridge({type:e})];case 1:t=n.sent();r.k.log("bridge Info:",t);return[2,t]}}))}))};RCVMeetingScheduleController.prototype.getBridge=function(e){return Ur(this,void 0,void 0,(function(){var t;return jr(this,(function(n){switch(n.label){case 0:return[4,i.RCVEApi.getBridge(oe().pick(e,["shortId","phoneNumber","code"]))];case 1:t=n.sent();r.k.log("bridge Info:",t);return[2,t]}}))}))};return RCVMeetingScheduleController}();var Hr=n(61190);var Gr=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Br=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var qr=r.k.tags("[ObtainMeetingInfoPipeline]");var Yr=function(){function ObtainMeetingInfoPipeline(e,t){this.finished=false;this.args=e;this._localMediaInfo=t||{localMute:false,localMuteVideo:true}}ObtainMeetingInfoPipeline.prototype.initBridgeInfo=function(){return Gr(this,void 0,void 0,(function(){var e,t,n,i,o;return Br(this,(function(a){switch(a.label){case 0:e=this.args.option;if(this.args.meetingDataProvider.hasValidBridge()){return[2,this.args.meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.BRIDGE_INFO).getEntitiesSync()[0]]}t=new xr;n=RCVETracer(r.k);if(!(e&&(e.type===je.wJ.JOIN||e.type===je.wJ.CALL||e.type===je.wJ.REJOIN)))return[3,2];return[4,t.getBridge(e)];case 1:o=a.sent();return[3,4];case 2:return[4,t.createBridge()];case 3:o=a.sent();a.label=4;case 4:i=o;n.end({key:rr.OBTAIN_BRIDGE_INFO,level:It.LOG_CONTROL_LEVEL.NORMAL});return[2,i]}}))}))};ObtainMeetingInfoPipeline.prototype.createMeetingInfo=function(e,t,n){return Gr(this,void 0,void 0,(function(){var i,o,a,s;return Br(this,(function(l){switch(l.label){case 0:o={bridgeId:e,meetingPassword:t};return[4,this.buildInitParticipantSessionPayload(e,n)];case 1:i=(o.participants=[l.sent()],o);a=RCVETracer(r.k);return[4,Hr.y.createMeeting(i)];case 2:s=l.sent();a.end({key:rr.OBTAIN_MEETING_INFO,level:It.LOG_CONTROL_LEVEL.NORMAL});return[2,s]}}))}))};ObtainMeetingInfoPipeline.prototype.buildInitParticipantSessionPayload=function(e,t){return Gr(this,void 0,Promise,(function(){var n,r,i;return Br(this,(function(a){switch(a.label){case 0:n=et.Pal.instance.getPlatformUtils().getOSName();return[4,(0,o.getCurrentAccount)().getUserInfo()];case 1:r=a.sent();i=this.args.option.joinAudio;return[2,{bridgeId:e,ringing:true,displayName:r?r.name:"",allowUnmute:false,allowUnmuteVideo:false,sessions:[{bridgeId:e,localMute:this._localMediaInfo.localMute,localMuteVideo:this._localMediaInfo.localMuteVideo,userAgent:t?t:et.Pal.instance.getPlatformUtils().isElectron()?c.yZ.electron:c.yZ.web,operatingSystem:n&&c.xW[n]}],streams:[{bridgeId:e,audio:{isActiveIn:i,isActiveOut:i}}]}]}}))}))};ObtainMeetingInfoPipeline.prototype.tryJoinMeeting=function(e){var t,n;return Gr(this,void 0,void 0,(function(){var r,i;return Br(this,(function(o){switch(o.label){case 0:qr.info("try join meeting");o.label=1;case 1:o.trys.push([1,3,,4]);return[4,this.createMeetingInfo(e,(t=this.args.option)===null||t===void 0?void 0:t.password,(n=this.args.option)===null||n===void 0?void 0:n.userAgent)];case 2:r=o.sent();return[2,r];case 3:i=o.sent();if(i instanceof Yn.o$){qr.info("this meeting need password");return[2,null]}throw i;case 4:return[2]}}))}))};ObtainMeetingInfoPipeline.prototype.start=function(){var e=this;return new Promise((function(t,n){e.resolve=t;e.reject=n;e.initBridgeInfo().then((function(t){var n,r;e.bridgeInfo=t;if(t.isMeetingSecret){qr.info("bridgeId: "+t.id+". meeting need password");return e.tryJoinMeeting(t.id)}return e.createMeetingInfo(t.id,(n=e.args.option)===null||n===void 0?void 0:n.password,(r=e.args.option)===null||r===void 0?void 0:r.userAgent)})).then((function(r){if(!e.bridgeInfo){e.finished=true;qr.error("bridge info not present");n(new Error("bridgeInfo is undefined"));return}e.bridgeInfo.isMeetingSecret=!r;e.args.onBridgeInfoGet(e.bridgeInfo);var i=r===null;if(i)return;e.finished=true;t({meetingInfo:r,bridgeInfo:e.bridgeInfo})})).catch((function(t){qr.warn("init bridge info error:",t);e.finished=true;n(t)}))}))};ObtainMeetingInfoPipeline.prototype.enterPassword=function(e){return Gr(this,void 0,void 0,(function(){var t,n;return Br(this,(function(r){switch(r.label){case 0:qr.info("enter password: ",e);if(!this.bridgeInfo){qr.error("bridgeInfo does not exist when enter password");return[2,false]}r.label=1;case 1:r.trys.push([1,3,,4]);return[4,this.createMeetingInfo(this.bridgeInfo.id,e)];case 2:t=r.sent();qr.info("resolve promise with ",{meetingInfo:t,bridgeInfo:this.bridgeInfo});this.finished=true;this.resolve&&this.resolve({meetingInfo:t,bridgeInfo:this.bridgeInfo});return[2,true];case 3:n=r.sent();if(n instanceof Yn.o$){return[2,false]}throw n;case 4:return[2]}}))}))};ObtainMeetingInfoPipeline.prototype.dispose=function(){qr.info("disposed");this.finished=true;this.reject&&this.reject(new Yn.Sj("disposed"))};return ObtainMeetingInfoPipeline}();var Kr=n(81787);var Qr=n(352929);var Wr=n.n(Qr);var Jr=undefined&&undefined.__assign||function(){Jr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Jr.apply(this,arguments)};var zr=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var $r=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var Xr=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Zr=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var ei=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var ti=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ei(arguments[t]));return e};var ni=r.k.tags("[CallController]");var ri=(0,It.createLogDecorator)(ni);var ii=function(){function CallController(e){var t=this;this._dependency=e;this._isoCountryMap=new Map;Kr.forEach((function(e){t._isoCountryMap.set(e.isoCode,e)}))}CallController.prototype._updateCallCache=function(e,t,n){var r;return Xr(this,void 0,void 0,(function(){var i,o,a,s;return Zr(this,(function(l){switch(l.label){case 0:if(!t){ni.log("No isoCode, skip update cache.");return[2]}i=this._dependency.getRCVEUserConfig();return[4,i.getRememberNumber(e)];case 1:o=l.sent();if(!o)return[3,5];return[4,i.getCallRecords(e)];case 2:a=l.sent()||[];s={isoCode:t,number:n,callingCode:(r=this._isoCountryMap.get(t))===null||r===void 0?void 0:r.callingCode};return[4,i.setLastCallRecord(e,s)];case 3:l.sent();return[4,i.setCallRecords(e,Wr()(ti([s],a),(function(e,t){return e.isoCode===t.isoCode&&e.number===t.number})).slice(0,5))];case 4:l.sent();l.label=5;case 5:return[2]}}))}))};CallController.prototype.callMe=function(e,t){var n;return Xr(this,void 0,void 0,(function(){var r,o,a,s,l,u,d;return Zr(this,(function(f){switch(f.label){case 0:r=this._dependency.getMeetingIds(),o=r.bridgeId,a=r.meetingId,s=r.participantId;l=(n=this._isoCountryMap.get(e))===null||n===void 0?void 0:n.callingCode;return[4,this._updateCallCache(je.rf.CallMe,e,t)];case 1:f.sent();return[4,i.RCVEApi.call({bridgeId:o,meetingId:a,participantId:s,calleeId:s,number:"+"+l+t})];case 2:u=f.sent();ni.info("Call request success, update local dial info.",u);d=Jr(Jr({},u),{dialType:ve.XU.CALL_ME});return[4,this._dependency.getMeetingUpdateController().sendLocalEntityPartialChange(d,c.FY.ENTITY.DIAL_INFO,{initialWhenNotExist:true})];case 3:f.sent();return[2]}}))}))};CallController.prototype.callOut=function(e,t){var n;return Xr(this,void 0,void 0,(function(){var r,o,a,s,l,u,d;return Zr(this,(function(f){switch(f.label){case 0:r=this._dependency.getMeetingIds(),o=r.bridgeId,a=r.meetingId,s=r.participantId;l=(n=this._isoCountryMap.get(e))===null||n===void 0?void 0:n.callingCode;return[4,this._updateCallCache(je.rf.CallOut,e,t)];case 1:f.sent();return[4,i.RCVEApi.call({bridgeId:o,meetingId:a,participantId:s,number:l?"+"+l+t:t})];case 2:u=f.sent();ni.info("Call request success, update local dial info.",u);d=Jr(Jr({},u),{dialType:ve.XU.CALL_OUT});return[4,this._dependency.getMeetingUpdateController().sendLocalEntityPartialChange(d,c.FY.ENTITY.DIAL_INFO,{initialWhenNotExist:true})];case 3:f.sent();return[2,u]}}))}))};CallController.prototype.deleteCall=function(e){var t=this._dependency.getMeetingIds(),n=t.bridgeId,r=t.meetingId,o=t.participantId;return i.RCVEApi.deleteCall({bridgeId:n,meetingId:r,participantId:o,dialId:e})};CallController.prototype.getCountryInfoList=function(){return Kr};CallController.prototype.getCallSetting=function(e){return Xr(this,void 0,Promise,(function(){var t,n,r,i,o;return Zr(this,(function(a){switch(a.label){case 0:t=this._dependency.getRCVEUserConfig();return[4,t.getLastCallRecord(e)];case 1:n=a.sent();return[4,t.getCallRecords(e)];case 2:r=a.sent()||[];return[4,t.getDefaultCountry(e)];case 3:i=a.sent();return[4,t.getRememberNumber(e)];case 4:o=a.sent();return[2,{rememberNumber:!!o,callRecords:r,lastCallRecord:n,defaultCountry:i}]}}))}))};var e,t,n,r;zr([ri({call:true}),$r("design:type",Function),$r("design:paramtypes",[typeof(e=typeof je.rf!=="undefined"&&je.rf)==="function"?e:Object,String,String]),$r("design:returntype",Promise)],CallController.prototype,"_updateCallCache",null);zr([ri({call:true}),$r("design:type",Function),$r("design:paramtypes",[String,String]),$r("design:returntype",Promise)],CallController.prototype,"callMe",null);zr([ri({call:true,error:true}),$r("design:type",Function),$r("design:paramtypes",[String,String]),$r("design:returntype",Promise)],CallController.prototype,"callOut",null);zr([ri({call:true,error:true}),$r("design:type",Function),$r("design:paramtypes",[String]),$r("design:returntype",typeof(t=typeof Promise!=="undefined"&&Promise)==="function"?t:Object)],CallController.prototype,"deleteCall",null);zr([ri({call:true}),$r("design:type",Function),$r("design:paramtypes",[typeof(n=typeof je.rf!=="undefined"&&je.rf)==="function"?n:Object]),$r("design:returntype",typeof(r=typeof Promise!=="undefined"&&Promise)==="function"?r:Object)],CallController.prototype,"getCallSetting",null);return CallController}();var oi=undefined&&undefined.__assign||function(){oi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return oi.apply(this,arguments)};var ai=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var si=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var li=undefined&&undefined.__rest||function(e,t){var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0)n[r]=e[r];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++){if(t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i]))n[r[i]]=e[r[i]]}return n};var ui=r.k.tags("[DemandController]");var ci=function(){function DemandController(e,t,n){var r=this;this._demandInfoEntityController=e;this._dataProvider=t;this._localMediaController=n;this.cancelDemand=function(e){var t=r._getLatestDemand(e);if(t){ui.log("cancel demand, id: "+t.id);r.rejectDemand(t.id)}};this.getCurrentParticipantId=function(){var e;return(e=r._dataProvider.remoteSelfMeetingEntityIds())===null||e===void 0?void 0:e.participantId};this._preHandleData=function(e,t){var n=[];e.forEach((function(e){var t;if(!(e===null||e===void 0?void 0:e.id)){return}if(e.deleted){n.push(e)}else if((t=e.decisions)===null||t===void 0?void 0:t.some((function(e){return e.id===r.getCurrentParticipantId()}))){e.deleted=true;n.push(e)}else{if(!e.isSelf){return}switch(e.type){case ve.cZ.UNMUTE_DEMAND:if(r._dataProvider.getLocalParticipantPSTNSessionInfo()){return}if(r._currentSession.localMute===false){r._rejectDemandInternal(e.id);return}break;case ve.cZ.UNMUTE_VIDEO_DEMAND:if(r._currentSession.localMuteVideo===false){r._rejectDemandInternal(e.id);return}break;default:}n.push(e)}}));return n};e.currentParticipantId=this.getCurrentParticipantId();e.preHandleData=this._preHandleData}DemandController.prototype._getLatestDemand=function(e){if(!e){return}var t=this._demandInfoEntityController.getEntitiesSync((function(t){return e===t.type&&t.status===ve.Uf.NEW&&!t.deleted}),(function(e,t){return new Date(t.createTime).getTime()-new Date(e.createTime).getTime()}));if(t&&t.length){return t[0]}return};DemandController.prototype.meetingIdInfo=function(){var e=this._dataProvider.remoteSelfMeetingEntityIds(),t=e.meetingInfoId,n=li(e,["meetingInfoId"]);return oi({bridgeId:this._dataProvider.bridgeId(),meetingId:t},n)};Object.defineProperty(DemandController.prototype,"_currentSession",{get:function(){return this._dataProvider.localSession()},enumerable:true,configurable:true});DemandController.prototype.answerDemand=function(e,t){var n=this;var r=this._demandInfoEntityController.handleDemandDeleted(e);(0,It.runInPool)(r.map((function(e){return function(){return ai(n,void 0,void 0,(function(){var n;return si(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,this.updateDemand(e,[{id:this.getCurrentParticipantId(),status:t}])];case 1:r.sent();return[3,3];case 2:n=r.sent();ui.error("answer demand failed, continue, demandId: "+e+", answer: "+t,n.code);return[3,3];case 3:return[2]}}))}))}})))};DemandController.prototype._rejectDemandInternal=function(e){this.answerDemand(e,ve.Uf.REJECT);ui.log("reject demand internal, demandId: ",e)};DemandController.prototype.approveDemand=function(e){var t,n;return ai(this,void 0,void 0,(function(){var r,i;return si(this,(function(o){switch(o.label){case 0:r=this._demandInfoEntityController.getSynchronously(e);if(!r){ui.error("Cannot find demand, demandId: ",e);return[2]}if(r.deleted){ui.error("Cannot approve a deleted demand, demand: ",e);return[2]}if(!r.isSelf){ui.error("Cannot approve a demand not belong to me, demand: ",e);return[2]}i=r===null||r===void 0?void 0:r.type;switch(i){case ve.cZ.UNMUTE_DEMAND:return[3,1];case ve.cZ.UNMUTE_VIDEO_DEMAND:return[3,2];case ve.cZ.CONTROL_DEMAND:return[3,4];case ve.cZ.ANNOTATE_DEMAND:return[3,5]}return[3,6];case 1:(t=this._localMediaController)===null||t===void 0?void 0:t.unmuteAudio();(r===null||r===void 0?void 0:r.isSelfOnly)?this.deleteDemand(e):this.answerDemand(e,ve.Uf.APPROVE);return[3,7];case 2:return[4,(n=this._localMediaController)===null||n===void 0?void 0:n.unmuteVideo()];case 3:o.sent();(r===null||r===void 0?void 0:r.isSelfOnly)?this.deleteDemand(e):this.answerDemand(e,ve.Uf.APPROVE);return[3,7];case 4:ui.log("CONTROL_DEMAND not supported yet");return[2];case 5:ui.log("ANNOTATE_DEMAND not supported yet");return[2];case 6:ui.log("unknown demand type received");return[2];case 7:ui.log("approve demand, demandId: "+e+", demandType: "+(r===null||r===void 0?void 0:r.type)+" ");return[2]}}))}))};DemandController.prototype.rejectDemand=function(e){var t=this._demandInfoEntityController.getSynchronously(e);if(!t){ui.error("Cannot find demand, demandId: ",e);return}if(t.deleted){ui.error("Cannot approve a deleted demand, demand: ",e);return}if(!t.isSelf){ui.error("Cannot approve a demand not belong to me, demand: ",e);return}(t===null||t===void 0?void 0:t.isSelfOnly)?this.deleteDemand(e):this.answerDemand(e,ve.Uf.REJECT);ui.log("reject demand, demandId: ",e)};DemandController.prototype.createSelfDemand=function(e){return ai(this,void 0,void 0,(function(){var t;return si(this,(function(n){switch(n.label){case 0:t=this.getCurrentParticipantId();if(!t){ui.warn("[leave phone audio] Not find currentParticipantId to createSelfDemand.");return[2]}return[4,this.createDemand(e,t)];case 1:n.sent();return[2]}}))}))};DemandController.prototype.createDemand=function(e,t){return ai(this,void 0,void 0,(function(){var n,r,o;return si(this,(function(a){switch(a.label){case 0:n=this.meetingIdInfo();r={bridgeId:n.bridgeId,meetingId:n.meetingId,info:{participantId:n.participantId,sessionId:n.sessionId},resource:{participantId:t},participantId:n.participantId,status:ve.Uf.NEW,type:e};a.label=1;case 1:a.trys.push([1,3,,4]);return[4,i.RCVEApi.createDemand(r)];case 2:a.sent();return[3,4];case 3:o=a.sent();ui.error("create demand request failed, err code: ",o.code);throw o;case 4:return[2]}}))}))};DemandController.prototype.deleteDemand=function(e){var t=this;var n=this._demandInfoEntityController.handleDemandDeleted(e);(0,It.runInPool)(n.map((function(e){return function(){return ai(t,void 0,void 0,(function(){var t;return si(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,i.RCVEApi.deleteDemand(e,this.meetingIdInfo())];case 1:n.sent();return[3,3];case 2:t=n.sent();ui.error("delete demand request failed, err code: ",t.code);return[3,3];case 3:return[2]}}))}))}})))};DemandController.prototype.updateDemand=function(e,t){return ai(this,void 0,void 0,(function(){var n,r;return si(this,(function(o){switch(o.label){case 0:if(oe().isEmpty(t)){ui.error("update demand failed, decision is empty or undefined, decisions: ",t);return[2]}n={id:e,decisions:t};o.label=1;case 1:o.trys.push([1,3,,4]);return[4,i.RCVEApi.updateDemand(n,this.meetingIdInfo())];case 2:o.sent();return[3,4];case 3:r=o.sent();ui.error("update demand failed, err code: "+r.code+", decisions: "+t);throw r;case 4:return[2]}}))}))};return DemandController}();var di=function(){function ObserverManager(){this._observerControllerList=[]}ObserverManager.prototype.close=function(){this._observerControllerList.forEach((function(e){return e.close()}));this._observerControllerList=[]};ObserverManager.prototype.registerObserver=function(e){if(this._observerControllerList.some((function(t){return t===e}))){return}this._observerControllerList.push(e);e.init()};return ObserverManager}();var fi=function(){function AbstractObserver(){}return AbstractObserver}();var pi=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var hi=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var _i=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var vi=function(e){pi(PSTNObserver,e);function PSTNObserver(t,n,i){var o=e.call(this)||this;o._localMediaController=t;o._meetingDataProvider=n;o._meetingEventManager=i;o._logger=r.k.tags("[PSTNObserver]");o._hasPSTNSession=false;o._wasJoinedAudioBeforePSTN=false;o._handlePSTNSessionChange=function(){return hi(o,void 0,void 0,(function(){var e,t,n,r;return _i(this,(function(i){switch(i.label){case 0:this._logger.debug("SessionInfo update, to start PSTNSession change.");e=this._hasPSTNSession;t=this._meetingDataProvider.getLocalParticipantPSTNSessionInfo();this._hasPSTNSession=t!==null;if(e===this._hasPSTNSession){this._logger.debug("No PSTNSessionInfo changed, not need to do action.");return[2]}n=this._isLocalStreamJoinedAudio();r=this._hasPSTNSession&&!e;if(!r)return[3,2];this._logger.debug("join PSTNSession, emit UI.");this._meetingEventManager.emit(c.FY.EVENT.USING_PHONE_AUDIO);if(!n)return[3,2];this._logger.debug("PSTNSessionInfo changed, and isJoinedAudio now, so need to leaveAudio.");this._wasJoinedAudioBeforePSTN=true;return[4,this._localMediaController.leaveAudio()];case 1:i.sent();return[2];case 2:if(!(this._wasJoinedAudioBeforePSTN&&!this._hasPSTNSession&&e))return[3,4];this._logger.debug("PSTNSessionInfo changed, and wasJoinedAudioBeforePSTN, so need to joinAudio.");return[4,this._localMediaController.joinAudio()];case 3:i.sent();this._wasJoinedAudioBeforePSTN=false;return[2];case 4:this._logger.debug("PSTNSessionInfo changed but nothing need to do.");return[2]}}))}))};return o}PSTNObserver.prototype.close=function(){o.notificationCenter.off(this._getSessionChangeEvent(),this._handlePSTNSessionChange)};PSTNObserver.prototype.init=function(){return hi(this,void 0,Promise,(function(){return _i(this,(function(e){switch(e.label){case 0:return[4,this._handlePSTNSessionChange()];case 1:e.sent();o.notificationCenter.on(this._getSessionChangeEvent(),this._handlePSTNSessionChange);return[2]}}))}))};PSTNObserver.prototype._getSessionChangeEvent=function(){return c.FY.ENTITY.SESSION_INFO+"."+this._localIdentifier()};PSTNObserver.prototype._localIdentifier=function(){return this._meetingDataProvider.localIdentifier()};PSTNObserver.prototype._isLocalStreamJoinedAudio=function(){var e=this._meetingDataProvider.getLocalState();var t=e?e.media.audioJoined:false;this._logger.debug("_isLocalStreamJoinedAudio:"+t);return t};return PSTNObserver}(fi);var gi=n(334065);var yi=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var mi=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Si=r.k.tags("[ParticipantInfoEntityObserver]");var Ci=function(e){yi(ParticipantInfoEntityObserver,e);function ParticipantInfoEntityObserver(t,n,r){var i=e.call(this)||this;i._localMediaController=t;i._dataProvider=n;i._eventManager=r;i._selfParticipantEntity={};i._shouldEmitMute=function(e){if(i._dataProvider.getLocalParticipantPSTNSessionInfo()){Si.log("isPSTN, not emit mute event");return false}if(e===null||e===void 0?void 0:e.localMute){Si.log("local mute, not emit mute event");return false}return true};i._shouldEmitMuteVideo=function(e){if(e===null||e===void 0?void 0:e.localMuteVideo){Si.log("local video mute, not emit muteVideo event");return false}return true};i._selfParticipantEntity=oe().cloneDeep(i._dataProvider.getSelfParticipantEntity());i._listener=function(e){i._onEntityUpdateHandle(e)};return i}ParticipantInfoEntityObserver.prototype.close=function(){gi.r.removeListener(c.FY.ENTITY.PARTICIPANT_INFO+"."+this._dataProvider.localIdentifier(),this._listener)};ParticipantInfoEntityObserver.prototype.init=function(){gi.r.onEntityUpdate(c.FY.ENTITY.PARTICIPANT_INFO+"."+this._dataProvider.localIdentifier(),this._listener);this._checkInitServerMuteStatus()};ParticipantInfoEntityObserver.prototype._checkInitServerMuteStatus=function(){if(this._selfParticipantEntity.serverMute){Si.log("check init server mute configuration, mute self");this._localMediaController.muteAudio()}if(this._selfParticipantEntity.serverMuteVideo){Si.log("check init server mute video configuration, mute video self");this._localMediaController.muteVideo()}};ParticipantInfoEntityObserver.prototype._onEntityUpdateHandle=function(e){if(this._selfParticipantEntity.id===undefined){return}var t=this._getSelfEntityFromUpdatePayload(e);if(t===undefined){return}var n=this._selfParticipantEntity,r=n.serverMute,i=n.serverMuteVideo,o=n.moderator,a=n.temporaryModerator;var s=t.serverMute,l=t.serverMuteVideo,u=t.moderator,d=t.temporaryModerator;var f=oe().cloneDeep(this._dataProvider.getLocalSessionInfo());this._selfParticipantEntity=oe().cloneDeep(t);if(r!==true&&s){this._localMediaController.muteAudio();Si.log("mute by moderator or host, invoke mute audio");if(this._shouldEmitMute(f)){this._eventManager.emit(c.FY.PARTICIPANT_ACTION.MUTED_BY_MODERATOR)}}if(i!==true&&l){this._localMediaController.muteVideo();Si.log("mute video by moderator or host, invoke mute video");if(this._shouldEmitMuteVideo(f)){this._eventManager.emit(c.FY.PARTICIPANT_ACTION.MUTED_VIDEO_BY_MODERATOR)}}if(o&&u===false){Si.log("moderator revoked");this._eventManager.emit(c.FY.PARTICIPANT_ACTION.MODERATOR_REVOKED)}if(o===false&&u){Si.log("moderator granted");this._eventManager.emit(c.FY.PARTICIPANT_ACTION.MODERATOR_GRANTED)}if(a&&d===false){Si.log("no longer have moderator privileges");this._eventManager.emit(c.FY.PARTICIPANT_ACTION.TEMPORARY_MODERATOR_REVOKED)}if(a===false&&d){Si.log("have moderator privileges until the actual host joins");this._eventManager.emit(c.FY.PARTICIPANT_ACTION.TEMPORARY_MODERATOR_GRANTED)}};ParticipantInfoEntityObserver.prototype._getSelfEntityFromUpdatePayload=function(e){var t,n;var r=e.body.entities;try{for(var i=mi(r.values()),o=i.next();!o.done;o=i.next()){var a=o.value;if(a&&a.isSelf){return a}}}catch(e){t={error:e}}finally{try{if(o&&!o.done&&(n=i.return))n.call(i)}finally{if(t)throw t.error}}return undefined};return ParticipantInfoEntityObserver}(fi);var Ei=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var bi=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var Ii=r.k.tags("[MeetingInfoEntityObserver]");var Mi=function(e){Ei(MeetingInfoEntityObserver,e);function MeetingInfoEntityObserver(t,n,r){var i=e.call(this)||this;i._meetingActionController=t;i._dataProvider=n;i._eventManager=r;i._selfMeetingInfoEntity={};i._listener=function(e){i._onEntityUpdateHandle(e)};i._selfMeetingInfoEntity=oe().cloneDeep(i._dataProvider.meetingInfo());return i}MeetingInfoEntityObserver.prototype.init=function(){gi.r.onEntityUpdate(c.FY.ENTITY.MEETING_INFO+"."+this._dataProvider.localIdentifier(),this._listener)};MeetingInfoEntityObserver.prototype.close=function(){gi.r.removeListener(c.FY.ENTITY.MEETING_INFO+"."+this._dataProvider.localIdentifier(),this._listener)};MeetingInfoEntityObserver.prototype._getSelfEntityFromUpdatePayload=function(e){var t,n;var r=e.body.entities;try{for(var i=bi(r.values()),o=i.next();!o.done;o=i.next()){var a=o.value;if(a){return a}}}catch(e){t={error:e}}finally{try{if(o&&!o.done&&(n=i.return))n.call(i)}finally{if(t)throw t.error}}return undefined};MeetingInfoEntityObserver.prototype._onEntityUpdateHandle=function(e){var t=this._getSelfEntityFromUpdatePayload(e);if(t===undefined){return}var n=this._dataProvider.remoteSelfMeetingEntityIds().participantId;if(n===undefined){return}var r=this._selfMeetingInfoEntity,i=r.allowJoin,o=r.allowScreenSharing;var a=t.allowJoin,s=t.allowScreenSharing,l=t.allowJoinChangedBy,u=t.allowScreenSharingChangedBy;this._selfMeetingInfoEntity=oe().cloneDeep(t);if(i&&a===false){Ii.log("meeting locked");n!==l&&this._eventManager.emit(c.FY.MEETING_ACTION.MEETING_LOCKED)}if(i===false&&a){Ii.log("meeting unlocked");n!==l&&this._eventManager.emit(c.FY.MEETING_ACTION.MEETING_UNLOCKED)}if(o&&s===false){Ii.log("only moderator or host can share");var d=this._dataProvider.getSelfParticipantEntity();if(this._shouldStopScreenSharing(d)){Ii.log("try to stop screensharing");this._meetingActionController.stopScreenSharing()}n!==u&&this._eventManager.emit(c.FY.MEETING_ACTION.MEETING_ONLY_MODERATOR_SHARING)}if(o===false&&s){Ii.log("everyone can share now");n!==u&&this._eventManager.emit(c.FY.MEETING_ACTION.MEETING_EVERYONE_SHARING)}};MeetingInfoEntityObserver.prototype._shouldStopScreenSharing=function(e){if(e){if(!!e.moderator||!!e.host||!!e.temporaryModerator){return false}return true}return false};return MeetingInfoEntityObserver}(fi);var Ri=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ti=undefined&&undefined.__assign||function(){Ti=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Ti.apply(this,arguments)};var Oi=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Ai=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Pi=function(e){Ri(DialInfoEntityObserver,e);function DialInfoEntityObserver(t,n){var i=e.call(this)||this;i._meetingDataProvider=t;i._meetingEventManager=n;i._dialInfoStatusMap=new Map;i._logger=r.k.tags("[DialInfoEntityObserver]");i._handleDialInfoChange=function(){var e;var t=(e=i._meetingDataProvider.remoteSelfMeetingEntityIds())===null||e===void 0?void 0:e.participantId;i._logger.info("participantId:"+t);if(!t){i._logger.warn("No participant id to handle dialInfo.");return}var n=i._meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.DIAL_INFO);var r=n===null||n===void 0?void 0:n.getEntitiesSync((function(e){return e.callerId===t}));if(r.length<1){i._logger.debug("No localParticipant dialInfo to handle");return}r.forEach((function(e){var t=e.id;var n=i._dialInfoStatusMap.get(t);if(n){if(e.deleted){i._logger.debug("delete dial status "+t+".");i._dialInfoStatusMap.delete(t);return}if(n===e.status){i._logger.debug("dial status not change "+t+", status:"+e.status+".");return}i._emitDialStatusChange(n,e)}i._logger.debug("update dial status "+t+": "+e.status);i._dialInfoStatusMap.set(t,e.status)}))};return i}DialInfoEntityObserver.prototype.close=function(){o.notificationCenter.off(this._getDialInfoChangeEvent(),this._handleDialInfoChange);this._dialInfoStatusMap.clear()};DialInfoEntityObserver.prototype.init=function(){return Oi(this,void 0,Promise,(function(){return Ai(this,(function(e){switch(e.label){case 0:return[4,this._handleDialInfoChange()];case 1:e.sent();o.notificationCenter.on(this._getDialInfoChangeEvent(),this._handleDialInfoChange);return[2]}}))}))};DialInfoEntityObserver.prototype._getDialInfoChangeEvent=function(){return c.FY.ENTITY.DIAL_INFO+"."+this._localIdentifier()};DialInfoEntityObserver.prototype._localIdentifier=function(){return this._meetingDataProvider.localIdentifier()};DialInfoEntityObserver.prototype._emitDialStatusChange=function(e,t){this._logger.info("Dial status "+t.id+": change from "+e+" to "+t.status+".");var n=t.dialType!==ve.XU.CALL_OUT&&t.dialType!==ve.XU.CALL_ME;if(n){this._logger.debug("this client not need to emit, because dialType:"+t.dialType+".");return}if(t.status===ve.nO.FAIL){this._logger.debug("dial fail, show call rejected.");this._meetingEventManager.emit(c.FY.EVENT.DIAL_FAIL,Ti({},t));return}if(t.status===ve.nO.START&&t.dialType===ve.XU.CALL_OUT){this._logger.debug("InviteByPhone success, show call accepted.");this._meetingEventManager.emit(c.FY.EVENT.DIAL_SUCCESS,Ti({},t));return}};return DialInfoEntityObserver}(fi);var Ni=function(){function EntityObserverController(e,t,n,r){this._localMediaController=e;this._meetingActionController=t;this._meetingDataProvider=n;this._meetingEventManager=r;this.observerManager=new di;this._init()}EntityObserverController.prototype.clean=function(){this.observerManager.close()};EntityObserverController.prototype._init=function(){this.observerManager.registerObserver(new vi(this._localMediaController,this._meetingDataProvider,this._meetingEventManager));this.observerManager.registerObserver(new Ci(this._localMediaController,this._meetingDataProvider,this._meetingEventManager));this.observerManager.registerObserver(new Mi(this._meetingActionController,this._meetingDataProvider,this._meetingEventManager));this.observerManager.registerObserver(new Pi(this._meetingDataProvider,this._meetingEventManager))};return EntityObserverController}();var wi=function(){function AbstractDataUpdatePrehandler(){}AbstractDataUpdatePrehandler.prototype.doPreHandle=function(e){if(this.supportedSources().includes(e.source)){this.doPrehandleInternal(e)}};return AbstractDataUpdatePrehandler}();var Di=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var ki=undefined&&undefined.__assign||function(){ki=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return ki.apply(this,arguments)};var Li=r.k.tags("[active speaker]");var Fi;(function(e){e["STREAM"]="STREAM";e["PSTN"]="PSTN"})(Fi||(Fi={}));var Vi=function(e){Di(ActiveSpeakerPrehandler,e);function ActiveSpeakerPrehandler(t){var n;var r=e.call(this)||this;r._handleFuncMap=(n={},n[I.ACTIVE_SPEAKERS_REPORT_REQ]=r._handleActiveSpeakerReport,n[I.PSTN_AS_REPORT_REQ]=r._handlePSTNActiveSpeakerReport,n);r._lastStreamState=[];r._lastPSTNState=[];r._compareSpeakerStatus=function(e,t){if(e.lastActive!==t.lastActive){return e.lastActive?-1:1}if(e.startSpeakTime!==t.startSpeakTime){return e.startSpeakTime<=t.startSpeakTime?-1:1}if(e.v!==t.v){return(e.v||0)>(t.v||0)?-1:1}if(e.q!==t.q){return(e.q||0)>(t.q||0)?-1:1}if(e.available_q!==t.available_q){return(e.available_q||0)>(t.available_q||0)?-1:1}if(e.desired_q!==t.desired_q){return(e.desired_q||0)>(t.desired_q||0)?-1:1}return e.id>t.id?1:0};r._context=t;return r}ActiveSpeakerPrehandler.prototype.clean=function(){delete this._context};ActiveSpeakerPrehandler.prototype.supportedSources=function(){return[Pn.SIGNALING]};ActiveSpeakerPrehandler.prototype.doPrehandleInternal=function(e){var t;if(!this._isContextReady()){Li.error("receive as report when context not ready.");return}var n=e.data;var r=this._handleFuncMap[n.event];if(r!==undefined){r.bind(this)(n);this._updateLastActiveSession();Li.log("update active speaker completed, current active=",this._lastActiveSession);n.body.active_session=this._lastActiveSession;(t=this._context.qualityController())===null||t===void 0?void 0:t.updateActiveSession(this._lastActiveSession)}};ActiveSpeakerPrehandler.prototype._handleActiveSpeakerReport=function(e){var t,n;var r=e.body;if(!r.remote_streams){Li.log("report does not contain remote_streams, no update.");return}var i=this._parseActiveSpeakerReport(r);this._lastStreamState=i;this._lastActiveStreamRecord=i.length===0?undefined:i.sort(this._compareSpeakerStatus)[0];Li.log("update stream active completed, current active stream=",(t=this._lastActiveStreamRecord)===null||t===void 0?void 0:t.id," start speak from:",(n=this._lastActiveStreamRecord)===null||n===void 0?void 0:n.startSpeakTime)};ActiveSpeakerPrehandler.prototype._handlePSTNActiveSpeakerReport=function(e){var t,n;var r=e.body;if(!r.active_speakers){Li.log("report does not contain active_speakers, no update");return}var i=this._parsePSTNActiveSpeakerReport(r);this._lastPSTNState=i;this._lastActivePSTNRecord=i.length===0?undefined:i.sort(this._compareSpeakerStatus)[0];Li.log("update PSTN active completed, current active=",(t=this._lastActivePSTNRecord)===null||t===void 0?void 0:t.id," start speak from:",(n=this._lastActivePSTNRecord)===null||n===void 0?void 0:n.startSpeakTime)};ActiveSpeakerPrehandler.prototype._updateLastActiveSession=function(){var e=this._streamActiveSessionId();var t=this._PSTNActiveSessionId();Li.log("active stream session id=",e," active PSTN session id=",t);if(!e&&!t){this._lastActiveSession=undefined;return}if(this._lastActiveSession===undefined||this._lastActiveSession!==e&&this._lastActiveSession!==t){var n=e&&this._lastActiveStreamRecord?this._lastActiveStreamRecord.startSpeakTime:Number.MAX_SAFE_INTEGER;var r=t&&this._lastActivePSTNRecord?this._lastActivePSTNRecord.startSpeakTime:Number.MAX_SAFE_INTEGER;this._lastActiveSession=n>r?t:e}};ActiveSpeakerPrehandler.prototype._parseActiveSpeakerReport=function(e){var t=this;var n=[];var r=e.remote_streams||[];r.forEach((function(e){(e.v||0)>0&&n.push(ki(ki({},e),{type:Fi.STREAM,startSpeakTime:0,lastActive:t._lastActiveStreamRecord?e.id===t._lastActiveStreamRecord.id:false}))}));Li.log("update by as_report, speaking stream count=",n.length);return this._markStartSpeakingTime(n,this._lastStreamState)};ActiveSpeakerPrehandler.prototype._parsePSTNActiveSpeakerReport=function(e){var t=this;var n=[];var r=e.active_speakers||[];r.forEach((function(e){n.push({id:e,type:Fi.PSTN,startSpeakTime:0,lastActive:t._lastActivePSTNRecord?e===t._lastActivePSTNRecord.id:false})}));Li.log("update by pstn_as_report, speaking PSTN count=",n.length);return this._markStartSpeakingTime(n,this._lastPSTNState)};ActiveSpeakerPrehandler.prototype._markStartSpeakingTime=function(e,t){var n=this._currentTimestamp();e.forEach((function(e){var r=t.find((function(t){return e.id===t.id}));e.startSpeakTime=r?r.startSpeakTime:n}));return e};ActiveSpeakerPrehandler.prototype._streamActiveSessionId=function(){var e=this;if(!this._lastActiveStreamRecord){return undefined}var t=this._queryMatchedSessions((function(t){return!!t.streamIds&&t.streamIds.includes(e._lastActiveStreamRecord.id)}));return t.length===0?undefined:t[0].id};ActiveSpeakerPrehandler.prototype._PSTNActiveSessionId=function(){if(!this._lastActivePSTNRecord){return undefined}var e=this._lastActivePSTNRecord.id;var t=this._queryMatchedSessions((function(t){return t.participantId===e&&t.userAgent!=="rcv/pstn"}));if(t.length>0){return t[0].id}var n=this._queryMatchedSessions((function(t){return t.participantId===e&&t.userAgent==="rcv/pstn"}));return n.length===0?undefined:n[0].id};ActiveSpeakerPrehandler.prototype._queryMatchedSessions=function(e){var t=this._context.dataProvider().getEntityControllerByEntityKey(c.FY.ENTITY.SESSION_INFO);return t.getEntitiesSync(e)};ActiveSpeakerPrehandler.prototype._isContextReady=function(){return this._context&&!!this._context.dataProvider()&&!!this._context.qualityController()};ActiveSpeakerPrehandler.prototype._currentTimestamp=function(){return(new Date).getTime()};return ActiveSpeakerPrehandler}(wi);var Ui=function(){function MeetingEventManager(){this._eventMap=new Map;this._logger=r.k.tags("[MeetingEventManager]")}MeetingEventManager.prototype.setId=function(e){this._id=e};MeetingEventManager.prototype.listen=function(e,t){var n=this;var r=this._genEventKey(e);this._logger.debug("listen "+r);var i=this._eventMap.get(r);if(!i){i=[];this._eventMap.set(r,i)}else if(i.some((function(e){return e===t}))){return function(){}}i.push(t);o.notificationCenter.on(r,t);return function(){o.notificationCenter.off(r,t);n._remove(r,t)}};MeetingEventManager.prototype.emit=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}var r=this._genEventKey(e);this._logger.debug("emit "+r);o.notificationCenter.emit(r,t)};MeetingEventManager.prototype.cleanAll=function(){this._eventMap.forEach((function(e,t){return o.notificationCenter.removeAllListeners(t)}));this._eventMap.clear()};MeetingEventManager.prototype._genEventKey=function(e){return e+"."+this._id};MeetingEventManager.prototype._remove=function(e,t){var n=this._eventMap.get(e);if(!n||n.length===1&&n[0]===t){this._eventMap.delete(e);return}var r=n.filter((function(e){return e!==t}));this._eventMap.set(e,r)};return MeetingEventManager}();var ji=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var xi=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Hi=5e3;var Gi=5e3;var Bi=25e3;var qi=function(){function AbstractMediaStateSynchronizer(e){this._failedCount=0;this._logger=r.k;this._stopped=true;this._needRetry=true;this._syncing=false;this._pendingSync=false;this._dataProvider=e.dataProvider;this._needRetry=e.needRetry===undefined?true:e.needRetry;this._initialRetryInterval=e.initialRetryInterval||Hi;this._intervalStepSize=e.intervalStepSize||Gi;this._maxRetryInterval=e.maxRetryInterval||Bi}AbstractMediaStateSynchronizer.prototype.startSync=function(e){return ji(this,void 0,void 0,(function(){var t;return xi(this,(function(n){switch(n.label){case 0:if(this._stopped){this._logger.warn("sync be called but now stopped");return[2]}if(this._syncing){this._logger.log("on-going sync executing, set as pending.");this._pendingSync=true;return[2]}t=this._syncPayload(e);if(!t){this._logger.log("no need to do sync since nothing is changed");this._cleanRetry();return[2]}this._syncing=true;return[4,this._doSync(t)];case 1:n.sent();return[2]}}))}))};AbstractMediaStateSynchronizer.prototype._doSync=function(e){return ji(this,void 0,void 0,(function(){var t;return xi(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,3,4]);this._logger.log("going to do sync.");return[4,this._doSyncInternal(e)];case 1:n.sent();this._cleanRetry();this._logger.log("sync done successfully.");return[3,4];case 2:t=n.sent();this._logger.log("sync failed, error=",JSON.stringify(t));if(this._needScheduleRetry()){this._scheduleRetry()}return[3,4];case 3:this._syncing=false;if(this._pendingSync){this._pendingSync=false;this.startSync(true)}return[7];case 4:return[2]}}))}))};AbstractMediaStateSynchronizer.prototype.stop=function(){this._stopped=true;this._cleanRetry()};AbstractMediaStateSynchronizer.prototype.resume=function(){this._stopped=false};AbstractMediaStateSynchronizer.prototype.close=function(){this.stop();delete this._dataProvider};AbstractMediaStateSynchronizer.prototype._customizeLog=function(e){this._logger=r.k.tags(e)};AbstractMediaStateSynchronizer.prototype._needScheduleRetry=function(){this._logger.log("sync failed, check if we need to retry, current job=",this._currentRetryJob," pending sync=",this._pendingSync," stopped=",this._stopped);return this._needRetry&&!this._currentRetryJob&&!this._stopped&&!this._pendingSync};AbstractMediaStateSynchronizer.prototype._scheduleRetry=function(){var e=this;var t=Math.min(this._initialRetryInterval+this._failedCount*this._intervalStepSize,this._maxRetryInterval);this._logger.log("retry sync job with interval=",t," failed times=",this._failedCount);this._currentRetryJob=setTimeout((function(){e._currentRetryJob=undefined;e.startSync(false)}),t);this._failedCount++};AbstractMediaStateSynchronizer.prototype._cleanRetry=function(){this._failedCount=0;this._currentRetryJob&&clearTimeout(this._currentRetryJob);this._currentRetryJob=undefined};AbstractMediaStateSynchronizer.prototype._meetingInfoIds=function(){var e=this._dataProvider();if(!e){return undefined}var t=e.remoteSelfMeetingEntityIds();return{bridgeId:e.bridgeId(),meetingId:t.meetingInfoId,participantId:t.participantId,sessionId:t.sessionId,streamId:t.streamId}};return AbstractMediaStateSynchronizer}();var Yi=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ki=undefined&&undefined.__assign||function(){Ki=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Ki.apply(this,arguments)};var Qi=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Wi=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Ji=function(e){Yi(SessionStateSynchronizer,e);function SessionStateSynchronizer(t){var n=e.call(this,t)||this;n._customizeLog("[Local Media Actions]"+SessionStateSynchronizer.name);return n}SessionStateSynchronizer.prototype._syncPayload=function(e){var t=this._dataProvider();if(!t){return undefined}var n;var r=t.getLocalState();var i=t.getLocalSessionInfo();if(!r||!i){return undefined}if(e||r.media.videoMute!==i.localMuteVideo){n=Ki(Ki({},n),{localMuteVideo:r.media.videoMute})}if(e||r.media.audioMute!==i.localMute){n=Ki(Ki({},n),{localMute:r.media.audioMute})}return n};SessionStateSynchronizer.prototype._doSyncInternal=function(e){return Qi(this,void 0,void 0,(function(){var t,n;return Wi(this,(function(r){switch(r.label){case 0:t=this._meetingInfoIds();n=t;if(!n)return[3,2];return[4,i.RCVEApi.updateSession(e,t)];case 1:n=r.sent();r.label=2;case 2:n;return[2]}}))}))};SessionStateSynchronizer.prototype.shouldTriggerSync=function(e){return e.audioMute!==undefined||e.videoMute!==undefined};return SessionStateSynchronizer}(qi);var zi=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var $i=undefined&&undefined.__assign||function(){$i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return $i.apply(this,arguments)};var Xi=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Zi=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var eo=function(e){zi(StreamStateSynchronizer,e);function StreamStateSynchronizer(t){var n=e.call(this,t)||this;n._customizeLog("[Local Media Actions]"+StreamStateSynchronizer.name);return n}StreamStateSynchronizer.prototype._syncPayload=function(e){var t=this._dataProvider();if(!t){return undefined}var n;var r=t.getLocalState();var i=t.getLocalStreamInfo();if(!r||!i){return undefined}if(e||!i.audio||r.media.audioJoined!==i.audio.isActiveIn){n=$i($i({},n),{audio:{isActiveIn:r.media.audioJoined,isActiveOut:r.media.audioJoined}})}return n};StreamStateSynchronizer.prototype._doSyncInternal=function(e){return Xi(this,void 0,void 0,(function(){var t,n;return Zi(this,(function(r){switch(r.label){case 0:t=this._meetingInfoIds();n=t;if(!n)return[3,2];return[4,i.RCVEApi.updateStream(e,t)];case 1:n=r.sent();r.label=2;case 2:n;return[2]}}))}))};StreamStateSynchronizer.prototype.shouldTriggerSync=function(e){return e.audioJoined!==undefined};return StreamStateSynchronizer}(qi);var to=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var no=undefined&&undefined.__assign||function(){no=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return no.apply(this,arguments)};var ro=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var io=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var oo=function(e){to(ParticipantStateSynchronizer,e);function ParticipantStateSynchronizer(t){var n=e.call(this,t)||this;n._customizeLog("[Local Media Actions]"+ParticipantStateSynchronizer.name);return n}ParticipantStateSynchronizer.prototype._syncPayload=function(e){var t=this._dataProvider();if(!t||!e){return undefined}var n;var r=t.getLocalState();var i=t.getLocalParticipantInfo();if(!r||!i){return undefined}if(!r.media.audioMute&&i.serverMute===true){n=no(no({},n),{serverMute:false})}if(!r.media.videoMute&&i.serverMuteVideo===true){n=no(no({},n),{serverMuteVideo:false})}return n};ParticipantStateSynchronizer.prototype._doSyncInternal=function(e){return ro(this,void 0,Promise,(function(){var t,n;return io(this,(function(r){switch(r.label){case 0:t=this._meetingInfoIds();n=t;if(!n)return[3,2];return[4,i.RCVEApi.updateParticipant(e,t)];case 1:n=r.sent();r.label=2;case 2:n;return[2]}}))}))};ParticipantStateSynchronizer.prototype.shouldTriggerSync=function(e){return e.audioMute===false||e.videoMute===false};return ParticipantStateSynchronizer}(qi);var ao=undefined&&undefined.__assign||function(){ao=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return ao.apply(this,arguments)};var so=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var lo=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var uo=r.k.tags("[Local Media Actions]");var co=function(){function LocalMediaController(e){this._context=e;this._stateSynchronizers=[];this._syncable=false;this._executingAsyncOperation=[];this._registerSynchronizers()}LocalMediaController.prototype.startSyncMediaState=function(){uo.log("start sync media state");this._syncable=true;this._stateSynchronizers.forEach((function(e){return e.resume()}));this._triggerSync()};LocalMediaController.prototype.stopSyncMediaState=function(){uo.log("stop sync media state");this._syncable=false;this._stateSynchronizers.forEach((function(e){return e.stop()}))};LocalMediaController.prototype.close=function(){var e=this;setTimeout((function(){stopStream(e._localMediaStream)}));this._syncable=false;this._stateSynchronizers.forEach((function(e){return e.close()}));this._stateSynchronizers=[];delete this._context};LocalMediaController.prototype.muteAudio=function(){var e;uo.log("mute audio");(e=this._context.demandController())===null||e===void 0?void 0:e.cancelDemand(ve.cZ.UNMUTE_DEMAND);this._localMediaStream&&changeTracksEnableState(this._localMediaStream,"audio",false);this._updateMediaStateAndSync({audioMute:true})};LocalMediaController.prototype.unmuteAudio=function(){var e;uo.log("unmute audio");if(!this._allowUnmute(c.oZ.AUDIO)){uo.warn("unmute audio be called but unmute is not allowed now.");return}(e=this._context.demandController())===null||e===void 0?void 0:e.cancelDemand(ve.cZ.UNMUTE_DEMAND);this._localMediaStream&&changeTracksEnableState(this._localMediaStream,"audio",true);this._updateMediaStateAndSync({audioMute:false})};LocalMediaController.prototype.switchAudio=function(e){var t,n;return so(this,void 0,void 0,(function(){var r;return lo(this,(function(i){switch(i.label){case 0:uo.log("switch audio source, constraints=",e);return[4,(t=this._context.requestMediaController())===null||t===void 0?void 0:t.requestUserMedia(Cr.SWITCH_AUDIO,e)];case 1:r=i.sent();this._ensureValidStream(r);changeTracksEnableState(r,"audio",!this._checkLocalMute(c.oZ.AUDIO));this._localMediaStream&&replaceStreamTracks(this._localMediaStream,r,"audio");this._syncable&&((n=this._context.mediaController())===null||n===void 0?void 0:n.switchAudio(r));return[2]}}))}))};LocalMediaController.prototype.switchVideo=function(e){var t,n;return so(this,void 0,void 0,(function(){var r;return lo(this,(function(i){switch(i.label){case 0:uo.log("switch video source, constraints=",e);if(this._checkLocalMute(c.oZ.VIDEO)){uo.log("switch video source when video is muted, skip actual action");return[2]}return[4,(t=this._context.requestMediaController())===null||t===void 0?void 0:t.requestUserMedia(Cr.SWITCH_VIDEO,e)];case 1:r=i.sent();this._ensureValidStream(r);this._localMediaStream&&replaceStreamTracks(this._localMediaStream,r,"video");this._syncable&&((n=this._context.mediaController())===null||n===void 0?void 0:n.switchVideo(r));return[2]}}))}))};LocalMediaController.prototype.muteVideo=function(){var e,t;uo.log("mute video");if(this._isAsyncMediaOperationExecuting(c.oZ.VIDEO)){uo.warn("mute video but another async video operation executing, skip.");return}(e=this._context.demandController())===null||e===void 0?void 0:e.cancelDemand(ve.cZ.UNMUTE_VIDEO_DEMAND);this._localMediaStream&&stopAndRemoveTrackByKind(this._localMediaStream,"video");(t=this._context.mediaController())===null||t===void 0?void 0:t.muteVideo();this._updateMediaStateAndSync({videoMute:true})};LocalMediaController.prototype.unmuteVideo=function(){var e,t,n;return so(this,void 0,void 0,(function(){var r,i;return lo(this,(function(o){switch(o.label){case 0:uo.log("unmute video");if(!this._allowUnmute(c.oZ.VIDEO)){uo.warn("unmute audio be called but unmute is not allowed now.");return[2]}if(this._isAsyncMediaOperationExecuting(c.oZ.VIDEO)){uo.warn("unmute video but another video operation executing, skip.");return[2]}this._startAsyncMediaOperation(c.oZ.VIDEO);o.label=1;case 1:o.trys.push([1,3,,4]);return[4,(e=this._context.requestMediaController())===null||e===void 0?void 0:e.requestUserMedia(Cr.SWITCH_VIDEO)];case 2:r=o.sent();return[3,4];case 3:i=o.sent();this._stopAsyncMediaOperation(c.oZ.VIDEO);throw i;case 4:this._ensureValidStream(r);(t=this._context.demandController())===null||t===void 0?void 0:t.cancelDemand(ve.cZ.UNMUTE_VIDEO_DEMAND);this._localMediaStream&&replaceStreamTracks(this._localMediaStream,r,"video");this._syncable&&((n=this._context.mediaController())===null||n===void 0?void 0:n.unmuteVideo(r));this._updateMediaStateAndSync({videoMute:false});this._stopAsyncMediaOperation(c.oZ.VIDEO);return[2]}}))}))};LocalMediaController.prototype.joinAudio=function(){var e,t;return so(this,void 0,void 0,(function(){var n;return lo(this,(function(r){switch(r.label){case 0:uo.log("join audio");return[4,(e=this._context.requestMediaController())===null||e===void 0?void 0:e.requestUserAudioMedia(true,this._checkLocalMute(c.oZ.AUDIO))];case 1:n=r.sent();this._ensureValidStream(n);this._localMediaStream&&replaceStreamTracks(this._localMediaStream,n,"audio");this._syncable&&((t=this._context.mediaController())===null||t===void 0?void 0:t.joinAudio(n));this._updateMediaStateAndSync({audioJoined:true});return[2]}}))}))};LocalMediaController.prototype.leaveAudio=function(){var e;uo.log("leave audio");this._localMediaStream&&stopAndRemoveTrackByKind(this._localMediaStream,"audio");this._syncable&&((e=this._context.mediaController())===null||e===void 0?void 0:e.leaveAudio());this._updateMediaStateAndSync({audioJoined:false})};LocalMediaController.prototype.initializeMedia=function(e,t,n){if(n===void 0){n=false}var r=e.getVideoTracks().length>0;var i=e.getAudioTracks().length>0;var o=e.getAudioTracks().some((function(e){return e.enabled===false}));var a={audioJoined:i?t:false,audioMute:i?o:n,videoMute:!r};a&&this._updateMediaStateAndSync(a);this._localMediaStream=e};LocalMediaController.prototype.getLocalMediaStream=function(){return this._localMediaStream};LocalMediaController.prototype.currentMediaState=function(){var e;var t=this._context.dataProvider();if(!t){return undefined}return(e=t.getLocalState())===null||e===void 0?void 0:e.media};LocalMediaController.prototype._registerSynchronizers=function(){var e={dataProvider:this._context.dataProvider};this._stateSynchronizers.push(new Ji(e));this._stateSynchronizers.push(new eo(e));this._stateSynchronizers.push(new oo(ao(ao({},e),{needRetry:false})))};LocalMediaController.prototype._updateMediaStateAndSync=function(e){var t={media:e};var n=this._context.dataProvider();n&&n.handleNewLocalState(t);this._syncable&&this._triggerSync(e)};LocalMediaController.prototype._triggerSync=function(e){this._stateSynchronizers.forEach((function(t){var n=e?t.shouldTriggerSync(e):true;var r=e?true:false;n&&t.startSync(r)}))};LocalMediaController.prototype._checkLocalMute=function(e){var t;var n=(t=this._context.dataProvider())===null||t===void 0?void 0:t.getLocalState();if(!n){return true}switch(e){case c.oZ.AUDIO:return n.media.audioMute;case c.oZ.VIDEO:return n.media.videoMute;default:return true}};LocalMediaController.prototype._allowUnmute=function(e){var t;var n=(t=this._context.dataProvider())===null||t===void 0?void 0:t.getLocalParticipantInfo();if(!n){return false}switch(e){case c.oZ.AUDIO:return n.allowUnmute===undefined?true:n.allowUnmute;case c.oZ.VIDEO:return n.allowUnmuteVideo===undefined?true:n.allowUnmuteVideo;default:return false}};LocalMediaController.prototype._ensureValidStream=function(e){if(!e){throw new Yn.cn("can not get stream due to no request media controller")}};LocalMediaController.prototype._startAsyncMediaOperation=function(e){this._executingAsyncOperation.push(e)};LocalMediaController.prototype._stopAsyncMediaOperation=function(e){this._executingAsyncOperation=this._executingAsyncOperation.filter((function(t){return t!==e}))};LocalMediaController.prototype._isAsyncMediaOperationExecuting=function(e){return this._executingAsyncOperation.includes(e)};return LocalMediaController}();var fo=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var po=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var ho=function(){function ValueHolder(){}ValueHolder.prototype.getValue=function(){return this._value};ValueHolder.prototype.awaitValue=function(){return fo(this,void 0,Promise,(function(){return po(this,(function(e){switch(e.label){case 0:if(!(this._value===undefined))return[3,2];return[4,this._getBarrier()];case 1:e.sent();return[2,this._value];case 2:return[2,this._value]}}))}))};ValueHolder.prototype.reject=function(){this._rejectPromise&&this._rejectPromise();delete this._promise;delete this._completePromise;delete this._rejectPromise};ValueHolder.prototype.resolve=function(e){this._value=e;if(this._completePromise){this._completePromise();delete this._promise;delete this._rejectPromise;delete this._completePromise}};ValueHolder.prototype.reset=function(){this.reject();delete this._value};ValueHolder.prototype._getBarrier=function(){var e=this;if(!this._promise){this._promise=new Promise((function(t,n){e._completePromise=t;e._rejectPromise=n}))}return this._promise};return ValueHolder}();var _o=n(325719);var vo=n(390582);var go=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var yo=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var mo=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var So=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return o};var Co=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(So(arguments[t]));return e};var Eo;(function(e){e["FIELD_CHANGE"]="FIELD_CHANGE";e["LIST_ITEM_ADD"]="LIST_ITEM_ADD";e["LIST_ITEM_DELETE"]="LIST_ITEM_DELETE"})(Eo||(Eo={}));var bo=function(){function BaseObservableEntity(e,t){this._emitter=t;this._customSetterMap=new Map;this._disposeList=[];this.$initCustomSetter();this.$update(e)}BaseObservableEntity.prototype.$update=function(e){var t=this;Object.entries(e).forEach((function(e){var n=So(e,2),r=n[0],i=n[1];if(t._customSetterMap.has(r)){t[r]=t._customSetterMap.get(r)(i)}else{t[r]=i}}))};BaseObservableEntity.prototype.$initCustomSetter=function(){};BaseObservableEntity.prototype.$reaction=function(e,t,n){var r=(0,_o.reaction)(e,t,n);this.$addDisposer(r);return r};BaseObservableEntity.prototype.$reactionFieldChange=function(e){var t=this;this.$reaction((function(){return t[e]}),(function(n){t._emitter.emit(t.$getName()+"."+Eo.FIELD_CHANGE+"."+e,{id:t["id"],key:e,value:n})}))};BaseObservableEntity.prototype.$addChildObservableEntity=function(e){this.$addDisposer((function(){return e.$dispose()}));return e};BaseObservableEntity.prototype.$addCustomSetter=function(e,t){this._customSetterMap.set(e,t)};BaseObservableEntity.prototype.$addObservableListField=function(e,t){var n=this;this.$addCustomSetter(e,(function(r){var i=n[e]||[];var o=vo.BB.comparator(r,i||[]);var a=o.added,s=o.updated,l=o.deleted;var u=Co(l,s.map((function(e){var t=i.find((function(t){return t.id===e.id}));t===null||t===void 0?void 0:t.$update(e);return t})),a.map((function(r){n._emitter.emit(n.$getName()+"."+Eo.LIST_ITEM_ADD+"."+e,{id:n["id"],itemId:r.id,deleted:r.deleted});var i=t(r);n.$addChildObservableEntity(i);n.$reaction((function(){return i["deleted"]}),(function(t){t&&n._emitter.emit(n.$getName()+"."+Eo.LIST_ITEM_DELETE+"."+e,{id:n["id"],itemId:r.id,deleted:t})}));return i})));return u}))};BaseObservableEntity.prototype.$addDisposer=function(e){this._disposeList.push(e);return e};BaseObservableEntity.prototype.$dispose=function(){this._disposeList=this._disposeList.filter((function(e){e();return false}))};return BaseObservableEntity}();var Io=function(e){go(ObservableMeetingInfo,e);function ObservableMeetingInfo(){return e!==null&&e.apply(this,arguments)||this}ObservableMeetingInfo.prototype.$getName=function(){return c.FY.ENTITY.MEETING_INFO};ObservableMeetingInfo.prototype.$initCustomSetter=function(){var e=this;this.$addObservableListField("participants",(function(t){return new Mo(t,e._emitter)}))};Object.defineProperty(ObservableMeetingInfo.prototype,"validParticipants",{get:function(){var e;return(e=this.participants)===null||e===void 0?void 0:e.filter((function(e){return!e.deleted})).map((function(e){return e["id"]}))},enumerable:true,configurable:true});yo([_o.observable,mo("design:type",String)],ObservableMeetingInfo.prototype,"id",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableMeetingInfo.prototype,"deleted",void 0);yo([_o.observable,mo("design:type",Array)],ObservableMeetingInfo.prototype,"participants",void 0);yo([_o.computed,mo("design:type",Object),mo("design:paramtypes",[])],ObservableMeetingInfo.prototype,"validParticipants",null);return ObservableMeetingInfo}(bo);var Mo=function(e){go(ObservableParticipantInfo,e);function ObservableParticipantInfo(){return e!==null&&e.apply(this,arguments)||this}ObservableParticipantInfo.prototype.$getName=function(){return c.FY.ENTITY.PARTICIPANT_INFO};ObservableParticipantInfo.prototype.$initCustomSetter=function(){var e=this;this.$reactionFieldChange("_hasAliveSession");this.$addObservableListField("sessions",(function(t){return new Ro(t,e._emitter)}))};Object.defineProperty(ObservableParticipantInfo.prototype,"_hasAliveSession",{get:function(){if(!this.sessions){return false}return this.sessions.filter((function(e){return!e.deleted})).length>0},enumerable:true,configurable:true});yo([_o.observable,mo("design:type",String)],ObservableParticipantInfo.prototype,"id",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableParticipantInfo.prototype,"deleted",void 0);yo([_o.observable,mo("design:type",Array)],ObservableParticipantInfo.prototype,"sessions",void 0);yo([_o.observable,mo("design:type",Array)],ObservableParticipantInfo.prototype,"streams",void 0);yo([_o.observable,mo("design:type",Array)],ObservableParticipantInfo.prototype,"dials",void 0);yo([_o.observable,mo("design:type",Array)],ObservableParticipantInfo.prototype,"demands",void 0);yo([_o.computed,mo("design:type",Object),mo("design:paramtypes",[])],ObservableParticipantInfo.prototype,"_hasAliveSession",null);return ObservableParticipantInfo}(bo);var Ro=function(e){go(ObservableSessionInfo,e);function ObservableSessionInfo(){return e!==null&&e.apply(this,arguments)||this}ObservableSessionInfo.prototype.$getName=function(){return c.FY.ENTITY.SESSION_INFO};yo([_o.observable,mo("design:type",String)],ObservableSessionInfo.prototype,"id",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableSessionInfo.prototype,"deleted",void 0);return ObservableSessionInfo}(bo);var To=function(e){go(ObservableStreamInfo,e);function ObservableStreamInfo(){return e!==null&&e.apply(this,arguments)||this}ObservableStreamInfo.prototype.$getName=function(){return c.FY.ENTITY.STREAM_INFO};var t;yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"id",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"bridgeId",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableStreamInfo.prototype,"localMute",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableStreamInfo.prototype,"localMuteVideo",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableStreamInfo.prototype,"serverMute",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableStreamInfo.prototype,"serverMuteVideo",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"userAgent",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"operatingSystem",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"locale",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"token",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableStreamInfo.prototype,"justCreated",void 0);yo([_o.observable,mo("design:type",typeof(t=typeof ve.PingInfo!=="undefined"&&ve.PingInfo)==="function"?t:Object)],ObservableStreamInfo.prototype,"pingInfo",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"notificationSubKey",void 0);yo([_o.observable,mo("design:type",String)],ObservableStreamInfo.prototype,"notificationToken",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableStreamInfo.prototype,"deleted",void 0);yo([_o.observable,mo("design:type",Number)],ObservableStreamInfo.prototype,"deleteReason",void 0);return ObservableStreamInfo}(bo);var Oo=function(e){go(ObservableDialInfo,e);function ObservableDialInfo(){return e!==null&&e.apply(this,arguments)||this}ObservableDialInfo.prototype.$getName=function(){return c.FY.ENTITY.DIAL_INFO};var t;yo([_o.observable,mo("design:type",String)],ObservableDialInfo.prototype,"id",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableDialInfo.prototype,"deleted",void 0);yo([_o.observable,mo("design:type",String)],ObservableDialInfo.prototype,"number",void 0);yo([_o.observable,mo("design:type",String)],ObservableDialInfo.prototype,"callerId",void 0);yo([_o.observable,mo("design:type",String)],ObservableDialInfo.prototype,"calleeId",void 0);yo([_o.observable,mo("design:type",typeof(t=typeof ve.nO!=="undefined"&&ve.nO)==="function"?t:Object)],ObservableDialInfo.prototype,"status",void 0);return ObservableDialInfo}(bo);var Ao=function(e){go(ObservableDemandInfo,e);function ObservableDemandInfo(){return e!==null&&e.apply(this,arguments)||this}ObservableDemandInfo.prototype.$getName=function(){return c.FY.ENTITY.DEMAND_INFO};var t;yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"id",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"bridgeId",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"meetingId",void 0);yo([_o.observable,mo("design:type",Object)],ObservableDemandInfo.prototype,"info",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"participantId",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"sessionId",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"status",void 0);yo([_o.observable,mo("design:type",typeof(t=typeof ve.cZ!=="undefined"&&ve.cZ)==="function"?t:Object)],ObservableDemandInfo.prototype,"type",void 0);yo([_o.observable,mo("design:type",Object)],ObservableDemandInfo.prototype,"resource",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"createTime",void 0);yo([_o.observable,mo("design:type",Array)],ObservableDemandInfo.prototype,"grant",void 0);yo([_o.observable,mo("design:type",Boolean)],ObservableDemandInfo.prototype,"deleted",void 0);yo([_o.observable,mo("design:type",String)],ObservableDemandInfo.prototype,"deletedBy",void 0);yo([_o.observable,mo("design:type",Array)],ObservableDemandInfo.prototype,"decisions",void 0);return ObservableDemandInfo}(bo);var Po=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var No=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var wo=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Do=r.k.tags("[debug]");var ko;(function(e){e["BeforeDataCreated"]="OnDataCreated";e["AfterDataCreated"]="AfterDataCreated";e["AfterDataInit"]="AfterDataInit";e["BeforeDataClear"]="BeforeDataClear";e["AfterDataClear"]="AfterDataClear"})(ko||(ko={}));var Lo=function(e){Po(ObservableMeetingInfoEntityController,e);function ObservableMeetingInfoEntityController(t){var n=e.call(this,t,"ENTITY.OBSERVABLE_MEETING_INFO")||this;n._disposeList=[];n._emitter=new D.EventEmitter2;n._lifeCycleEmitter=new D.EventEmitter2;return n}ObservableMeetingInfoEntityController.prototype._createMeetingInfo=function(e){this._destoryMeetingInfo();this._enterLifeCycle(ko.BeforeDataCreated);this._meetingInfo=new Io(e,this._emitter);this._enterLifeCycle(ko.AfterDataCreated)};ObservableMeetingInfoEntityController.prototype._initObserve=function(){var e=this;this.addDisposer((0,_o.reaction)((function(){return e._meetingInfo.validParticipants.length}),(function(){Do.log("validParticipants change",e._meetingInfo.validParticipants)})))};ObservableMeetingInfoEntityController.prototype.addDisposer=function(e){this._disposeList.push(e);return e};ObservableMeetingInfoEntityController.prototype._destoryMeetingInfo=function(){if(this._meetingInfo){this._enterLifeCycle(ko.BeforeDataClear);this._meetingInfo.$dispose();this.disposeAll();delete this._meetingInfo;this._enterLifeCycle(ko.AfterDataClear)}};ObservableMeetingInfoEntityController.prototype._enterLifeCycle=function(e){this._lifeCycleEmitter.emit(e)};ObservableMeetingInfoEntityController.prototype.disposeAll=function(){this._disposeList=this._disposeList.filter((function(e){e();return false}))};ObservableMeetingInfoEntityController.prototype.clear=function(){return No(this,void 0,void 0,(function(){return wo(this,(function(t){switch(t.label){case 0:this._lifeCycleEmitter.removeAllListeners();this.disposeAll();return[4,e.prototype.clear.call(this)];case 1:t.sent();return[2]}}))}))};ObservableMeetingInfoEntityController.prototype.extractHandleData=function(e){return e};ObservableMeetingInfoEntityController.prototype.onHandleData=function(e,t){var n=false;if(t||!this._meetingInfo){n=true;this._createMeetingInfo(e)}this._meetingInfo.$update(e);if(n){this._initObserve();this._enterLifeCycle(ko.AfterDataInit)}return null};ObservableMeetingInfoEntityController.prototype.onLifeCycle=function(e,t){return this._lifeCycleEmitter.on(e,t)};ObservableMeetingInfoEntityController.prototype.on=function(e,t){var n=this;this._emitter.on(e,t);return this.addDisposer((function(){return n._emitter.off(e,t)}))};ObservableMeetingInfoEntityController.prototype.onFieldChange=function(e,t,n){return this.on(e+"."+Eo.FIELD_CHANGE+"."+t,n)};ObservableMeetingInfoEntityController.prototype.onListItemAdded=function(e,t,n){return this.on(e+"."+Eo.LIST_ITEM_ADD+"."+t,n)};ObservableMeetingInfoEntityController.prototype.onListItemDeleted=function(e,t,n){return this.on(e+"."+Eo.LIST_ITEM_DELETE+"."+t,n)};return ObservableMeetingInfoEntityController}(u);var Fo=r.k.tags("[MeetingInfo][Observe]");var Vo=function(){function MeetingInfoObserverController(e,t){var n=this;this._identify=e;this._meetingUpdateController=t;this._controller=new Lo(this._identify);this._controller.onLifeCycle(ko.BeforeDataCreated,(function(){n._controller.onFieldChange(c.FY.ENTITY.PARTICIPANT_INFO,"_hasAliveSession",(function(e){var t=e.id,r=e.value;var i;Fo.log("Participant._hasAliveSession changed: ",t,r);(i=n._meetingUpdateController())===null||i===void 0?void 0:i.sendLocalEntityPartialChange({id:t,_hasAliveSession:r},c.FY.ENTITY.PARTICIPANT_INFO)}))}));this._controller.onLifeCycle(ko.AfterDataInit,(function(){n._controller.onListItemAdded(c.FY.ENTITY.PARTICIPANT_INFO,"sessions",(function(e){!e.deleted&&Fo.log("session added: ",e)}));n._controller.onListItemDeleted(c.FY.ENTITY.PARTICIPANT_INFO,"sessions",(function(e){Fo.log("session deleted:",e)}))}))}MeetingInfoObserverController.prototype.getEntityController=function(){return this._controller};return MeetingInfoObserverController}();var Uo=undefined&&undefined.__assign||function(){Uo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};return Uo.apply(this,arguments)};var jo=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var xo=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var Ho=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Go=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Bo,qo;var Yo=r.k.tags("[ActiveMeetingController]");var Ko=(0,It.createLogDecorator)(Yo.tags("[EXECUTE_LOG]"));var Qo=(Bo={},Bo[Rn.EVENTS.SIGNAL.INIT]=p.hj.INIT,Bo[Rn.EVENTS.SIGNAL.CONNECTED]=p.hj.CONNECTED,Bo[Rn.EVENTS.SIGNAL.CONNECTING]=p.hj.CONNECTING,Bo[Rn.EVENTS.SIGNAL.DISCONNECTED]=p.hj.DISCONNECTED,Bo[Rn.EVENTS.SIGNAL.RECONNECTING]=p.hj.RECONNECTING,Bo[Rn.EVENTS.SIGNAL.TERMINATING]=p.hj.TERMINATING,Bo[Rn.EVENTS.SIGNAL.TERMINATED]=p.hj.TERMINATED,Bo);var Wo=(qo={},qo[Rn.EVENTS.PEER.INIT]=p.hj.INIT,qo[Rn.EVENTS.PEER.CONNECTED]=p.hj.CONNECTED,qo[Rn.EVENTS.PEER.CONNECTING]=p.hj.CONNECTING,qo[Rn.EVENTS.PEER.DISCONNECTED]=p.hj.DISCONNECTED,qo[Rn.EVENTS.PEER.RECONNECTING]=p.hj.RECONNECTING,qo[Rn.EVENTS.PEER.TERMINATING]=p.hj.TERMINATING,qo[Rn.EVENTS.PEER.TERMINATED]=p.hj.TERMINATED,qo);var Jo=function(){function ActiveMeetingController(e,t){var n=this;this._userConfig=e;this._activeMeetingOptions=t;this._cleanOldData=function(){return Ho(n,void 0,void 0,(function(){var e,t;var n,r,o,a,s;return Go(this,(function(l){switch(l.label){case 0:(n=this._meetingUpdateController)===null||n===void 0?void 0:n.onStartMeetingRecover();this._localMediaController.stopSyncMediaState();(r=this._sessionPingController)===null||r===void 0?void 0:r.stop();(o=this._mediaController)===null||o===void 0?void 0:o.close();(a=this._pubnubSubscriber)===null||a===void 0?void 0:a.clean();return[4,(s=this._actionController)===null||s===void 0?void 0:s.stopScreenSharing(true)];case 1:l.sent();e=this._meetingStatusController.meetingIdInfo;if(!(e.bridgeId&&e.meetingId&&e.sessionId))return[3,5];l.label=2;case 2:l.trys.push([2,4,,5]);return[4,i.RCVEApi.deleteSession(e)];case 3:l.sent();return[3,5];case 4:t=l.sent();Yo.error("delete session error:",t);return[3,5];case 5:delete this._sessionPingController;delete this._mediaController;delete this._pubnubSubscriber;return[2]}}))}))};this._onMeetingEnded=function(e){n._endMeetingHandler&&n._endMeetingHandler(n._meetingDataProvider.localIdentifier(),e)};this._signalSocketInfoHolder=new ho;this._isInitStreamEnabled=new ho;this._meetingEventManager=new Ui;this._meetingDataProvider=new Ue;this._observableMeetingController=new Vo(this._meetingDataProvider.localIdentifier(),(function(){return n._meetingUpdateController}));this._meetingDataProvider.addMeetingEntityController(this._observableMeetingController.getEntityController());this._meetingEventManager.setId(this._meetingDataProvider.localIdentifier());this._meetingStatusController=new sr({localIdentifier:this._meetingDataProvider.localIdentifier()});this._initializeUpdateController();this._callController=new ii({getMeetingIds:function(){var e;return(e=n._meetingStatusController)===null||e===void 0?void 0:e.meetingIdInfo},getRCVEUserConfig:function(){return n._userConfig},getMeetingUpdateController:function(){return n._meetingUpdateController}});this._registerUpdatePrehandler();this._actionEnableBarrier=new It.Barrier;this._meetingReconnectionController=new nr(this._cleanOldData,(function(){return n.connectToMeeting(Uo(Uo({},n._options),{type:je.wJ.REJOIN}))}),(function(){n._onMeetingEnded(c.MH.RECOVERY_LIMIT_HIT)}));this._localMediaController=new co({dataProvider:function(){return n._meetingDataProvider},statusController:function(){return n._meetingStatusController},requestMediaController:function(){return n.requestMediaController},mediaController:function(){return n._mediaController},demandController:function(){return n._demandController}})}ActiveMeetingController.prototype._mergeActiveMeetingOptions=function(e,t){var n=["withLocalData","media","chat","dial"];n.forEach((function(n){if(e[n]!==undefined){t[n]=e[n]}else if(t[n]!==undefined){e[n]=t[n]}}))};Object.defineProperty(ActiveMeetingController.prototype,"meetingDataProvider",{get:function(){return this._meetingDataProvider},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"actionController",{get:function(){return this._actionController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"streamQualityController",{get:function(){var e=this;if(!this._streamQualityController){this._streamQualityController=new qn({getMediaController:function(){return e._mediaController},getDataProvider:function(){return e._meetingDataProvider}})}return this._streamQualityController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"updateController",{get:function(){return this._meetingUpdateController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"callController",{get:function(){return this._callController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"demandController",{get:function(){return this._demandController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"localMediaController",{get:function(){return this._localMediaController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"requestMediaController",{get:function(){if(!this._requestMediaController){this._requestMediaController=new Er}return this._requestMediaController},enumerable:true,configurable:true});Object.defineProperty(ActiveMeetingController.prototype,"endMeetingHandler",{set:function(e){this._endMeetingHandler=e},enumerable:true,configurable:true});ActiveMeetingController.prototype.initLocalMeetingData=function(e){return Ho(this,void 0,void 0,(function(){var t,n,r;return Go(this,(function(i){switch(i.label){case 0:if(!e)return[3,2];t=(0,o.getCurrentAccount)();return[4,t.getUserInfo()];case 1:n=i.sent();this._meetingDataProvider.initLocalMeetingInfo(n?n.name:"");this._meetingStatusController.setLocalSelfEntityIds(this._meetingDataProvider.localSelfMeetingEntityIds());i.label=2;case 2:r=this._meetingStatusController.localSelfEntityIds.meetingInfoId;return[2,{identifier:this._meetingDataProvider.localIdentifier(),meetingInfoId:r||""}]}}))}))};ActiveMeetingController.prototype._shouldBeRejoin=function(e){return[It.ERROR_CODES_NETWORK.GENERAL,It.ERROR_CODES_NETWORK.NOT_NETWORK,It.ERROR_CODES_NETWORK.LOCAL_TIMEOUT,It.ERROR_CODES_NETWORK.NETWORK_ERROR,It.ERROR_CODES_NETWORK.SERVICE_UNAVAILABLE].includes(e.code)};ActiveMeetingController.prototype.connectToMeeting=function(e){return Ho(this,void 0,void 0,(function(){var t;return Go(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,5]);return[4,this._connectToMeeting(e)];case 1:n.sent();this._meetingReconnectionController.afterConnected();return[3,5];case 2:t=n.sent();if(!this._shouldBeRejoin(t))return[3,4];Yo.info("rejoin by err:",t);this._meetingReconnectionController.reset();return[4,this._meetingReconnectionController.reJoin()];case 3:n.sent();return[2];case 4:this._onMeetingEnded((0,Yn.$T)(t));throw t;case 5:return[2]}}))}))};ActiveMeetingController.prototype.connectTap=function(e){var t,n,r,i,o;return Ho(this,void 0,void 0,(function(){var a,s,l,u,c,d,f;return Go(this,(function(h){switch(h.label){case 0:this._isInitStreamEnabled.resolve(true);if(!((e===null||e===void 0?void 0:e.type)===je.wJ.CALL))return[3,2];return[4,this._startVideoCall(e)];case 1:if(!h.sent()){return[2]}h.label=2;case 2:h.trys.push([2,4,,5]);return[4,this._obtainMeetingInfo(e)];case 3:a=h.sent();return[3,5];case 4:s=h.sent();if(!(s instanceof Yn.Sj)){Yo.warn("error occur when request basic meeting info.",s)}throw s;case 5:l=a.meetingInfo,u=a.bridgeInfo;this._meetingStatusController.setMeetingStatus("request",p.hj.CONNECTED);c=(t=l.participants)===null||t===void 0?void 0:t.find((function(e){return e.justCreated}));d=(n=c===null||c===void 0?void 0:c.sessions)===null||n===void 0?void 0:n.find((function(e){return e.justCreated}));f=(r=c===null||c===void 0?void 0:c.streams)===null||r===void 0?void 0:r.find((function(e){return e.justCreated}));this._meetingStatusController.setMeetingIdInfo({bridgeId:u.id,meetingId:l.id,participantId:c===null||c===void 0?void 0:c.id,sessionId:d===null||d===void 0?void 0:d.id,streamId:f===null||f===void 0?void 0:f.id,shortId:u===null||u===void 0?void 0:u.shortId});this._signalSocketInfoHolder.resolve({shortId:u.shortId,socketToken:(d===null||d===void 0?void 0:d.token)||"",socketUrl:l.wsConnectionUrl||""});this._meetingDataProvider.handleData(l,true);this._localMediaController.startSyncMediaState();(i=this._meetingUpdateController)===null||i===void 0?void 0:i.onMeetingConnected();this._startSessionPing(((o=d===null||d===void 0?void 0:d.pingInfo)===null||o===void 0?void 0:o.pingInterval)||1e4);this._subscribeToPunNubChannel((d===null||d===void 0?void 0:d.notificationSubKey)||"",(d===null||d===void 0?void 0:d.notificationToken)||"",l.channelInfo);return[2,a]}}))}))};ActiveMeetingController.prototype.connectMedia=function(e){return Ho(this,void 0,void 0,(function(){var t,n,r,i;return Go(this,(function(o){switch(o.label){case 0:this._mergeActiveMeetingOptions({media:true},this._activeMeetingOptions);return[4,this._signalSocketInfoHolder.awaitValue()];case 1:t=o.sent(),n=t.shortId,r=t.socketToken,i=t.socketUrl;return[4,this._connectMedia(n,r||"",i||"",e)];case 2:o.sent();return[2]}}))}))};ActiveMeetingController.prototype.initialMediaStream=function(e){return Ho(this,void 0,void 0,(function(){var t,n;return Go(this,(function(r){switch(r.label){case 0:if(!((e===null||e===void 0?void 0:e.type)!==je.wJ.REJOIN&&e.media))return[3,5];r.label=1;case 1:r.trys.push([1,4,,5]);return[4,this._isInitStreamEnabled.awaitValue()];case 2:t=r.sent();if(!t){return[2]}this.requestMediaController.isEnableHD=!!e.isEnableHD;return[4,this._initialMediaStream(e)];case 3:r.sent();return[3,5];case 4:n=r.sent();this._onMeetingEnded((0,Yn.$T)(n));throw n;case 5:return[2]}}))}))};ActiveMeetingController.prototype._connectToMeeting=function(e){return Ho(this,void 0,void 0,(function(){var t;return Go(this,(function(n){switch(n.label){case 0:this._mergeActiveMeetingOptions(e,this._activeMeetingOptions);this._options=e;Yo.log("connect to meeting, options=",e);this._isInitStreamEnabled.resolve(!!e.media);return[4,this.initialMediaStream(e)];case 1:n.sent();return[4,this.connectTap(e)];case 2:n.sent();t=e.media;if(!t)return[3,4];return[4,this.connectMedia(e)];case 3:t=n.sent();n.label=4;case 4:t;this._enableMeetingAction();this._meetingStatusController.setMeetingStartTime(Date.now());return[2]}}))}))};Object.defineProperty(ActiveMeetingController.prototype,"meetingStatusController",{get:function(){return this._meetingStatusController},enumerable:true,configurable:true});ActiveMeetingController.prototype._obtainMeetingInfo=function(e){var t=this;var n=this._localMediaController.currentMediaState();var r={localMute:n?n.audioMute:true,localMuteVideo:n?n.videoMute:true};this._options.joinAudio=n?n.audioJoined:false;var i=new Yr({option:e,meetingDataProvider:this._meetingDataProvider,onBridgeInfoGet:function(e){t._meetingDataProvider.handleBridgeInfo(e)}},r);this._obtainMeetingInfoPipeline=i;return i.start()};ActiveMeetingController.prototype.leave=function(){return Ho(this,void 0,void 0,(function(){var e=this;return Go(this,(function(t){switch(t.label){case 0:return[4,this._quitMeeting((function(t){return Ho(e,void 0,void 0,(function(){return Go(this,(function(e){switch(e.label){case 0:if(!(t.bridgeId&&t.meetingId&&t.sessionId))return[3,2];return[4,i.RCVEApi.deleteSession(t)];case 1:e.sent();e.label=2;case 2:t.shortId&&(0,o.getModule)(Vr.oF).sendEndMeeting(t.shortId);return[2]}}))}))}))];case 1:t.sent();return[2]}}))}))};ActiveMeetingController.prototype.end=function(e){return Ho(this,void 0,void 0,(function(){var t;var n=this;return Go(this,(function(r){switch(r.label){case 0:t=e||this._meetingStatusController.isVideoCaller&&this._meetingStatusController.meetingStatus.request===p.hj.CONNECTING;Yo.log("[end meeting] user triggered?",e," needRequest=",t);return[4,this._quitMeeting((function(e){return Ho(n,void 0,void 0,(function(){return Go(this,(function(n){switch(n.label){case 0:if(!t)return[3,2];if(!(e.bridgeId&&e.meetingId))return[3,2];return[4,i.RCVEApi.endMeeting(e)];case 1:n.sent();n.label=2;case 2:e.shortId&&(0,o.getModule)(Vr.oF).sendEndMeeting(e.shortId);return[2]}}))}))}))];case 1:r.sent();return[2]}}))}))};ActiveMeetingController.prototype.cleanUpData=function(){var e,t,n,r,i,o,a,s,l,u;return Ho(this,void 0,void 0,(function(){return Go(this,(function(c){switch(c.label){case 0:Yo.log("[end meeting] start clean up meeting data");this._meetingReconnectionController.stop();(e=this._requestMediaController)===null||e===void 0?void 0:e.close();(t=this._mediaController)===null||t===void 0?void 0:t.close();(n=this._sessionPingController)===null||n===void 0?void 0:n.stop();(r=this._pubnubSubscriber)===null||r===void 0?void 0:r.clean();(i=this._meetingUpdateController)===null||i===void 0?void 0:i.stop();return[4,this._meetingDataProvider.clean()];case 1:c.sent();(o=this._streamQualityController)===null||o===void 0?void 0:o.close();(a=this._actionController)===null||a===void 0?void 0:a.close();this._meetingStatusController.close();this._meetingEventManager.cleanAll();(s=this._entityObserverController)===null||s===void 0?void 0:s.clean();this._localMediaController.close();delete this._mediaController;delete this._sessionPingController;delete this._pubnubSubscriber;delete this._meetingUpdateController;delete this._meetingDataProvider;delete this._streamQualityController;delete this._actionController;delete this._endMeetingHandler;delete this._meetingEventManager;delete this._demandController;delete this._entityObserverController;delete this._localMediaController;delete this._observableMeetingController;if(!((l=this._obtainMeetingInfoPipeline)===null||l===void 0?void 0:l.finished)){(u=this._obtainMeetingInfoPipeline)===null||u===void 0?void 0:u.dispose();delete this._obtainMeetingInfoPipeline}Yo.log("[end meeting] finish clean up meeting data");return[2]}}))}))};ActiveMeetingController.prototype.mixedAudioStreamId=function(){var e=this._meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.MEDIA_STREAM);return e.mixedAudioStreamId};ActiveMeetingController.prototype.waitActionEnable=function(){return this._actionEnableBarrier.wait()};ActiveMeetingController.prototype.registerEventListener=function(e,t){return this._meetingEventManager.listen(e,t)};ActiveMeetingController.prototype._subscribeToPunNubChannel=function(e,t,n){var r=this;if(n){var i={subscribeKey:e,authKey:t,origin:(0,c.d)(),restore:true,suppressLeaveEvents:true,heartbeatInterval:0};this._pubnubSubscriber=new cr(i);this._pubnubSubscriber.addMessageListener((function(e){var t;return(t=r._meetingUpdateController)===null||t===void 0?void 0:t.handleIncomingData({source:Pn.PUBNUB,data:e})}));this._pubnubSubscriber.subscribeChannel([n.channel])}};ActiveMeetingController.prototype._startSessionPing=function(e){var t=this._meetingStatusController.meetingIdInfo;var n={pingInterval:e,bridgeId:t.bridgeId,meetingId:t.meetingId,sessionId:t.sessionId,participantId:t.participantId};this._sessionPingController=new An(n)};ActiveMeetingController.prototype._connectMedia=function(e,t,n,r){var i;return Ho(this,void 0,void 0,(function(){var a,s,l,u,d;var f=this;return Go(this,(function(p){switch(p.label){case 0:a=this._meetingStatusController.meetingIdInfo;return[4,(0,o.getCurrentAccount)().getUserInfo()];case 1:s=p.sent();l={localIdentifier:a.localIdentifier||"",bridgeId:a.bridgeId||"",meetingId:a.meetingId||"",shortId:e,sessionId:a.sessionId||"",streamId:a.streamId||"",sessionToken:t,username:s?s.name:"",wsConnectionUrl:n,joinAudio:r.joinAudio};if(!!this._localMediaController.getLocalMediaStream())return[3,3];return[4,this._initialMediaStream(r)];case 2:p.sent();p.label=3;case 3:u=this._localMediaController.currentMediaState();d=this._localMediaController.getLocalMediaStream();u&&(l.joinAudio=u.audioJoined);if(!this._meetingUpdateController){Yo.error("there is no _meetingUpdateController");throw new Error("No meetingUpdateController")}this._mediaController=new Rn(l,{closeMeeting:function(e){switch(e){case M.SESSION_REMOVED:f._onMeetingEnded(c.MH.CALL_FINISHED);break;case M.MAX_RETRY_ERROR:f._onMeetingEnded(c.MH.RECOVERY_LIMIT_HIT);break;case M.SESSION_NOT_FOUND:f._onMeetingEnded(c.MH.CALL_FINISHED);break;default:f._onMeetingEnded(c.MH.WS_SERVER_ERROR)}},addStream:(i=this._meetingUpdateController)===null||i===void 0?void 0:i.onMediaStreamReceived,removeRemoteStream:this._meetingUpdateController.onMediaStreamRemoved,activeSpeaker:function(e){var t;return(t=f._meetingUpdateController)===null||t===void 0?void 0:t.handleIncomingData({source:Pn.SIGNALING,data:e})},onRemoteNetworkStatusUpdate:function(e){var t;(t=f._meetingUpdateController)===null||t===void 0?void 0:t.onRemoteNetworkStatusUpdate(e)},onLocalNetworkStatusUpdate:function(e){var t;(t=f._meetingUpdateController)===null||t===void 0?void 0:t.onLocalNetworkStatusUpdate(e)},onSessionStatusUpdate:function(e){var t;(t=f._meetingUpdateController)===null||t===void 0?void 0:t.onSessionStatusUpdate(e)},getMeetingStatusController:function(){return f.meetingStatusController}});this._mediaController.getSignalStatusController().onAny((function(e){Qo[e]&&f._meetingStatusController.setMeetingStatus("signalStatus",Qo[e])}));this._mediaController.getPeerStatusController().onAny((function(e){Wo[e]&&f._meetingStatusController.setMeetingStatus("peerStatus",Wo[e])}));return[4,this._mediaController.connect(d)];case 4:p.sent();return[4,this._sendJoinAction()];case 5:p.sent();return[2]}}))}))};ActiveMeetingController.prototype._initialMediaStream=function(e){return Ho(this,void 0,Promise,(function(){var t;return Go(this,(function(n){switch(n.label){case 0:return[4,this._requestUserInitMedia(e)];case 1:t=n.sent();this._localMediaController.initializeMedia(t,e.joinAudio);this._meetingDataProvider.handleMediaData({stream:t},this._meetingStatusController.localSelfEntityIds.streamId);this._meetingStatusController.setMeetingStatus("localMedia",p.hj.CONNECTED);return[2,t]}}))}))};ActiveMeetingController.prototype._enableMeetingAction=function(){this._actionEnableBarrier.open();var e=new $n(this._meetingUpdateController,this._mediaController,this._meetingStatusController,this.requestMediaController,this._meetingDataProvider);this._actionController=e;this._meetingStatusController.setRemoteSelfMeetingEntityIds(this._meetingDataProvider.remoteSelfMeetingEntityIds());this._demandController=new ci(this._meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.DEMAND_INFO),this._meetingDataProvider,this._localMediaController);this._entityObserverController=new Ni(this._localMediaController,this._actionController,this._meetingDataProvider,this._meetingEventManager)};ActiveMeetingController.prototype._quitMeeting=function(e){return Ho(this,void 0,void 0,(function(){var t,n;return Go(this,(function(r){switch(r.label){case 0:r.trys.push([0,4,,5]);this._meetingStatusController.setMeetingStatus("signalStatus",p.hj.TERMINATING);this._meetingStatusController.setMeetingStatus("peerStatus",p.hj.TERMINATING);t=this._meetingStatusController.meetingIdInfo;Yo.log("quitMeeting",t);return[4,this.cleanUpData()];case 1:r.sent();if(!e)return[3,3];return[4,e(t)];case 2:r.sent();r.label=3;case 3:return[3,5];case 4:n=r.sent();Yo.warn("quit meeting error:",n);return[3,5];case 5:return[2]}}))}))};ActiveMeetingController.prototype._startVideoCall=function(e){return Ho(this,void 0,void 0,(function(){var t,n,o;return Go(this,(function(a){switch(a.label){case 0:a.trys.push([0,3,,4]);if(!e.startCallFunc)return[3,2];n=RCVETracer(r.k);return[4,e.startCallFunc()];case 1:t=a.sent();n.end({key:rr.START_VIDEO_CALL,level:It.LOG_CONTROL_LEVEL.NORMAL});a.label=2;case 2:return[3,4];case 3:o=a.sent();Yo.log("error occur when create video call, end meeting.");return[3,4];case 4:if(!t){this._onMeetingEnded(c.MH.CREATE_VIDEO_CALL_ERROR);return[2,false]}if(this._meetingStatusController.meetingStatus.status===p.hj.TERMINATING||this._meetingStatusController.meetingStatus.status===p.hj.TERMINATED){i.RCVEApi.endMeeting({bridgeId:t.bridgeId,meetingId:t.meetingId});return[2,false]}this._meetingStatusController.setMeetingIdInfo({bridgeId:t.bridgeId||undefined,meetingId:t.meetingId||undefined,participantId:t.participantId||undefined,shortId:t.shortId||undefined});this._meetingStatusController.setIsVideoCaller(true);e.shortId=t.shortId;return[2,true]}}))}))};ActiveMeetingController.prototype.enterPassword=function(e){return Ho(this,void 0,void 0,(function(){var t;return Go(this,(function(n){switch(n.label){case 0:if(!this._obtainMeetingInfoPipeline){Yo.error("_obtainMeetingInfoPipeline not exist when try to enter password");return[2,false]}n.label=1;case 1:n.trys.push([1,3,,4]);if(this._options)this._options.password=e;return[4,this._obtainMeetingInfoPipeline.enterPassword(e)];case 2:return[2,n.sent()];case 3:t=n.sent();if(t instanceof Yn.TJ){this._endMeetingHandler&&this._endMeetingHandler(this._meetingDataProvider.localIdentifier(),c.MH.NOT_ALLOW_JOIN_BEFORE_HOST);return[2,true]}throw t;case 4:return[2]}}))}))};ActiveMeetingController.prototype._registerUpdatePrehandler=function(){var e=this;var t;var n=new Vi({dataProvider:function(){return e._meetingDataProvider},qualityController:function(){return e.streamQualityController}});(t=this._meetingUpdateController)===null||t===void 0?void 0:t.addPrehandler(n)};ActiveMeetingController.prototype._requestUserInitMedia=function(e){return Ho(this,void 0,Promise,(function(){var t,n;var r=this;return Go(this,(function(i){switch(i.label){case 0:return[4,this.requestMediaController.requestInitAudioMedia(e.joinAudio,!!e.mute,(function(t){if(e.joinAudio){Yo.warn("[join audio] need join audio but fail, set joinAudio = false.");e.joinAudio=false;r._meetingEventManager.emit(c.FY.REQUEST_MEDIA_PERMISSION_FAIL,t.message)}}))];case 1:t=i.sent();if(!e.video)return[3,3];return[4,this.requestMediaController.requestInitVideoMedia((function(){Yo.warn("[unmute video] unmuteVideo but fail.")}))];case 2:n=i.sent();replaceStreamTracks(n,t,"video");i.label=3;case 3:return[2,t]}}))}))};ActiveMeetingController.prototype._initializeUpdateController=function(){var e=this;var t;this._meetingUpdateController=new kn(this._meetingDataProvider,this._meetingStatusController);var n=new Or(this._meetingDataProvider);var r=new Mr(this._meetingDataProvider);var i=new Fr(this._meetingDataProvider);var o=new kr(this._meetingDataProvider,this._onMeetingEnded,(function(){e._meetingReconnectionController.reJoin()}));(t=this._meetingUpdateController)===null||t===void 0?void 0:t.addDataHandler(o);this._meetingUpdateController.addDataHandler(n);this._meetingUpdateController.addDataHandler(r);this._meetingUpdateController.addDataHandler(i)};ActiveMeetingController.prototype._sendJoinAction=function(){var e=this.meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.MEETING_INFO).getEntitiesSync()[0];e&&(0,o.getModule)(Vr.oF).sendJoinAction({meetId:e.shortId,startAt:this.meetingStatusController.getMeetingStartTime(),password:e.meetingPassword})};var e,t,n,a,s,l,u;jo([Ko({call:true,error:true}),xo("design:type",Function),xo("design:paramtypes",[typeof(e=typeof je.ConnectMediaOptions!=="undefined"&&je.ConnectMediaOptions)==="function"?e:Object]),xo("design:returntype",Promise)],ActiveMeetingController.prototype,"connectMedia",null);jo([Ko({call:true,error:true}),It.SingleRequest,xo("design:type",Function),xo("design:paramtypes",[typeof(t=typeof je.ConnectMeetingOptions!=="undefined"&&je.ConnectMeetingOptions)==="function"?t:Object]),xo("design:returntype",Promise)],ActiveMeetingController.prototype,"initialMediaStream",null);jo([Ko({call:true,error:true}),xo("design:type",Function),xo("design:paramtypes",[typeof(n=typeof je.ConnectMeetingOptions!=="undefined"&&je.ConnectMeetingOptions)==="function"?n:Object]),xo("design:returntype",Promise)],ActiveMeetingController.prototype,"_connectToMeeting",null);jo([Ko({call:true,error:true}),xo("design:type",Function),xo("design:paramtypes",[String,String,typeof(a=typeof p.ChannelInfo!=="undefined"&&p.ChannelInfo)==="function"?a:Object]),xo("design:returntype",void 0)],ActiveMeetingController.prototype,"_subscribeToPunNubChannel",null);jo([Ko({call:true,error:true}),xo("design:type",Function),xo("design:paramtypes",[String,String,String,typeof(s=typeof je.ConnectMediaOptions!=="undefined"&&je.ConnectMediaOptions)==="function"?s:Object]),xo("design:returntype",Promise)],ActiveMeetingController.prototype,"_connectMedia",null);jo([Ko({call:true,error:true}),xo("design:type",Function),xo("design:paramtypes",[typeof(l=typeof je.ConnectMediaOptions!=="undefined"&&je.ConnectMediaOptions)==="function"?l:Object]),xo("design:returntype",typeof(u=typeof Promise!=="undefined"&&Promise)==="function"?u:Object)],ActiveMeetingController.prototype,"_initialMediaStream",null);jo([Ko({call:true,error:true}),xo("design:type",Function),xo("design:paramtypes",[]),xo("design:returntype",void 0)],ActiveMeetingController.prototype,"_enableMeetingAction",null);return ActiveMeetingController}();var zo=n(38942);var $o=n(187933);var Xo=n(686221);var Zo=n(902114);var ea=function(){function RCVEInfoContorller(){}RCVEInfoContorller.prototype.getRCVPreference=function(e){return Zo.gv.getInstance().getRCVPreference(e)};RCVEInfoContorller.prototype.getRCVPreferences=function(){return Zo.gv.getInstance().getRCVPreferences()};RCVEInfoContorller.prototype.updateRCVPreference=function(e,t){return Zo.gv.getInstance().updateRCVPreference(e,t)};RCVEInfoContorller.prototype.subscribeRCVPreferenceChange=function(e){return Zo.gv.getInstance().subscribeRCVPreferenceChange(e)};RCVEInfoContorller.prototype.getDialInNumbers=function(){return Zo.gv.getInstance().getDialInNumbers()};return RCVEInfoContorller}();var ta=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,o=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o;return i>3&&o&&Object.defineProperty(t,n,o),o};var na=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var ra=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ia=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var oa=function(){function RCVEMeetingService(e){var t=this;this._userConfig=e;this._activeMeetingControllers=new Map;this.onMeetingEnded=function(e,n){r.k.log("[end meeting] on meeting ended for bridge=",e);var i=t._activeMeetingControllers.get(e);if(i){i.updateController&&i.updateController.notifyMeetingDeleted(n);i.end(false);t._activeMeetingControllers.delete(e)}};if(It.DebugUtils.isFeatureMode("RCVE")){window["_rcveService"]=this}this._rcveInfoController=new ea;this._scheduleRCVEInfoJob()}RCVEMeetingService.prototype.getActiveMeetingIds=function(){var e=[];this._activeMeetingControllers.forEach((function(t,n){var r;if(!t["_activeMeetingOptions"].media){return}var i=(r=t.meetingDataProvider.getEntityControllerByEntityKey(c.FY.ENTITY.MEETING_STATUS).getSynchronously(n))===null||r===void 0?void 0:r.status;if(i&&![ve.hj.INIT,ve.hj.TERMINATED].includes(i)){e.push(n)}}));return e};RCVEMeetingService.prototype.getMeetingDataProvider=function(e){var t=this._activeMeetingControllers.get(e);if(!t){r.k.error("can not find meeting id with local identifier=",e);throw new Yn.wU("meeting not exist")}return t.meetingDataProvider};RCVEMeetingService.prototype.getCallController=function(e){var t=this._activeMeetingControllers.get(e);if(!t){r.k.error("can not find meeting id with local identifier=",e);throw new Yn.wU("meeting not exist")}return t.callController};RCVEMeetingService.prototype.createActiveMeeting=function(e){if(e===void 0){e={withLocalData:true,media:true,dial:true,chat:true}}return ra(this,void 0,void 0,(function(){var t,n;return ia(this,(function(r){switch(r.label){case 0:t=new Jo(this._userConfig,e);t.endMeetingHandler=this.onMeetingEnded;return[4,t.initLocalMeetingData(!!e.withLocalData)];case 1:n=r.sent();this._activeMeetingControllers.set(n.identifier,t);return[2,n]}}))}))};RCVEMeetingService.prototype.connectToMeeting=function(e,t){return ra(this,void 0,void 0,(function(){var n,i,o,a,n;return ia(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,,6]);n=this._activeMeetingControllers.get(e);i=n;if(!i)return[3,2];return[4,n.connectToMeeting(t)];case 1:i=s.sent();s.label=2;case 2:i;r.k.debug("connectToMeeting options:",t);o=t===null||t===void 0?void 0:t.screen;if(!o)return[3,4];return[4,this.startScreenSharing(e).catch((function(e){r.k.warn("connect to meeting with screen share failed.",e)}))];case 3:o=s.sent();s.label=4;case 4:o;return[3,6];case 5:a=s.sent();n=this._activeMeetingControllers.get(e);n===null||n===void 0?void 0:n.cleanUpData();this._activeMeetingControllers.delete(e);throw a;case 6:return[2]}}))}))};RCVEMeetingService.prototype.endMeeting=function(e){var t=this._activeMeetingControllers.get(e);t===null||t===void 0?void 0:t.end(true);this._activeMeetingControllers.delete(e)};RCVEMeetingService.prototype.leaveMeeting=function(e){var t=this._activeMeetingControllers.get(e);r.k.log("leaveMeeting: "+e,t);t===null||t===void 0?void 0:t.leave();this._activeMeetingControllers.delete(e)};RCVEMeetingService.prototype.mutePhone=function(e){var t;return ra(this,void 0,Promise,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.actionController)===null||t===void 0?void 0:t.mutePhone(true)];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmutePhone=function(e){var t;return ra(this,void 0,Promise,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.actionController)===null||t===void 0?void 0:t.mutePhone(false)];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.leavePhoneAudio=function(e){var t,n;return ra(this,void 0,Promise,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(t=r===null||r===void 0?void 0:r.actionController)===null||t===void 0?void 0:t.muteSelfParticipantAudio()];case 1:i.sent();return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.hangupPSTNSession()];case 2:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.leaveAudio=function(e){var t;return ra(this,void 0,Promise,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.localMediaController)===null||t===void 0?void 0:t.leaveAudio()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.joinAudio=function(e){var t;return ra(this,void 0,Promise,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.localMediaController)===null||t===void 0?void 0:t.joinAudio()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.muteAudio=function(e){var t;return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.localMediaController)===null||t===void 0?void 0:t.muteAudio()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmuteAudio=function(e){var t;return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.localMediaController)===null||t===void 0?void 0:t.unmuteAudio()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.muteVideo=function(e){var t;return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.localMediaController)===null||t===void 0?void 0:t.muteVideo()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmuteVideo=function(e){var t;return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.localMediaController)===null||t===void 0?void 0:t.unmuteVideo()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.muteParticipant=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.muteParticipant(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.muteParticipantVideo=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.muteParticipantVideo(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.updateWaitingRoomStatus=function(e,t,n){var r;return ra(this,void 0,void 0,(function(){var i;return ia(this,(function(o){switch(o.label){case 0:i=this._activeMeetingControllers.get(e);return[4,(r=i===null||i===void 0?void 0:i.actionController)===null||r===void 0?void 0:r.updateWaitingRoomStatus(t,n)];case 1:o.sent();return[2]}}))}))};RCVEMeetingService.prototype.switchAudio=function(e,t){return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,n===null||n===void 0?void 0:n.localMediaController.switchAudio(t)];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.switchVideo=function(e,t){return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,n===null||n===void 0?void 0:n.localMediaController.switchVideo(t)];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmuteParticipantAudio=function(e,t){var n,r;return ra(this,void 0,void 0,(function(){var i;return ia(this,(function(o){switch(o.label){case 0:i=this._activeMeetingControllers.get(e);return[4,(n=i===null||i===void 0?void 0:i.actionController)===null||n===void 0?void 0:n.unmuteParticipantAudio(t)];case 1:o.sent();return[4,(r=i===null||i===void 0?void 0:i.demandController)===null||r===void 0?void 0:r.createDemand(ve.cZ.UNMUTE_DEMAND,t)];case 2:o.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmuteParticipantVideo=function(e,t){var n,r;return ra(this,void 0,void 0,(function(){var i;return ia(this,(function(o){switch(o.label){case 0:i=this._activeMeetingControllers.get(e);return[4,(n=i===null||i===void 0?void 0:i.actionController)===null||n===void 0?void 0:n.unmuteParticipantVideo(t)];case 1:o.sent();return[4,(r=i===null||i===void 0?void 0:i.demandController)===null||r===void 0?void 0:r.createDemand(ve.cZ.UNMUTE_VIDEO_DEMAND,t)];case 2:o.sent();return[2]}}))}))};RCVEMeetingService.prototype.approveDemand=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.demandController)===null||n===void 0?void 0:n.approveDemand(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.rejectDemand=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.demandController)===null||n===void 0?void 0:n.rejectDemand(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.allowJoin=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.allowJoin(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.muteAllAudio=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.muteAllAudio(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.muteAllVideo=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.muteAllVideo(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmuteAllAudio=function(e){var t,n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(t=r===null||r===void 0?void 0:r.actionController)===null||t===void 0?void 0:t.unmuteAllAudio()];case 1:i.sent();return[4,(n=r===null||r===void 0?void 0:r.demandController)===null||n===void 0?void 0:n.createDemand(ve.cZ.UNMUTE_DEMAND)];case 2:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.unmuteAllVideo=function(e){var t,n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(t=r===null||r===void 0?void 0:r.actionController)===null||t===void 0?void 0:t.unmuteAllVideo()];case 1:i.sent();return[4,(n=r===null||r===void 0?void 0:r.demandController)===null||n===void 0?void 0:n.createDemand(ve.cZ.UNMUTE_VIDEO_DEMAND)];case 2:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.allowScreenSharing=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.allowScreenSharing(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype.assignModerator=function(e,t,n,r){var i;return ra(this,void 0,void 0,(function(){var o;return ia(this,(function(a){switch(a.label){case 0:o=this._activeMeetingControllers.get(e);return[4,(i=o===null||o===void 0?void 0:o.actionController)===null||i===void 0?void 0:i.assignModerator(t,n,r)];case 1:a.sent();return[2]}}))}))};RCVEMeetingService.prototype.hangUp=function(e,t){var n;return ra(this,void 0,void 0,(function(){var r;return ia(this,(function(i){switch(i.label){case 0:r=this._activeMeetingControllers.get(e);return[4,(n=r===null||r===void 0?void 0:r.actionController)===null||n===void 0?void 0:n.hangUp(t)];case 1:i.sent();return[2]}}))}))};RCVEMeetingService.prototype._isRCVEEnabled=function(){return ra(this,void 0,Promise,(function(){var e,t;return ia(this,(function(n){switch(n.label){case 0:e=(0,o.getModule)(zo.FEATURE_FLAG_MODULE);t=(0,o.getModule)($o.oF);if(!e.hasPermission(zo.G.D_USE_RCVE_POC)){return[2,false]}if(!t.hasSetting(Xo.O.RCVE_AllEntry)){return[2,false]}return[4,t.getSettingItemValue(Xo.O.RCVE_AllEntry)];case 1:return[2,n.sent()]}}))}))};RCVEMeetingService.prototype._scheduleRCVEInfoJob=function(){return ra(this,void 0,void 0,(function(){var e;var t=this;return ia(this,(function(n){switch(n.label){case 0:e=function(){return ra(t,void 0,void 0,(function(){return ia(this,(function(e){switch(e.label){case 0:return[4,this._isRCVEEnabled()];case 1:if(e.sent()){Zo.gv.getInstance().startSync({preference:true,dialInNumber:true})}return[2]}}))}))};return[4,this._isRCVEEnabled()];case 1:if(n.sent()){Zo.gv.getInstance().startSync({preference:true,dialInNumber:true})}(0,o.getModule)($o.oF).observeSettingChange(Xo.O.RCVE_AllEntry,e);return[2]}}))}))};RCVEMeetingService.prototype.getInfoController=function(){return this._rcveInfoController};RCVEMeetingService.prototype.mixedAudioStreamId=function(e){var t;return((t=this._activeMeetingControllers.get(e))===null||t===void 0?void 0:t.mixedAudioStreamId())||""};RCVEMeetingService.prototype.updateStreamDisplayStatus=function(e,t){var n;var r=this._activeMeetingControllers.get(e);(n=r===null||r===void 0?void 0:r.streamQualityController)===null||n===void 0?void 0:n.updateStreamDisplayStatus(t)};RCVEMeetingService.prototype.startScreenSharing=function(e){var t;return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.actionController)===null||t===void 0?void 0:t.startScreenSharing()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.stopScreenSharing=function(e){var t;return ra(this,void 0,void 0,(function(){var n;return ia(this,(function(r){switch(r.label){case 0:n=this._activeMeetingControllers.get(e);return[4,(t=n===null||n===void 0?void 0:n.actionController)===null||t===void 0?void 0:t.stopScreenSharing()];case 1:r.sent();return[2]}}))}))};RCVEMeetingService.prototype.getMeetingStartTime=function(e){var t=this._activeMeetingControllers.get(e);return(t===null||t===void 0?void 0:t.meetingStatusController.getMeetingStartTime())||0};RCVEMeetingService.prototype.registerEventListener=function(e,t,n){var r=this._activeMeetingControllers.get(e);if(!r){return function(){}}return r===null||r===void 0?void 0:r.registerEventListener(t,n)};RCVEMeetingService.prototype.setRememberNumber=function(e,t){return this._userConfig.setRememberNumber(e,t)};RCVEMeetingService.prototype.setPinnedStream=function(e,t){var n;var r=this._activeMeetingControllers.get(e);(n=r===null||r===void 0?void 0:r.streamQualityController)===null||n===void 0?void 0:n.setPinnedStream(t)};RCVEMeetingService.prototype.setCurrentLayout=function(e,t){var n;var r=this._activeMeetingControllers.get(e);(n=r===null||r===void 0?void 0:r.streamQualityController)===null||n===void 0?void 0:n.setCurrentLayout(t)};RCVEMeetingService.prototype.enterPassword=function(e,t){var n=this._activeMeetingControllers.get(e);if(!n){r.k.log("enterPassword(): "+e+" cannot find activeMeetingController");return Promise.resolve(false)}return n.enterPassword(t)};var e,t;ta([(0,It.TakeLastRequest)({time:100}),na("design:type",Function),na("design:paramtypes",[String,typeof(e=typeof MediaStreamConstraints!=="undefined"&&MediaStreamConstraints)==="function"?e:Object]),na("design:returntype",Promise)],RCVEMeetingService.prototype,"switchAudio",null);ta([(0,It.TakeLastRequest)({time:100}),na("design:type",Function),na("design:paramtypes",[String,typeof(t=typeof MediaStreamConstraints!=="undefined"&&MediaStreamConstraints)==="function"?t:Object]),na("design:returntype",Promise)],RCVEMeetingService.prototype,"switchVideo",null);return RCVEMeetingService}()},686221:(e,t,n)=>{"use strict";n.d(t,{O:()=>r.O,V:()=>V});var r=n(587844);var i=n(696206);var o=n(667489);var a=n(38942);var s=n(231820);var l=n(470033);var u=n(295454);var c=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var d=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var f=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var p=function(e){c(RCVEAllEntrySettingItemProvider,e);function RCVEAllEntrySettingItemProvider(t){var n=e.call(this,{id:r.O.RCVE_AllEntry,value:{type:i.Pe.STORAGE,defaultValue:false}})||this;n._context=t;return n}RCVEAllEntrySettingItemProvider.prototype._isEnable=function(){var e;return d(this,void 0,void 0,(function(){var t,n,r;return f(this,(function(a){switch(a.label){case 0:t=this._context.entitlement;n=t===null||t===void 0?void 0:t.get(l.H3.RolePermissionId.PERMISSION_MEETINGS);r=n;if(!r)return[3,2];return[4,(e=(0,o.getModule)(i.oF))===null||e===void 0?void 0:e.getSettingItemValue(s.Hr.Video_Service)];case 1:r=a.sent()===s.ZE.RINGCENTRAL_VIDEO_EMBEDDED;a.label=2;case 2:return[2,r]}}))}))};RCVEAllEntrySettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return d(e,void 0,void 0,(function(){var e,t,n,r,s,l;var u,c,d,p;return f(this,(function(f){switch(f.label){case 0:return[4,this._isEnable()];case 1:e=f.sent();if(!e){return[2,i.ESettingItemState.INVISIBLE]}return[4,(u=(0,o.getModule)(a.FEATURE_FLAG_MODULE))===null||u===void 0?void 0:u.getFeatureFlag(a.G.D_USE_RCVE_POC)];case 2:t=(f.sent()||{}).settings.all,n=t===void 0?false:t;r=Boolean((d=(c=this._getRWCFlag())===null||c===void 0?void 0:c.getConfig())===null||d===void 0?void 0:d.enable);l=r;if(!l)return[3,4];return[4,(p=(0,o.getModule)(i.oF))===null||p===void 0?void 0:p.getSettingItemValue("RCVE_HERCULES_ENABLE")];case 3:l=f.sent()===true;f.label=4;case 4:s=l;return[2,n?s?i.ESettingItemState.DISABLE:i.ESettingItemState.ENABLE:i.ESettingItemState.INVISIBLE]}}))}))}})};RCVEAllEntrySettingItemProvider.prototype.onLoad=function(){var e=this;var handleUpdate=function(){e.getStateProvider().notifyChange()};(0,o.getModule)(a.FEATURE_FLAG_MODULE).observeFeatureFlag(a.G.D_USE_RCVE_POC,handleUpdate);this.onSettingUpdate(s.Hr.Video_Service,handleUpdate);this.onSettingUpdate("RCVE_HERCULES_ENABLE",handleUpdate);this._observeRWCFlag()};RCVEAllEntrySettingItemProvider.prototype._getRWCFlag=function(){var e;return(e=o.configStoreManager.getConfigStore(u.L2.RWC_CONFIG_STORE))===null||e===void 0?void 0:e.getConfigObj()};RCVEAllEntrySettingItemProvider.prototype._observeRWCFlag=function(){var e=this;this.addSubscription((function(){var t={getter:function(e){return e.enable},callback:function(){return e.getStateProvider().notifyChange()}};var n={name:u.L2.RWC_CONFIG_STORE,callback:function(e){e.getConfigObj().addConfigObserver(t)}};o.configStoreManager.observeAddConfigStore(n);return function(){var r;o.configStoreManager.unobserveAddConfigStore(n);(r=e._getRWCFlag())===null||r===void 0?void 0:r.removeConfigObserver(t)}}))};return RCVEAllEntrySettingItemProvider}(i.BaseSettingItemProvider);var h=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var _=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var v=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var g=function(e){h(RCVEOneOneEntrySettingItemProvider,e);function RCVEOneOneEntrySettingItemProvider(t){var n=e.call(this,{id:r.O.RCVE_OneOneEntry,value:{type:i.Pe.STORAGE,defaultValue:false}})||this;n._context=t;return n}RCVEOneOneEntrySettingItemProvider.prototype._isEnable=function(){var e;return _(this,void 0,void 0,(function(){var t,n,r;return v(this,(function(a){switch(a.label){case 0:t=this._context.entitlement;n=t===null||t===void 0?void 0:t.get(l.H3.RolePermissionId.PERMISSION_MEETINGS);r=n;if(!r)return[3,2];return[4,(e=(0,o.getModule)(i.oF))===null||e===void 0?void 0:e.getSettingItemValue(s.Hr.Video_Service)];case 1:r=a.sent()===s.ZE.RINGCENTRAL_VIDEO_EMBEDDED;a.label=2;case 2:return[2,r]}}))}))};RCVEOneOneEntrySettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return _(e,void 0,void 0,(function(){var e,t,n;var r;return v(this,(function(s){switch(s.label){case 0:return[4,this._isEnable()];case 1:e=s.sent();if(!e){return[2,i.ESettingItemState.INVISIBLE]}return[4,(r=(0,o.getModule)(a.FEATURE_FLAG_MODULE))===null||r===void 0?void 0:r.getFeatureFlag(a.G.D_USE_RCVE_POC)];case 2:t=(s.sent()||{settings:{one_one:false}}).settings.one_one,n=t===void 0?false:t;return[2,n?i.ESettingItemState.ENABLE:i.ESettingItemState.INVISIBLE]}}))}))}})};RCVEOneOneEntrySettingItemProvider.prototype.onLoad=function(){var e=this;var handleUpdate=function(){e.getStateProvider().notifyChange()};(0,o.getModule)(a.FEATURE_FLAG_MODULE).observeFeatureFlag(a.G.D_USE_RCVE_POC,handleUpdate);this.onSettingUpdate(s.Hr.Video_Service,handleUpdate)};return RCVEOneOneEntrySettingItemProvider}(i.BaseSettingItemProvider);var y=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var m=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var S=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var C=function(e){y(RCVEHDSettingItemProvider,e);function RCVEHDSettingItemProvider(t){var n=e.call(this,{id:r.O.RCVE_HD,value:{type:i.Pe.STORAGE,defaultValue:false}})||this;n._context=t;return n}RCVEHDSettingItemProvider.prototype._isEnable=function(){var e;return m(this,void 0,void 0,(function(){var t,n,r;return S(this,(function(a){switch(a.label){case 0:t=this._context.entitlement;n=t===null||t===void 0?void 0:t.get(l.H3.RolePermissionId.PERMISSION_MEETINGS);r=n;if(!r)return[3,2];return[4,(e=(0,o.getModule)(i.oF))===null||e===void 0?void 0:e.getSettingItemValue(s.Hr.Video_Service)];case 1:r=a.sent()===s.ZE.RINGCENTRAL_VIDEO_EMBEDDED;a.label=2;case 2:return[2,r]}}))}))};RCVEHDSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return m(e,void 0,void 0,(function(){var e,t,n;var r;return S(this,(function(s){switch(s.label){case 0:return[4,this._isEnable()];case 1:e=s.sent();if(!e){return[2,i.ESettingItemState.INVISIBLE]}return[4,(r=(0,o.getModule)(a.FEATURE_FLAG_MODULE))===null||r===void 0?void 0:r.getFeatureFlag(a.G.D_USE_RCVE_POC)];case 2:t=(s.sent()||{}).settings.all,n=t===void 0?false:t;return[2,n?i.ESettingItemState.ENABLE:i.ESettingItemState.INVISIBLE]}}))}))}})};RCVEHDSettingItemProvider.prototype.onLoad=function(){var e=this;var handleUpdate=function(){e.getStateProvider().notifyChange()};(0,o.getModule)(a.FEATURE_FLAG_MODULE).observeFeatureFlag(a.G.D_USE_RCVE_POC,handleUpdate);this.onSettingUpdate(s.Hr.Video_Service,handleUpdate)};return RCVEHDSettingItemProvider}(i.BaseSettingItemProvider);var E=n(302186);var b=n(531616);var I=n(376271);var M=n(922742);var R=n(968006);var T=n(812490);var O=n(721974);var A=n(204285);var P=n(397672);var N=n(827027);var w=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var D=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var k=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var L=function(e){w(RCVEDirectShareSettingItemProvider,e);function RCVEDirectShareSettingItemProvider(){var t=e.call(this,r.O.DIRECT_SHARE)||this;t._profileSettingKey=A.PROFILE_SETTING_KEYS.SHOW_DIRECT_SHARE_BUTTON_RCVE;return t}RCVEDirectShareSettingItemProvider.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this);o.notificationCenter.on("ENTITY.GROUP",(function(){M.k.log("notificationCenter.on ENTITY.GROUP");t.getStateProvider().notifyChange();t.getValueProvider().notifyChange()}))};RCVEDirectShareSettingItemProvider.prototype._trackInitialState=function(e){var t={value:e?"On":"Off",videoService:"RingCentral Video",endPoint:E.Pal.instance.getPlatformUtils().getOSName()||"unresolved"};M.k.tags("[DirectShare Analytics]").info("Jup_Web/DT_shareRoomSetting",t);R.s6.track("Jup_Web/DT_shareRoomSetting",t)};RCVEDirectShareSettingItemProvider.prototype._getValueOverride=function(e){return D(this,void 0,void 0,(function(){var t,n;return k(this,(function(r){switch(r.label){case 0:M.k.log("Got initial value: "+e+". Skip one and check rooms license.");return[4,(0,o.getModuleAsync)(P.GROUP_EXTENSION_MODULE)];case 1:t=r.sent();return[4,t.getNonUserExtensions({type:N.RC_EXTENSION_TYPES.ROOM})];case 2:n=r.sent();M.k.log("Rooms license data:",n);if(n&&n.length){M.k.log("Has rooms license");return[2,true]}M.k.log("No rooms license");return[2,false]}}))}))};RCVEDirectShareSettingItemProvider.prototype._trackDirectShareSettingValue=function(e,t,n){if(n===void 0){n=E.Pal.instance.getPlatformUtils().getOSName()||"unresolved"}if(e!==t){var r={type:"video",videoService:"RingCentral Video",name:"display share in room option",option:!e&&t?"off to on":"on to off",endPoint:n};M.k.tags("[DirectShare Analytics]").info("Jup_Web/DT_settings_updateSetting",r);R.s6.track("Jup_Web/DT_settings_updateSetting",r)}};RCVEDirectShareSettingItemProvider.prototype._getState=function(){return D(this,void 0,void 0,(function(){var e,t;return k(this,(function(n){switch(n.label){case 0:e=(0,o.getModule)(i.oF);return[4,e.getSettingItemValue(O.H.Video_Service)];case 1:t=n.sent();if(t===T.ZE.RINGCENTRAL_VIDEO_EMBEDDED){return[2,b.Ye.ENABLE]}return[2,b.Ye.INVISIBLE]}}))}))};return RCVEDirectShareSettingItemProvider}(I.m);var F=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var V=function(e){F(RCVESettingManager,e);function RCVESettingManager(t){var n=e.call(this)||this;n._context=t;return n}RCVESettingManager.prototype.getProviderMap=function(){var e;return e={},e[r.O.RCVE_AllEntry]=new p(this._context),e[r.O.RCVE_OneOneEntry]=new g(this._context),e[r.O.RCVE_HD]=new C(this._context),e[r.O.DIRECT_SHARE]=new L,e};return RCVESettingManager}(i.AbstractModuleSettingProviderManager)},587844:(e,t,n)=>{"use strict";n.d(t,{O:()=>r.Og});var r=n(782117)},313242:(e,t,n)=>{"use strict";n.d(t,{wJ:()=>i,rf:()=>o});var r=n(902114);var i;(function(e){e["START"]="start";e["JOIN"]="join";e["CALL"]="call";e["REJOIN"]="rejoin"})(i||(i={}));var o;(function(e){e["CallMe"]="CallMe";e["CallOut"]="CallOut"})(o||(o={}))},81787:e=>{"use strict";e.exports=JSON.parse('[{"isoCode":"AF","callingCode":"93","id":"89","name":"Afghanistan"},{"isoCode":"AL","callingCode":"355","id":"3","name":"Albania"},{"isoCode":"DZ","callingCode":"213","id":"4","name":"Algeria"},{"isoCode":"AS","callingCode":"1","id":"5","name":"American Samoa"},{"isoCode":"AD","callingCode":"376","id":"6","name":"Andorra"},{"isoCode":"AO","callingCode":"244","id":"7","name":"Angola"},{"isoCode":"AI","callingCode":"1","id":"8","name":"Anguilla"},{"isoCode":"AQ","callingCode":"672","id":"9","name":"Antarctica"},{"isoCode":"AG","callingCode":"1","id":"10","name":"Antigua and Barbuda"},{"isoCode":"AR","callingCode":"54","id":"11","name":"Argentina"},{"isoCode":"AM","callingCode":"374","id":"12","name":"Armenia"},{"isoCode":"AW","callingCode":"297","id":"13","name":"Aruba"},{"isoCode":"AU","callingCode":"61","id":"15","name":"Australia"},{"isoCode":"AT","callingCode":"43","id":"16","name":"Austria"},{"isoCode":"AZ","callingCode":"994","id":"17","name":"Azerbaijan"},{"isoCode":"BS","callingCode":"1","id":"18","name":"Bahamas"},{"isoCode":"BH","callingCode":"973","id":"19","name":"Bahrain"},{"isoCode":"BD","callingCode":"880","id":"20","name":"Bangladesh"},{"isoCode":"BB","callingCode":"1","id":"21","name":"Barbados"},{"isoCode":"BY","callingCode":"375","id":"22","name":"Belarus"},{"isoCode":"BE","callingCode":"32","id":"23","name":"Belgium"},{"isoCode":"BZ","callingCode":"501","id":"24","name":"Belize"},{"isoCode":"BJ","callingCode":"229","id":"25","name":"Benin"},{"isoCode":"BM","callingCode":"1","id":"26","name":"Bermuda"},{"isoCode":"BT","callingCode":"975","id":"27","name":"Bhutan"},{"isoCode":"BO","callingCode":"591","id":"28","name":"Bolivia"},{"isoCode":"BQ","callingCode":"599","id":"291","name":"Bonaire, Saint Eustatius and Saba (Caribbean Netherlands)"},{"isoCode":"BA","callingCode":"387","id":"29","name":"Bosnia and Herzegovina"},{"isoCode":"BW","callingCode":"267","id":"30","name":"Botswana"},{"isoCode":"BR","callingCode":"55","id":"31","name":"Brazil"},{"isoCode":"BN","callingCode":"673","id":"33","name":"Brunei Darussalam"},{"isoCode":"BG","callingCode":"359","id":"34","name":"Bulgaria"},{"isoCode":"BF","callingCode":"226","id":"35","name":"Burkina Faso"},{"isoCode":"BI","callingCode":"257","id":"36","name":"Burundi"},{"isoCode":"KH","callingCode":"855","id":"37","name":"Cambodia"},{"isoCode":"CM","callingCode":"237","id":"38","name":"Cameroon"},{"isoCode":"CA","callingCode":"1","id":"39","name":"Canada"},{"isoCode":"CV","callingCode":"238","id":"40","name":"Cape Verde"},{"isoCode":"KY","callingCode":"1","id":"41","name":"Cayman Islands"},{"isoCode":"CF","callingCode":"236","id":"42","name":"Central African Republic"},{"isoCode":"TD","callingCode":"235","id":"43","name":"Chad"},{"isoCode":"CL","callingCode":"56","id":"45","name":"Chile"},{"isoCode":"CN","callingCode":"86","id":"46","name":"China"},{"isoCode":"CO","callingCode":"57","id":"49","name":"Colombia"},{"isoCode":"KM","callingCode":"269","id":"50","name":"Comoros"},{"isoCode":"CG","callingCode":"242","id":"51","name":"Congo"},{"isoCode":"CD","callingCode":"243","id":"14","name":"Congo, Democratic Republic"},{"isoCode":"CK","callingCode":"682","id":"52","name":"Cook Islands"},{"isoCode":"CR","callingCode":"506","id":"53","name":"Costa Rica"},{"isoCode":"HR","callingCode":"385","id":"54","name":"Croatia"},{"isoCode":"CU","callingCode":"53","id":"55","name":"Cuba"},{"isoCode":"CW","callingCode":"599","id":"273","name":"Curacao"},{"isoCode":"CY","callingCode":"357","id":"56","name":"Cyprus"},{"isoCode":"CZ","callingCode":"420","id":"57","name":"Czech Republic"},{"isoCode":"DK","callingCode":"45","id":"58","name":"Denmark"},{"isoCode":"DJ","callingCode":"253","id":"60","name":"Djibouti"},{"isoCode":"DM","callingCode":"1","id":"61","name":"Dominica"},{"isoCode":"DO","callingCode":"1","id":"62","name":"Dominican Republic"},{"isoCode":"EC","callingCode":"593","id":"64","name":"Ecuador"},{"isoCode":"EG","callingCode":"20","id":"65","name":"Egypt"},{"isoCode":"SV","callingCode":"503","id":"66","name":"El Salvador"},{"isoCode":"GQ","callingCode":"240","id":"67","name":"Equatorial Guinea"},{"isoCode":"ER","callingCode":"291","id":"68","name":"Eritrea"},{"isoCode":"EE","callingCode":"372","id":"69","name":"Estonia"},{"isoCode":"ET","callingCode":"251","id":"70","name":"Ethiopia"},{"isoCode":"FK","callingCode":"500","id":"71","name":"Falkland Islands (Malvinas)"},{"isoCode":"FO","callingCode":"298","id":"72","name":"Faroe Islands"},{"isoCode":"FJ","callingCode":"679","id":"73","name":"Fiji"},{"isoCode":"FI","callingCode":"358","id":"74","name":"Finland"},{"isoCode":"FR","callingCode":"33","id":"75","name":"France"},{"isoCode":"GF","callingCode":"594","id":"77","name":"French Guiana"},{"isoCode":"PF","callingCode":"689","id":"78","name":"French Polynesia"},{"isoCode":"GA","callingCode":"241","id":"80","name":"Gabon"},{"isoCode":"GM","callingCode":"220","id":"81","name":"Gambia"},{"isoCode":"GE","callingCode":"995","id":"82","name":"Georgia"},{"isoCode":"DE","callingCode":"49","id":"83","name":"Germany"},{"isoCode":"GH","callingCode":"233","id":"84","name":"Ghana"},{"isoCode":"GI","callingCode":"350","id":"85","name":"Gibraltar"},{"isoCode":"GR","callingCode":"30","id":"86","name":"Greece"},{"isoCode":"GL","callingCode":"299","id":"87","name":"Greenland"},{"isoCode":"GD","callingCode":"1","id":"88","name":"Grenada"},{"isoCode":"GP","callingCode":"590","id":"90","name":"Guadeloupe"},{"isoCode":"GU","callingCode":"1","id":"91","name":"Guam"},{"isoCode":"GT","callingCode":"502","id":"93","name":"Guatemala"},{"isoCode":"GN","callingCode":"224","id":"95","name":"Guinea"},{"isoCode":"GW","callingCode":"245","id":"96","name":"Guinea-Bissau"},{"isoCode":"GY","callingCode":"592","id":"97","name":"Guyana"},{"isoCode":"HT","callingCode":"509","id":"98","name":"Haiti"},{"isoCode":"HN","callingCode":"504","id":"99","name":"Honduras"},{"isoCode":"HK","callingCode":"852","id":"100","name":"Hong Kong"},{"isoCode":"HU","callingCode":"36","id":"101","name":"Hungary"},{"isoCode":"IS","callingCode":"354","id":"102","name":"Iceland"},{"isoCode":"IN","callingCode":"91","id":"103","name":"India"},{"isoCode":"ID","callingCode":"62","id":"104","name":"Indonesia"},{"isoCode":"IR","callingCode":"98","id":"105","name":"Iran"},{"isoCode":"IQ","callingCode":"964","id":"106","name":"Iraq"},{"isoCode":"IE","callingCode":"353","id":"107","name":"Ireland"},{"isoCode":"IL","callingCode":"972","id":"108","name":"Israel"},{"isoCode":"IT","callingCode":"39","id":"109","name":"Italy"},{"isoCode":"CI","callingCode":"225","id":"110","name":"Ivory Coast"},{"isoCode":"JM","callingCode":"1","id":"111","name":"Jamaica"},{"isoCode":"JP","callingCode":"81","id":"112","name":"Japan"},{"isoCode":"JO","callingCode":"962","id":"114","name":"Jordan"},{"isoCode":"KZ","callingCode":"7","id":"115","name":"Kazakhstan"},{"isoCode":"KE","callingCode":"254","id":"116","name":"Kenya"},{"isoCode":"KI","callingCode":"686","id":"117","name":"Kiribati"},{"isoCode":"XK","callingCode":"383","id":"280","name":"Kosovo"},{"isoCode":"KW","callingCode":"965","id":"118","name":"Kuwait"},{"isoCode":"KG","callingCode":"996","id":"119","name":"Kyrgyzstan"},{"isoCode":"LA","callingCode":"856","id":"120","name":"Laos"},{"isoCode":"LV","callingCode":"371","id":"121","name":"Latvia"},{"isoCode":"LB","callingCode":"961","id":"122","name":"Lebanon"},{"isoCode":"LS","callingCode":"266","id":"123","name":"Lesotho"},{"isoCode":"LR","callingCode":"231","id":"124","name":"Liberia"},{"isoCode":"LY","callingCode":"218","id":"125","name":"Libya"},{"isoCode":"LI","callingCode":"423","id":"126","name":"Liechtenstein"},{"isoCode":"LT","callingCode":"370","id":"127","name":"Lithuania"},{"isoCode":"LU","callingCode":"352","id":"128","name":"Luxembourg"},{"isoCode":"MO","callingCode":"853","id":"129","name":"Macao"},{"isoCode":"MK","callingCode":"389","id":"130","name":"Macedonia"},{"isoCode":"MG","callingCode":"261","id":"131","name":"Madagascar"},{"isoCode":"MW","callingCode":"265","id":"132","name":"Malawi"},{"isoCode":"MY","callingCode":"60","id":"133","name":"Malaysia"},{"isoCode":"MV","callingCode":"960","id":"134","name":"Maldives"},{"isoCode":"ML","callingCode":"223","id":"135","name":"Mali"},{"isoCode":"MT","callingCode":"356","id":"136","name":"Malta"},{"isoCode":"MH","callingCode":"692","id":"138","name":"Marshall Islands"},{"isoCode":"MQ","callingCode":"596","id":"139","name":"Martinique"},{"isoCode":"MR","callingCode":"222","id":"140","name":"Mauritania"},{"isoCode":"MU","callingCode":"230","id":"141","name":"Mauritius"},{"isoCode":"YT","callingCode":"262","id":"142","name":"Mayotte"},{"isoCode":"MX","callingCode":"52","id":"143","name":"Mexico"},{"isoCode":"FM","callingCode":"691","id":"144","name":"Micronesia, Federated States"},{"isoCode":"MD","callingCode":"373","id":"147","name":"Moldova"},{"isoCode":"MC","callingCode":"377","id":"148","name":"Monaco"},{"isoCode":"MN","callingCode":"976","id":"149","name":"Mongolia"},{"isoCode":"ME","callingCode":"382","id":"240","name":"Montenegro"},{"isoCode":"MS","callingCode":"1","id":"150","name":"Montserrat"},{"isoCode":"MA","callingCode":"212","id":"151","name":"Morocco"},{"isoCode":"MZ","callingCode":"258","id":"152","name":"Mozambique"},{"isoCode":"MM","callingCode":"95","id":"153","name":"Myanmar"},{"isoCode":"NA","callingCode":"264","id":"154","name":"Namibia"},{"isoCode":"NR","callingCode":"674","id":"155","name":"Nauru"},{"isoCode":"NP","callingCode":"977","id":"156","name":"Nepal"},{"isoCode":"NL","callingCode":"31","id":"157","name":"Netherlands"},{"isoCode":"AN","callingCode":"599","id":"145","name":"Netherlands Antilles"},{"isoCode":"NC","callingCode":"687","id":"159","name":"New Caledonia"},{"isoCode":"NZ","callingCode":"64","id":"160","name":"New Zealand"},{"isoCode":"NI","callingCode":"505","id":"161","name":"Nicaragua"},{"isoCode":"NE","callingCode":"227","id":"162","name":"Niger"},{"isoCode":"NG","callingCode":"234","id":"163","name":"Nigeria"},{"isoCode":"NU","callingCode":"683","id":"164","name":"Niue"},{"isoCode":"NF","callingCode":"672","id":"249","name":"Norfolk Island"},{"isoCode":"KP","callingCode":"850","id":"166","name":"North Korea"},{"isoCode":"MP","callingCode":"1","id":"146","name":"Northern Mariana Islands"},{"isoCode":"NO","callingCode":"47","id":"167","name":"Norway"},{"isoCode":"OM","callingCode":"968","id":"168","name":"Oman"},{"isoCode":"PK","callingCode":"92","id":"169","name":"Pakistan"},{"isoCode":"PW","callingCode":"680","id":"170","name":"Palau"},{"isoCode":"PS","callingCode":"970","id":"232","name":"Palestinian Territory"},{"isoCode":"PA","callingCode":"507","id":"171","name":"Panama"},{"isoCode":"PG","callingCode":"675","id":"172","name":"Papua New Guinea"},{"isoCode":"PY","callingCode":"595","id":"173","name":"Paraguay"},{"isoCode":"PE","callingCode":"51","id":"174","name":"Peru"},{"isoCode":"PH","callingCode":"63","id":"175","name":"Philippines"},{"isoCode":"PL","callingCode":"48","id":"176","name":"Poland"},{"isoCode":"PT","callingCode":"351","id":"177","name":"Portugal"},{"isoCode":"PR","callingCode":"1","id":"179","name":"Puerto Rico"},{"isoCode":"QA","callingCode":"974","id":"180","name":"Qatar"},{"isoCode":"RE","callingCode":"262","id":"181","name":"Reunion"},{"isoCode":"RO","callingCode":"40","id":"182","name":"Romania"},{"isoCode":"RU","callingCode":"7","id":"2","name":"Russia"},{"isoCode":"RW","callingCode":"250","id":"183","name":"Rwanda"},{"isoCode":"BL","callingCode":"590","id":"251","name":"Saint Barthelemy"},{"isoCode":"SH","callingCode":"290","id":"197","name":"Saint Helena"},{"isoCode":"KN","callingCode":"1","id":"158","name":"Saint Kitts and Nevis"},{"isoCode":"LC","callingCode":"1","id":"199","name":"Saint Lucia"},{"isoCode":"MF","callingCode":"590","id":"252","name":"Saint Martin (French part)"},{"isoCode":"PM","callingCode":"508","id":"200","name":"Saint Pierre and Miquelon"},{"isoCode":"VC","callingCode":"1","id":"201","name":"Saint Vincent and the Grenadines"},{"isoCode":"WS","callingCode":"685","id":"44","name":"Samoa"},{"isoCode":"SM","callingCode":"378","id":"185","name":"San Marino"},{"isoCode":"ST","callingCode":"239","id":"178","name":"Sao Tome and Principe"},{"isoCode":"SA","callingCode":"966","id":"187","name":"Saudi Arabia"},{"isoCode":"SN","callingCode":"221","id":"94","name":"Senegal"},{"isoCode":"RS","callingCode":"381","id":"76","name":"Serbia"},{"isoCode":"SC","callingCode":"248","id":"186","name":"Seychelles"},{"isoCode":"SL","callingCode":"232","id":"198","name":"Sierra Leone"},{"isoCode":"SG","callingCode":"65","id":"188","name":"Singapore"},{"isoCode":"SX","callingCode":"1","id":"268","name":"Sint Maarten"},{"isoCode":"SK","callingCode":"421","id":"189","name":"Slovakia"},{"isoCode":"SI","callingCode":"386","id":"190","name":"Slovenia"},{"isoCode":"SB","callingCode":"677","id":"191","name":"Solomon Islands"},{"isoCode":"SO","callingCode":"252","id":"192","name":"Somalia"},{"isoCode":"ZA","callingCode":"27","id":"193","name":"South Africa"},{"isoCode":"KR","callingCode":"82","id":"194","name":"South Korea"},{"isoCode":"SS","callingCode":"211","id":"267","name":"South Sudan"},{"isoCode":"ES","callingCode":"34","id":"195","name":"Spain"},{"isoCode":"LK","callingCode":"94","id":"196","name":"Sri Lanka"},{"isoCode":"SD","callingCode":"249","id":"202","name":"Sudan"},{"isoCode":"SR","callingCode":"597","id":"203","name":"Suriname"},{"isoCode":"SZ","callingCode":"268","id":"204","name":"Swaziland"},{"isoCode":"SE","callingCode":"46","id":"205","name":"Sweden"},{"isoCode":"CH","callingCode":"41","id":"206","name":"Switzerland"},{"isoCode":"SY","callingCode":"963","id":"207","name":"Syria"},{"isoCode":"TW","callingCode":"886","id":"208","name":"Taiwan"},{"isoCode":"TJ","callingCode":"992","id":"209","name":"Tajikistan"},{"isoCode":"TZ","callingCode":"255","id":"210","name":"Tanzania, United Republic"},{"isoCode":"TH","callingCode":"66","id":"211","name":"Thailand"},{"isoCode":"TL","callingCode":"670","id":"137","name":"Timor-Leste"},{"isoCode":"TG","callingCode":"228","id":"212","name":"Togo"},{"isoCode":"TK","callingCode":"690","id":"213","name":"Tokelau"},{"isoCode":"TO","callingCode":"676","id":"214","name":"Tonga"},{"isoCode":"TT","callingCode":"1","id":"215","name":"Trinidad and Tobago"},{"isoCode":"TN","callingCode":"216","id":"216","name":"Tunisia"},{"isoCode":"TR","callingCode":"90","id":"217","name":"Turkey"},{"isoCode":"TM","callingCode":"993","id":"218","name":"Turkmenistan"},{"isoCode":"TC","callingCode":"1","id":"219","name":"Turks and Caicos Islands"},{"isoCode":"TV","callingCode":"688","id":"220","name":"Tuvalu"},{"isoCode":"UG","callingCode":"256","id":"221","name":"Uganda"},{"isoCode":"UA","callingCode":"380","id":"222","name":"Ukraine"},{"isoCode":"AE","callingCode":"971","id":"223","name":"United Arab Emirates"},{"isoCode":"GB","callingCode":"44","id":"224","name":"United Kingdom"},{"isoCode":"US","callingCode":"1","id":"1","name":"United States"},{"isoCode":"UY","callingCode":"598","id":"225","name":"Uruguay"},{"isoCode":"UZ","callingCode":"998","id":"227","name":"Uzbekistan"},{"isoCode":"VU","callingCode":"678","id":"228","name":"Vanuatu"},{"isoCode":"VA","callingCode":"379","id":"229","name":"Vatican City"},{"isoCode":"VE","callingCode":"58","id":"230","name":"Venezuela"},{"isoCode":"VN","callingCode":"84","id":"231","name":"Vietnam"},{"isoCode":"VG","callingCode":"1","id":"32","name":"Virgin Islands, British"},{"isoCode":"VI","callingCode":"1","id":"226","name":"Virgin Islands, U.S."},{"isoCode":"WF","callingCode":"681","id":"233","name":"Wallis and Futuna"},{"isoCode":"YE","callingCode":"967","id":"63","name":"Yemen"},{"isoCode":"ZM","callingCode":"260","id":"59","name":"Zambia"},{"isoCode":"ZW","callingCode":"263","id":"92","name":"Zimbabwe"}]')}}]);