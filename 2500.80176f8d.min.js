(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[2500],{758996:(e,t,r)=>{"use strict";r.r(t);r.d(t,{CalendarModule:()=>T});var n=r(667489);var o=r(960782);var i=r(187933);var a=r(587040);var c=r(470036);var u=r(58893);var s=r(978581);var l=r.n(s);var d=r(945760);var f=r(190420);var v=r(622483);var p=function(){function CalendarResponseParser(){this.name="CalendarResponseParser"}CalendarResponseParser.prototype.parse=function(e){var t=e.status,r=e.statusText,n=e.data;if(n&&n.errors&&n.errors instanceof Array&&n.errors.length>0){var o=n.errors[0];return this._parseByStatus(t,r,o)}return this._parseByStatus(t,r)};CalendarResponseParser.prototype._parseByStatus=function(e,t,r){if(l()(e)&&e===410){return new f.mE(d.w.GONE,t)}if(l()(e)&&e===403&&(r===null||r===void 0?void 0:r.errorCode)==="CIN-205"){(0,n.getModule)(v.CLOUD_INTEGRATION_MODULE).handleLocalExpired(r.providerId);return new f.mE(d.w.TOKEN_EXPIRED,t)}return null};return CalendarResponseParser}();var h=r(779071);var gen=function(e,t,r){if(e===void 0){e="id"}if(t===void 0){t=[]}return{unique:e,indices:t,onUpgrade:r}};var _={name:"Calendar",version:1,schema:{1:{provider:gen(),calendar:gen("id",["__providerId"]),event:gen("id",["__startTimestamp","[__providerId+__calendarId]"])},2:{userConfigs:gen("key")},3:{team_association:gen()},4:{provider2:gen(),calendar2:gen("id",["__providerId"]),event2:gen("id",["__startTimestamp","[__providerId+__calendarId]"])}}};const y=_;var C=r(12779);var E=r(177679);var S=r(40013);var g=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var P=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var b=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var T=function(e){g(CalendarModule,e);function CalendarModule(t){return e.call(this,t)||this}CalendarModule.prototype.onLoad=function(){var e=this;this._setupNetworkClient();this.calendarService.start();this.getHealthController().registerItemMap({isSyncing:function(){return e.isSyncing()},calendarInfo:function(){return P(e,void 0,void 0,(function(){var e,t,r,n,o;var i=this;return b(this,(function(a){switch(a.label){case 0:e=24*60*60*1e3;return[4,this.getProviders()];case 1:t=a.sent();return[4,Promise.all(t.map((function(e){return i.getCalendars(e.id)})))];case 2:r=a.sent();return[4,this.calendarService.getAssociationEntitySource().getAll()];case 3:n=a.sent();return[4,this.getAllEvents({eventFilter:function(t){return Math.abs(Date.now().valueOf()-t.__startTimestamp)<=e}})];case 4:o=a.sent().map((function(e){return{id:e.id,calendarId:e.__calendarId,title:e.title,startTime:e.startTime,endTime:e.endTime}}));return[2,{providers:t,calendars:r,recentEvents:o,associations:n}]}}))}))},calendarPresence:function(){return P(e,void 0,void 0,(function(){var e,t;return b(this,(function(r){switch(r.label){case 0:return[4,(0,n.getModule)(i.oF).getSettingItem(E.l.Calendar_Presence)];case 1:e=r.sent();t={};return[4,this._calendarService.getUserConfig().getPresenceLinks()];case 2:return[2,(t.links=r.sent(),t.state=e===null||e===void 0?void 0:e.state,t.value=e===null||e===void 0?void 0:e.value,t)]}}))}))}});this._initCommonKeyAction();n.notificationCenter.emit(h.FY.EVENT.CALENDAR_MODULE_LOAD_FINISH)};CalendarModule.prototype._initCommonKeyAction=function(){var e=this;var t=(0,n.getModule)(o.COMMON_KEY_ACTION_MODULE).getKeyActionService();t.register(o.ACTION_KEY.REGISTER_CALENDAR_SYNC_SOURCE,new S.sF(this.calendarService.eventSyncSourceProviderManager));t.register(o.ACTION_KEY.UNREGISTER_CALENDAR_SYNC_SOURCE,new S.FQ(this.calendarService.eventSyncSourceProviderManager));t.register(o.ACTION_KEY.CALENDAR_EVENT,new S.I1((function(t,r,n){return e.scheduleCalendarEvent(t,r,n)})));t===null||t===void 0?void 0:t.register(o.ACTION_KEY.DELETE_CALENDAR_EVENT,new S.WS((function(t,r,n){return e.deleteEvent(t,r,n)})));t===null||t===void 0?void 0:t.register(o.ACTION_KEY.GET_EVENT_FROM_REMOTE,new S.Rg((function(t,r,n){return e.getEventFromRemote(t,r,n)})))};CalendarModule.prototype.onUnload=function(){this.calendarService.stop()};CalendarModule.prototype.onDBRecoverRequire=function(){C.k.warn("DB integrity check failed. Calendar and event data will be re-synced.")};CalendarModule.prototype.getSchema=function(){return y};CalendarModule.prototype.moduleName=function(){return h.oF};CalendarModule.prototype.associateTeamWithEvent=function(e,t){return this.calendarService.associateTeamWithEvent(e,t)};CalendarModule.prototype.getProvider=function(e){return this.calendarService.getProvider(e)};CalendarModule.prototype.getProviders=function(){return this.calendarService.getProviders()};CalendarModule.prototype.getProvidersFromRemote=function(){return this.calendarService.getProvidersFromRemote()};CalendarModule.prototype.getCalendar=function(e){return this.calendarService.getCalendar(e)};CalendarModule.prototype.getCalendars=function(e,t){return this.calendarService.getCalendars(e,t)};CalendarModule.prototype.getEvent=function(e){return this.calendarService.getEvent(e)};CalendarModule.prototype.getEventFromRemote=function(e,t,r){return this.calendarService.getEventFromRemote(e,t,r)};CalendarModule.prototype.getAllEvents=function(e){return this.calendarService.getAllEvents(e)};CalendarModule.prototype.deleteEvent=function(e,t,r){return this.calendarService.deleteEvent(e,t,r)};CalendarModule.prototype.setSyncMode=function(e){this.calendarService.setSyncMode(e)};CalendarModule.prototype.syncProviders=function(){return this.calendarService.syncProviders()};CalendarModule.prototype.sync=function(e){return this.calendarService.sync(e)};CalendarModule.prototype.isSyncing=function(){return this.calendarService.isSyncing()};CalendarModule.prototype.scheduleCalendarEvent=function(e,t,r){return this.calendarService.scheduleCalendarEvent(e,t)};CalendarModule.prototype.getAllFilterOptions=function(){return this.calendarService.getAllFilterOptions()};CalendarModule.prototype.getCalendarFilterOption=function(){return this.calendarService.getCalendarFilterOption()};CalendarModule.prototype.setCalendarFilterOption=function(e){return this.calendarService.setCalendarFilterOption(e)};Object.defineProperty(CalendarModule.prototype,"calendarService",{get:function(){if(!this._calendarService){this._calendarService=new c.o(this.daoManager)}return this._calendarService},enumerable:true,configurable:true});CalendarModule.prototype._setupNetworkClient=function(){var e=(0,a.gT)();var t=e.getNetworkHandlerConfig(a.vm.RC_SERVER);if(t){var r={server:""+n.apiConfiguration.getConfig().rc.server};var o=new n.ResponseParser;o.register(new p);o.register(new n.CommonResponseParser);u.z.networkClient=e.buildNetworkClient(r,t,o)}};CalendarModule.prototype.subscribeEventReminder=function(e){return this.calendarService.addEventReminderController(e)};CalendarModule.prototype.registerSyncSourceProvider=function(e){return this.calendarService.registerSyncSourceProvider(e)};CalendarModule.prototype.unregisterSyncSourceProvider=function(e){return this.calendarService.unregisterSyncSourceProvider(e)};CalendarModule.prototype.getConnectedCalendars=function(e,t,r){return this.calendarService.getConnectedCalendars(e,t,r)};CalendarModule.prototype.getAllCalendars=function(e){return this.calendarService.getAllCalendars(e)};CalendarModule.prototype.getLimit=function(e){return this.calendarService.getLimit(e)};CalendarModule.prototype.connectCalendars=function(e,t,r){return this.calendarService.connectCalendars(e,t,r)};return CalendarModule}(n.AbstractModule)},628078:(e,t,r)=>{"use strict";r.d(t,{z:()=>v});var n=r(862926);var o=r(827027);var i={API_CIS:"/rcvideo/"+o.API_VERSION_V1+"/scheduling",API_CPC:"/restapi/v1.0/account/~/extension/~/calendar-presence-link",API_CIN:"/restapi/v1.0/account/~/extension/~/cloud-calendars/ucc"};var a=r(190420);var c=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var u=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var s=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var l=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e};var d=8191;var f=100;var v=function(){function CalendarApi(){}CalendarApi.getEvent=function(e,t,r){var o={path:n.RequestPath.buildRequestPath(i.API_CIS+"/providers/"+n.FORMAT_MARK+"/calendars/"+n.FORMAT_MARK+"/event/"+n.FORMAT_MARK+"?_="+n.FORMAT_MARK,e,t,r,Date.now()),method:n.NETWORK_METHOD.GET,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return CalendarApi.networkClient.http(o)};CalendarApi.deleteEvent=function(e,t,r){var o={path:n.RequestPath.buildRequestPath(i.API_CIS+"/providers/"+n.FORMAT_MARK+"/calendars/"+n.FORMAT_MARK+"/events/"+n.FORMAT_MARK,e,t,r),method:n.NETWORK_METHOD.DELETE,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return CalendarApi.networkClient.http(o)};CalendarApi.newCreateCalendarEvent=function(e,t,r){if(r.description&&r.description.length>d){throw new a.Eh("Description Max length: 8191")}var o={data:r,authFree:false,via:n.NETWORK_VIA.HTTP,method:n.NETWORK_METHOD.POST,HAPriority:n.HA_PRIORITY.HIGH,path:n.RequestPath.buildRequestPath(i.API_CIN+"/"+n.FORMAT_MARK+"/~/"+n.FORMAT_MARK+"/events",e,encodeURIComponent(t))};return CalendarApi.networkClient.http(o)};CalendarApi.getAllPresenceLinks=function(){var e={authFree:false,via:n.NETWORK_VIA.HTTP,method:n.NETWORK_METHOD.GET,HAPriority:n.HA_PRIORITY.HIGH,path:n.RequestPath.buildRequestPath(""+i.API_CPC)};return CalendarApi.networkClient.http(e)};CalendarApi.deleteAllPresenceLinks=function(){var e={authFree:false,via:n.NETWORK_VIA.HTTP,method:n.NETWORK_METHOD.DELETE,HAPriority:n.HA_PRIORITY.HIGH,path:n.RequestPath.buildRequestPath(""+i.API_CPC)};return CalendarApi.networkClient.http(e)};CalendarApi.setPresenceLinks=function(e){var t={data:e,authFree:false,via:n.NETWORK_VIA.HTTP,method:n.NETWORK_METHOD.PUT,HAPriority:n.HA_PRIORITY.HIGH,path:n.RequestPath.buildRequestPath(""+i.API_CPC)};return CalendarApi.networkClient.http(t)};CalendarApi.getConnectedCalendars=function(e){if(e===void 0){e=false}return c(this,void 0,Promise,(function(){var t,r;return u(this,(function(o){switch(o.label){case 0:t={path:n.RequestPath.buildRequestPath(i.API_CIN+"?sync="+n.FORMAT_MARK,""+e),method:n.NETWORK_METHOD.GET,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return[4,CalendarApi.networkClient.http(t)];case 1:r=o.sent();return[2,r.records]}}))}))};CalendarApi.getAvailableCalendarsByProviderId=function(e,t,r){return c(this,void 0,Promise,(function(){var o,a;return u(this,(function(c){switch(c.label){case 0:o={params:{perPage:r?r:f,pageToken:t?decodeURIComponent(t):undefined},path:n.RequestPath.buildRequestPath(i.API_CIN+"/"+n.FORMAT_MARK+"/~",e),method:n.NETWORK_METHOD.GET,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return[4,CalendarApi.networkClient.http(o)];case 1:a=c.sent();return[2,{calendars:a.records,pageToken:a.paging&&a.paging.nextPageToken,syncToken:a.syncToken}]}}))}))};CalendarApi.syncEventsNew=function(e,t,r,o){return c(this,void 0,Promise,(function(){var a,c,s;return u(this,(function(u){switch(u.label){case 0:a={startTimeFrom:r.startTimeFrom,startTimeTo:r.startTimeTo,includeNonRcEvents:r.includeNonRcEvents?"true":undefined,perPage:"100",pageToken:o?decodeURIComponent(o):undefined};c={params:a,path:n.RequestPath.buildRequestPath(i.API_CIN+"/"+n.FORMAT_MARK+"/~/"+n.FORMAT_MARK+"/events",e,encodeURIComponent(t)),method:n.NETWORK_METHOD.GET,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return[4,CalendarApi.networkClient.http(c)];case 1:s=u.sent();return[2,{events:s.records,pageToken:s.paging&&s.paging.nextPageToken,syncToken:s===null||s===void 0?void 0:s.syncToken}]}}))}))};CalendarApi.getProviderMetaData=function(){var e={path:n.RequestPath.buildRequestPath(i.API_CIN+"/provider-metadata"),method:n.NETWORK_METHOD.GET,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return CalendarApi.networkClient.http(e)};CalendarApi.connectCalendars=function(e,t,r){return c(this,void 0,Promise,(function(){var o,a;return u(this,(function(c){switch(c.label){case 0:o={records:l(t.map((function(e){return{calendarId:e,connected:true}})),r.map((function(e){return{calendarId:e,connected:false}})))};a={path:n.RequestPath.buildRequestPath(i.API_CIN+"/"+n.FORMAT_MARK+"/~",e),data:o,method:n.NETWORK_METHOD.PATCH,authFree:false,via:n.NETWORK_VIA.HTTP,HAPriority:n.HA_PRIORITY.HIGH};return[4,CalendarApi.networkClient.http(a)];case 1:c.sent();return[2]}}))}))};return CalendarApi}()},58893:(e,t,r)=>{"use strict";r.d(t,{z:()=>n.z});var n=r(628078);var o=r(960782)},779071:(e,t,r)=>{"use strict";r.d(t,{FY:()=>c,oF:()=>a,XU:()=>s,sP:()=>u,dL:()=>l,xO:()=>d});var n=r(615061);var o=r(295454);var i;var a=o.Lb.CALENDAR;var c={ENTITY:{CALENDAR_PROVIDER:"ENTITY.CALENDAR_PROVIDER",CALENDAR:"ENTITY.CALENDAR",CALENDAR_EVENT:"ENTITY.CALENDAR_EVENT",CALENDAR_FILTER_OPTION:"ENTITY.CALENDAR_FILTER_OPTION"},EVENT:{CALENDAR_MODULE_LOAD_FINISH:"CALENDAR_MODULE_LOAD_FINISH",CALENDAR_FILTER_OPTIONS_CHANGE:"CALENDAR_FILTER_OPTIONS_CHANGE"}};var u;(function(e){e["Google"]="google";e["Office365"]="office365"})(u||(u={}));var s=(i={},i[n.gf.GOOGLE]="google",i[n.gf.OFFICE365]="office365",i);var l=[n.gf.GOOGLE,n.gf.OFFICE365];var d=3},955166:(e,t,r)=>{"use strict";r.d(t,{tw:()=>n.EventType,Xt:()=>o});var n=r(204285);var o;(function(e){e["seriesMaster"]="RecurrentMaster";e["occurrence"]="Recurrent";e["singleInstance"]="Single"})(o||(o={}))},190420:(e,t,r)=>{"use strict";r.d(t,{mE:()=>u,jg:()=>s,Eh:()=>l});var n=r(862926);var o=r.n(n);var i=r(654588);var a=r(945760);var c=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var u=function(e){c(CalendarError,e);function CalendarError(t,r,n){return e.call(this,i.Pw,t,r,n)||this}return CalendarError}(n.JError);var s=function(e){c(CalendarNotFoundError,e);function CalendarNotFoundError(t,r){return e.call(this,a.w.NOT_FOUND,t,r)||this}return CalendarNotFoundError}(u);var l=function(e){c(CalendarParameterError,e);function CalendarParameterError(t,r){return e.call(this,a.w.INVALID_PARAMETER,t,r)||this}return CalendarParameterError}(u)},945760:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var n={GONE:"GONE",NOT_FOUND:"NOT_FOUND",INVALID_PARAMETER:"INVALID_PARAMETER",TOKEN_EXPIRED:"TOKEN_EXPIRED"}},40013:(e,t,r)=>{"use strict";r.d(t,{I1:()=>s,WS:()=>d,Rg:()=>v,sF:()=>i,FQ:()=>c});var n=r(667489);var o=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var i=function(e){o(RegisterSyncSourceKeyAction,e);function RegisterSyncSourceKeyAction(t,r){if(r===void 0){r=n.ActionWeight.NORMAL}var o=e.call(this,r)||this;o._eventSyncSourceProviderManager=t;return o}RegisterSyncSourceKeyAction.prototype.getAction=function(){return Promise.resolve(this._eventSyncSourceProviderManager.registerSyncSourceProvider)};return RegisterSyncSourceKeyAction}(n.AbstractKeyAction);var a=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var c=function(e){a(UnregisterSyncSourceKeyAction,e);function UnregisterSyncSourceKeyAction(t,r){if(r===void 0){r=n.ActionWeight.NORMAL}var o=e.call(this,r)||this;o._eventSyncSourceProviderManager=t;return o}UnregisterSyncSourceKeyAction.prototype.getAction=function(){return Promise.resolve(this._eventSyncSourceProviderManager.unregisterSyncSourceProvider)};return UnregisterSyncSourceKeyAction}(n.AbstractKeyAction);var u=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var s=function(e){u(CalendarEventKeyAction,e);function CalendarEventKeyAction(t,r){if(r===void 0){r=n.ActionWeight.NORMAL}var o=e.call(this,r)||this;o._schedule=t;return o}CalendarEventKeyAction.prototype.getAction=function(){var e=this;return Promise.resolve({schedule:function(t){return e._schedule(t.providerId,t,t.createEventDirectly)}})};return CalendarEventKeyAction}(n.AbstractKeyAction);var l=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var d=function(e){l(DeleteCalendarEventKeyAction,e);function DeleteCalendarEventKeyAction(t,r){if(r===void 0){r=n.ActionWeight.NORMAL}var o=e.call(this,r)||this;o._deleteEvent=t;return o}DeleteCalendarEventKeyAction.prototype.getAction=function(){return Promise.resolve(this._deleteEvent)};return DeleteCalendarEventKeyAction}(n.AbstractKeyAction);var f=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var v=function(e){f(GetEventFromRemoteKeyAction,e);function GetEventFromRemoteKeyAction(t,r){if(r===void 0){r=n.ActionWeight.NORMAL}var o=e.call(this,r)||this;o._getEventFromRemote=t;return o}GetEventFromRemoteKeyAction.prototype.getAction=function(){return Promise.resolve(this._getEventFromRemote)};return GetEventFromRemoteKeyAction}(n.AbstractKeyAction)},12779:(e,t,r)=>{"use strict";r.d(t,{u:()=>autoPrefix,k:()=>l});var n=r(862926);var o=r.n(n);var i=r(204285);var a=r(298784);var c=r.n(a);var u=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};function autoPrefix(e,t){if(t===void 0){t=""}Object.entries(e).forEach((function(r){var n=u(r,2),o=n[0],i=n[1];if(c().isString(i)){e[o]=t+"."+o+" "+i+" -> "}else{e[o]=autoPrefix(i,t?t+"."+o:o)}}));return e}var s="[CALENDAR][CORE]";var l=n.ModuleLogger.getLogger(s,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),i.VIDEO_EVENT_DATA_FEATURE_KEY)},631448:()=>{},470036:(e,t,r)=>{"use strict";r.d(t,{o:()=>Tt});var n=r(298784);var o=r.n(n);var i=r(667489);var a=r(587040);var c=r(204285);var u=r(955166);var s=r(58893);var l=r(161320);var d=r.n(l);var f=undefined&&undefined.__assign||function(){f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return f.apply(this,arguments)};var v=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var p=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var h=function(){function CalendarActionController(){}CalendarActionController.prototype.connectCalendars=function(e,t,r){return s.z.connectCalendars(e,t,r)};CalendarActionController.prototype.createCalendarEvent=function(e,t,r){var n,o;return v(this,void 0,Promise,(function(){var i,a;return p(this,(function(c){switch(c.label){case 0:i=function(e){return d()(e).toISOString(true).slice(0,-6)};return[4,s.z.newCreateCalendarEvent(e,t,{subject:r.subject,start:{dateTime:r.startDate?i(r.startDate):i(d()().minutes(0).seconds(0).add(1,"hour").toDate()),timeZone:!r.timezone?Intl.DateTimeFormat().resolvedOptions().timeZone:r.timezone},end:{dateTime:r.endDate?i(r.endDate):i(d()().minutes(0).seconds(0).add(2,"hour").toDate()),timeZone:!r.timezone?Intl.DateTimeFormat().resolvedOptions().timeZone:r.timezone},location:r.location,description:r.description,attendees:r.attendees})];case 1:a=c.sent();return[2,f(f({},a),{__calendarId:t,startTime:((n=a===null||a===void 0?void 0:a.start)===null||n===void 0?void 0:n.dateTime)+"Z",endTime:((o=a===null||a===void 0?void 0:a.end)===null||o===void 0?void 0:o.dateTime)+"Z"})]}}))}))};return CalendarActionController}();var _=r(862926);var y=r(622483);var C=r(628078);var E=r(779071);function getProvidersFromIntegrations(e){var t=[y.CLOUD_INTEGRATION_PROVIDER.GOOGLE,y.CLOUD_INTEGRATION_PROVIDER.OFFICE365];return t.map((function(t){var r,n;var o=e.find((function(e){return e.providerId===t&&e.scopeGroups.calendar}));if(o){if(o.active){return{id:E.XU[t],isAuthorized:true,isExpired:false,email:(r=o.subscriber)===null||r===void 0?void 0:r.email}}if(o.inactivityReason===y.INACTIVITY_REASON.EXPIRED){return{id:E.XU[t],isAuthorized:true,isExpired:true,email:(n=o.subscriber)===null||n===void 0?void 0:n.email}}}return{id:E.XU[t],isAuthorized:false,isExpired:false}}))}var S=undefined&&undefined.__assign||function(){S=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return S.apply(this,arguments)};var g=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var P=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var b=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var T=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e};var A=function(){function CalendarFetchController(e){this.eventsProcessor=e}CalendarFetchController.prototype.getProviders=function(){return g(this,void 0,Promise,(function(){var e;return P(this,(function(t){switch(t.label){case 0:return[4,(0,i.getModule)(y.CLOUD_INTEGRATION_MODULE).getIntegrations({providerIds:E.dL,getFromRemoteOption:y.GET_FROM_REMOTE_OPTION.IMMEDIATELY})];case 1:e=t.sent();return[2,getProvidersFromIntegrations(e)]}}))}))};CalendarFetchController.prototype.getCalendars=function(e,t){return g(this,void 0,Promise,(function(){var r,n,o,i,a,c;return P(this,(function(u){switch(u.label){case 0:return[4,C.z.getAvailableCalendarsByProviderId(e,t)];case 1:r=u.sent(),n=r.calendars,o=n===void 0?[]:n,i=r.pageToken;a=o.map((function(t){return S(S({},t),{id:t.calendarId,__providerId:e.toLowerCase()})}));if(!(i&&o.length!==0))return[3,3];return[4,this.getCalendars(e,i)];case 2:c=u.sent();return[2,T(a,c)];case 3:return[2,a]}}))}))};CalendarFetchController.prototype.getPrimaryCalendar=function(e){return g(this,void 0,Promise,(function(){var t,r,n;return P(this,(function(o){switch(o.label){case 0:return[4,C.z.getAvailableCalendarsByProviderId(e,undefined,1)];case 1:t=o.sent().calendars,r=t===void 0?[]:t;n=r.find((function(e){return e.primary}));if(n){return[2,n]}return[2,undefined]}}))}))};CalendarFetchController.prototype.getConnectedCalendars=function(e,t){return g(this,void 0,Promise,(function(){var r;return P(this,(function(n){switch(n.label){case 0:return[4,C.z.getConnectedCalendars(t)];case 1:r=n.sent();return[2,r.filter((function(t){return t.providerId.toLowerCase()===e.toLowerCase()})).map((function(t){return S(S({},t),{id:t.calendarId,__providerId:e})}))]}}))}))};CalendarFetchController.prototype.getEvents=function(e,t,r,n){return g(this,void 0,Promise,(function(){var o,i,a,c,u,s;return P(this,(function(l){switch(l.label){case 0:return[4,C.z.syncEventsNew(e,t,S(S({},r),{includeNonRcEvents:true}),n)];case 1:o=l.sent(),i=o.events,a=i===void 0?[]:i,c=o.pageToken;u=a.map((function(r){return S(S({},r),{__providerId:e,__calendarId:t,__rawId:r.id,startTime:r.start.dateTime+"Z",endTime:r.end.dateTime+"Z"})}));if(!(c&&a.length!==0))return[3,3];return[4,this.getEvents(e,t,r,c)];case 2:s=l.sent();return[2,T(u,s)];case 3:return[2,u]}}))}))};CalendarFetchController.prototype.getAllEvents=function(e){return g(this,void 0,void 0,(function(){var t,r,n;var i=this;return P(this,(function(a){switch(a.label){case 0:return[4,this.getProviders()];case 1:t=a.sent();return[4,(0,_.runInPool)(t.filter((function(e){return e.isAuthorized})).map((function(e){return function(){return i.getConnectedCalendars(e.id)}})))];case 2:r=a.sent();return[4,(0,_.runInPool)(o().flatMap(r,(function(t){return t.flatMap((function(e){return e})).filter((function(e){return!e.connected})).map((function(t){return function(){return i.getEvents(t.__providerId,t.id,e)}}))})))];case 3:n=a.sent();return[2,o().flatMap(n,(function(e){return i.eventsProcessor.process(e)}))]}}))}))};CalendarFetchController.prototype.getLimit=function(e){return g(this,void 0,Promise,(function(){var t,r;return P(this,(function(n){switch(n.label){case 0:return[4,C.z.getProviderMetaData()];case 1:t=n.sent();r=t.find((function(t){return t.providerId.toLowerCase()===e.toLowerCase()}));if(r){return[2,r.connectedCalendarsLimit]}return[2,E.xO]}}))}))};CalendarFetchController.prototype.getEvent=function(e,t,r){return C.z.getEvent(e,t,r)};return CalendarFetchController}();var m=r(95279);var I=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var O=function(e){I(CalendarProviderDao,e);function CalendarProviderDao(t){return e.call(this,CalendarProviderDao.COLLECTION_NAME,t)||this}CalendarProviderDao.COLLECTION_NAME="provider";return CalendarProviderDao}(m.BaseDao);var N=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var w=function(e){N(CalendarDao,e);function CalendarDao(t){return e.call(this,CalendarDao.COLLECTION_NAME,t)||this}CalendarDao.COLLECTION_NAME="calendar2";return CalendarDao}(m.BaseDao);var R=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var D=function(e){R(CalendarEventDao,e);function CalendarEventDao(t){return e.call(this,CalendarEventDao.COLLECTION_NAME,t)||this}CalendarEventDao.COLLECTION_NAME="event2";return CalendarEventDao}(m.BaseDao);var M=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var L=function(e){M(CalendarAssociationDao,e);function CalendarAssociationDao(t){return e.call(this,CalendarAssociationDao.COLLECTION_NAME,t)||this}CalendarAssociationDao.COLLECTION_NAME="team_association";return CalendarAssociationDao}(m.BaseDao);var F=undefined&&undefined.__assign||function(){F=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return F.apply(this,arguments)};var k=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var Y=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var U=function(){function CalendarEntitySourcesController(e){this._daoManager=e}CalendarEntitySourcesController.prototype._buildController=function(e){return(0,i.buildEntitySourceController)({entityPersistentController:(0,i.buildEntityPersistentController)(e,(0,i.buildEntityCacheController)(e.getEntityName()))})};CalendarEntitySourcesController.prototype.setProviders=function(e){return this.providerEntityController.bulkPut(e)};CalendarEntitySourcesController.prototype.deleteProviders=function(e){return this.providerEntityController.bulkDelete(e)};CalendarEntitySourcesController.prototype.getProvider=function(e){return this.providerEntityController.get(e)};CalendarEntitySourcesController.prototype.getProviders=function(){return this.providerEntityController.getAll()};CalendarEntitySourcesController.prototype.setCalendars=function(e,t){return k(this,void 0,Promise,(function(){return Y(this,(function(r){switch(r.label){case 0:return[4,this.calendarEntityController.bulkPut(t.map((function(t){return F(F({},t),{__providerId:e})})))];case 1:r.sent();return[2]}}))}))};CalendarEntitySourcesController.prototype.deleteCalendars=function(e){return this.calendarEntityController.bulkDelete(e)};CalendarEntitySourcesController.prototype.getCalendars=function(e){return this.calendarEntityController.getEntities((function(t){return t.__providerId===e}))};CalendarEntitySourcesController.prototype.setEvents=function(e,t,r){return k(this,void 0,Promise,(function(){return Y(this,(function(n){switch(n.label){case 0:return[4,this.eventEntityController.bulkPut(r.map((function(r){return F(F({},r),{__providerId:e,__calendarId:t})})))];case 1:n.sent();return[2]}}))}))};CalendarEntitySourcesController.prototype.cleanProviderData=function(e){return k(this,void 0,void 0,(function(){var t,r;return Y(this,(function(n){switch(n.label){case 0:return[4,this.calendarEntityController.getEntities((function(t){return e.includes(t.__providerId)}))];case 1:t=n.sent();return[4,this.calendarEntityController.bulkDelete(t.map((function(e){return e.id})))];case 2:n.sent();return[4,this.eventEntityController.getEntities((function(t){return e.includes(t.__providerId)}))];case 3:r=n.sent();return[4,this.eventEntityController.bulkDelete(r.map((function(e){return e.id})))];case 4:n.sent();return[2,{deleteCalendars:t,deleteEvents:r}]}}))}))};CalendarEntitySourcesController.prototype.deleteEvents=function(e){return this.eventEntityController.bulkDelete(e)};CalendarEntitySourcesController.prototype.getEvents=function(e,t,r){var n=r||{},o=n.startTimeFrom,i=o===void 0?undefined:o,a=n.startTimeTo,c=a===void 0?undefined:a;var u=i?d()(i).valueOf():undefined;var s=c?d()(c).valueOf():undefined;return this.eventEntityController.getEntities((function(r){if(r.__providerId===e&&r.__calendarId===t){if(u&&s){return r.__startTimestamp>=u&&r.__startTimestamp<=s}return true}return false}))};CalendarEntitySourcesController.prototype.getAllEvents=function(e){return k(this,void 0,Promise,(function(){var t,r,n,a,c,u;return Y(this,(function(s){switch(s.label){case 0:return[4,this.providerEntityController.getEntities((function(e){return e.isAuthorized}))];case 1:t=s.sent();r=t.reduce((function(e,t){e[t.id]=t;return e}),{});return[4,this.calendarEntityController.getEntities((function(e){return e.connected&&o().has(r,e.__providerId)}))];case 2:n=s.sent();a=n.reduce((function(e,t){e[t.id]=t;return e}),{});c=(e||{}).eventFilter,u=c===void 0?function(){return true}:c;return[2,this.eventEntityController.getEntities((function(e){if(o().has(a,e.__calendarId)&&o().get(a,[e.__calendarId,"__providerId"])===e.__providerId){return u(e)}return false}),(function(e,t){var r=e.__startTimestamp-t.__startTimestamp;var n=e.__endTimestamp-t.__endTimestamp;if(r===0&&n===0){return i.SortUtils.compareLowerCaseString(e.subject,t.subject)}return r===0?n:r}))]}}))}))};Object.defineProperty(CalendarEntitySourcesController.prototype,"providerEntityController",{get:function(){if(!this._providerEntityController){this._providerEntityController=this._buildController(this._daoManager.getDao(O))}return this._providerEntityController},enumerable:true,configurable:true});Object.defineProperty(CalendarEntitySourcesController.prototype,"calendarEntityController",{get:function(){if(!this._calendarEntityController){this._calendarEntityController=this._buildController(this._daoManager.getDao(w))}return this._calendarEntityController},enumerable:true,configurable:true});Object.defineProperty(CalendarEntitySourcesController.prototype,"eventEntityController",{get:function(){if(!this._eventEntityController){this._eventEntityController=this._buildController(this._daoManager.getDao(D))}return this._eventEntityController},enumerable:true,configurable:true});Object.defineProperty(CalendarEntitySourcesController.prototype,"associationEntityController",{get:function(){if(!this._associationEntityController){this._associationEntityController=this._buildController(this._daoManager.getDao(L))}return this._associationEntityController},enumerable:true,configurable:true});CalendarEntitySourcesController.prototype.setAssociation=function(e){return this.associationEntityController.put(e)};CalendarEntitySourcesController.prototype.getAssociation=function(e){return this.associationEntityController.get(e)};return CalendarEntitySourcesController}();var x=r(461197);var H=r(334065);var V=r(696206);var j=r(187933);var K=r(12779);var G=r(177679);var W=r(885057);var B=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var z=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var q=K.k.tags("[PresenceLink]");var X=15*1e3*60;var Q=1e3;var J="CALENDAR_PRESENCE_LINKS";var Z=12*1e3*60;function isPresenceLinksEmpty(e){return!e||e.length===0||e.filter((function(e){return e.calendarIds.length>0})).length===0}function isPresenceLinksDifferent(e,t){return!o().isEqual(e,t)}var $=function(){function CalendarPresenceLinkController(e){var t=this;this.calendarService=e;this._isNeedUpdate=false;this._syncPresenceLinks=function(){return B(t,void 0,void 0,(function(){var e,t,r,n,o,a,c,u;var l=this;return z(this,(function(d){switch(d.label){case 0:d.trys.push([0,16,,17]);return[4,this.calendarService.getUserConfig().getPresenceLinks()];case 1:t=d.sent();if(t)return[3,3];return[4,this._getAndUpdateCalendarPresenceLinks()];case 2:t=d.sent();d.label=3;case 3:e=t.sort((function(e,t){return i.SortUtils.compareString(e.providerId,t.providerId)})).map((function(e){e.calendarIds.sort();return e}));r=(0,x.getModule)(j.oF);return[4,r.getById(G.l.Calendar_Presence)];case 4:n=d.sent();q.info("STATUS:",{presenceLinks:e,setting:n});if(!((n===null||n===void 0?void 0:n.state)!==V.ESettingItemState.ENABLE))return[3,7];if(!!isPresenceLinksEmpty(e))return[3,6];q.info("CalendarPresence is not enable, should delete presence links..",e);return[4,this._doSync((function(){return B(l,void 0,void 0,(function(){return z(this,(function(e){switch(e.label){case 0:return[4,s.z.deleteAllPresenceLinks()];case 1:e.sent();return[4,this.calendarService.getUserConfig().setPresenceLink([])];case 2:e.sent();return[2]}}))}))}))];case 5:d.sent();return[2];case 6:q.info("CalendarPresence is not enable. Presence link already empty.");return[2];case 7:if(!((n===null||n===void 0?void 0:n.value)===true))return[3,13];return[4,this.calendarService.getProviders()];case 8:o=d.sent();return[4,(0,_.runInBand)(o.map((function(e){return function(){return B(l,void 0,void 0,(function(){var t;return z(this,(function(r){switch(r.label){case 0:if(!(e.isAuthorized&&!e.isExpired))return[3,2];t={providerId:e.id};return[4,this.calendarService.getCalendars(e.id)];case 1:return[2,(t.calendarIds=r.sent().filter((function(e){return!e.disabled})).map((function(e){return e.id})).sort(),t)];case 2:return[2,{providerId:e.id,calendarIds:[]}]}}))}))}})))];case 9:a=d.sent();c=isPresenceLinksDifferent(e,a);if(!c)return[3,11];q.info("CalendarPresence is On and has difference, should sync presence links..",{presenceLinks:e,newPresenceLinks:a});return[4,this._doSync((function(){return B(l,void 0,void 0,(function(){return z(this,(function(e){switch(e.label){case 0:return[4,s.z.setPresenceLinks(a)];case 1:e.sent();return[4,this.calendarService.getUserConfig().setPresenceLink(a)];case 2:e.sent();return[2]}}))}))}))];case 10:d.sent();return[3,12];case 11:q.info("CalendarPresence is On but not update.");d.label=12;case 12:return[3,15];case 13:if(!((n===null||n===void 0?void 0:n.value)===false&&!isPresenceLinksEmpty(e)))return[3,15];q.info("CalendarPresence is Off and presence links not empty, should delete presence links..",{presenceLinks:e});return[4,this._doSync((function(){return B(l,void 0,void 0,(function(){return z(this,(function(e){switch(e.label){case 0:return[4,s.z.deleteAllPresenceLinks()];case 1:e.sent();return[4,this.calendarService.getUserConfig().setPresenceLink([])];case 2:e.sent();return[2]}}))}))}))];case 14:d.sent();d.label=15;case 15:return[3,17];case 16:u=d.sent();q.warn("Sync links failed. Will try later.",{error:u});this._scheduleNextSync();return[3,17];case 17:return[2]}}))}))};this._debounceSync=o().debounce(this._syncPresenceLinks,Q)}CalendarPresenceLinkController.prototype.start=function(){var e=this;var t=(0,x.getModule)(j.oF);this._settingDisposer=t.observeSettingChange(G.l.Calendar_Presence,this._debounceSync);H.r.on(E.FY.ENTITY.CALENDAR,this._debounceSync);H.r.on(E.FY.ENTITY.CALENDAR_PROVIDER,this._debounceSync);W.L7.schedulePeriodicJob(J,(function(t){return B(e,void 0,void 0,(function(){return z(this,(function(e){try{this._getAndUpdateCalendarPresenceLinks();t(true)}catch(e){q.info("_executeDBEnsureJob() failed:",e);t(false)}return[2]}))}))}),true,Z,W.dV.BASE_ON_LAST_TIME)};CalendarPresenceLinkController.prototype.stop=function(){this._settingDisposer&&this._settingDisposer();H.r.off(E.FY.ENTITY.CALENDAR,this._debounceSync)};CalendarPresenceLinkController.prototype._debounceSync=function(){};CalendarPresenceLinkController.prototype._doSync=function(e){return B(this,void 0,void 0,(function(){var t;return z(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);this._isNeedUpdate=true;return[4,e()];case 1:r.sent();this._clearTimeout();this._isNeedUpdate=false;return[3,3];case 2:t=r.sent();q.warn("update Presence Link failed. Will try later.",{error:t});this._scheduleNextSync();return[3,3];case 3:return[2]}}))}))};CalendarPresenceLinkController.prototype._clearTimeout=function(){if(this._timeoutId){clearTimeout(this._timeoutId)}};CalendarPresenceLinkController.prototype._scheduleNextSync=function(){var e=this;this._clearTimeout();this._timeoutId=setTimeout((function(){e._isNeedUpdate&&e._debounceSync()}),X)};CalendarPresenceLinkController.prototype._getAndUpdateCalendarPresenceLinks=function(){return B(this,void 0,void 0,(function(){var e,t,r,n;return z(this,(function(o){switch(o.label){case 0:o.trys.push([0,4,,5]);e=(0,x.getModule)(j.oF);return[4,e.getById(G.l.Calendar_Presence)];case 1:t=o.sent();if((t===null||t===void 0?void 0:t.state)!==V.ESettingItemState.ENABLE)return[2,[]];return[4,s.z.getAllPresenceLinks()];case 2:r=o.sent()||[];return[4,this.calendarService.getUserConfig().setPresenceLink(r.sort((function(e,t){return i.SortUtils.compareString(e.providerId,t.providerId)})))];case 3:o.sent();return[2,r];case 4:n=o.sent();q.warn("get presencelinks failed.",n);return[2,[]];case 5:return[2]}}))}))};return CalendarPresenceLinkController}();var ee=r(118484);var te=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var re=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var ne=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var oe=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ne(arguments[t]));return e};var ie="[EventSyncSourceProviderManager]";var ae=K.k.tags(ie);var ce="fetch_calendar_events";var ue=function(){function EventSyncSourceProviderManager(){var e=this;this._handleSyncSourceReadyProviderEvent=function(t){ae.info("Sync source "+t+" is ready.");if(e._providerReadyBarrier.isOpen())return;e._providerMap.set(t,true);oe(e._providerMap.values()).every((function(e){return!!e}))&&e._providerReadyBarrier.open();ae.info("Sync source ready state: "+JSON.stringify(oe(e._providerMap.keys()).map((function(t){return{key:t,ready:e._providerMap.get(t)}}))))};this.registerSyncSourceProvider=function(t){if(e._getProviderBySourceName(t.getSourceName()))return;e._syncSourceProviders.push(t);e._syncSourceProviders.sort((function(e,t){return e.getPriority()-t.getPriority()}));e._hasStarted&&t.start();t.setSyncMode(e._syncMode);i.notificationCenter.emit(E.FY.EVENT.CALENDAR_FILTER_OPTIONS_CHANGE);ae.info(t.getSourceName()+" has been registered into CalendarSyncSourceProviderManager. All providers: "+e._syncSourceProviders.map((function(e){return e.getSourceName()})))};this.unregisterSyncSourceProvider=function(t){var r=e._getProviderBySourceName(t);if(r){r.stop();e._syncSourceProviders=e._syncSourceProviders.filter((function(e){return e!==r}));i.notificationCenter.emit(E.FY.EVENT.CALENDAR_FILTER_OPTIONS_CHANGE);ae.info(t+" has been stopped and unregistered from CalendarSyncSourceProviderManager. All providers: "+e._syncSourceProviders.map((function(e){return e.getSourceName()})))}};this._syncSourceProviders=[];this._providerMap=new Map;this._syncMode=ee.JW.NORMAL;this._hasStarted=false;this._providerReadyBarrier=new _.Barrier;this._initializeProviderMap();i.notificationCenter.on(c.CALENDAR_SYNC_SOURCE_EVENT.SYNC_SOURCE_READY,this._handleSyncSourceReadyProviderEvent)}EventSyncSourceProviderManager.prototype._initializeProviderMap=function(){var e=this;c.CALENDAR_SYNC_SOURCE_LIST.forEach((function(t){return e._providerMap.set(t,false)}))};EventSyncSourceProviderManager.prototype._isSyncSourceProviderReady=function(){return this._providerReadyBarrier.wait()};Object.defineProperty(EventSyncSourceProviderManager.prototype,"syncSourceProviders",{get:function(){return this._syncSourceProviders},enumerable:true,configurable:true});EventSyncSourceProviderManager.prototype.getSyncSourceProvider=function(e){return this._getProviderBySourceName(e)};EventSyncSourceProviderManager.prototype.start=function(){this._syncSourceProviders.forEach((function(e){return e.start()}));this._hasStarted=true};EventSyncSourceProviderManager.prototype.stop=function(){this._syncSourceProviders.forEach((function(e){return e.stop()}));this._hasStarted=false};EventSyncSourceProviderManager.prototype._getProviderBySourceName=function(e){return this._syncSourceProviders.find((function(t){return t.getSourceName()===e}))};EventSyncSourceProviderManager.prototype.getEvent=function(e){var t=this;return new Promise((function(r){(0,_.runInPool)(t._syncSourceProviders.map((function(t){return function(){return t.getEvent(e)}}))).then((function(e){var t=e.find((function(e){return!!e}));r(t!==null&&t!==void 0?t:null)}))}))};EventSyncSourceProviderManager.prototype.getEvents=function(e){return te(this,void 0,Promise,(function(){var t=this;return re(this,(function(r){switch(r.label){case 0:return[4,this._providerReadyBarrier.wait()];case 1:r.sent();return[2,new Promise((function(r){var n=K.k.performance();(0,_.runInPool)(t._syncSourceProviders.map((function(t){return function(){return t.getEvents(e).catch((function(e){ae.warn("Unable to get events from "+t.getSourceName()+" due to "+e+".");return[]}))}}))).then((function(e){n.end({key:ce,level:_.LOG_CONTROL_LEVEL.HIGH});r(e.reduce((function(e,t){return oe(e,t)}),[]))}))}))]}}))}))};EventSyncSourceProviderManager.prototype._syncAllProviders=function(e){var t=this;return new Promise((function(r){(0,_.runInPool)(t._syncSourceProviders.map((function(t){return function(){return t.sync(e).catch((function(e){ae.warn("Unable to sync events from "+t.getSourceName()+" due to "+e+". Will skip this sync process.")}))}}))).then((function(){return r()}))}))};EventSyncSourceProviderManager.prototype.sync=function(e){return te(this,void 0,Promise,(function(){return re(this,(function(t){switch(t.label){case 0:return[4,this._providerReadyBarrier.wait()];case 1:t.sent();return[2,this._syncAllProviders(e)]}}))}))};EventSyncSourceProviderManager.prototype.isSyncing=function(e){var t,r;if(e){return(r=(t=this._getProviderBySourceName(e))===null||t===void 0?void 0:t.isSyncing())!==null&&r!==void 0?r:false}return this._syncSourceProviders.map((function(e){return e.isSyncing()})).reduce((function(e,t){return e||t}))};EventSyncSourceProviderManager.prototype.getFilterOptions=function(e){var t,r;return te(this,void 0,Promise,(function(){var n=this;return re(this,(function(o){switch(o.label){case 0:return[4,this._isSyncSourceProviderReady()];case 1:o.sent();if(e){return[2,(r=(t=this._getProviderBySourceName(e))===null||t===void 0?void 0:t.getFilterOptions())!==null&&r!==void 0?r:Promise.resolve([])]}return[2,new Promise((function(e){(0,_.runInPool)(n.syncSourceProviders.map((function(e){return function(){return te(n,void 0,void 0,(function(){var t;return re(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.getFilterOptions()];case 1:return[2,r.sent()];case 2:t=r.sent();ae.warn("Unable to get filter options from "+e.getSourceName()+" due to "+t+".");return[2,[]];case 3:return[2]}}))}))}}))).then((function(t){return e(t.reduce((function(e,t){return oe(e,t)}),[]).sort((function(e,t){return e.order-t.order})))}))}))]}}))}))};EventSyncSourceProviderManager.prototype.setSyncMode=function(e){this._syncMode=e;this._syncSourceProviders.forEach((function(t){return t.setSyncMode(e)}));ae.info("sync mode has switched to ",e)};EventSyncSourceProviderManager.prototype.getSyncMode=function(){return this._syncMode};EventSyncSourceProviderManager.prototype._waitAllSynced=function(){var e=this;return new Promise((function(t){(0,_.runInPool)(e._syncSourceProviders.map((function(e){return function(){return e.waitSynced().catch((function(t){ae.error("Waiting for "+e.getSourceName()+" failed due to "+t+".")}))}}))).then((function(){return t()}))}))};EventSyncSourceProviderManager.prototype.waitSynced=function(e){var t,r;if(e){return(r=(t=this._getProviderBySourceName(e))===null||t===void 0?void 0:t.waitSynced())!==null&&r!==void 0?r:Promise.resolve()}return this._waitAllSynced()};return EventSyncSourceProviderManager}();var se=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var le=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var de=K.k.tags("[SyncQueue]");var fe;(function(e){e["google"]="google";e["office365"]="office365";e["all"]="all"})(fe||(fe={}));var ve=2;var pe=function(){function CalendarSyncQueue(e){this._executeFunc=e;this._queue=[];this._waiters=[];this._isExecuting=false}CalendarSyncQueue.prototype.executeInQueue=function(e,t){var r=this;this._addToQueue(e,t);var n=new Promise((function(t,n){r._waiters.push({pid:e,addTime:Date.now(),resolve:t,reject:n})}));this._triggerExecute();return n};CalendarSyncQueue.prototype._triggerExecute=function(){if(this._isExecuting){return}var e=this._queue.shift();if(e){this._execute(e.providerId,e.calendarId)}};CalendarSyncQueue.prototype._execute=function(e,t){return se(this,void 0,void 0,(function(){var r,n;return le(this,(function(o){switch(o.label){case 0:this._isExecuting=true;r=Date.now();o.label=1;case 1:o.trys.push([1,3,4,5]);return[4,this._executeFunc(e,t)];case 2:o.sent();this._notifySuccessToWaiters(e,r);return[3,5];case 3:n=o.sent();this._notifyFailToWaiters(n,e,r);return[3,5];case 4:this._isExecuting=false;this._triggerExecute();return[7];case 5:return[2]}}))}))};CalendarSyncQueue.prototype._notifySuccessToWaiters=function(e,t){this._waiters.filter((function(r){return r.addTime<=t&&(r.pid===e||e===fe.all)})).forEach((function(e){return e.resolve()}))};CalendarSyncQueue.prototype._notifyFailToWaiters=function(e,t,r){this._waiters.filter((function(e){return e.addTime<=r&&(e.pid===t||t===fe.all)})).forEach((function(t){return t.reject(e)}))};CalendarSyncQueue.prototype._addToQueue=function(e,t){if(e===fe.all){this._queue=[{providerId:fe.all}];de.info("info: queue: [all]")}else if(this._queue.findIndex((function(e){return e.providerId===fe.all}))>-1){return}else if(this._queue.findIndex((function(t){return t.providerId===e}))>-1){return}else{this._queue.push({providerId:e,calendarId:t});if(this._queue.length>=ve){this._queue=[{providerId:fe.all}]}de.info("info: queue: ",this._queue)}};return CalendarSyncQueue}();var he=r(654588);var _e=r(945760);var isExpiredError=function(e){return _.errorUtils.errorConditionSelector(e,{type:he.Pw,codes:[_e.w.GONE]})};function sanitizeEvent(e){return{id:e.id,subject:(0,_.sanitize)(e.subject,{$truncate:10}),cancelled:e.cancelled,allDay:e.allDay,startTime:e.startTime,endTime:e.endTime}}function sanitizeArray(e,t){return e.map(t)}function sanitizeEvents(e){return sanitizeArray(e,sanitizeEvent)}var ye=undefined&&undefined.__assign||function(){ye=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return ye.apply(this,arguments)};var Ce=undefined&&undefined.__rest||function(e,t){var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0)r[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++){if(t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o]))r[n[o]]=e[n[o]]}return r};function convertEventsToOld(e){return e.map((function(e){return convertEventToOld(e)}))}function convertEventToOld(e){var t=e.subject,r=e.cancelled,n=e.allDay,o=e.responseStatus,i=e.presenceStatus,a=e.recurrentMasterId,c=e.webEditUri,s=e.visibility,l=e.attendees,d=e.type,f=Ce(e,["subject","cancelled","allDay","responseStatus","presenceStatus","recurrentMasterId","webEditUri","visibility","attendees","type"]);var v=l?l.map((function(e){return{name:e.name,email:e.email,acceptance:e.responseStatus,isOptional:e.optional}})):[];var p=u.tw.singleInstance;switch(e.type){case u.Xt.occurrence:p=u.tw.occurrence;break;case u.Xt.seriesMaster:p=u.tw.seriesMaster;break;case u.Xt.singleInstance:p=u.tw.singleInstance;break;default:K.k.tags("[convertEventToOld]").warn("there are some errors in event type:",e.type)}var h=ye(ye({title:t,isCancelled:r,isAllDay:n,acceptance:o&&o.toLowerCase(),busyness:i&&i.toLowerCase(),visibility:s&&s.toLowerCase(),seriesMasterId:a,editEventUrl:c,attendees:v,type:p},f),{start:null,end:null});Object.keys(h).forEach((function(e){return h[e]==null&&delete h[e]}));return h}function convertCalendarsToOld(e){return e.map((function(e){return convertCalendarToOld(e)}))}function convertCalendarToOld(e){var t=e.calendarId,r=e.primary,n=e.connected,o=Ce(e,["calendarId","primary","connected"]);return ye(ye({isPrimary:r,disabled:!n,ownerAddress:""},o),{id:t})}var Ee=r(728687);var Se=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var ge=undefined&&undefined.__decorate||function(e,t,r,n){var o=arguments.length,i=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)if(a=e[c])i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i;return o>3&&i&&Object.defineProperty(t,r,i),i};var Pe=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var be=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var Te=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Ae=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var me=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ae(arguments[t]));return e};var Ie;var Oe=K.k.tags("[CalendarEventSyncController]");var Ne=(0,K.u)({SYNC_MODE:{SET:"",INTERVAL_MAP:""},SYNC:{HAS_EXECUTING_JOB:"",START:"",SUCCESS:"",FINISHED:"",DO_SYNC:"",FAILED:"",SKIP_TIME:"",SCHEDULE:"",SILENT:{START:"",FAILED:""},PROVIDER:{RESULT:"",CHANGED:"",FAILED:"",EXPIRED:""},CALENDAR:{RESULT:"",CHANGED:"",FAILED:"",EXPIRED:""},EVENT:{RESULT:"",CHANGED:"",FAILED:"",EXPIRED:""}}});var we="[CalendarEventSyncController]";var Re=(Ie={},Ie[ee.JW.NORMAL]=30*60*1e3,Ie[ee.JW.ADVANCE]=5*60*1e3,Ie);var De=24*60*60*1e3;var Me=function(e){Se(CalendarEventSyncController,e);function CalendarEventSyncController(t,r,n,i,a){var c=e.call(this,{syncName:we})||this;c.calendarDataController=t;c.calendarCache=r;c.eventsProcessor=n;c.handleUpdateController=i;c._userConfig=a;c._syncMode=ee.JW.NORMAL;c._waiters=[];c._syncModeIntervalMap=o().cloneDeep(Re);c._startSyncTime=0;c._lastChangedAuthProviders={};c._stopped=false;c._handleIncomingEvents=function(e,t,r,n){return be(c,void 0,void 0,(function(){var i=this;return Te(this,(function(a){switch(a.label){case 0:return[4,this._compareChanges(r,n,{comparator:function(e,t){if(e.id!==t.id)return false;if(e.etag!==t.etag)return false;return o().isEqual(e,t)},changeMapCallback:function(n){return be(i,void 0,void 0,(function(){var o;return Te(this,(function(i){switch(i.label){case 0:Oe.info(Ne.SYNC.EVENT.CHANGED,{deleted:sanitizeEvents(n.deleted||[]),added:sanitizeEvents(n.added||[]),updated:sanitizeEvents(n.updated||[])});o=n.deleted;if(!o)return[3,2];return[4,this.calendarCache.deleteEvents(n.deleted.map((function(e){return e.id})))];case 1:o=i.sent();i.label=2;case 2:o;return[4,this.calendarCache.setEvents(e,t,r)];case 3:i.sent();this._emitChangeMap(E.FY.ENTITY.CALENDAR_EVENT,{added:convertEventsToOld(n.added||[]),deleted:convertEventsToOld(n.deleted||[]),updated:convertEventsToOld(n.updated||[])});return[2]}}))}))}})];case 1:a.sent();return[2]}}))}))};return c}CalendarEventSyncController.prototype.setSyncMode=function(e){Oe.info(Ne.SYNC_MODE.SET,e);var t=e!==this._syncMode;this._syncMode=e;t&&this.onPollingIntervalUpdated()};CalendarEventSyncController.prototype.getSyncMode=function(){return this._syncMode};CalendarEventSyncController.prototype.getStartSyncTime=function(){return this._startSyncTime};CalendarEventSyncController.prototype.updateSyncModeIntervalMap=function(e){var t=e[this._syncMode]&&this._syncModeIntervalMap[this._syncMode]!==e[this._syncMode];this._syncModeIntervalMap=o().merge(this._syncModeIntervalMap,o().pickBy(e,o().identity));t&&this.onPollingIntervalUpdated();Oe.info(Ne.SYNC_MODE.INTERVAL_MAP,this._syncModeIntervalMap,e)};CalendarEventSyncController.prototype.stop=function(){this._stopped=true;this.stopPolling()};CalendarEventSyncController.prototype.startPolling=function(){if(this._stopped){return Promise.resolve()}return e.prototype.startPolling.call(this)};CalendarEventSyncController.prototype.sync=function(e,t){return be(this,void 0,Promise,(function(){var r;return Te(this,(function(n){switch(n.label){case 0:Oe.info(Ne.SYNC.START);if(this.isJobExecuting()){this._scheduleSync=true;Oe.info(Ne.SYNC.HAS_EXECUTING_JOB,"waiting job done");return[2,this._addWaiter()]}this._syncingProviderId=e;this._scheduleSync=false;this.stopPolling();n.label=1;case 1:n.trys.push([1,3,4,5]);this._startSyncTime=Date.now();return[4,this._doSync(e,t)];case 2:n.sent();this._syncingProviderId=undefined;Oe.info(Ne.SYNC.SUCCESS);this._waiters.forEach((function(e){return e.resolve()}));return[3,5];case 3:r=n.sent();this._syncingProviderId=undefined;Oe.warn(Ne.SYNC.FAILED,{error:r});this._waiters.forEach((function(e){return e.reject(r)}));throw r;case 4:Oe.info(Ne.SYNC.FINISHED,"restart polling");this._waiters=[];this.startPolling();return[7];case 5:return[2]}}))}))};CalendarEventSyncController.prototype.waitSynced=function(){if(this.isSyncing()){return this._addWaiter()}return Promise.resolve()};CalendarEventSyncController.prototype.getPollingInterval=function(){return this._syncModeIntervalMap[this._syncMode]};CalendarEventSyncController.prototype.getPollingIntervalOffset=function(){if(this._syncMode===ee.JW.NORMAL){return Math.random()*1e3*60*10}return 0};CalendarEventSyncController.prototype.getLastSyncTime=function(){return 0};CalendarEventSyncController.prototype.doSilentSyncLatestData=function(){return be(this,void 0,Promise,(function(){return Te(this,(function(e){switch(e.label){case 0:Oe.info(Ne.SYNC.SILENT.START);return[4,this._doSync().catch((function(e){Oe.warn(Ne.SYNC.SILENT.FAILED,{error:e})}))];case 1:e.sent();return[2]}}))}))};CalendarEventSyncController.prototype.onPollingDone=function(){return be(this,void 0,void 0,(function(){return Te(this,(function(e){switch(e.label){case 0:if(!this._scheduleSync)return[3,2];Oe.info(Ne.SYNC.SCHEDULE,"find schedule job.");return[4,this.sync()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};CalendarEventSyncController.prototype.isSyncing=function(){return this._isSyncing};CalendarEventSyncController.prototype.getSyncingProviderId=function(){return this._syncingProviderId};CalendarEventSyncController.prototype._doSync=function(e,t){return be(this,void 0,Promise,(function(){var r,n,o;return Te(this,(function(i){switch(i.label){case 0:this._isSyncing=true;r=d()().startOf("day");n=d()().startOf("day").add(5,"day");Oe.info(Ne.SYNC.DO_SYNC,e);i.label=1;case 1:i.trys.push([1,3,4,5]);return[4,this._syncAllEvents({startTimeFrom:r.toISOString(),startTimeTo:n.toISOString()},e,t)];case 2:i.sent();return[3,5];case 3:o=i.sent();Oe.info(Ne.SYNC.FAILED,{error:o});throw o;case 4:this._isSyncing=false;return[7];case 5:return[2]}}))}))};CalendarEventSyncController.prototype._cleanEvents=function(e,t){return be(this,void 0,void 0,(function(){var r,n;return Te(this,(function(o){switch(o.label){case 0:return[4,this.calendarCache.getEvents(e,t)];case 1:r=o.sent();n=r.length;if(!n)return[3,3];return[4,this.calendarCache.deleteEvents(r.map((function(e){return e.id})))];case 2:n=o.sent();o.label=3;case 3:n;return[4,this._emitChangeMap(E.FY.ENTITY.CALENDAR_EVENT,{deleted:convertEventsToOld(r)})];case 4:o.sent();return[2]}}))}))};CalendarEventSyncController.prototype._cleanCalendar=function(e){return be(this,void 0,void 0,(function(){var t,r;var n=this;return Te(this,(function(o){switch(o.label){case 0:return[4,this.calendarCache.getCalendars(e)];case 1:t=o.sent();r=t.length;if(!r)return[3,3];return[4,this.calendarCache.deleteCalendars(t.map((function(e){return e.id})))];case 2:r=o.sent();o.label=3;case 3:r;return[4,this._emitChangeMap(E.FY.ENTITY.CALENDAR,{deleted:convertCalendarsToOld(t)})];case 4:o.sent();return[2,(0,_.runInPool)(t.map((function(t){return function(){return n._cleanEvents(e,t.id)}})))]}}))}))};CalendarEventSyncController.prototype.updateProviders=function(e){return be(this,void 0,void 0,(function(){var t;var r=this;return Te(this,(function(n){switch(n.label){case 0:Oe.log("CalendarEventSyncController","updateProviders.");return[4,this.calendarCache.getProviders()];case 1:t=n.sent();return[4,this._compareChanges(e,t,{comparator:function(e,t){return e.id===t.id&&e.isAuthorized===t.isAuthorized&&!e.isExpired===!t.isExpired},changeMapCallback:function(n){return be(r,void 0,void 0,(function(){var r,a,c,u;var s=this;var l;return Te(this,(function(d){switch(d.label){case 0:Oe.info(Ne.SYNC.PROVIDER.CHANGED,(0,_.sensitive)(n,["email"]));r=false;if(!((l=n.updated)===null||l===void 0?void 0:l.length))return[3,2];return[4,(0,i.getModule)(V.oF).getSettingItem(Ee.l.Calendar_Presence)];case 1:a=d.sent();n.updated.forEach((function(e){var r;s._lastChangedAuthProviders[e.id]=t.find((function(t){return t.id===e.id&&t.isAuthorized&&t.email!==e.email}));if(e.isAuthorized&&t.findIndex((function(t){return t.id!==e.id&&t.isAuthorized}))===-1&&(a===null||a===void 0?void 0:a.value)){(r=a.valueSetter)===null||r===void 0?void 0:r.call(a,false)}}));r=true;d.label=2;case 2:c=o().intersectionWith(me(n.updated||[],n.deleted||[]).filter((function(e){return!e.isAuthorized})),t.filter((function(e){return e.isAuthorized})),(function(e,t){return e.id===t.id}));(c===null||c===void 0?void 0:c.length)&&Oe.info(Ne.SYNC.PROVIDER.CHANGED,"newUnauthorizedList:",(0,_.sensitive)(c,["email"]));return[4,Promise.all(c.map((function(e){return s._cleanCalendar(e.id)})))];case 3:d.sent();u=n.deleted;if(!u)return[3,5];return[4,this.calendarCache.deleteProviders(n.deleted.map((function(e){return e.id})))];case 4:u=d.sent();d.label=5;case 5:u&&(r=true);return[4,this.calendarCache.setProviders(e)];case 6:d.sent();r&&i.notificationCenter.emit(E.FY.EVENT.CALENDAR_FILTER_OPTIONS_CHANGE);this._emitChangeMap(E.FY.ENTITY.CALENDAR_PROVIDER,n);return[2]}}))}))}})];case 2:n.sent();return[2]}}))}))};CalendarEventSyncController.prototype.syncProviders=function(){return this._syncProviders()};CalendarEventSyncController.prototype._syncProviders=function(){return be(this,void 0,Promise,(function(){var e;return Te(this,(function(t){switch(t.label){case 0:return[4,this.calendarDataController.getProviders()];case 1:e=t.sent();return[4,this.updateProviders(e)];case 2:t.sent();return[2,e]}}))}))};CalendarEventSyncController.prototype._syncCalendars=function(e,t){if(t===void 0){t=false}return be(this,void 0,Promise,(function(){var r,n;return Te(this,(function(o){switch(o.label){case 0:if(!e.isAuthorized){return[2,Promise.resolve([])]}if(t||e.isExpired){return[2,this.calendarCache.getCalendars(e.id)]}return[4,this._userConfig.getLastSyncCalendarsTime()];case 1:r=o.sent()||0;n=Date.now()-r>De?true:false;return[2,this._fillProviderCalendars(e,n)]}}))}))};CalendarEventSyncController.prototype._syncEvents=function(e,t,r,n){if(n===void 0){n=false}if(!e.isAuthorized||!t.connected){return Promise.resolve([])}if(n||e.isExpired){return this.calendarCache.getEvents(e.id,t.id)}return this._getEvents(e.id,t.id,r)};CalendarEventSyncController.prototype._syncAllEvents=function(e,t,r){return be(this,void 0,Promise,(function(){var n,o,i;var a=this;return Te(this,(function(c){switch(c.label){case 0:return[4,this._syncProviders()];case 1:n=c.sent();return[4,(0,_.runInPool)(n.filter((function(e){return e.isAuthorized})).map((function(n){return function(){return be(a,void 0,void 0,(function(){var o,i,a,c,u;var s=this;return Te(this,(function(l){switch(l.label){case 0:o=n.isExpired||(t?t!==n.id:false);i=o||!!r;return[4,this._syncCalendars(n,i)];case 1:a=l.sent();return[4,(0,_.runInPool)(a.map((function(t){return function(){return be(s,void 0,void 0,(function(){var i,a;return Te(this,(function(c){switch(c.label){case 0:i=(r?r!==t.id:false)||o;return[4,this._syncEvents(n,t,e,i)];case 1:a=c.sent();return[2,a]}}))}))}})))];case 2:c=l.sent();u=c.flatMap((function(e){return e}));delete this._lastChangedAuthProviders[n.id];return[2,u]}}))}))}})))];case 2:o=c.sent();i=o.flatMap((function(e){return e}));this.handleUpdateController.handleEvents(i||[]);Oe.info(Ne.SYNC.EVENT.RESULT,{providerId:t},"sync events result: ",i&&sanitizeEvents(i));return[2,i]}}))}))};CalendarEventSyncController.prototype._fillProviderCalendars=function(e,t){return be(this,void 0,Promise,(function(){var r,n,o,i;var a=this;return Te(this,(function(c){switch(c.label){case 0:return[4,this.calendarCache.getCalendars(e.id)];case 1:r=c.sent();n=function(t){return be(a,void 0,void 0,(function(){var r,n;var o=this;return Te(this,(function(i){switch(i.label){case 0:r=this._compareChanges;n=[t];return[4,this.calendarCache.getCalendars(e.id)];case 1:return[4,r.apply(this,n.concat([i.sent(),{changeMapCallback:function(r){return be(o,void 0,void 0,(function(){var n,o,i,a,c;var u=this;return Te(this,(function(s){switch(s.label){case 0:Oe.info(Ne.SYNC.CALENDAR.CHANGED,(0,_.sensitive)(r,["email"]));n=r.updated,o=n===void 0?[]:n,i=r.deleted,a=i===void 0?[]:i;c=a.length;if(!c)return[3,2];return[4,this.calendarCache.deleteCalendars(a.map((function(e){return e.id})))];case 1:c=s.sent();s.label=2;case 2:c;return[4,(0,_.runInPool)(me(o.filter((function(e){return!e.connected})),a).map((function(t){return function(){return u._cleanEvents(e.id,t.id)}})))];case 3:s.sent();return[4,this.calendarCache.setCalendars(e.id,t)];case 4:s.sent();this._emitChangeMap(E.FY.ENTITY.CALENDAR,{added:convertCalendarsToOld(r.added||[]),deleted:convertCalendarsToOld(r.deleted||[]),updated:convertCalendarsToOld(r.updated||[])});return[2]}}))}))}}]))];case 2:i.sent();return[2]}}))}))};c.label=2;case 2:c.trys.push([2,5,,6]);return[4,this.calendarDataController.getConnectedCalendars(e.id,t)];case 3:o=c.sent();if(t){this._userConfig.setLastSyncCalendarsTime(Date.now())}return[4,n(o)];case 4:c.sent();Oe.info(Ne.SYNC.CALENDAR.RESULT,o);return[2,o];case 5:i=c.sent();Oe.warn(Ne.SYNC.CALENDAR.FAILED,{error:i});if(isExpiredError(i)){Oe.info(Ne.SYNC.CALENDAR.EXPIRED,"fetch calendar fail: ",(0,_.sensitive)(e,["email"]))}return[2,r];case 6:return[2]}}))}))};CalendarEventSyncController.prototype._getEvents=function(e,t,r){return be(this,void 0,void 0,(function(){var n,o,i,a;return Te(this,(function(c){switch(c.label){case 0:return[4,this.calendarCache.getEvents(e,t)];case 1:n=c.sent();c.label=2;case 2:c.trys.push([2,6,,7]);return[4,this.calendarDataController.getEvents(e,t,r)];case 3:o=c.sent();return[4,this._loadAssociatedTeamIdsToEvents(this.eventsProcessor.process(o))];case 4:i=c.sent();Oe.info(Ne.SYNC.EVENT.RESULT,sanitizeEvents(o));return[4,this._handleIncomingEvents(e,t,i,n)];case 5:c.sent();return[2,i];case 6:a=c.sent();Oe.warn(Ne.SYNC.EVENT.FAILED,{providerId:e,calendarId:t,error:a});if(isExpiredError(a)){Oe.info(Ne.SYNC.EVENT.EXPIRED,{providerId:e,calendarId:t})}if(this._lastChangedAuthProviders[e]){this._emitChangeMap(E.FY.ENTITY.CALENDAR_EVENT,{deleted:convertEventsToOld(n)});return[2,[]]}return[2,n];case 7:return[2]}}))}))};CalendarEventSyncController.prototype._addWaiter=function(){var e=this;return new Promise((function(t,r){e._waiters.push({resolve:t,reject:r})}))};CalendarEventSyncController.prototype._emitChangeMap=function(e,t){return be(this,void 0,void 0,(function(){var r,n,o,a,c,u,s,l,d;return Te(this,(function(f){switch(f.label){case 0:r=t.added,n=r===void 0?[]:r,o=t.deleted,a=o===void 0?[]:o,c=t.updated,u=c===void 0?[]:c;s=me(n,u);l=a.length;if(!l)return[3,2];return[4,i.notificationCenter.emitEntityDelete(e,a.map((function(e){return e.id})))];case 1:l=f.sent();f.label=2;case 2:l;d=s.length;if(!d)return[3,4];return[4,i.notificationCenter.emitEntityUpdate(e,s)];case 3:d=f.sent();f.label=4;case 4:d;return[2]}}))}))};CalendarEventSyncController.prototype._compareChanges=function(e,t,r){var n=r.comparator,o=r.changeMapCallback;var a=i.ArrayUtils.comparator(e,t,n);return o?o(a):undefined};CalendarEventSyncController.prototype._loadAssociatedTeamIdsToEvents=function(e){return be(this,void 0,Promise,(function(){var t;var r=this;return Te(this,(function(n){switch(n.label){case 0:t=function(e){return be(r,void 0,void 0,(function(){var t;return Te(this,(function(r){switch(r.label){case 0:return[4,this.calendarCache.getAssociation(e.recurrentMasterId||e.__rawId)];case 1:t=r.sent();e.associatedTeamId=t&&t.associatedTeamId||undefined;return[2,e]}}))}))};return[4,(0,_.runInPool)(e.map((function(e){return function(){return t(e)}})))];case 1:return[2,n.sent()]}}))}))};var t;ge([_.SingleRequest,Pe("design:type",Function),Pe("design:paramtypes",[String,String]),Pe("design:returntype",typeof(t=typeof Promise!=="undefined"&&Promise)==="function"?t:Object)],CalendarEventSyncController.prototype,"_doSync",null);return CalendarEventSyncController}(i.AbstractPollingController);var Le=undefined&&undefined.__decorate||function(e,t,r,n){var o=arguments.length,i=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)if(a=e[c])i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i;return o>3&&i&&Object.defineProperty(t,r,i),i};var Fe=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var ke=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var Ye=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Ue;var xe=K.k.tags("[HandleUpdate]");var He=(0,K.u)({HANDLE_EVENTS:"",HANDLE_UPDATE:{START:"",FORCE_SYNC:"",DEBOUNCE_SYNC:{WAITING:"",START:""}},HANDLE_EXPIRE:{START:"",NOT_FOUND:"",EXIST_EXPIRED:"",CLEAR_DATA:""},DO_SYNC:{SUCCESS:"",FAIL:""}});var Ve=(Ue={},Ue[ee.JW.NORMAL]=5*1e3,Ue[ee.JW.ADVANCE]=3*1e3,Ue);var je=function(){function CalendarHandleUpdateController(e){this.calendarEventSyncSourceProvider=e;this._eventObservers=[]}CalendarHandleUpdateController.prototype._doSync=function(e,t){return ke(this,void 0,void 0,(function(){var r;return Ye(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,this.calendarEventSyncSourceProvider.sync(e,t)];case 1:n.sent();xe.info(He.DO_SYNC.SUCCESS);return[3,3];case 2:r=n.sent();xe.warn(He.DO_SYNC.FAIL,{error:r});return[3,3];case 3:return[2]}}))}))};CalendarHandleUpdateController.prototype._cancelDebounceTask=function(){if(this._timeoutHandler){clearTimeout(this._timeoutHandler);this._timeoutHandler=undefined}};CalendarHandleUpdateController.prototype._debounceSync=function(e,t){this._timeoutHandler=setTimeout(e,t)};CalendarHandleUpdateController.prototype.subscribeEvents=function(e){var t=this;if(this._events){e(this._events)}this._eventObservers.push(e);return function(){t._eventObservers=t._eventObservers.filter((function(t){return t!==e}))}};CalendarHandleUpdateController.prototype.handleEvents=function(e){this._events=e;this._eventObservers.map((function(t){return t(e)}))};CalendarHandleUpdateController.prototype.handleUpdate=function(e,t){var r=this;var n=Date.now();xe.info(He.HANDLE_UPDATE.START,n);this._cancelDebounceTask();if(this._startDebounceTime&&n-this._startDebounceTime>this._forceSyncTime){xe.info(He.HANDLE_UPDATE.FORCE_SYNC,"over force sync time -> start sync",{_forceSyncTime:this._forceSyncTime,_startDebounceTime:this._startDebounceTime});this._startDebounceTime=0;this._doSync(e,t)}else{if(!this._startDebounceTime){this._startDebounceTime=n}xe.info(He.HANDLE_UPDATE.DEBOUNCE_SYNC.WAITING,this._debounceTime);this._debounceSync((function(){xe.info(He.HANDLE_UPDATE.DEBOUNCE_SYNC.START);r._doSync(e,t)}),this._debounceTime)}};Object.defineProperty(CalendarHandleUpdateController.prototype,"_debounceTime",{get:function(){return this._syncInterval},enumerable:true,configurable:true});Object.defineProperty(CalendarHandleUpdateController.prototype,"_forceSyncTime",{get:function(){return this._syncInterval},enumerable:true,configurable:true});Object.defineProperty(CalendarHandleUpdateController.prototype,"_syncInterval",{get:function(){var e=this.calendarEventSyncSourceProvider.getSyncMode();return Ve[e!==undefined?e:ee.JW.NORMAL]},enumerable:true,configurable:true});Le([_.SingleRequest,Fe("design:type",Function),Fe("design:paramtypes",[String,String]),Fe("design:returntype",Promise)],CalendarHandleUpdateController.prototype,"_doSync",null);return CalendarHandleUpdateController}();var Ke=r(390582);var Ge=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var We=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Ge(arguments[t]));return e};var Be=function(){function CalendarReminderController(e){this.option=e;this.sanitizedEvents=[];this.reminder=new _.Reminder(59*1e3,1e3);this.reminder.subscribe(e.handler)}CalendarReminderController.prototype._generateTasks=function(e){return e.map((function(e){return{id:e.id,time:e.startTime}}))};CalendarReminderController.prototype.onEvents=function(e){var t=e.filter((function(e){return!e.cancelled})).map((function(e){return{id:e.id,startTime:e.__startTimestamp,endTime:e.__endTimestamp}}));var r=this.sanitizedEvents;this.sanitizedEvents=t;var n=Ke.BB.comparator(t,r),o=n.added,i=n.deleted,a=n.updated;var c=We(i.map((function(e){return e.id})),a.map((function(e){return e.id})));var u=this.option.generateTasksStrategy,s=u===void 0?this._generateTasks:u;var l=s(We(o,a));this.reminder.removeTask((function(e){return c.includes(e.id)}));this.reminder.addTasks(l)};return CalendarReminderController}();var ze=r(228164);var qe=1e3;var Xe=function(){function CalendarSubscribeController(){var e=this;this._onProviderUpdate=function(){e._debounceRefreshSubscription()};this._onProviderDeleted=function(){e._debounceRefreshSubscription()};this._handlePubnubEvent=function(t){if(o().get(t,"service")==="cin"){var r=o().get(t,"providerId");var n=o().get(t,"calendarId");e._onSubscriptionUpdateCallback&&e._onSubscriptionUpdateCallback(r.toLowerCase(),n)}};this._debounceRefreshSubscription=o().debounce(this._refreshSubscription,qe)}CalendarSubscribeController.prototype.setOnSubscriptionUpdateCallback=function(e){this._onSubscriptionUpdateCallback=e};CalendarSubscribeController.prototype.start=function(){this._subscribeCalendarProviderChange();this._rcNotificationModule.subscribe(ze.RCSubscriptionKeys.CloudCalendar,this._handlePubnubEvent)};CalendarSubscribeController.prototype.stop=function(){this._unsubscribeCalendarProviderChange();this._rcNotificationModule.unsubscribe(ze.RCSubscriptionKeys.CloudCalendar,this._handlePubnubEvent)};Object.defineProperty(CalendarSubscribeController.prototype,"_rcNotificationModule",{get:function(){return(0,x.getModule)(ze.MODULE_NAME)},enumerable:true,configurable:true});CalendarSubscribeController.prototype._subscribeCalendarProviderChange=function(){H.r.onEntityUpdate(E.FY.ENTITY.CALENDAR_PROVIDER,this._onProviderUpdate);H.r.onEntityDelete(E.FY.ENTITY.CALENDAR_PROVIDER,this._onProviderDeleted)};CalendarSubscribeController.prototype._unsubscribeCalendarProviderChange=function(){H.r.off(E.FY.ENTITY.CALENDAR_PROVIDER,this._onProviderUpdate);H.r.off(E.FY.ENTITY.CALENDAR_PROVIDER,this._onProviderDeleted)};CalendarSubscribeController.prototype._debounceRefreshSubscription=function(){};CalendarSubscribeController.prototype._refreshSubscription=function(){this._rcNotificationModule&&this._rcNotificationModule.restart()};return CalendarSubscribeController}();var Qe=0;var Je=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var Ze=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var $e="[CalendarEventSyncSourceController]";var et=K.k.tags($e);var tt=1e3;var rt=function(){function CalendarEventSyncSourceProvider(e,t,r,n){var o=this;this._calendarEntitySourcesController=e;this._fetchController=t;this._eventsProcessor=r;this._userConfig=n;this._onCloudIntegrationChanged=function(){return Je(o,void 0,Promise,(function(){var e,t,r;return Ze(this,(function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,(0,i.getModule)(y.CLOUD_INTEGRATION_MODULE).getIntegrations({providerIds:E.dL})];case 1:e=n.sent();t=getProvidersFromIntegrations(e);return[4,this._syncController.updateProviders(t)];case 2:n.sent();return[3,4];case 3:r=n.sent();et.warn("updateProvider failed:",r);return[3,4];case 4:return[2]}}))}))};this.onLoginResult=function(e){if(e.success){o._syncController.startPolling();if(o._syncController.isSyncing()||o._syncController.getStartSyncTime()>0){et.info("skip first silent sync");return}o._syncController.sync().catch((function(e){et.info("first silent sync failed: ",{error:e})}))}};this._reminderControllers=[];this._syncQueue=new pe((function(e,t){if(e===fe.all){return o._syncController.sync()}return o._syncController.sync(e,t)}));this._buildController();this._hasStarted=false}CalendarEventSyncSourceProvider.prototype._buildController=function(){var e=this;this._handleUpdateController=new je(this);this._syncController=new Me(this._fetchController,this._calendarEntitySourcesController,this._eventsProcessor,this._handleUpdateController,this._userConfig);this._subscriptionController=new Xe;this._subscriptionController.setOnSubscriptionUpdateCallback((function(t,r){return e._handleUpdateController.handleUpdate(t,r)}))};CalendarEventSyncSourceProvider.prototype.getSourceName=function(){return c.CalendarSyncSource.CALENDAR_EVENT};CalendarEventSyncSourceProvider.prototype.getPriority=function(){return Qe};CalendarEventSyncSourceProvider.prototype.start=function(){if(!this._hasStarted){this._subscriptionController.start();i.notificationCenter.on(y.CLOUD_INTEGRATION_EVENT.DATA_CHANGE,this._onCloudIntegrationChanged);this._hasStarted=true}};CalendarEventSyncSourceProvider.prototype.stop=function(){if(this._hasStarted){this._syncController.stop();this._subscriptionController.stop();i.notificationCenter.off(y.CLOUD_INTEGRATION_EVENT.DATA_CHANGE,this._onCloudIntegrationChanged)}};CalendarEventSyncSourceProvider.prototype.getEvent=function(e){return Je(this,void 0,void 0,(function(){var t;return Ze(this,(function(r){switch(r.label){case 0:return[4,this._calendarEntitySourcesController.eventEntityController.get(e)];case 1:t=r.sent();return[2,t&&convertEventToOld(t)]}}))}))};CalendarEventSyncSourceProvider.prototype.getEvents=function(e){return Je(this,void 0,Promise,(function(){var t;return Ze(this,(function(r){switch(r.label){case 0:return[4,this._calendarEntitySourcesController.getAllEvents()];case 1:t=r.sent();if(!e){return[2,convertEventsToOld(t)]}return[2,convertEventsToOld(t).filter((function(t){return e(t)}))]}}))}))};CalendarEventSyncSourceProvider.prototype.syncProviders=function(){return this._syncController.syncProviders()};CalendarEventSyncSourceProvider.prototype.sync=function(e,t){et.info("sync provider and calendar",e,t);var r=e?e:fe.all;if(!this._syncController.isSyncing()){return this._syncQueue.executeInQueue(r,t)}var n=this._syncController.getSyncingProviderId();if(n!==e&&n||Date.now()-this._syncController.getStartSyncTime()>tt){return this._syncQueue.executeInQueue(r,t)}return this._syncController.waitSynced()};CalendarEventSyncSourceProvider.prototype.isSyncing=function(){return this._syncController.isSyncing()};CalendarEventSyncSourceProvider.prototype.getFilterOptions=function(){return Je(this,void 0,Promise,(function(){var e,t;return Ze(this,(function(r){switch(r.label){case 0:return[4,this._calendarEntitySourcesController.getProviders()];case 1:e=r.sent();t=e.some((function(e){return e.isAuthorized}));return[2,t?[{source:c.CalendarSyncSource.CALENDAR_EVENT,option:c.CalendarSyncSource.CALENDAR_EVENT,order:c.CalendarFilterOptionOrder.CALENDAR_EVENT}]:[]]}}))}))};CalendarEventSyncSourceProvider.prototype.setSyncMode=function(e){this._syncController.setSyncMode(e)};CalendarEventSyncSourceProvider.prototype.getSyncMode=function(){return this._syncController.getSyncMode()};CalendarEventSyncSourceProvider.prototype.waitSynced=function(){return this._syncController.waitSynced()};CalendarEventSyncSourceProvider.prototype.getStartSyncTime=function(){return this._syncController.getStartSyncTime()};CalendarEventSyncSourceProvider.prototype.updateProviders=function(e){return this._syncController.updateProviders(e)};CalendarEventSyncSourceProvider.prototype.getSyncingProviderId=function(){return this._syncController.getSyncingProviderId()};CalendarEventSyncSourceProvider.prototype.addEventReminderController=function(e){var t=new Be(e);this._reminderControllers.push(t);var r=this._handleUpdateController.subscribeEvents((function(e){return t.onEvents(e)}));return function(){r();t.reminder.cleanUp()}};return CalendarEventSyncSourceProvider}();var nt=r(468694);var ot=r(631448);var it=function(){function EventsProcessor(e){if(e===void 0){e=[]}this._eventsProcessors=e}EventsProcessor.prototype.process=function(e){return this._eventsProcessors.reduce((function(e,t){return t.process(e)}),e)};return EventsProcessor}();var at=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var ct=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(at(arguments[t]));return e};var ut="YYYY-MM-DD";function genId(e,t){return e.id+"-"+t.valueOf()}function getStartOfDay(e){return e.clone().startOf("day")}function getEndOfDay(e){return e.clone().endOf("day")}function isStartOfDay(e){return e.valueOf()===e.clone().startOf("day").valueOf()}function fillTime(e){return e.map((function(e){if(!e.endTime){e.endTime=d()(e.startTime).add(1,"day").toISOString(true)}return e}))}function isDifferentDay(e,t){return e.format(ut)!==t.format(ut)}function createEvent(e,t,r,n){return o().merge({},e,{startTime:t.toISOString(true),endTime:r.toISOString(true),__startTimestamp:t.valueOf(),__endTimestamp:r.valueOf()},n)}function createAllDayEvent(e,t){var r=t.clone().add(1,"day");return createEvent(e,t,r,{id:genId(e,t),allDay:true})}function createAlldayEvents(e,t,r,n){return o().range(r,n).map((function(r){var n=t.clone().add(r,"day");return createAllDayEvent(e,n)}))}function handleCrossDay(e){return o().flatMap(e,(function(e){if(e.allDay){return[e]}var t=d()(e.startTime);var r=d()(e.endTime);var n=getStartOfDay(r).diff(getEndOfDay(t),"day");if(isDifferentDay(t,r)){var o=getStartOfDay(t).add(1,"day");if(n<1&&isStartOfDay(r)){return[createEvent(e,t,r)]}var i=getStartOfDay(r);var a=n>0?createAlldayEvents(e,o,0,n):[];if(i.isSame(r)){return ct([createEvent(e,t,o,{id:genId(e,t)})],a)}return ct([createEvent(e,t,o,{id:genId(e,t)})],a,[createEvent(e,i,r,{id:genId(e,i)})])}return[e]}))}function isAllDayEvent(e,t){if(e.allDay)return true;if(e.type===u.Xt.occurrence&&e.recurrentMasterId){return t.some((function(t){return t.id===e.recurrentMasterId&&t.allDay}))}return false}function handleAllDay(e){var getDateIgnoreZone=function(e){var t=d().parseZone(e);return d()(t.format(ut))};return o().flatMap(e,(function(t){if(isAllDayEvent(t,e)){var r=getDateIgnoreZone(t.startTime);var n=t.endTime?getDateIgnoreZone(t.endTime):r.clone().add(1,"day");var o=n.diff(r,"day");t.allDay=true;if(o<=1){return[createEvent(t,r,n)]}return createAlldayEvents(t,r,0,o)}return[createEvent(t,d()(t.startTime),d()(t.endTime))]}))}var st=function(){function EventsTimeProcessor(){}EventsTimeProcessor.prototype.process=function(e){return handleCrossDay(handleAllDay(fillTime(e))).sort((function(e,t){if(e.__startTimestamp===t.__startTimestamp){if(e.__endTimestamp===t.__endTimestamp){return Ke.jj.compareString(e.subject,t.subject)}return e.__endTimestamp-t.__endTimestamp}return e.__startTimestamp-t.__startTimestamp}))};return EventsTimeProcessor}();var lt=undefined&&undefined.__assign||function(){lt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return lt.apply(this,arguments)};var dt=function(){function EventsSourceProcessor(){}EventsSourceProcessor.prototype.process=function(e){return e.map((function(e){return lt(lt({},e),{source:c.CalendarSyncSource.CALENDAR_EVENT})}))};return EventsSourceProcessor}();var ft=r(190420);var vt=r(469882);var pt="CALENDAR_USER_CONFIG";var ht={PRESENCE_LINKS:"PRESENCE_LINKS",PRESENCE_ON:"PRESENCE_ON",CALENDAR_FILTER_OPTION:"calendar_filter_option",LAST_SYNC_CALENDARS_TIME:"last_sync_calendars_time"};var _t=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var yt=function(e){_t(CalendarUserConfig,e);function CalendarUserConfig(t){return e.call(this,pt,t)||this}CalendarUserConfig.prototype.getPresenceLinks=function(){return this.get(ht.PRESENCE_LINKS)||[]};CalendarUserConfig.prototype.setPresenceLink=function(e){return this.put(ht.PRESENCE_LINKS,e)};CalendarUserConfig.prototype.getPresenceOn=function(){return this.get(ht.PRESENCE_ON)};CalendarUserConfig.prototype.setPresenceOn=function(e){return this.put(ht.PRESENCE_ON,e)};CalendarUserConfig.prototype.getCalendarFilterOption=function(){return this.get(ht.CALENDAR_FILTER_OPTION)};CalendarUserConfig.prototype.setCalendarFilterOption=function(e){return this.put(ht.CALENDAR_FILTER_OPTION,e)};CalendarUserConfig.prototype.getLastSyncCalendarsTime=function(){return this.get(ht.LAST_SYNC_CALENDARS_TIME)};CalendarUserConfig.prototype.setLastSyncCalendarsTime=function(e){return this.put(ht.LAST_SYNC_CALENDARS_TIME,e)};return CalendarUserConfig}(vt.DBConfig);var Ct=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Et=undefined&&undefined.__assign||function(){Et=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return Et.apply(this,arguments)};var St=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var gt=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Pt="[CalendarService]";var bt=K.k.tags(Pt);var Tt=function(e){Ct(CalendarService,e);function CalendarService(t){var r=e.call(this)||this;r._daoManager=t;r._buildController();r._registerCalendarEventSyncSourceProvider();return r}CalendarService.prototype.onAppRestored=function(){e.prototype.onAppRestored.call(this);(0,a.gT)().onLoginResult(this._calendarEventSyncSourceProvider.onLoginResult)};CalendarService.prototype.onStarted=function(){e.prototype.onStarted.call(this);this.calendarSettings.load();this._eventSyncSourceManager.start();this._calendarPresenceLinkController.start()};CalendarService.prototype.onStopped=function(){e.prototype.onStopped.call(this);this.calendarSettings.unload();this._eventSyncSourceManager.stop()};CalendarService.prototype._registerCalendarEventSyncSourceProvider=function(){i.notificationCenter.emit(c.CALENDAR_SYNC_SOURCE_EVENT.SYNC_SOURCE_READY,this._calendarEventSyncSourceProvider.getSourceName());this._eventSyncSourceManager.registerSyncSourceProvider(this._calendarEventSyncSourceProvider)};CalendarService.prototype._buildController=function(){this._eventsProcessor=new it([new st,new dt]);this._actionController=new h;this._fetchController=new A(this._eventsProcessor);this._calendarEntitySourcesController=new U(this._daoManager);this._eventSyncSourceManager=new ue;this._calendarEventSyncSourceProvider=new rt(this._calendarEntitySourcesController,this._fetchController,this._eventsProcessor,this.getUserConfig());this._calendarPresenceLinkController=new $(this)};Object.defineProperty(CalendarService.prototype,"calendarSettings",{get:function(){if(!this._calendarSettings){this._calendarSettings=new nt.C(this)}return this._calendarSettings},enumerable:true,configurable:true});CalendarService.prototype.getProviderEntitySource=function(){return this._calendarEntitySourcesController.providerEntityController};CalendarService.prototype.getCalendarEntitySource=function(){return this._calendarEntitySourcesController.calendarEntityController};CalendarService.prototype.getEventEntitySource=function(){return this._calendarEntitySourcesController.eventEntityController};CalendarService.prototype.getAssociationEntitySource=function(){return this._calendarEntitySourcesController.associationEntityController};CalendarService.prototype.getProvider=function(e){return this._calendarEntitySourcesController.providerEntityController.get(e)};CalendarService.prototype.getProviders=function(){return this._calendarEntitySourcesController.getProviders()};CalendarService.prototype.getProvidersFromRemote=function(){return this._fetchController.getProviders()};CalendarService.prototype.syncProviders=function(){return this._calendarEventSyncSourceProvider.syncProviders()};CalendarService.prototype.getCalendar=function(e){return St(this,void 0,void 0,(function(){var t;return gt(this,(function(r){switch(r.label){case 0:return[4,this._calendarEntitySourcesController.calendarEntityController.get(e)];case 1:t=r.sent();return[2,t?convertCalendarToOld(t):null]}}))}))};CalendarService.prototype.getCalendars=function(e,t){if(t===void 0){t=false}return St(this,void 0,Promise,(function(){var r,n,i;return gt(this,(function(a){switch(a.label){case 0:return[4,this._calendarEntitySourcesController.getCalendars(e)];case 1:r=a.sent();if(!(t||o().isEmpty(r)))return[3,5];return[4,this._fetchController.getProviders()];case 2:n=a.sent();if(!((n===null||n===void 0?void 0:n.findIndex((function(t){return t.id===e&&t.isAuthorized})))>-1))return[3,4];return[4,this._fetchController.getCalendars(e)];case 3:i=a.sent();return[2,convertCalendarsToOld(i)];case 4:return[2,[]];case 5:return[2,convertCalendarsToOld(r)]}}))}))};CalendarService.prototype.getEvent=function(e){return this._eventSyncSourceManager.getEvent(e)};CalendarService.prototype.getEventFromRemote=function(e,t,r){return this._fetchController.getEvent(e,t,r)};CalendarService.prototype.getAllEvents=function(e){return this.eventSyncSourceProviderManager.getEvents(e===null||e===void 0?void 0:e.eventFilter)};CalendarService.prototype.deleteEvent=function(e,t,r){return St(this,void 0,Promise,(function(){return gt(this,(function(n){switch(n.label){case 0:return[4,s.z.deleteEvent(e,t,r).catch((function(n){bt.warn("unable to delete event("+e+"."+t+"."+r+") remotely due to",n);throw n}))];case 1:n.sent();this.getEventEntitySource().delete(r);i.notificationCenter.emitEntityDelete(E.FY.ENTITY.CALENDAR_EVENT,[r]);return[2]}}))}))};CalendarService.prototype.sync=function(e){return this._eventSyncSourceManager.sync(e)};CalendarService.prototype.setSyncMode=function(e){this._eventSyncSourceManager.setSyncMode(e)};CalendarService.prototype.getSyncMode=function(){return this._eventSyncSourceManager.getSyncMode()};CalendarService.prototype.isSyncing=function(){return this._eventSyncSourceManager.isSyncing()};CalendarService.prototype._getPrimaryCalendarId=function(e){return St(this,void 0,Promise,(function(){var t,r;return gt(this,(function(n){switch(n.label){case 0:return[4,this._calendarEntitySourcesController.getCalendars(e)];case 1:t=n.sent();r=t.find((function(e){return e.primary}));if(r){return[2,r.calendarId]}return[4,this._fetchController.getPrimaryCalendar(e)];case 2:r=n.sent();if(!r){throw new ft.jg("Primary calendar is not found.")}return[2,r.calendarId]}}))}))};CalendarService.prototype.scheduleCalendarEvent=function(e,t){return St(this,void 0,Promise,(function(){var r,n,o;return gt(this,(function(i){switch(i.label){case 0:i.trys.push([0,3,,4]);return[4,this._getPrimaryCalendarId(e)];case 1:r=i.sent();return[4,this._actionController.createCalendarEvent(e,r,t)];case 2:n=i.sent();return[2,Et(Et({},n),{url:n.webEditUri})];case 3:o=i.sent();if(isExpiredError(o)){bt.warn("find expired error",o)}throw o;case 4:return[2]}}))}))};CalendarService.prototype.addEventReminderController=function(e){return this._calendarEventSyncSourceProvider.addEventReminderController(e)};CalendarService.prototype.getUserConfig=function(){if(!this._userConfig){this._userConfig=new yt(this._daoManager.getDBConfigService())}return this._userConfig};CalendarService.prototype._getEventNew=function(e){return this._calendarEntitySourcesController.eventEntityController.get(e)};CalendarService.prototype._getAllEventsNew=function(e){return this._calendarEntitySourcesController.getAllEvents(e)};CalendarService.prototype.associateTeamWithEvent=function(e,t){return St(this,void 0,Promise,(function(){var r,n,o,i;return gt(this,(function(a){switch(a.label){case 0:return[4,this._getEventNew(t)];case 1:r=a.sent();if(!r){bt.warn("Association between team("+e+") and event("+t+") failed due to null event.");return[2]}n=r.type===u.Xt.seriesMaster||!!r.recurrentMasterId;o={id:r.recurrentMasterId||r.__rawId,associatedTeamId:e,isSeriesMaster:n};return[4,this._getAllEventsNew({eventFilter:function(e){return e.__rawId===r.__rawId||e.recurrentMasterId&&e.recurrentMasterId===r.recurrentMasterId||e.id===r.recurrentMasterId||e.recurrentMasterId===r.id}})];case 2:i=a.sent();i.forEach((function(t){return t.associatedTeamId=e}));return[4,this._calendarEventSyncSourceProvider.waitSynced()];case 3:a.sent();return[4,this._calendarEntitySourcesController.setAssociation(o)];case 4:a.sent();return[4,this._calendarEntitySourcesController.eventEntityController.bulkPut(i)];case 5:a.sent();this._emitEventEntityUpdate(convertEventsToOld(i));bt.info("Association between team("+e+") and events(["+i.map((function(e){return e.id}))+"] succeeded)");return[2]}}))}))};CalendarService.prototype.registerSyncSourceProvider=function(e){return this._eventSyncSourceManager.registerSyncSourceProvider(e)};CalendarService.prototype.unregisterSyncSourceProvider=function(e){return this._eventSyncSourceManager.unregisterSyncSourceProvider(e)};CalendarService.prototype.getAllFilterOptions=function(){return this._eventSyncSourceManager.getFilterOptions()};CalendarService.prototype.getCalendarFilterOption=function(){return St(this,void 0,void 0,(function(){var e,t;return gt(this,(function(r){switch(r.label){case 0:return[4,this.getUserConfig().getCalendarFilterOption()];case 1:e=r.sent();if(e)return[2,e];return[4,this.getAllFilterOptions()];case 2:t=r.sent();return[2,t[0]]}}))}))};CalendarService.prototype.setCalendarFilterOption=function(e){return this.getUserConfig().setCalendarFilterOption(e)};CalendarService.prototype.getConnectedCalendars=function(e,t,r){return St(this,void 0,Promise,(function(){var n,o,i;return gt(this,(function(a){switch(a.label){case 0:if(!t)return[3,6];return[4,this._fetchController.getConnectedCalendars(e,true)];case 1:n=a.sent();if(!(n.length===0&&r))return[3,5];return[4,this._fetchController.getPrimaryCalendar(e)];case 2:o=a.sent();if(!o)return[3,5];return[4,this.connectCalendars(e,[o.calendarId],[])];case 3:a.sent();return[4,this._fetchController.getConnectedCalendars(e,true)];case 4:n=a.sent();a.label=5;case 5:return[2,convertCalendarsToOld(n)];case 6:return[4,this._calendarEntitySourcesController.getCalendars(e)];case 7:i=a.sent();return[2,convertCalendarsToOld(i)]}}))}))};CalendarService.prototype.getAllCalendars=function(e){return St(this,void 0,Promise,(function(){var t;return gt(this,(function(r){switch(r.label){case 0:return[4,this._fetchController.getCalendars(e)];case 1:t=r.sent();return[2,convertCalendarsToOld(t)]}}))}))};CalendarService.prototype.getLimit=function(e){return this._fetchController.getLimit(e)};CalendarService.prototype.connectCalendars=function(e,t,r){return this._actionController.connectCalendars(e,t,r)};CalendarService.prototype._emitEventEntityUpdate=function(e){i.notificationCenter.emitEntityUpdate(E.FY.ENTITY.CALENDAR_EVENT,e)};Object.defineProperty(CalendarService.prototype,"eventSyncSourceProviderManager",{get:function(){return this._eventSyncSourceManager},enumerable:true,configurable:true});return CalendarService}(i.MicroService)},468694:(e,t,r)=>{"use strict";r.d(t,{C:()=>P});var n=r(696206);var o=r(177679);var i=r(531616);var a=r(779071);var c=r(707938);var u=r(587040);var s=r(470033);var l=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var d=function(e){l(CalendarProviderSettingItemProvider,e);function CalendarProviderSettingItemProvider(t){var r=e.call(this,{id:o.l.Calendar_Provider,value:{type:n.Pe.CONSTANT}})||this;r.calendarService=t;return r}CalendarProviderSettingItemProvider.prototype.buildSourceProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return e.calendarService.getProviders()}})};CalendarProviderSettingItemProvider.prototype.buildStateProvider=function(){return this.buildBaseItemValueProvider({getter:function(){var e=(0,u.gT)().context.entitlement;var t=e.get(s.H3.RolePermissionId.PERMISSION_MEETINGS);return Promise.resolve(t?i.Ye.ENABLE:i.Ye.INVISIBLE)}})};CalendarProviderSettingItemProvider.prototype.onLoad=function(){var e=this;this.on(a.FY.ENTITY.CALENDAR_PROVIDER,(function(){return e.getSourceProvider().notifyChange()}))};return CalendarProviderSettingItemProvider}(c.t);var f=r(667489);var v=r(379269);var p=r(862926);var h=r(295454);var _=new p.BaseConfig({enableCalendarPresence:true});f.configStoreManager.addConfigStore(h.L2.CALENDAR_PRESENCE_CONFIG_STORE,_);var y=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var C=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var E=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var S=function(e){y(CalendarPresenceSettingItemProvider,e);function CalendarPresenceSettingItemProvider(t){var r=e.call(this,{id:o.l.Calendar_Presence,source:{type:n.Pe.CONSTANT,defaultValue:[true,false]},value:{type:n.Pe.STORAGE,defaultValue:true}})||this;r.calendarService=t;return r}CalendarPresenceSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return C(e,void 0,void 0,(function(){var e,t,r,n,o;return E(this,(function(a){switch(a.label){case 0:return[4,this._isDisabledForCurrentAccount()];case 1:e=a.sent();t=(0,u.gT)().context.entitlement;r=t.get(s.H3.RolePermissionId.PERMISSION_MEETINGS);if(!r||e){return[2,i.Ye.INVISIBLE]}return[4,this.calendarService.getProviders()];case 2:n=a.sent();o=n.findIndex((function(e){return e.isAuthorized}))>-1;return[2,o?i.Ye.ENABLE:i.Ye.INVISIBLE]}}))}))}})};CalendarPresenceSettingItemProvider.prototype._isDisabledForCurrentAccount=function(){return C(this,void 0,void 0,(function(){var e;return E(this,(function(t){switch(t.label){case 0:e=!_.getConfig().enableCalendarPresence;if(e)return[3,2];return[4,this._isPhoenixUser()];case 1:e=t.sent();t.label=2;case 2:return[2,e]}}))}))};CalendarPresenceSettingItemProvider.prototype._isPhoenixUser=function(){var e=(0,f.getModule)(v.oF);return e.isPhoenixUser()};CalendarPresenceSettingItemProvider.prototype.onLoad=function(){var e=this;var onUpdate=function(){return e.getStateProvider().notifyChange()};this.onEntitlement(s.H3.RolePermissionId.PERMISSION_MEETINGS,onUpdate);this.addSubscription((function(){f.notificationCenter.on(a.FY.ENTITY.CALENDAR_PROVIDER,onUpdate);return function(){return f.notificationCenter.off(a.FY.ENTITY.CALENDAR_PROVIDER,onUpdate)}}))};return CalendarPresenceSettingItemProvider}(c.t);var g=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var P=function(e){g(CalendarSettings,e);function CalendarSettings(t){var r=e.call(this)||this;r.calendarService=t;return r}CalendarSettings.prototype.getProviderMap=function(){var e;return e={},e[o.l.Calendar_Provider]=new d(this.calendarService),e[o.l.Calendar_Presence]=new S(this.calendarService),e};return CalendarSettings}(n.AbstractModuleSettingProviderManager)},728687:(e,t,r)=>{"use strict";r.d(t,{l:()=>n.l});var n=r(177679);var o=r(468694)},177679:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var n;(function(e){e["Calendar_Provider"]="Calendar_Provider";e["Calendar_Presence"]="Calendar_Presence"})(n||(n={}))},118484:(e,t,r)=>{"use strict";r.d(t,{JW:()=>n.SYNC_MODE,lC:()=>n.CalendarSyncSource});var n=r(204285)},834576:(e,t,r)=>{"use strict";r.d(t,{QT:()=>i,q4:()=>o,JW:()=>n});var n;(function(e){e[e["NORMAL"]=0]="NORMAL";e[e["ADVANCE"]=1]="ADVANCE"})(n||(n={}));var o;(function(e){e["SHOW_DIRECT_SHARE_BUTTON"]="show_direct_share_button";e["SHOW_DIRECT_SHARE_BUTTON_RCM"]="show_direct_share_button_rcm";e["SHOW_DIRECT_SHARE_BUTTON_RCVE"]="show_direct_share_button_rcve"})(o||(o={}));var i={MEETING:"ENTITY.MEETING"}},406036:(e,t,r)=>{"use strict";var n=r(218128);if(r.o(n,"VIDEO_EVENT_DATA_FEATURE_KEY"))r.d(t,{VIDEO_EVENT_DATA_FEATURE_KEY:function(){return n.VIDEO_EVENT_DATA_FEATURE_KEY}});if(r.o(n,"videoPerformanceTracer"))r.d(t,{videoPerformanceTracer:function(){return n.videoPerformanceTracer}})},403373:()=>{},218128:(e,t,r)=>{"use strict";var n=r(403373);var o=r.n(n);if(r.o(n,"VIDEO_EVENT_DATA_FEATURE_KEY"))r.d(t,{VIDEO_EVENT_DATA_FEATURE_KEY:function(){return n.VIDEO_EVENT_DATA_FEATURE_KEY}});if(r.o(n,"videoPerformanceTracer"))r.d(t,{videoPerformanceTracer:function(){return n.videoPerformanceTracer}})},204285:(e,t,r)=>{"use strict";r.d(t,{Acceptance:()=>n.Acceptance,CALENDAR_SYNC_SOURCE_EVENT:()=>n.CALENDAR_SYNC_SOURCE_EVENT,CALENDAR_SYNC_SOURCE_LIST:()=>n.CALENDAR_SYNC_SOURCE_LIST,CalendarFilterOptionOrder:()=>n.CalendarFilterOptionOrder,CalendarSyncSource:()=>n.CalendarSyncSource,EventType:()=>n.EventType,ENTITY:()=>o.QT,PROFILE_SETTING_KEYS:()=>o.q4,SYNC_MODE:()=>o.JW,VIDEO_EVENT_DATA_FEATURE_KEY:()=>a.f,videoPerformanceTracer:()=>a.S});var n=r(632682);if(r.o(n,"ENTITY"))r.d(t,{ENTITY:function(){return n.ENTITY}});if(r.o(n,"PROFILE_SETTING_KEYS"))r.d(t,{PROFILE_SETTING_KEYS:function(){return n.PROFILE_SETTING_KEYS}});if(r.o(n,"SYNC_MODE"))r.d(t,{SYNC_MODE:function(){return n.SYNC_MODE}});if(r.o(n,"VIDEO_EVENT_DATA_FEATURE_KEY"))r.d(t,{VIDEO_EVENT_DATA_FEATURE_KEY:function(){return n.VIDEO_EVENT_DATA_FEATURE_KEY}});if(r.o(n,"videoPerformanceTracer"))r.d(t,{videoPerformanceTracer:function(){return n.videoPerformanceTracer}});var o=r(834576);var i=r(406036);if(r.o(i,"VIDEO_EVENT_DATA_FEATURE_KEY"))r.d(t,{VIDEO_EVENT_DATA_FEATURE_KEY:function(){return i.VIDEO_EVENT_DATA_FEATURE_KEY}});if(r.o(i,"videoPerformanceTracer"))r.d(t,{videoPerformanceTracer:function(){return i.videoPerformanceTracer}});var a=r(888086)},888086:(e,t,r)=>{"use strict";r.d(t,{S:()=>videoPerformanceTracer,f:()=>i.fK});var n=r(862926);var o=r.n(n);var i=r(982313);var videoPerformanceTracer=function(e,t){return n.PerformanceTracer.start(i.fK,e,t)}},820460:()=>{},570099:(e,t,r)=>{"use strict";r.d(t,{t:()=>n,a:()=>o});var n;(function(e){e["seriesMaster"]="seriesMaster";e["singleInstance"]="singleInstance";e["occurrence"]="occurrence";e["exception"]="exception";e["recurring"]="recurring"})(n||(n={}));var o;(function(e){e["Accepted"]="Accepted";e["Declined"]="Declined";e["Tentative"]="Tentative"})(o||(o={}))},70125:(e,t,r)=>{"use strict";r.d(t,{RW:()=>a,lC:()=>n,xE:()=>o,jo:()=>i});var n;(function(e){e["CALENDAR_EVENT"]="CALENDAR_EVENT";e["RCM_MEETING"]="RCM_MEETING"})(n||(n={}));var o=[n.CALENDAR_EVENT.toString(),n.RCM_MEETING.toString()];var i={SYNC_SOURCE_READY:"SYNC_SOURCE_READY"};var a;(function(e){e[e["CALENDAR_EVENT"]=0]="CALENDAR_EVENT";e[e["HOSTED_BY_ME_AND_OTHERS"]=1]="HOSTED_BY_ME_AND_OTHERS";e[e["HOSTED_BY_ME"]=2]="HOSTED_BY_ME";e[e["HOSTED_BY_OTHERS"]=3]="HOSTED_BY_OTHERS"})(a||(a={}))},535154:(e,t,r)=>{"use strict";var n=r(834576)},632682:(e,t,r)=>{"use strict";r.d(t,{Acceptance:()=>n.a,EventType:()=>n.t,CALENDAR_SYNC_SOURCE_EVENT:()=>o.jo,CALENDAR_SYNC_SOURCE_LIST:()=>o.xE,CalendarFilterOptionOrder:()=>o.RW,CalendarSyncSource:()=>o.lC});var n=r(570099);var o=r(70125);var i=r(535154);var a=r(820460);var c=r.n(a);if(r.o(a,"ENTITY"))r.d(t,{ENTITY:function(){return a.ENTITY}});if(r.o(a,"PROFILE_SETTING_KEYS"))r.d(t,{PROFILE_SETTING_KEYS:function(){return a.PROFILE_SETTING_KEYS}});if(r.o(a,"SYNC_MODE"))r.d(t,{SYNC_MODE:function(){return a.SYNC_MODE}});if(r.o(a,"VIDEO_EVENT_DATA_FEATURE_KEY"))r.d(t,{VIDEO_EVENT_DATA_FEATURE_KEY:function(){return a.VIDEO_EVENT_DATA_FEATURE_KEY}});if(r.o(a,"videoPerformanceTracer"))r.d(t,{videoPerformanceTracer:function(){return a.videoPerformanceTracer}})},527815:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var n="meet"},389847:(e,t,r)=>{"use strict";r.d(t,{z:()=>n,x:()=>o});var n;(function(e){e["NOT_STARTED"]="not_started";e["LIVE"]="live";e["ENDED"]="ended";e["CANCELLED"]="cancelled";e["NO_ANSWER"]="no_answer"})(n||(n={}));var o;(function(e){e["INIT"]="init";e["REJECT"]="reject";e["JOIN"]="join";e["LEAVE"]="leave";e["ACK"]="ack";e["NO_ANSWER"]="no_answer"})(o||(o={}))},110811:(e,t,r)=>{"use strict";r.d(t,{D:()=>n,T:()=>o});var n;(function(e){e["Both"]="both";e["Telephony"]="Phone";e["Voip"]="ComputerAudio"})(n||(n={}));var o;(function(e){e["LOCAL"]="local";e["CLOUD"]="cloud";e["NONE"]="none"})(o||(o={}))},120300:(e,t,r)=>{"use strict";r.d(t,{u:()=>n});var n=109}}]);