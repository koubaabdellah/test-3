"use strict";var orderDetailsCtrl=["$scope","$rootScope","ordrDtls","$log","$cookies","OSHPService","$filter","$location","$window","$route","$timeout","ContentService","geolocation","ReportInterfaceAngular",function($scope,$rootScope,ordrDtls,$log,$cookies,OSHPService,$filter,$location,$window,$route,$timeout,ContentService,geolocation,ReportInterfaceAngular){$log.log("entering orderDetail"),$rootScope.setPageContent();var current=$rootScope.current;current||(current=$rootScope.current=SessionKeeper.read());var source="";if(void 0!==current.appSource&&null!=current.appSource&&(source=current.appSource),"CMO Landing"===source&&void 0==current.ordertoken){var fulldataList={eosIdType:"Order Number",eosSearchId:current.OrderID,eosSearchLob:"Wireless",dtvInd:"N",eosOriginSource:source};$scope.dtmCustomNotification("formResponse",current.appevent,"1","0",fulldataList,"CMO Order Status Details Pg",window.location.pathname)}current.orderDetails=ordrDtls,$rootScope.content&&($scope.understanStatus=$rootScope.prepareOrderStatusJson($rootScope.content.M_7_70_4_HUB_Order_Details.UnderstandingYourOrderStatus.FieldLabels)),(void 0!=$rootScope.orderSummaryDetails&&$rootScope.orderSummaryDetails.orders.length>1||void 0!=current.orderSummaryDetails&&current.orderSummaryDetails.orders.length>1)&&($scope.backToSummary=sessionStorage.getItem("backToSummary")),$scope.isNR_IVTOrder=!1,$scope.NR_IVTMsg=void 0,$scope._pageRender=function(order){if($scope.orderDetails=order,$scope.productType=$scope.orderDetails.orderProductType,$scope.intuitiveOrderStatusDisplayFlag=!1,void 0!=$scope.orderDetails){if($scope.orderDetails.orderNumber.indexOf("99-")>-1&&"true"==$scope.orderDetails.showUpdatePaymentMsgNR&&angular.isDefined(NR_IVT_Config)&&NR_IVT_Config.NR_IVT_Msg&&($scope.NR_IVTMsg=NR_IVT_Config.NR_IVT_Msg,$scope.isNR_IVTOrder=!0),$scope.appid=current.appId,$scope.wirelessOrderStatus=$scope.orderDetails.wirelessDetailsOrderStatus,$scope.wirelessDetailsOrderStatusDesc=$scope.orderDetails.wirelessDetailsOrderStatusDesc,$scope.friendlyOrderStatusCd=$scope.orderDetails.friendlyOrderStatusCd,$scope.friendlyOrderStatusDesc=$scope.orderDetails.friendlyOrderStatusDesc,void 0!=$scope.friendlyOrderStatusCd&&null!=$scope.friendlyOrderStatusCd&&""!=$scope.friendlyOrderStatusCd&&void 0!=$scope.friendlyOrderStatusDesc&&null!=$scope.friendlyOrderStatusDesc&&""!=$scope.friendlyOrderStatusDesc&&($scope.intuitiveOrderStatusDisplayFlag=!0),$log.log(" intuitiveOrderStatusDisplayFlag "+$scope.intuitiveOrderStatusDisplayFlag),$scope.wirelessOrderStatusKey=$scope.orderDetails.wirelessDetailsOrderStatusKey,$scope.orderDetails.wirelessLines){if($scope.itemLength=$scope.orderDetails.wirelessLines.length,$scope.orderShow="single",$scope.itemLength>1)for(var oderstatus=$scope.orderDetails.wirelessLines[0].productStatus,i=1;i<$scope.itemLength;i++)if($scope.orderDetails.wirelessLines[i].productStatus!==oderstatus){$scope.orderShow="multi";break}$log.log("number of wireless items "+$scope.itemLength),$scope.wirelessItems=$scope.orderDetails.wirelessLines;var noOfShippedItems=0,noOfUnshippedItems=0;$scope.groupByStatusKey="productStatus",$scope.OrderCarrierName=null,$scope.OrderCarrierCount=0;for(var uniqueId=0,index=0;index<$scope.wirelessItems.length;index++)$scope.wirelessItems[index].uniqueId=++uniqueId,$scope.checkIfItemStatusEligibleForCancellation($scope.wirelessItems[index].productStatus)&&"NR_ATT"!==$scope.wirelessItems[index].fullfillmentType&&($scope.cancellableItemExists=!0),"true"===$scope.wirelessItems[index].consentRequired&&($scope.consentRequired=!0),"true"===$scope.wirelessItems[index].itemShipped?($scope.wirelessItems[index].trackingNumSort=$scope.wirelessItems[index].carrier.TrackingNumber,noOfShippedItems++,"DELIVERED"==$scope.wirelessItems[index].statusKey&&null!=$scope.wirelessItems[index].carrier&&void 0!==$scope.wirelessItems[index].carrier&&($scope.OrderCarrierName=$scope.wirelessItems[index].carrier.Name,$scope.OrderCarrierCount++)):noOfUnshippedItems++,"ACTIONREQUIREDCONSENTTOSHIPPINGDATECHANGE"==$scope.wirelessItems[index].statusKey&&($scope.nearestShipDate=$scope.wirelessItems[index].originalShipDate);noOfShippedItems>0&&0===noOfUnshippedItems?($scope.groupByKey="trackingNumSort",$scope.orderByKey="shipDate"):0===noOfShippedItems&&noOfUnshippedItems>0&&($scope.groupByKey="estimatedShipDate",$scope.orderByKey="estimatedShipDate"),$scope.filterByCancelled="Cancelled",$scope.filterByCanceled="Canceled",$scope.filterByCancelledForOT="4_Status",$scope.elgibleToUpdateConsent="true"}if("C2S"===$scope.orderDetails.orderType){$log.log("Store Id Returned:"+$scope.orderDetails.storeIdBopis),pageID="CMO C2S Order Status Details Pg",geolocation.getLocation().then(function(position){$scope.geolocation=position},function(reason){$scope.message="Could not be determined."}),current.StoreId=$scope.orderDetails.storeIdBopis;OSHPService.bopisDataStoreDetails(current,oshpData.useStubs).then(function(data){$log.log("Success BOPIS Store details "),$scope.bopisStoreData=data.results[0],$scope.storeTiming=$scope.bopisStoreData.hours.split(",")},function(error){$log.log("BOPIS store details Error")})}try{if("ONTHEWAY"===$scope.orderDetails.statusDescriptionKey&&$scope.orderDetails.deliveryDetails.minutesRemaining<=20){sessionStorage.setItem("dtRefreshTimer","true");$timeout(function(){$route.reload()},refreshTimerInMS)}}catch(error){$log.log(error.message)}$(document).ready(function(){function _arrayBufferToBase64(buffer){for(var binary="",bytes=new Uint8Array(buffer),len=bytes.byteLength,i=0;i<len;i++)binary+=String.fromCharCode(bytes[i]);return window.btoa(binary)}var rotation={1:"rotate(0deg)",3:"rotate(180deg)",6:"rotate(90deg)",8:"rotate(270deg)"},orientation=function(file,callback){var fileReader=new FileReader;fileReader.onloadend=function(){var base64img="data:"+file.type+";base64,"+_arrayBufferToBase64(fileReader.result),scanner=new DataView(fileReader.result),idx=0,value=1;if(fileReader.result.length<2||65496!=scanner.getUint16(idx))callback&&callback(base64img,value);else{idx+=2;for(var maxBytes=scanner.byteLength;idx<maxBytes-2;){var uint16=scanner.getUint16(idx);switch(idx+=2,uint16){case 65505:maxBytes=scanner.getUint16(idx)-idx,idx+=2;break;case 274:value=scanner.getUint16(idx+6,!1),maxBytes=0}}callback&&callback(base64img,value)}},fileReader.readAsArrayBuffer(file)};void 0!=$scope.orderDetails&&void 0!=$scope.orderDetails.deliveryDetails&&void 0!=$scope.orderDetails.deliveryDetails.dropOffImageUrl&&function(url){return new Promise(function(resolve,reject){try{var xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.responseType="blob",xhr.onerror=function(){reject("Network error.")},xhr.onload=function(){200===xhr.status?resolve(xhr.response):reject("Loading error:"+xhr.statusText)},xhr.send()}catch(err){reject(err.message)}})}($scope.orderDetails.deliveryDetails.dropOffImageUrl).then(function(file){file&&orientation(file,function(base64img,value){console.log(rotation[value]);var rotated=$("#dropOffImage").attr("src",base64img);value&&rotated.css("transform",rotation[value])})})})}},void 0!=ordrDtls&&void 0!=ordrDtls.searchType&&"UNAUTH"===ordrDtls.searchType?$scope.isAuthType=!1:$scope.isAuthType=!0;var pageID="CMO Order Status Details Pg",additionalData={},itemSKU="";if(angular.isDefined(ordrDtls)&&angular.isDefined(ordrDtls.orders)&&angular.isDefined(ordrDtls.orders[0].account)){var orderDetails=ordrDtls.orders[0],dtmLiabilityType="";dtmLiabilityType="B2C"===orderDetails.account.accountType||null==orderDetails.account.accountType||""===orderDetails.account.accountType?"CONS":orderDetails.account.accountType,void 0!==$rootScope.current.customerType&&"SMB"===$rootScope.current.customerType||null!=sessionStorage.getItem("customerTypeSMB")&&"SMB"==sessionStorage.getItem("customerTypeSMB")?dtmLiabilityType="SMB":void 0!==$rootScope.current.customerType&&"IRU"===$rootScope.current.customerType&&(dtmLiabilityType="IRU"),void 0!==ordrDtls.orders[0].slid&&null!=ordrDtls.orders[0].slid&&""!==ordrDtls.orders[0].slid?(sessionStorage.setItem("dtmLoginId",ordrDtls.orders[0].slid),sessionStorage.setItem("dtmLoginType","SLID"),sessionStorage.setItem("dtmLoginSource","native"),localStorage.setItem("dtmFlowCode","CMO_AUTH"),sessionStorage.setItem("dtmAcctInFocusType","Wireless"),sessionStorage.setItem("dtmLiabilityType",dtmLiabilityType)):void 0!==ordrDtls.orders[0].ctn&&null!=ordrDtls.orders[0].ctn&&""!==ordrDtls.orders[0].ctn?(sessionStorage.setItem("dtmLoginId",ordrDtls.orders[0].ctn),sessionStorage.setItem("dtmLoginType","CTN"),sessionStorage.setItem("dtmLoginSource","native"),localStorage.setItem("dtmFlowCode","CMO_AUTH"),sessionStorage.setItem("dtmCTN",void 0!==ordrDtls.orders[0].ctn?ordrDtls.orders[0].ctn:null),sessionStorage.setItem("dtmLiabilityType",dtmLiabilityType)):sessionStorage.setItem("dtmLiabilityType",dtmLiabilityType),localStorage.setItem("dtmZipCode",void 0!==ordrDtls.orders[0].ShippingZip?ordrDtls.orders[0].ShippingZip:null)}if($scope.showZipCodeModal=function(){1==$rootScope.isOrderTokenUrl&&current.ordertoken&&current.appId&&!SuppressZipModalConfig.AppIds.includes(current.appId.toLowerCase())&&($("#zipCode-modal").modal({show:!0,backdrop:"static",keyboard:!1}),setTimeout(function(){$(document).on("shown.bs.modal",function(){$("#securityZIPCode").focus()})},200))},$scope.validateSecurityZipCode=function(){current.orderDetailReq.zipCode=$rootScope.securityZIPCode;OSHPService.oshpOrderSummaryAPIServices(current,oshpData.useStubs,$rootScope).then(function(data){void 0!==data&&"SUCCESS"===data.Result.Status&&void 0!==data.orders&&($scope.showDetails=!0,$scope.orderDetails=data.orders[0],current.summaryPageDetails=data)},function(error){$scope.showDetails=!1,$rootScope.SecureZipCodeFlag="invalid",$rootScope.securityZIPCode="",current.ordertoken=void 0,$("#zipCode-modal").modal("hide"),$rootScope.viewlandingPage(),console.log("failure orders.setStatus ")})},$scope.closeZipModal=function(){$("#zipCode-modal").modal("hide"),$rootScope.SecureZipCodeFlag="invalid",$rootScope.viewlandingPage()},$scope.disableZipCodeModalSubmit=function(orderZip){var orderZipLength=(orderZip+"").length;return void 0===orderZip||5!=orderZipLength},$scope.checkIfItemStatusEligibleForCancellation=function(productStatus){return["Action Required","Action required - Pending Terms & Conditions acceptance","Action Required - Update Payment Method","Action required - Consent to shipping date change","Backordered","Back ordered","Partially Canceled","Partially Shipped","Partially Shipped/Canceled","Pending","Pending Approval","Pending port approval","Processing","Submitted","In progress","Preparing to Ship","Preparing to ship"].indexOf(productStatus)>-1},$scope.$watch("showDetails",function(val){if($rootScope.orderTokenToSummary="false",1==val&&current.ordertoken)if($rootScope.current.ordertoken=void 0,$("#zipCode-modal").modal("hide"),void 0!=$scope.orderDetails&&($scope.redirectEnjoyToIDPPage($scope.orderDetails)||$scope.redirectWirelessDFToIDPPage($scope.orderDetails)||$scope.redirectWirelessBOPISToIDPPage($scope.orderDetails))){var zipCode=void 0!=$scope.orderDetails.inputZip?$scope.orderDetails.inputZip:null!=$scope.orderDetails.billingZip&&void 0!=$scope.orderDetails.billingZip?$scope.orderDetails.billingZip:$scope.orderDetails.shippingZip,orderCookie={searchType:current.orderDetails.searchType,accessToken:current.orderDetails.accessToken};document.cookie="wirelessProductIdp="+JSON.stringify(orderCookie)+"; domain=.att.com; path=/; secure",document.cookie="accessToken="+current.orderDetails.accessToken+"; domain=.att.com; path=/; secure",$("body").hide(),!1===$scope.fromSummary?window.location.href=$scope.orderDetails.idpManageUrl+"details?appid=omhLegacy&orderid="+$scope.orderDetails.orderNumber+"&zip="+zipCode:window.location.href=$scope.orderDetails.idpManageUrl+"details?appid=omhLegacy&orderid="+$scope.orderDetails.orderNumber+"&zip="+zipCode+"&lob=wireless"}else current.summaryPageDetails&&"WIRELESS"!==current.summaryPageDetails.orders[0].orderProductType&&"DTVNOW"!==current.summaryPageDetails.orders[0].orderProductType?($rootScope.orderTokenToSummary="true",$("body").hide(),$scope.setView("orderSummary")):$scope._pageRender($scope.orderDetails);else if(current.ordertoken&&$rootScope.isOrderTokenUrl&&!SuppressZipModalConfig.AppIds.includes(current.appId.toLowerCase())&&void 0==val){var orderDetails=[];$scope._pageRender(orderDetails)}}),void 0!=ordrDtls&&void 0!=ordrDtls.orders&&ordrDtls.orders.length>0&&((void 0==current.ordertoken||void 0==$rootScope.isOrderTokenUrl||void 0==current.appId||SuppressZipModalConfig.AppIds.includes(current.appId.toLowerCase()))&&$scope._pageRender(ordrDtls.orders[0]),function(myOrders){var firstNetSubtype="";if(null!==myOrders&&void 0!==myOrders)if(myOrders.account.firstNetIndicator&&null!=myOrders.account.firstNetIndicator&&void 0!=myOrders.account.firstNetIndicator&&void 0!=myOrders.account.firstNetSubtype&&null!=myOrders.account.firstNetSubtype){if("P1"==myOrders.account.firstNetSubtype.toUpperCase()?firstNetSubtype="Primary":"V1"==myOrders.account.firstNetSubtype.toUpperCase()?firstNetSubtype="Volunteer":"E1"==myOrders.account.firstNetSubtype.toUpperCase()&&(firstNetSubtype="Extended"),null!=myOrders.wirelessLines&&void 0!==myOrders.wirelessLines)for(var i=0;i<myOrders.wirelessLines.length;i++)void 0!=myOrders.wirelessLines[i].itemSKU&&null!=myOrders.wirelessLines[i].itemSKU&&(itemSKU=myOrders.wirelessLines[i].itemSKU+"|"+itemSKU);""!==itemSKU&&itemSKU.length>0&&(itemSKU=itemSKU.substring(0,itemSKU.length-1)),void 0!=ddo&&(ddo.setVar("user.attributes.firstNetFlag","1"),ddo.setVar("user.attributes.firstNetUserRole",firstNetSubtype),ddo.setVar("user.account.fan",""),ddo.setVar("user.account.wirelessAccountStatus","A"),ddo.setVar("page.attributes.sku",itemSKU)),additionalData={firstNetFlag:"1",firstNetUserRole:firstNetSubtype}}else void 0!=ddo&&ddo.setVar("user.attributes.firstNetFlag","0"),additionalData={firstNetFlag:"0"}}($scope.orderDetails)),$scope.redirectEnjoyToIDPPage=function(orderDetails){if("true"==$scope.orderDetails.reDirectSDDOrder&&("SAMEDAY"===$scope.orderDetails.orderType||"CC"===$scope.orderDetails.orderType)&&"true"!=$scope.orderDetails.nfflOrder&&"true"!==$scope.orderDetails.smbOrder)return!0},$scope.redirectWirelessDFToIDPPage=function(orderDetails){if("true"==$scope.orderDetails.reDirectWirelessDFOrder&&("WIRELESSDF"===$scope.orderDetails.orderType||"WLS_EG"===$scope.orderDetails.orderType||"WLSEG"===$scope.orderDetails.orderType||"CC"===$scope.orderDetails.orderType)&&"true"!=$scope.orderDetails.nfflOrder&&"true"!==$scope.orderDetails.smbOrder)return!0},$scope.redirectWirelessBOPISToIDPPage=function(orderDetails){if("true"==$scope.orderDetails.reDirectWirelessBopisC2SOrder&&("C2S"===$scope.orderDetails.orderType||"CC"===$scope.orderDetails.orderType)&&"true"!=$scope.orderDetails.nfflOrder&&"true"!==$scope.orderDetails.smbOrder)return!0},void 0!=$scope.orderDetails&&($scope.redirectWirelessDFToIDPPage($scope.orderDetails)||$scope.redirectEnjoyToIDPPage($scope.orderDetails)||$scope.redirectWirelessBOPISToIDPPage($scope.orderDetails))){var tAuthNState=$cookies.tAuthNState;void 0==$scope.backToSummary||"true"!==$scope.backToSummary&&!0!==$scope.backToSummary?$scope.fromSummary=!1:$scope.fromSummary=!0,"true"==current.orderDetails.orders[0].account.firstNetIndicator?$scope.customerType="FIRSTNET":"true"==current.orderDetails.orders[0].smbOrder||"CRU"==dtmLiabilityType&&"true"===tAuthNState?$scope.customerType="SMB":$scope.customerType="CONSUMER";var zipCode=void 0!=$scope.orderDetails.inputZip?$scope.orderDetails.inputZip:null!=$scope.orderDetails.billingZip&&void 0!=$scope.orderDetails.billingZip?$scope.orderDetails.billingZip:$scope.orderDetails.shippingZip,orderCookie={searchType:void 0!==tAuthNState&&null!=tAuthNState&&"true"===tAuthNState?"AUTH":current.orderDetails.searchType,fromSummaryPage:$scope.fromSummary,accessToken:current.orderDetails.accessToken};document.cookie="accessToken="+current.orderDetails.accessToken+"; domain=.att.com; path=/; secure",document.cookie="wirelessProductIdp="+JSON.stringify(orderCookie)+"; domain=.att.com; path=/; secure",$("body").hide(),!1===$scope.fromSummary?window.location.href=$scope.orderDetails.idpManageUrl+"details?appid=omhLegacy&orderid="+$scope.orderDetails.orderNumber+"&zip="+zipCode:window.location.href=$scope.orderDetails.idpManageUrl+"details?appid=omhLegacy&orderid="+$scope.orderDetails.orderNumber+"&zip="+zipCode+"&lob=wireless"}$scope.happyPath=!1,void 0==$scope.orderDetails||"ENJOYINPROGRESS"!==$scope.orderDetails.statusDescriptionKey&&"DELIVERYSCHEDULED"!==$scope.orderDetails.statusDescriptionKey&&"ONTHEWAY"!==$scope.orderDetails.statusDescriptionKey&&"EXPERTONSITE"!==$scope.orderDetails.statusDescriptionKey&&"ENJOYDELIVERED"!==$scope.orderDetails.statusDescriptionKey&&"ORDERCOMPLETE"!==$scope.orderDetails.statusDescriptionKey&&"ENJOYREADYFORPROCESSING"!==$scope.orderDetails.statusDescriptionKey||($scope.happyPath=!0),$scope.isAuth=!1,void 0!=ordrDtls&&"AUTH"==ordrDtls.searchType&&($scope.isAuth=!0),$scope.rescheduleAllowed=!1,null!=$scope.orderDetails&&void 0!=$scope.orderDetails.deliveryDetails&&void 0!=$scope.orderDetails.deliveryDetails.isRescheduleAllowed&&"true"===$scope.orderDetails.deliveryDetails.isRescheduleAllowed?void 0!=$scope.orderDetails.deliveryDetails.rescheduleUrl&&($scope.rescheduleAllowed=!0):null==$scope.orderDetails||"ENJOYINPROGRESS"!==$scope.orderDetails.statusDescriptionKey&&"ACTIONREQUIREDRESCHEDULEAPPOINTMENT"!==$scope.orderDetails.statusDescriptionKey&&"DELIVERYSCHEDULED"!==$scope.orderDetails.statusDescriptionKey&&"ENJOYREADYFORPROCESSING"!==$scope.orderDetails.statusDescriptionKey||($scope.rescheduleLinkForUnAuth=!0),$scope.status1=$rootScope.content.Common_Order_Management.ENJOYProgressBarStep.FieldLabels.Status1.Label,$scope.status2=$rootScope.content.Common_Order_Management.ENJOYProgressBarStep.FieldLabels.Status2.Label,$scope.status3=$rootScope.content.Common_Order_Management.ENJOYProgressBarStep.FieldLabels.Status3.Label,$scope.status4=$rootScope.content.Common_Order_Management.ENJOYProgressBarStep.FieldLabels.Status4.Label,$scope.status5=$rootScope.content.Common_Order_Management.ENJOYProgressBarStep.FieldLabels.Status5.Label,$scope.statusList=[$scope.status1,$scope.status2,$scope.status3,$scope.status4,$scope.status5],void 0!=$scope.orderDetails&&("ENJOYINPROGRESS"===$scope.orderDetails.statusDescriptionKey||"ENJOYREADYFORPROCESSING"===$scope.orderDetails.statusDescriptionKey?$scope.statusIndex=0:"DELIVERYSCHEDULED"===$scope.orderDetails.statusDescriptionKey?$scope.statusIndex=1:"ONTHEWAY"===$scope.orderDetails.statusDescriptionKey?$scope.statusIndex=2:"EXPERTONSITE"===$scope.orderDetails.statusDescriptionKey||"ORDERCOMPLETE"===$scope.orderDetails.statusDescriptionKey?$scope.statusIndex=3:"ENJOYDELIVERED"===$scope.orderDetails.statusDescriptionKey&&($scope.statusIndex=4),$scope.inProgressStatus=!1,"ENJOYINPROGRESS"!==$scope.orderDetails.statusDescriptionKey&&"ENJOYREADYFORPROCESSING"!==$scope.orderDetails.statusDescriptionKey||($scope.inProgressStatus=!0),$scope.deliveryScheduledStatus=!1,"DELIVERYSCHEDULED"===$scope.orderDetails.statusDescriptionKey&&($scope.deliveryScheduledStatus=!0),$scope.onWayStatus=!1,"ONTHEWAY"===$scope.orderDetails.statusDescriptionKey&&($scope.onWayStatus=!0),$scope.expertOnSiteStatus=!1,"EXPERTONSITE"!==$scope.orderDetails.statusDescriptionKey&&"ORDERCOMPLETE"!==$scope.orderDetails.statusDescriptionKey||($scope.expertOnSiteStatus=!0),$scope.statusDelivered=!1,"ENJOYDELIVERED"===$scope.orderDetails.statusDescriptionKey&&($scope.statusDelivered=!0),$scope.showEnjoyTnC=!1,null!=$scope.orderDetails.pendingTnC&&void 0!=$scope.orderDetails.pendingTnC&&($scope.showEnjoyTnC=!0,$scope.tncDesription=$scope.orderDetails.pendingTnC.statusDescription),$scope.showDeliveryAddress=!1,null!=$scope.orderDetails.deliveryDetails&&void 0!=$scope.orderDetails.deliveryDetails.address&&($scope.showDeliveryAddress=!0),$scope.showExpertBioLink=!1,null!=$scope.orderDetails.deliveryDetails&&void 0!=$scope.orderDetails.deliveryDetails.expertBioUrl&&($scope.showExpertBioLink=!0),$scope.showAppointmentDetails=!1,null==$scope.orderDetails||null==$scope.orderDetails.deliveryDetails||null==$scope.orderDetails.deliveryDetails.appointmentDate||null==$scope.orderDetails.deliveryDetails.appointmentTime||"ENJOYINPROGRESS"!==$scope.orderDetails.statusDescriptionKey&&"DELIVERYSCHEDULED"!==$scope.orderDetails.statusDescriptionKey&&"ENJOYPENDINGPORTAPPROVAL"!==$scope.orderDetails.statusDescriptionKey&&"ACTIONREQUIREDPENDINGTERMSCONDITIONSACCEPTANCE"!==$scope.orderDetails.statusDescriptionKey&&"ENJOYREADYFORPROCESSING"!==$scope.orderDetails.statusDescriptionKey||($scope.showAppointmentDetails=!0),$scope.deliveryTypePDO=!1,$scope.deliveryTypeDDO=!1,void 0!=$scope.orderDetails.wirelessLines&&void 0!=$scope.orderDetails.wirelessLines[0].fullfillmentMethod&&null!=$scope.orderDetails.wirelessLines[0].fullfillmentMethod&&($scope.fullfillmentMethod=$scope.orderDetails.wirelessLines[0].fullfillmentMethod,"PDO"==$scope.fullfillmentMethod?$scope.deliveryTypePDO=!0:"DOO"==$scope.fullfillmentMethod&&($scope.deliveryTypeDOO=!0))),$scope.rescheduleOrder=function(){console.log("inside rescheduleOrder");var linkDestinationUrl=$scope.orderDetails.deliveryDetails.rescheduleUrl;ReportInterfaceAngular.setLinkTrack("Reschedule","Body",linkDestinationUrl),$rootScope.isNativeApp()?$window.open(linkDestinationUrl,"_blank"):$window.location.href=$scope.orderDetails.deliveryDetails.rescheduleUrl},$scope.termsClick=function(){ReportInterfaceAngular.setLinkTrack("Terms and conditions","Body","https://www.att.com/tc")},$scope.viewOrderSumaryBack=function(){console.log("inside viewOrderSumaryBack")},$scope.backUpDevice=function(backUpDeviceUrl){console.log("inside backUpDevice");var linkDestinationUrl=$rootScope.content.M_7_70_7_HUB_Order_Details_Enjoy.PageLevelItems.Links.BackUpYourDevice.URL,linkName=$rootScope.content.M_7_70_7_HUB_Order_Details_Enjoy.PageLevelItems.Links.BackUpYourDevice.Label;ReportInterfaceAngular.setLinkTrack(linkName,"Body",linkDestinationUrl),$window.open(linkDestinationUrl,"_blank")},$scope.expertBio=function(){ReportInterfaceAngular.setLinkTrack("Expert Bio","Body","");var expertBio=$scope.orderDetails.deliveryDetails.expertBioUrl;$window.open(expertBio,"_blank")},$scope.accordionclick=function(trigger,containerdiv){$("#"+trigger).hasClass("opened")?($("#"+trigger+"-i").removeClass("icon-accordion-minus").addClass("icon-accordion-plus"),$("#"+trigger).removeClass("opened").addClass("closed").attr({"aria-selected":"false","aria-expanded":"false",tabindex:"0"}),$("#"+containerdiv).slideUp(400).attr({"aria-hidden":"true"}),setTimeout(function(){$("#"+containerdiv).css("display","none")},500)):($("#"+trigger+"-i").removeClass("icon-accordion-plus").addClass("icon-accordion-minus"),$("#"+trigger).removeClass("closed").addClass("opened").attr({"aria-selected":"true","aria-expanded":"true",tabindex:"0"}),$("#"+containerdiv).slideDown(400).attr({"aria-hidden":"false"}).css("display",""),"panel-11"==containerdiv&&ReportInterfaceAngular.setLinkTrack("What to expect","Body",""),"panel-12"==containerdiv&&ReportInterfaceAngular.setLinkTrack("How to get ready","Body",""))},void 0!=$scope.productType&&"WIRELESS"===$scope.productType.toUpperCase().trim()&&void 0!=ddo&&ddo.setVar("page.attributes.productType",$scope.productType),void 0!=ddo&&ddo.disableAutoPageLoad(),angular.element(document).ready(function(){var msg="";void 0!==current.errmsg&&(msg=current.errmsg),setTimeout(function(){void 0!==$scope.productType&&"WIRELESS"===$scope.productType.toUpperCase().trim()&&$rootScope.setChatVariables(orderDetails,orderDetails.orderStatus,msg),ReportInterfaceAngular.setPageTrack(pageID,window.location.pathname,additionalData),$(".toggle-header").on("keydown",function(e){"13"!=e.keyCode&&"32"!=e.keyCode||($(this).trigger("click"),e.preventDefault())})},1e3)}),$scope.displayMarketingMessageCTA=function(linkName){var linkDestinationUrl="";linkName===$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingInsuranceMessageCTA.Label?linkDestinationUrl=$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingInsuranceMessageCTA.URL:linkName===$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingDataTransferCTA.Label?linkDestinationUrl=$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingDataTransferCTA.URL:linkName===$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingUpgradeMessageCTA.Label&&(linkDestinationUrl=$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingUpgradeMessageCTA.URL),ReportInterfaceAngular.setLinkTrack(linkName,"Body",linkDestinationUrl)},$scope.displayMarketingMessageImage=function(linkName){var linkDestinationUrl="";linkName===$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingInsuranceMessageCTA.Label?(linkDestinationUrl=$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingInsuranceMessageCTA.URL,linkName="Device Protection Img"):linkName===$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingDataTransferCTA.Label?(linkDestinationUrl=$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingDataTransferCTA.URL,linkName="Cloud Data Transfer Img"):linkName===$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingUpgradeMessageCTA.Label&&(linkDestinationUrl=$rootScope.content.M_7_70_4_HUB_Order_Details.MarketingTile.Links.MarketingUpgradeMessageCTA.URL,linkName="Upgrade Eligibility Img"),$window.open(linkDestinationUrl),ReportInterfaceAngular.setLinkTrack(linkName,"Body",linkDestinationUrl)},$scope.rexReport=function(order,accessoryDetail,imageSlot,imageDesc,acc){var linkName="",reqDestination="",itemSKU="";null!=order.wirelessLines&&void 0!==order.wirelessLines&&void 0!=order.wirelessLines[0].itemSKU&&null!=order.wirelessLines[0].itemSKU&&(itemSKU=order.wirelessLines[0].itemSKU),null==imageDesc||void 0===imageDesc?null!=acc&&"acc"===acc?(linkName=$rootScope.content.M_7_70_4_HUB_Order_Details.REX.Links.ViewAllAccessories.Label,reqDestination=accessoryDetail.accessoriesURL+"accessorieslist."+accessoryDetail.mProductId+".html?page=sbdp"):(linkName="View all "+accessoryDetail.category,reqDestination=accessoryDetail.productUrl.replace("//","")):(linkName=order.RexAccessory[imageSlot].categoryDisplayName,reqDestination=accessoryDetail.productUrl.replace("//",""));var fulldataList={contentId:reqDestination,slotPosition:++imageSlot,contentPageSectionId:"REX",contentSystem:"REX-TeamSite",contentProductGroup:"Accessories",contentSku:"sku"+itemSKU,slotFriendlyName:"slot"+imageSlot};ReportInterfaceAngular.setLinkTrack(linkName,"LinkFarm",reqDestination,fulldataList)},$scope.setPercentForStarRatings=function(accessoryDtls){var starPercent;starPercent=parseFloat(100*accessoryDtls.starRating/5.2),accessoryDtls.starPercent=starPercent},$scope.returnToSummary=function(){"true"!==$scope.backToSummary&&!0!==$scope.backToSummary||($rootScope.current.OrderID="",$rootScope.current.zipcode="",$rootScope.current.OrderID=$rootScope.orderNumber,$rootScope.current.zipcode=$rootScope.zipCode,$rootScope.backToSummary=!0,ReportInterfaceAngular.setLinkTrack($rootScope.content.M_7_70_0_HUB_Check_Order_Status.PageLevelItems.Links.BackToOrderSummary.Label,"Body","/checkmyorder/orderSummary.rt"),$scope.setView("orderSummary"))},$rootScope.displayMessageIndicator=function(){var displayMarketMsgOnLoad="";if(void 0!==$scope.orderDetails&&null!==$scope.orderDetails&&void 0!==$scope.orderDetails.showUpgradeMessage&&""!==$scope.orderDetails.showUpgradeMessage)return"ELIGIBLE_TO_INSURANCE"!==$scope.orderDetails.showUpgradeMessage||void 0===$scope.wirelessOrderStatusKey||""===$scope.wirelessOrderStatusKey||null==$scope.wirelessOrderStatusKey||"INPROGRESS"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PROCESSING"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PREPARINGTOSHIP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"SHIPPED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PARTIALLYSHIPPED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PARTIALLYCANCELED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"READYFORPICKUP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PICKEDUP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"COMPLETE"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"DELIVERED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PARTIALLYSHIPPEDCANCELED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"READYFORSTOREPICKUP"!==$scope.wirelessOrderStatusKey.toUpperCase()?"CLOUD_DATA_TRANSFER"===$scope.orderDetails.showUpgradeMessage&&""!==$scope.wirelessOrderStatus&&void 0!==$scope.wirelessOrderStatus&&null!=$scope.wirelessOrderStatus&&"CANCELLED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"CANCELED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&-1===$scope.wirelessOrderStatusKey.toUpperCase().indexOf("ACTIONREQUIRED")?displayMarketMsgOnLoad="Data Transfer":"UPGRADE_ELIGIBLE"!==$scope.orderDetails.showUpgradeMessage||""===$scope.wirelessOrderStatusKey||void 0===$scope.wirelessOrderStatusKey||null==$scope.wirelessOrderStatus||"INPROGRESS"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PROCESSING"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PREPARINGTOSHIP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"SHIPPED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PARTIALLYSHIPPED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PARTIALLYCANCELED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"READYFORPICKUP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PICKEDUP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"READYFORSTOREPICKUP"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"COMPLETE"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"DELIVERED"!==$scope.wirelessOrderStatusKey.toUpperCase()&&"PARTIALLYSHIPPEDCANCELED"!==$scope.wirelessOrderStatusKey.toUpperCase()||(displayMarketMsgOnLoad="Upgrade Eligibility"):displayMarketMsgOnLoad="Device Protection",$rootScope.insuranceIndicator=displayMarketMsgOnLoad,displayMarketMsgOnLoad},$rootScope.displayMessageIndicator(),$scope.noButtonTracking=function(event){$scope.dtmCustomNotification("formSubmit","CMO_Send_Email_Submit","-2","-2","","",""),$scope.dtmCustomNotification("formResponse","CMO_Send_Email_Submit","-1","-1","","","")},$scope.OrderNewShippingDateAccepted=function(lineItem){if(current.acceptConsentCall=!1,current.LineItem=lineItem,"OSH"===$scope.appid&&($scope.appid="validationLink"),"false"===$scope.orderDetails.updateConsentFlag)$("#newshippingError-modal").modal("show");else if($scope.isAuthType){$rootScope.isViewLoading=!0;var expShipDates=current.LineItem.originalShipDate.split("To"),updateConsentDetails={CommonData:oshpData.defaults.CommonData,YodaLineId:current.LineItem.itemNumber,YodaOrderNum:$scope.orderDetails.yodaOrderNumber,ExpFromShipDt:expShipDates[0],ExpToShipDt:expShipDates[1],UserId:current.LineItem.subscriberNumber,OrderNumber:$scope.orderDetails.orderNumber,ShippingZip:$scope.orderDetails.billingZip};current.updateConsentReq=updateConsentDetails,$scope.OrderNewShippingDateAPICall()}else $scope.emailMasked=$scope.orderDetails.email,$scope.action="consent",$scope.emailModePageName="CMO Ship Date Change Order Validation Modal Pg",$scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Ship Date Change Order Validation Modal Pg","/checkmyorder/virtual/shipDateChangeValidation.html"),$("#validationRequired-modal").modal("show"),setTimeout(function(){$("#wrapper").attr("aria-hidden","false"),$(".content-pane.content-tabs.innercontent-pane").attr("aria-hidden","true"),$("#validationRequired-modal").focus()},1e3)},$scope.OrderNewShippingDateAPICall=function(){OSHPService.updateConsentDateService(current,oshpData.useStubs).then(function(data){if($log.log("Update Success"),data&&data.Result&&"SUCCESS"===data.Result.Status)if("true"===!data.orders[0].ConsentSuccess){var msg=data.Result.Messages[0].DisplayCode+" : "+$scope.getErrorMessage(data),statusErr={code:data.Result.Messages[0].DisplayCode,type:"consetnFailure",message:msg};$rootScope.setStatus(statusErr),$rootScope.isViewLoading=!1,$rootScope.setChatVariables(data.orders[0],current.oStatus,msg),$scope.dtmCustomNotification("formResponse","CMO_Accept_Shipping_Date_Submit","0",data.Result.Messages[0].DisplayCode,"","","")}else $log.log("Update Concent SUCCESS"),$scope.dtmCustomNotification("formResponse","CMO_Accept_Shipping_Date_Submit","1","0","","",""),oshpData.useStubs?($scope.orderDetails=data.orderDetails,$scope._pageRender(data.orderDetails)):$scope._pageRender(data.orders[0]),$rootScope.isViewLoading=!1;else{$log.log("else end");var msg=data.Result.Messages[0].DisplayCode+" : "+$scope.getErrorMessage(data),statusErr={code:data.Result.Messages[0].DisplayCode,type:"consetnFailure",message:msg};$rootScope.setStatus(statusErr),$rootScope.isViewLoading=!1,$rootScope.setChatVariables(data.orders[0],current.oStatus,msg),$scope.dtmCustomNotification("formResponse","CMO_Accept_Shipping_Date_Submit","0",data.Result.Messages[0].DisplayCode,"","","")}},function(error){$log.log("Error"),$rootScope.isViewLoading=!1})},$scope.cancelButtonTracking=function(){$scope.dtmCustomNotification("formResponse","CMO_Update_PaymentInfo_Submit","-1","-1","","","")},$scope.viewPaymentUpdatedModal=function(){"false"===$scope.orderDetails.updatePaymentFlag?$("#updatepaymentError-modal").modal("show"):!1===$scope.isAuthType?($scope.emailMasked=$scope.orderDetails.email,$scope.action="update",$scope.emailModePageName="CMO Update Payment Order Validation Modal Pg",$scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Update Payment Order Validation Modal Pg","/checkmyorder/virtual/updatePaymentValidation.html"),$("#validationRequired-modal").modal("show"),setTimeout(function(){$("#wrapper").attr("aria-hidden","false"),$(".content-pane.content-tabs.innercontent-pane").attr("aria-hidden","true"),$("#validationRequired-modal").focus()},1e3)):($scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Order Status Payment Update Modal Pg",window.location.pathname),$scope.tenderId=$scope.orderDetails.tenderId,$scope.iVTAmount=$scope.orderDetails.IVTAmount,$("#updatePayment-modal").modal("show"),document.getElementById("updatePaymentForm").reset(),$("#cc-number-field").removeClass("error"),$("#cc-number-field ul").removeAttr("class"),$("#mm > span > span").text("Month").append('<i class="cssIcon-chevron-d-w"></i>'),$("#yy > span > span").text("Year").append('<i class="cssIcon-chevron-d-w"></i>')),"OSH"===$scope.appid&&($scope.appid="validationLink")},$scope.viewPaymentUpdated=function(){var cardNumber=this.card,expMonth=this.monthS,expYear=this.yearS,cvv=this.cvc,zipCode=this.zip,updateFlag=!1;if(void 0!==cardNumber&&"Month"!==expMonth.value&&"Year"!==expYear.value&&void 0!==cvv&&void 0!==zipCode&&(updateFlag=!0),updateFlag){var optId="";void 0!==$scope.orderDetails.slid&&null!=$scope.orderDetails.slid&&""!==$scope.orderDetails.slid?optId=$scope.orderDetails.slid:void 0!==$scope.orderDetails.ctn&&null!=$scope.orderDetails.ctn&&""!==$scope.orderDetails.ctn?optId=$scope.orderDetails.ctn:void 0!==$scope.orderDetails.email&&(optId=$scope.orderDetails.email);var updateDetails={CommonData:{AppName:oshpData.updatePayAPP,SecurityToken:$scope.orderDetails.updatePaymentSecurityToken},ReferenceOrderNumber:{LocationID:$scope.orderDetails.updatePaymentONum[0],ActivityID:$scope.orderDetails.updatePaymentONum[1],OrderID:$scope.orderDetails.updatePaymentONum[2]},CardRequest:{NameOnCard:"",CardNumber:cardNumber,CVV:cvv,ExpMonth:expMonth.index,ExpYear:expYear.value,ZipCode:zipCode},OperatorID:optId,CustomerType:oshpData.customerType};current.updateDetails=updateDetails,$("#updatePayment-modal").modal("hide");var addZoneEventData={CommonData:oshpData.defaults.CommonData,Action:"Call for Update Payment for OrderNumber#:"+$scope.orderDetails.orderNumber,Zip:$scope.orderDetails.shippingZip};current.addZoneEvent=addZoneEventData,$scope.zoneCallAPI(),$scope.paymetCallAPI()}},$scope.zoneCallAPI=function(){OSHPService.oshpAddZoneEventAPIServices(current,oshpData.useStubs).then(function(data){$log.log("Success Zone ")},function(error){$log.log("Zone Error")})},$scope.activateMyDevice=function(zip,activationContext){console.log("Activating device : "+activationContext),localStorage.setItem("dtmZipCode",zip);var redirectUrl="activations/activationLanding.rt?activationContext="+encodeURIComponent(activationContext);window.open(redirectUrl,"_blank").focus()},$scope.paymetCallAPI=function(){$rootScope.isViewLoading=!0;OSHPService.oshpPaymentUpdateAPIServices(current,oshpData.useStubs).then(function(data){if($rootScope.pageLoad("CMO Order Status Details Pg"),$rootScope.isViewLoading=!1,data&&data.Result&&"SUCCESS"===data.Result.Status){var orderNumObj;if(void 0===localStorage.getItem("PaymentUpdateSuccessList")||null==localStorage.getItem("PaymentUpdateSuccessList"))(orderNumObj=[]).push($scope.orderDetails.orderNumber),localStorage.setItem("PaymentUpdateSuccessList",orderNumObj);else{for(var newAddObj=!0,payUpdateList=[],orderListObj=(orderNumObj=localStorage.getItem("PaymentUpdateSuccessList")).split(","),i=0;i<orderListObj.length;i++)orderListObj[i]===$scope.orderDetails.orderNumber&&(newAddObj=!1);newAddObj&&payUpdateList.push($scope.orderDetails.orderNumber),localStorage.setItem("PaymentUpdateSuccessList",payUpdateList)}statusError={code:null,type:"PMTUPDT",message:""},$rootScope.setStatus(statusError),$rootScope.setChatVariables($scope.orders,current.oStatus,""),$scope.dtmCustomNotification("formResponse","CMO_Update_PaymentInfo_Submit","1","0","","","")}else{angular.isDefined(current)&&angular.isDefined(current.orderDetails)&&angular.isDefined(current.orderDetails.orders)&&angular.isDefined(current.orderDetails.orders[0])&&angular.isDefined(current.orderDetails.orders[0].account)&&"true"==current.orderDetails.orders[0].account.firstNetIndicator&&angular.isDefined(data)&&angular.isDefined(data.Result)&&angular.isDefined(data.Result.Messages)&&angular.isDefined(data.Result.Messages.DisplayCode)&&("OM115"==data.Result.Messages.DisplayCode||"OM215"==data.Result.Messages.DisplayCode?(data.Result.Messages.DisplayCode="OM315",data.Result.Messages.EnglishLongMessage="Looks like you entered incorrect information in one of the fields.  Please update your payment method to continue."):"OM116"==data.Result.Messages.DisplayCode||"OM216"==data.Result.Messages.DisplayCode?(data.Result.Messages.DisplayCode="OM316",data.Result.Messages.EnglishLongMessage="We had a problem updating your payment method. Please visit an AT&T store to provide your payment information."):"OM124"!=data.Result.Messages.DisplayCode&&"OM224"!=data.Result.Messages.DisplayCode||(data.Result.Messages.DisplayCode="OM324",data.Result.Messages.EnglishLongMessage="We're processing your updated payment method and it may take up to an hour for your order status to reflect a change."));var msg=data.Result.Messages.DisplayCode+" : "+data.Result.Messages.EnglishLongMessage,statusError={code:data.Result.Messages.DisplayCode,type:"PMTERROR",message:msg};$rootScope.setStatus(statusError),$rootScope.setChatVariables($scope.orders,current.oStatus,msg),$scope.dtmCustomNotification("formResponse","CMO_Update_PaymentInfo_Submit","0",data.Result.Messages.DisplayCode,"","","")}$scope.setView("orderDetails")},function(error){$rootScope.isViewLoading=!1,$log.log("Error")})},$scope.newValI="ccv2-security",$scope.newValIAlt="The CVC security code is on the back of your card right after the credit card number.",$scope.newValCCI="",$scope.cvcPlaceholder="3 or 4 digits",$scope.ZipPlaceholder="5 digit ZIP",$scope.cvcMaxlength=3,$scope.invalidCardError="",$scope.months=[{index:0,value:"Month",selected:"selected"},{index:1,value:"01 (Jan)"},{index:2,value:"02 (Feb)"},{index:3,value:"03 (Mar)"},{index:4,value:"04 (Apr)"},{index:5,value:"05 (May)"},{index:6,value:"06 (Jun)"},{index:7,value:"07 (Jul)"},{index:8,value:"08 (Aug)"},{index:9,value:"09 (Sep)"},{index:10,value:"10 (Oct)"},{index:11,value:"11 (Nov)"},{index:12,value:"12 (Dec)"}],$scope.monthS=$scope.months[0];var curYear=(new Date).getFullYear();$scope.years=[{index:0,value:"Year",selected:"selected"},{index:1,value:curYear},{index:2,value:curYear+1},{index:3,value:curYear+2},{index:4,value:curYear+3},{index:5,value:curYear+4},{index:6,value:curYear+5},{index:7,value:curYear+6},{index:8,value:curYear+7},{index:9,value:curYear+8}],$scope.yearS=$scope.years[0],$scope.filterByCancelled="Cancelled",$scope.filterByCanceled="Canceled",$scope.formatDate=null,$scope.formatDate=function(date){return new Date(date)},$scope.singleDateFunctn=function(date){$scope.singleDate=!1;var dateArray=date.split("To"),dateFrom=$filter("date")($scope.formatDate(dateArray[0]),"MMMM d, y"),dateTo=$filter("date")($scope.formatDate(dateArray[1]),"MMMM d, y");return dateFrom===dateTo||"undefined NaN, NaN"===dateTo},$scope.splitDate=function(date){var dateArray=date.split("To"),dateFrom=$filter("date")($scope.formatDate(dateArray[0]),"MMMM d, y"),dateTo=$filter("date")($scope.formatDate(dateArray[1]),"MMMM d, y");return dateFrom===dateTo&&(dateArray[1]=void 0),void 0!==dateArray[1]?dateFrom+" - "+dateTo:dateFrom},$scope.cancelOrder=function(type){sessionStorage.setItem("cancelFlag","Order"),$rootScope.cancelFlag="Order";var fulldataList={linkPosition:"Body",linkName:"Cancel Order"};"false"===current.orderDetails?$("#cancelledOrderError-modal").modal("show"):"UNAUTH"===ordrDtls.searchType?(fulldataList.linkDestinationUrl="/checkmyorder/virtual/cancelOrderValidation.html",$scope.dtmCustomNotification("linkClick","Link_Click","","",fulldataList,"",""),$scope.emailMasked=$scope.orderDetails.email,$scope.action="cancel",$scope.emailModePageName="CMO Cancel Order Validation Modal Pg",$scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Cancel Order Validation Modal Pg","/checkmyorder/virtual/cancelOrderValidation.html"),$("#validationRequired-modal").modal("show"),setTimeout(function(){$("#wrapper").attr("aria-hidden","false"),$(".content-pane.content-tabs.innercontent-pane").attr("aria-hidden","true"),$("#validationRequired-modal").focus()},1e3)):"true"===$scope.orderDetails.portOrder?($scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Order Mgmt Port Cancel Order Failure Modal Pg",window.location.pathname),$("#cancelledOrderError-modal").modal("show")):"DNCTN"===type?$("#cancelledOrder-modal").modal("show"):(fulldataList.linkDestinationUrl="/checkmyorder/cancelOrder.rt",$scope.dtmCustomNotification("linkClick","Link_Click","","",fulldataList,"",""),$scope.setView("cancelOrder"))},$scope.cancelItem=function(type,itemSelected){sessionStorage.setItem("cancelFlag","Item"),sessionStorage.setItem("itemSelected",itemSelected),$rootScope.cancelFlag="Item",$rootScope.itemSelected=itemSelected;var itemPortStatus,tempItemsList=[],j=0,qtyCounter=0;if(current.orderDetails.orders[0].wirelessLines.length>1)for(i=0;i<current.orderDetails.orders[0].wirelessLines.length;i++)current.orderDetails.orders[0].wirelessLines[i].uniqueId==itemSelected&&(itemPortStatus=current.orderDetails.orders[0].wirelessLines[i].productStatus,qtyCounter=current.orderDetails.orders[0].wirelessLines[i].quantity,$rootScope.qtyTobeCancelled=qtyCounter),current.orderDetails.orders[0].wirelessLines[i].uniqueId!=itemSelected&&"true"===current.orderDetails.orders[0].wirelessLines[i].lineLevelCancel&&(tempItemsList[j]=current.orderDetails.orders[0].wirelessLines[i],j++);else for(var ItemDetailsArray=current.orderDetails.orders[0].wirelessLines,i=0;i<ItemDetailsArray.length;i++)ItemDetailsArray[i].uniqueId==itemSelected&&(itemPortStatus=ItemDetailsArray[i].portStatus,qtyCounter=ItemDetailsArray[i].quantity,$rootScope.qtyTobeCancelled=qtyCounter),ItemDetailsArray[i].uniqueId!=itemSelected&&"true"===ItemDetailsArray[i].lineLevelCancel&&(tempItemsList[j]=ItemDetailsArray[i],j++);sessionStorage.setItem("qtyTobeCancelled",$rootScope.qtyTobeCancelled);var fulldataList={linkPosition:"Body"};"1"===qtyCounter?($rootScope.qtyCtr=!1,fulldataList.linkName="Cancel Item"):($rootScope.qtyCtr=!0,fulldataList.linkName="Cancel Item(s)"),$rootScope.tempItemDetails=tempItemsList,sessionStorage.setItem("qtyCtr",$rootScope.qtyCtr),"false"===current.orderDetails.CancelOnOff?$("#cancelledOrderError-modal").modal("show"):$scope.isAuthType?"true"===itemPortStatus?(current.orderDetails.portOrder="true",$scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Order Mgmt Port Cancel Order Failure Modal Pg",window.location.pathname),$("#cancelledOrderError-modal").modal("show")):"DNCTN"===type?$("#cancelledOrder-modal").modal("show"):(fulldataList.linkDestinationUrl="/checkmyorder/cancelOrder.rt",$scope.dtmCustomNotification("linkClick","Link_Click","","",fulldataList,"",""),$scope.setView("cancelOrder")):($scope.emailMasked=$scope.orderDetails.email,$scope.action="cancel",$scope.emailModePageName="CMO Cancel Order Validation Modal Pg",fulldataList.linkDestinationUrl="/checkmyorder/virtual/cancelOrderValidation.html",$scope.dtmCustomNotification("linkClick","Link_Click","","",fulldataList,"",""),$scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Cancel Order Validation Modal Pg","/checkmyorder/virtual/cancelOrderValidation.html"),$("#validationRequired-modal").modal("show"),setTimeout(function(){$("#wrapper").attr("aria-hidden","false"),$(".content-pane.content-tabs.innercontent-pane").attr("aria-hidden","true"),$("#validationRequired-modal").focus()},1e3))},$scope.clickBackToSearchReporting=function(){$scope.setStatus({code:null,type:null,message:null}),$rootScope.stop(),void 0!==current.orderDetails&&null!=current.orderDetails&&(current.orderDetails={});var linkName=$rootScope.content.M_7_70_5_App_Marketplace_Order_Details.PageLevelItems.Links.SearchPageLink.Label;ReportInterfaceAngular.setLinkTrack(linkName,"Body","/checkmyorder/omhub.rt"),$scope.setView("omhub")},$scope.viewHomePage=function(){if(current.orderDetails.ReturnURL&&void 0!==current.orderDetails.ReturnURL)$rootScope.stop(),current.orderDetails.ReturnURL.indexOf("checkorder")>=0?$window.location.href=current.orderDetails.ReturnURL.replace(/es-us\//g,""):$window.location.href=current.orderDetails.ReturnURL;else{$scope.setStatus({code:null,type:null,message:null}),$rootScope.stop(),void 0!==current.orderDetails&&null!=current.orderDetails&&(current.orderDetails={}),current.oStatus="";var linkName=$rootScope.content.M_7_70_5_App_Marketplace_Order_Details.PageLevelItems.Links.SearchPageLink.Label;ReportInterfaceAngular.setLinkTrack(linkName,"Body","/checkmyorder/omhub.rt"),$scope.backToSearchRedirectionFlag=backToSearchRedirectionConfig.backToSearchRedirectionFlag,$scope.backToSearchRedirectionFlag?window.location.href=backToSearchRedirectionConfig.OrderhistoryIDPLoginURL:$scope.setView("omhub")}},$scope.validationEmailSentView=function(orders,event){$scope.dtmCustomNotification("formSubmit","CMO_Send_Email_Submit","-2","-2","","",""),$scope.dtmCustomNotification("formResponse","CMO_Send_Email_Submit","1","0","","",""),current.OrderID=orders,$scope.setView("validationEmailSent")},$scope.clickOnSignIn=function(){var linkName=$rootScope.content.M_7_70_7_HUB_Order_Details_Enjoy.PageLevelItems.Links.SignIn.Label,linkURL=$rootScope.content.M_7_70_7_HUB_Order_Details_Enjoy.PageLevelItems.Links.SignIn.URL;ReportInterfaceAngular.setLinkTrack(linkName,"Body",linkURL),$window.location.href=linkURL}}];orderDetailsCtrl.resolve={ordrDtls:["$rootScope","SessionKeeper","$log","OSHPService","ContentService",function($rootScope,SessionKeeper,$log,OSHPService,ContentService){var current=$rootScope.current;current||(current=$rootScope.current=SessionKeeper.read());var orderDetail;if(void 0!=$rootScope.orderDetails?orderDetail=$rootScope.orderDetails.orders[0]:void 0!=current.orderDetails&&void 0!==current.orderDetails.orders&&(orderDetail=current.orderDetails.orders[0]),sessionStorage.getItem("dtRefreshTimer")&&orderDetail){var orderNumber,zipCode;orderDetail&&(orderNumber=orderDetail.orderNumber,zipCode=orderDetail.billingZip);var orderDetails={CommonData:oshpData.defaults.CommonData,orderNumber:orderNumber,zipCode:zipCode,passphrase:current.passphrase};return current.orderDetailReq=orderDetails,localStorage.setItem("dtmZipCode",current.zipcode),sessionStorage.removeItem("dtRefreshTimer"),OSHPService.oshpOrderSummaryAPIServices(current,oshpData.useStubs,$rootScope)}if(!current||void 0==$rootScope.orderDetails&&void 0==current.orderDetails)$rootScope.viewlandingPage();else{if(void 0!=$rootScope.orderDetails)return function(){if(void 0!==$rootScope.orderDetails&&void 0!==$rootScope.orderDetails.searchType&&$rootScope.orderDetails.searchType,void 0!==current.appId&&"OSH"===current.appId?$rootScope.showFooterDiv=!0:$rootScope.showFooterDiv=!1,$log.log("entering orderDetails resolver"),current.isHandOff){if(current.orderDetailReq&&current.orderDetailReq.ReqOrderNumber&&current.orderDetailReq.ReqShippingZip&&current.orderDetailReq.ReqContext)return"";$rootScope.viewlandingPage(),localStorage.setItem("dtmZipCode",current.orderDetailReq.ReqShippingZip)}else{if(void 0!==$rootScope.orderDetails&&null!=$rootScope.orderDetails){if("UNAUTH"===$rootScope.orderDetails.searchType&&null!=$rootScope.orderDetails.orders[0]&&"CRU"===$rootScope.orderDetails.orders[0].account.accountType&&void 0!=$rootScope.orderDetails.orders[0].account.accountNumber){$rootScope.current.customerType=void 0,sessionStorage.removeItem("customerTypeSMB");var success=function(data){data&&null!=data&&($rootScope.current.customerType=data.customerType)},failure=function(error){$log.log("Error in customerTypeAPIService")};(custTypeAPIService=OSHPService.customerTypeAPIService(current,oshpData.useStubs,$rootScope,"D",$rootScope)).then(success,failure)}else $rootScope.current.customerType=void 0,sessionStorage.removeItem("customerTypeSMB");var wirelessOrder=$rootScope.orderDetails;return $rootScope.orderDetails=null,wirelessOrder}"undefined"!==sessionStorage.getItem("customerTypeSMB")&&null!==sessionStorage.getItem("customerTypeSMB")&&($rootScope.current.customerType=sessionStorage.getItem("customerTypeSMB"));var time_now=(new Date).getTime(),sessionSetTime="",orderDetails="";if("undefined"!==sessionStorage.getItem("sessionSetTime")&&null!==sessionStorage.getItem("sessionSetTime")&&(sessionSetTime=sessionStorage.getItem("sessionSetTime")),"undefined"!==sessionStorage.getItem("orderDetailsWireless")&&null!==sessionStorage.getItem("orderDetailsWireless")&&current.orderDetailReq&&current.orderDetailReq.OrderNumber===current.OrderID&&(orderDetails=JSON.parse(sessionStorage.getItem("orderDetailsWireless"))),""!==sessionSetTime&&""!==orderDetails&&time_now-sessionSetTime<3e5&&null!==orderDetails.orderResponseVO[0]&&current.orderDetailReq&&orderDetails.orderResponseVO[0].OrderNumber===current.orderDetailReq.OrderNumber){if(orderDetails.orderResponseVO[0].cachePick="true","false"===orderDetails.Authenticated&&null!=orderDetails.orderResponseVO[0]&&"CRU"===orderDetails.orderResponseVO[0].OrderType&&void 0!=orderDetails.orderResponseVO[0].billingAccountNumber)if(null==sessionStorage.getItem("customerTypeSMB")){var custTypeAPIService=OSHPService.customerTypeAPIService(current,oshpData.useStubs,$rootScope,"C",$rootScope),success=function(data){data&&null!=data&&($rootScope.current.customerType=data.customerType)},failure=function(error){$log.log("Error in customerTypeAPIService")};custTypeAPIService.then(success,failure)}else $rootScope.current.customerType=sessionStorage.getItem("customerTypeSMB");else $rootScope.current.customerType=void 0,sessionStorage.removeItem("customerTypeSMB");return orderDetails}}}();if(void 0!=current.orderDetails)return current.orderDetails}}]};var validationEmailCtrl=["$scope","$rootScope","objectData","$log","OSHPService","$location","$window","ReportInterfaceAngular",function($scope,$rootScope,objectData,$log,OSHPService,$location,$window,ReportInterfaceAngular){$log.log("entering orderCancelCtrl");var current=$rootScope.current;if(void 0===current.orderDetails&&null==current.orderDetails)$scope.viewlandingPage();else{if($scope.orders=current.orderDetails,$scope.orderLen=current.orderDetails.orders[0].wirelessLines.length,$rootScope.setPageContent(),""!==objectData&&"SUCCESS"!==objectData.Result.Status){var statusError={code:objectData.Result.Messages.DisplayCode,type:"SLFailure",message:objectData.Result.Messages.DisplayCode+":"+$scope.getErrorMessage(objectData)};$scope.setStatus(statusError),$rootScope.errorType=statusError.message,$scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Order Management Email Validation Pg",window.location.pathname),$scope.setView("orderDetails")}else $scope.dtmCustomNotification("pageLoad","Page_Load","","","","CMO Order Management Email Validation Pg",window.location.pathname);$scope.viewHomePage=function(){current.orderDetails.ReturnURL&&void 0!==current.orderDetails.ReturnURL?($rootScope.stop(),current.orderDetails.ReturnURL.indexOf("checkorder")>=0?$window.location.href=current.orderDetails.ReturnURL.replace(/es-us\//g,""):$window.location.href=current.orderDetails.ReturnURL):($scope.setStatus({code:null,type:null,message:null}),$rootScope.stop(),void 0!==current.orderDetails&&null!=current.orderDetails&&(current.orderDetails={}),current.oStatus="",$scope.backToSearchRedirectionFlag=backToSearchRedirectionConfig.backToSearchRedirectionFlag,$scope.backToSearchRedirectionFlag?window.location.href=backToSearchRedirectionConfig.backToSearchRedirectionUrl:$scope.setView("omhub"))}}}];validationEmailCtrl.resolve={objectData:["$rootScope","SessionKeeper","$log","OSHPService",function($rootScope,SessionKeeper,$log,OSHPService){var current=$rootScope.current;if(current||(current=$rootScope.current=SessionKeeper.read()),$log.log("entering validationEmailCtrl resolver"),$rootScope.showFooterDiv=!0,void 0!==current.orderDetails||null!=current.orderDetails){var emailDetails={CommonData:oshpData.defaults.CommonData,Lang:current.language?current.language:"en",OrderType:current.orderDetails.orders[0].account.accountType,OrderNum:current.orderDetails.orders[0].orderNumber,Zip:current.zipcode,MaskedEmailKey:current.orderDetails.orders[0].orderNumber+current.orderDetails.orders[0].email};return current.emailDetailsReq=emailDetails,OSHPService.sendVerificationEmail(current,oshpData.useStubs)}$rootScope.viewlandingPage()}]};