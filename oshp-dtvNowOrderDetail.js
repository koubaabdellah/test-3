var dtvNowOrderDetailCtrl=["$scope","$rootScope","ordrDtls","$log","$cookies","OSHPService","$filter","$location","$window","constants","ReportInterfaceAngular",function($scope,$rootScope,ordrDtls,$log,$cookies,OSHPService,$filter,$location,$window,constants,ReportInterfaceAngular){function addParameter(form,name,value){var $input=angular.element("<input />").attr("type","hidden").attr("name",name).attr("value",value);form.append($input)}$log.log("entering dtvNowOrderDetailCtrl"),$rootScope.setPageContent(),$scope.understanStatus=$rootScope.prepareOrderStatusJson($rootScope.content.M_7_70_4_HUB_Order_Details.UnderstandingYourOrderStatus.FieldLabels);var current=$rootScope.current;current||(current=$rootScope.current=SessionKeeper.read()),void 0!=ordrDtls.orders&&ordrDtls.orders.length>0&&($scope.dtvOrderDetails=ordrDtls.orders[0],$scope.productType=$scope.dtvOrderDetails.orderProductType),$scope.meerkatFlag=!1,angular.isDefined(meerkatConfig)&&angular.isDefined(meerkatConfig.meerkatFlag)&&($scope.meerkatFlag=meerkatConfig.meerkatFlag),angular.isDefined(current.orderSummaryDetails)&&angular.isDefined(current.orderSummaryDetails.searchType)&&"UNAUTH"!==current.orderSummaryDetails.searchType&&($scope.isAuth=!0);var orderSummaryDetail={};if(angular.isDefined(current.orderSummaryDetails)&&angular.isDefined(current.orderSummaryDetails.orders)&&(orderSummaryDetail=current.orderSummaryDetails.orders),(void 0!=$rootScope.orderSummaryDetails&&$rootScope.orderSummaryDetails.orders.length>1||void 0!=current.orderSummaryDetails&&current.orderSummaryDetails.orders.length>1)&&($scope.backToSummary=sessionStorage.getItem("backToSummary")),$scope.redirectAttTvToIDPPage=function(dtvOrderDetails){if("true"==dtvOrderDetails.reDirectAttTvOrder&&(dtvOrderDetails.orderProductType===constants.dtvNowProductType||dtvOrderDetails.orderProductType===constants.dtvNowBundleProductType||dtvOrderDetails.orderProductType===constants.dtvNowDeviceProductType||dtvOrderDetails.orderProductType===constants.dtvNowServiceProductType)&&"true"!=dtvOrderDetails.nfflOrder&&"true"!==dtvOrderDetails.smbOrder)return!0},void 0!=$scope.dtvOrderDetails&&$scope.redirectAttTvToIDPPage($scope.dtvOrderDetails)){void 0==$scope.backToSummary||"true"!==$scope.backToSummary&&!0!==$scope.backToSummary?$scope.fromSummary=!1:$scope.fromSummary=!0;var zipCode=void 0!=$scope.dtvOrderDetails.inputZip?$scope.dtvOrderDetails.inputZip:null!=$scope.dtvOrderDetails.billingZip&&void 0!=$scope.dtvOrderDetails.billingZip?$scope.dtvOrderDetails.billingZip:$scope.dtvOrderDetails.shippingZip,wirelessOrder={searchType:void 0!==current.dtvOrderDetails.searchType?current.dtvOrderDetails.searchType:current.orderSummaryDetails.searchType,fromSummaryPage:$scope.fromSummary,accessToken:current.dtvOrderDetails.accessToken,orderType:"dtvnow"};document.cookie="wirelessProductIdp="+JSON.stringify(wirelessOrder)+"; domain=.att.com; path=/; secure",document.cookie="accessToken="+current.dtvOrderDetails.accessToken+"; domain=.att.com; path=/; secure",$("body").hide(),!1===$scope.fromSummary?window.location.href=$scope.dtvOrderDetails.idpManageUrl+"details?appid=omhLegacy&orderid="+$scope.dtvOrderDetails.orderNumber+"&zip="+zipCode:window.location.href=$scope.dtvOrderDetails.idpManageUrl+"details?appid=omhLegacy&orderid="+$scope.dtvOrderDetails.orderNumber+"&zip="+zipCode+"&lob=dtvstream"}angular.forEach(orderSummaryDetail,function(order){angular.isDefined($scope.dtvOrderDetails)&&order.orderNumber==$scope.dtvOrderDetails.orderNumber&&angular.isDefined(order)&&angular.isDefined(order.egLines)&&order.egLines.length>0&&(void 0!=$scope.dtvOrderDetails.address&&null!=$scope.dtvOrderDetails.address||($scope.dtvOrderDetails.address=order.address),angular.forEach(order.egLines,function(egLine){"true"==egLine.upgradeProduct&&"Complete"!=egLine.productStatus&&"Canceled"!=egLine.productStatus&&($scope.egLine=egLine)}))}),angular.isDefined($scope.dtvOrderDetails)&&angular.isDefined($scope.dtvOrderDetails.dtvNowLines)&&$scope.dtvOrderDetails.dtvNowLines.length>0&&($scope.hasOspreyDevice="false",angular.forEach($scope.dtvOrderDetails.dtvNowLines,function(dtvNowLine){angular.isDefined(dtvNowLine.equipments)&&dtvNowLine.equipments.length>0&&angular.forEach(dtvNowLine.equipments,function(equipment){"true"==equipment.osprey&&($scope.hasOspreyDevice="true")})})),$scope.addToCalendar=function(order,item){$rootScope.isViewLoading=!0,$rootScope.resetStatusError();var linkName=order.orderProductType+" "+item.productName+" Calendar";ReportInterfaceAngular.setLinkTrack(linkName,"Body");OSHPService.oshpGetAppointmentCalendarAPIServices(order,item,oshpData.useStubs,$rootScope).then(function(data){if(data&&data.Result&&"SUCCESS"==data.Result.Status){var $form=angular.element("<form/>").attr("id","data_form").attr("action","json/appointment.ics").attr("method","post");angular.element("body").append($form),addParameter($form,"calData",data.response),$form[0].submit(),$rootScope.isViewLoading=!1}else{var statusError={code:"OM150",type:"ODG_ERROR",message:"OM150 : "+ContentService.getError("OM150")};data&&data.Result&&null!=data.Result.Messages&&data.Result.Messages[0].DisplayCode&&(statusError={code:data.Result.Messages[0].DisplayCode,type:"ODG_ERROR",message:data.Result.Messages[0].DisplayCode+" : "+data.Result.Messages[0].EnglishLongMessage}),$rootScope.setStatus(statusError),$rootScope.isViewLoading=!1,$rootScope.setView("orderSummary"),$rootScope.focusOnError()}},function(error){$rootScope.isViewLoading=!1,$log.log("error="+error.code),$rootScope.setStatus(error),$rootScope.setView("orderSummary"),$rootScope.focusOnError()})};var additionalData={},itemSKU="";if(void 0!=$scope.dtvOrderDetails){if(function(myOrders){var firstNetSubtype="";if(myOrders.account.firstNetIndicator&&null!=myOrders.account.firstNetIndicator&&void 0!=myOrders.account.firstNetIndicator&&void 0!=myOrders.account.firstNetSubtype&&null!=myOrders.account.firstNetSubtype){if("P1"==myOrders.account.firstNetSubtype.toUpperCase()?firstNetSubtype="Primary":"V1"==myOrders.account.firstNetSubtype.toUpperCase()?firstNetSubtype="Volunteer":"E1"==myOrders.account.firstNetSubtype.toUpperCase()&&(firstNetSubtype="Extended"),null!=myOrders.dtvNowLines&&void 0!==myOrders.dtvNowLines)for(var i=0;i<myOrders.dtvNowLines.length;i++)void 0!=myOrders.dtvNowLines[i].equipments.itemSKU&&null!=myOrders.dtvNowLines[i].equipments.itemSKU&&(itemSKU=myOrders.dtvNowLines[i].equipments.itemSKU+"|"+itemSKU);""!==itemSKU&&itemSKU.length>0&&(itemSKU=itemSKU.substring(0,itemSKU.length-1)),void 0!=ddo&&(ddo.setVar("user.attributes.firstNetFlag","1"),ddo.setVar("user.attributes.firstNetUserRole",firstNetSubtype),ddo.setVar("user.account.fan",""),ddo.setVar("user.account.wirelessAccountStatus","A"),ddo.setVar("page.attributes.sku",itemSKU)),additionalData={firstNetFlag:"1",firstNetUserRole:firstNetSubtype}}else void 0!=ddo&&ddo.setVar("user.attributes.firstNetFlag","0"),additionalData={firstNetFlag:"0"}}($scope.dtvOrderDetails),void 0!=$scope.dtvOrderDetails.dtvNowLines&&$scope.dtvOrderDetails.dtvNowLines.length>0){if($scope.orderLen=$scope.dtvOrderDetails.dtvNowLines.length,$scope.OrderCarrierName=null,$scope.OrderCarrierCount=0,$scope.orderShow="single",$scope.orderStatus=$scope.dtvOrderDetails.orderStatus,$scope.orderStatusDescription=$scope.dtvOrderDetails.statusDescription,$scope.orderLen>0)for(i=0;i<$scope.orderLen;i++)if($scope.dtvOrderDetails.dtvNowLines[i].productStatus!==$scope.orderStatus){$scope.orderShow="multi";break}for(var i=0;i<$scope.orderLen;i++)if(void 0!=$scope.dtvOrderDetails.dtvNowLines[i].equipments&&$scope.dtvOrderDetails.dtvNowLines[i].equipments.length>0){$scope.equipmentLen=$scope.dtvOrderDetails.dtvNowLines[i].equipments.length;for(var x=0;x<$scope.equipmentLen;x++)(void 0!=$scope.dtvOrderDetails.dtvNowLines[i].equipments[x]&&void 0!=$scope.dtvOrderDetails.dtvNowLines[i].equipments[x].carrier&&"DELIVERED"==$scope.dtvOrderDetails.dtvNowLines[i].equipments[x].statusKey||"SHIPPED"==$scope.dtvOrderDetails.dtvNowLines[i].equipments[x].statusKey)&&($scope.OrderCarrierName=$scope.dtvOrderDetails.dtvNowLines[i].equipments[x].carrier.Name,$scope.OrderCarrierCount++),$scope.dtvOrderDetails.dtvNowLines[i].equipments[x].productStatus!==$scope.orderStatus&&"multi"!==$scope.orderShow&&($scope.orderShow="multi")}else $scope.orderShow="single"}$log.log("order orderShow is"+$scope.orderShow),$log.log("number of dtvNowLines items "+$scope.orderLen)}"DTVNOW"===$scope.productType.toUpperCase().trim()&&(void 0!=ddo&&(ddo.setVar("page.attributes.productType","DTVNOWEQUIPMENT"),ddo.setVar("page.pageInfo.lineOfBusiness","Home Solutions")),additionalData={productType:"DTVNOWEQUIPMENT"}),void 0!=ddo&&ddo.disableAutoPageLoad(),angular.element(document).ready(function(){setTimeout(function(){ReportInterfaceAngular.setPageTrack("CMO Order Status Details Pg",window.location.pathname,additionalData)},1e3)}),$scope.manageChangeAppointmentLink=function(order,item){var linkName=$rootScope.content.M_7_70_1_HUB_Order_Summary.OrderSummaryEG.Links.ChangeAppointment.Label,linkUrl=item.changeAppointmentUrl;ReportInterfaceAngular.setLinkTrack(linkName,"Body",linkUrl),window.location.href=item.changeAppointmentUrl,setTimeout(0)},$scope.manageDtvNowItems=function(dtvnowLines){var dtvLineItems=[];if(void 0!==dtvnowLines&&void 0!==dtvnowLines.length&&dtvnowLines.length>0)for(var i in dtvnowLines){var dtvLineItem={productName:dtvnowLines[i].productName,dtvNowRatePlan:dtvnowLines[i].dtvNowRatePlan,dtvNowAddOn:dtvnowLines[i].dtvNowAddOn,quantity:dtvnowLines[i].quantity,productType:dtvnowLines[i].productType,osprey:null,isUpgradedProduct:null};if(dtvLineItems.push(dtvLineItem),void 0!==dtvnowLines[i].equipments&&void 0!==dtvnowLines[i].equipments.length&&dtvnowLines[i].equipments.length>0)for(var j in dtvnowLines[i].equipments){var dtvEquipment={productName:dtvnowLines[i].equipments[j].equipmentName,quantity:dtvnowLines[i].equipments[j].quantity,osprey:dtvnowLines[i].equipments[j].osprey,productType:dtvnowLines[i].equipments[j].productType,imageUrl:dtvnowLines[i].equipments[j].imageUrl,isUpgradedProduct:dtvnowLines[i].equipments[j].isUpgradedProduct};dtvLineItems.push(dtvEquipment)}}return dtvLineItems},$scope.viewHomePage=function(){void 0!==$scope.dtvOrderDetails&&void 0!==$scope.dtvOrderDetails.ReturnURL&&current.dtvOrderDetails.ReturnURL?($rootScope.stop(),$scope.dtvOrderDetails.ReturnURL.indexOf("checkorder")>=0?$window.location.href=current.dtvOrderDetails.ReturnURL.replace(/es-us\//g,""):$window.location.href=current.dtvOrderDetails.ReturnURL):($scope.setStatus({code:null,type:null,message:null}),$rootScope.stop(),void 0!==$scope.dtvOrderDetails&&null!=current.dtvOrderDetails&&($scope.dtvOrderDetails={}),$scope.oStatus="",$scope.backToSearchRedirectionFlag=backToSearchRedirectionConfig.backToSearchRedirectionFlag,$scope.backToSearchRedirectionFlag?window.location.href=backToSearchRedirectionConfig.backToSearchRedirectionUrl:$scope.setView("omhub"))},$scope.returnToSummary=function(){!0===$scope.backToSummary&&($rootScope.current.OrderID="",$rootScope.current.zipcode="",$rootScope.current.OrderID=$rootScope.orderNumber,$rootScope.current.zipcode=$rootScope.zipCode,$rootScope.backToSummary="true",ReportInterfaceAngular.setLinkTrack($rootScope.content.M_7_70_0_HUB_Check_Order_Status.PageLevelItems.Links.BackToOrderSummary.Label,"Body","/checkmyorder/orderSummary.rt"),$scope.setView("orderSummary"))}}];dtvNowOrderDetailCtrl.resolve={ordrDtls:["$rootScope","SessionKeeper","$log","OSHPService","ContentService",function($rootScope,SessionKeeper,$log,OSHPService,ContentService){var current=$rootScope.current;if(current||(current=$rootScope.current=SessionKeeper.read()),current){if(void 0!=current.dtvOrderDetails)return current.dtvOrderDetails;var orderDetails={CommonData:oshpData.defaults.CommonData,OrderNumber:current.OrderID,ShippingZip:current.zipcode,passphrase:current.passphrase};return current.orderDetailReq=orderDetails,localStorage.setItem("dtmZipCode",current.zipcode),OSHPService.oshpOrderDetailsAPIServices(current,!1)}$rootScope.viewlandingPage()}]};