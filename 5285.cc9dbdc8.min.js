"use strict";(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[5285],{215285:(e,t,n)=>{n.r(t);n.d(t,{MeetModule:()=>_e});var r=n(667489);var i=n(187933);var o=n(960782);var u=n(642107);var c=n(812490);var s=n(302186);var a={VIDEO_SERVICE:"VIDEO_SERVICE",MEET_SOUND_SETTING:"MEET_SOUND_SETTING",RECENT_MEET_HISTORY:"RECENT_MEET_HISTORY",LATEST_JOIN_NAME:"LATEST_JOIN_NAME"};var l=n(469882);var f=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var d=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var v=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var p=function(e){f(MeetConfigOld,e);function MeetConfigOld(t){var n=e.call(this,c.oF,t)||this;n.getVideoService=function(){return n.get(a.VIDEO_SERVICE)};n.getMeetSoundSetting=function(){return n.get(a.MEET_SOUND_SETTING)};n.getRecentMeetItems=function(){return n.get(a.RECENT_MEET_HISTORY)};n.getLatestJoinName=function(){return n.get(a.LATEST_JOIN_NAME)};return n}MeetConfigOld.prototype.get=function(e,t){if(t===void 0){t=false}var n;return d(this,void 0,void 0,(function(){var r;return v(this,(function(i){switch(i.label){case 0:return[4,this._configService.get(c.oF,e,t)];case 1:if(!((n=i.sent())!==null&&n!==void 0))return[3,2];r=n;return[3,4];case 2:return[4,this._configService.get("meet",e,t)];case 3:r=i.sent();i.label=4;case 4:return[2,r]}}))}))};MeetConfigOld.prototype.setVideoService=function(e){return this.put(a.VIDEO_SERVICE,e)};MeetConfigOld.prototype.setMeetSoundSetting=function(e){return this.put(a.MEET_SOUND_SETTING,e)};MeetConfigOld.prototype.setRecentMeetItems=function(e){return this.put(a.RECENT_MEET_HISTORY,e)};MeetConfigOld.prototype.setLatestJoinName=function(e){return this.put(a.LATEST_JOIN_NAME,e)};return MeetConfigOld}(l.DBConfig);var h=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var _=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var g=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var y=function(e){h(MeetConfig,e);function MeetConfig(){var t=e.call(this,c.oF)||this;t._tryInitOldMeetConfigWithKeyAction=function(){return _(t,void 0,void 0,(function(){var e,t;return g(this,(function(n){switch(n.label){case 0:e=this.keyActionService;if(!e)return[3,2];t=e.get(o.ACTION_KEY.GET_GLIP_CONFIG_SERVICE);if(!t)return[3,2];return[4,this._initMeetConfigOld(t)];case 1:n.sent();n.label=2;case 2:return[2]}}))}))};t._initMeetConfigOld=function(e){return _(t,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:return[4,e.getAction()];case 1:t=n.sent();this._meetConfigOld=new p(t);return[2]}}))}))};return t}MeetConfig.prototype.getVideoService=function(){var e;return _(this,void 0,Promise,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.getSetting(a.VIDEO_SERVICE,(e=this._meetConfigOld)===null||e===void 0?void 0:e.getVideoService)];case 1:return[2,t.sent()]}}))}))};MeetConfig.prototype.setVideoService=function(e){var t;return _(this,void 0,Promise,(function(){return g(this,(function(n){switch(n.label){case 0:this.put(a.VIDEO_SERVICE,e);return[4,(t=this._meetConfigOld)===null||t===void 0?void 0:t.setVideoService(e)];case 1:n.sent();return[2]}}))}))};MeetConfig.prototype.getMeetSoundSetting=function(){var e;return _(this,void 0,Promise,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.getSetting(a.MEET_SOUND_SETTING,(e=this._meetConfigOld)===null||e===void 0?void 0:e.getMeetSoundSetting)];case 1:return[2,t.sent()]}}))}))};MeetConfig.prototype.setMeetSoundSetting=function(e){var t;return _(this,void 0,Promise,(function(){return g(this,(function(n){switch(n.label){case 0:this.put(a.MEET_SOUND_SETTING,e);return[4,(t=this._meetConfigOld)===null||t===void 0?void 0:t.setMeetSoundSetting(e)];case 1:n.sent();return[2]}}))}))};MeetConfig.prototype.getRecentMeetItems=function(){var e;return _(this,void 0,Promise,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.getSetting(a.RECENT_MEET_HISTORY,(e=this._meetConfigOld)===null||e===void 0?void 0:e.getRecentMeetItems)];case 1:return[2,t.sent()]}}))}))};MeetConfig.prototype.setRecentMeetItems=function(e){var t;return _(this,void 0,Promise,(function(){return g(this,(function(n){switch(n.label){case 0:this.put(a.RECENT_MEET_HISTORY,e);return[4,(t=this._meetConfigOld)===null||t===void 0?void 0:t.setRecentMeetItems(e)];case 1:n.sent();return[2]}}))}))};MeetConfig.prototype.getLatestJoinName=function(){var e;return _(this,void 0,Promise,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,this.getSetting(a.LATEST_JOIN_NAME,(e=this._meetConfigOld)===null||e===void 0?void 0:e.getLatestJoinName)];case 1:return[2,t.sent()]}}))}))};MeetConfig.prototype.setLatestJoinName=function(e){var t;return _(this,void 0,Promise,(function(){return g(this,(function(n){switch(n.label){case 0:this.put(a.LATEST_JOIN_NAME,e);return[4,(t=this._meetConfigOld)===null||t===void 0?void 0:t.setLatestJoinName(e)];case 1:n.sent();return[2]}}))}))};MeetConfig.prototype.init=function(){return _(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return[4,this._tryInitOldMeetConfigWithKeyAction()];case 1:e.sent();if(!this._meetConfigOld){this.keyActionService.on(o.ACTION_KEY.GET_GLIP_CONFIG_SERVICE,this._initMeetConfigOld)}return[2]}}))}))};MeetConfig.prototype.dispose=function(){this.keyActionService.off(o.ACTION_KEY.GET_GLIP_CONFIG_SERVICE,this._initMeetConfigOld)};MeetConfig.prototype.getSetting=function(e,t){return _(this,void 0,Promise,(function(){var n,r;return g(this,(function(i){switch(i.label){case 0:n=this.get(e);if(n){return[2,n]}if(!t)return[3,2];return[4,t()];case 1:r=i.sent();if(r){this.put(e,r)}return[2,r];case 2:return[2,undefined]}}))}))};Object.defineProperty(MeetConfig.prototype,"keyActionService",{get:function(){return(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE).getKeyActionService()},enumerable:true,configurable:true});return MeetConfig}(r.UserConfig);var b=15;var S=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var E=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var P=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],u;try{while((t===void 0||t-- >0)&&!(i=r.next()).done)o.push(i.value)}catch(e){u={error:e}}finally{try{if(i&&!i.done&&(n=r["return"]))n.call(r)}finally{if(u)throw u.error}}return o};var C=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(P(arguments[t]));return e};var M=function(){function RecentMeetController(e){this._meetConfig=e}RecentMeetController.prototype.upsertRecentMeetItem=function(e){return S(this,void 0,Promise,(function(){return E(this,(function(t){switch(t.label){case 0:return[4,this._upsertRecentMeetItem(e)];case 1:t.sent();if(this._recentMeetCache.length>b){this._recentMeetCache=this._recentMeetCache.slice(0,b)}return[4,this._meetConfig.setRecentMeetItems(this._recentMeetCache)];case 2:t.sent();return[2]}}))}))};RecentMeetController.prototype.getRecentMeetItems=function(){return S(this,void 0,Promise,(function(){var e;return E(this,(function(t){switch(t.label){case 0:if(!!this._recentMeetCache)return[3,2];e=this;return[4,this._meetConfig.getRecentMeetItems()];case 1:e._recentMeetCache=t.sent()||[];t.label=2;case 2:return[2,this._recentMeetCache]}}))}))};RecentMeetController.prototype._upsertRecentMeetItem=function(e){return S(this,void 0,void 0,(function(){var t,n;return E(this,(function(r){switch(r.label){case 0:return[4,this.getRecentMeetItems()];case 1:t=r.sent();n=t.findIndex((function(t){return t.id===e.id}));if(n<0){t=C([e],t)}else{t=C([e],t.slice(0,n),t.slice(n+1))}this._recentMeetCache=t;return[2]}}))}))};return RecentMeetController}();var w=function(){function JoinNameController(e){this._meetConfig=e}JoinNameController.prototype.getLatestJoinName=function(){return this._meetConfig.getLatestJoinName()};JoinNameController.prototype.updateJoinName=function(e){return this._meetConfig.setLatestJoinName(e)};return JoinNameController}();var I=n(370040);var m=n(7828);var O=n(295454);var N=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var A=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var T=function(){function BasePresence(){this._callbacks=new Set}BasePresence.prototype.subscribeSelfPresenceChange=function(e){return N(this,void 0,Promise,(function(){return A(this,(function(t){switch(t.label){case 0:this._callbacks.add(e);if(!(this._callbacks.size===1))return[3,2];return[4,this.monitorPresenceChange()];case 1:t.sent();t.label=2;case 2:return[2]}}))}))};BasePresence.prototype.unsubscribeSelfPresenceChange=function(e){this._callbacks.delete(e);if(this._callbacks.size===0){this.disposeMonitorPresenceChange()}};return BasePresence}();var R=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var V=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var U=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var x=2;var L=function(e){R(GlipPresenceProxy,e);function GlipPresenceProxy(){var t=e.call(this)||this;t._onPresenceChange=function(e){return V(t,void 0,void 0,(function(){var t,n;return U(this,(function(i){switch(i.label){case 0:return[4,this.getUserId()];case 1:t=i.sent();if(t&&e&&e.type===r.EVENT_TYPES.UPDATE){n=e.body.entities.get(t);if(n){this._doCallBacks(GlipPresenceProxy.transformGlipPresenceToUnify(n.presence))}}return[2]}}))}))};t._doCallBacks=function(e){t._callbacks.forEach((function(t){t(e)}))};return t}GlipPresenceProxy.prototype.setSelfPresence=function(e){return V(this,void 0,Promise,(function(){var t,n,r;return U(this,(function(i){switch(i.label){case 0:t=GlipPresenceProxy.transformUnifyToGlipPresence(e);n=0;i.label=1;case 1:if(!(n<x))return[3,6];i.label=2;case 2:i.trys.push([2,4,,5]);return[4,this._doSetSelfPresence(t)];case 3:i.sent();return[3,6];case 4:r=i.sent();I.k.warn("set glip presence happen fail, retry time:"+(n+1),r);if(n===x-1){throw r}return[3,5];case 5:++n;return[3,1];case 6:return[2]}}))}))};GlipPresenceProxy.prototype.setSelfRemotePresence=function(e){return V(this,void 0,Promise,(function(){var t,n,r;return U(this,(function(i){switch(i.label){case 0:t=GlipPresenceProxy.transformUnifyToGlipPresence(e);n=0;i.label=1;case 1:if(!(n<x))return[3,6];i.label=2;case 2:i.trys.push([2,4,,5]);return[4,this._doSetSelfRemotePresence(t)];case 3:i.sent();return[3,6];case 4:r=i.sent();I.k.warn("set glip remote presence happen fail, retry time:"+(n+1),r);if(n===x-1){throw r}return[3,5];case 5:++n;return[3,1];case 6:return[2]}}))}))};GlipPresenceProxy.prototype.getSelfPresence=function(){var e,t;return V(this,void 0,Promise,(function(){var n,i,u,c;return U(this,(function(s){switch(s.label){case 0:n=(t=(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.GET_GLIP_PRESENCE);if(!n)return[3,4];return[4,this.getUserId()];case 1:i=s.sent();return[4,n.getAction()];case 2:u=s.sent();return[4,u(i)];case 3:c=s.sent();return[2,GlipPresenceProxy.transformGlipPresenceToUnify(c===null||c===void 0?void 0:c.presence)];case 4:return[2,undefined]}}))}))};GlipPresenceProxy.prototype._doSetSelfRemotePresence=function(e){var t,n;return V(this,void 0,void 0,(function(){var i,u;return U(this,(function(c){switch(c.label){case 0:i=(n=(t=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||t===void 0?void 0:t.getKeyActionService())===null||n===void 0?void 0:n.get(o.ACTION_KEY.SET_GLIP_REMOTE_PRESENCE);return[4,i===null||i===void 0?void 0:i.getAction()];case 1:u=c.sent();return[4,u(e)];case 2:c.sent();return[2]}}))}))};GlipPresenceProxy.prototype._doSetSelfPresence=function(e){var t,n;return V(this,void 0,void 0,(function(){var i,u;return U(this,(function(c){switch(c.label){case 0:i=(n=(t=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||t===void 0?void 0:t.getKeyActionService())===null||n===void 0?void 0:n.get(o.ACTION_KEY.SET_GLIP_PRESENCE);return[4,i===null||i===void 0?void 0:i.getAction()];case 1:u=c.sent();return[4,u(e)];case 2:c.sent();return[2]}}))}))};GlipPresenceProxy.prototype.getUserId=function(){var e,t;return V(this,void 0,Promise,(function(){var n,i;return U(this,(function(u){switch(u.label){case 0:n=(t=(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.GET_GLIP_ACCOUNT_USER_CONFIG);if(!n)return[3,2];return[4,n.getAction()];case 1:i=u.sent();return[2,i.getUserId()];case 2:return[2,undefined]}}))}))};GlipPresenceProxy.prototype.monitorPresenceChange=function(){r.notificationCenter.on(O.QT.PRESENCE,this._onPresenceChange)};GlipPresenceProxy.prototype.disposeMonitorPresenceChange=function(){r.notificationCenter.off(O.QT.PRESENCE,this._onPresenceChange)};GlipPresenceProxy.transformGlipPresenceToUnify=function(e){switch(e){case O.wK.INMEETING:case O.wK.ONCALL:case O.wK.AVAILABLE:return O.FU.AVAILABLE;case O.wK.DND:return O.FU.DND;case O.wK.UNAVAILABLE:return O.FU.UNAVAILABLE;default:return O.FU.NOTREADY}};GlipPresenceProxy.transformUnifyToGlipPresence=function(e){switch(e){case O.FU.INMEETING:case O.FU.ONCALL:case O.FU.AVAILABLE:return O.wK.AVAILABLE;case O.FU.DND:return O.wK.DND;case O.FU.UNAVAILABLE:return O.wK.UNAVAILABLE;default:return O.wK.NOTREADY}};return GlipPresenceProxy}(T);var D=n(587040);var K=n(827027);var G=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var k=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Y=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var j=2;var B=function(e){G(RCPresenceProxy,e);function RCPresenceProxy(){var t=e.call(this)||this;t._onPresenceChange=function(e){return k(t,void 0,void 0,(function(){var t,n,i;return Y(this,(function(o){switch(o.label){case 0:return[4,this.getUserId()];case 1:t=o.sent();if(t&&e&&e.type===r.EVENT_TYPES.UPDATE){n=e.body.entities.get(t);if(n){i=RCPresenceProxy.transformRCPresenceToUnify(n);if(this._latestStatus!==i){this._latestStatus=i;this._doCallBacks(this._latestStatus)}}}return[2]}}))}))};t._doCallBacks=function(e){t._callbacks.forEach((function(t){t(e)}))};t._latestStatus=undefined;return t}RCPresenceProxy.prototype.setSelfPresence=function(e){return k(this,void 0,Promise,(function(){var t,n,r;return Y(this,(function(i){switch(i.label){case 0:t=RCPresenceProxy.transformUnifyToRCPresence(e);n=0;i.label=1;case 1:if(!(n<j))return[3,6];i.label=2;case 2:i.trys.push([2,4,,5]);return[4,this._doSetSelfPresence(t)];case 3:i.sent();return[3,6];case 4:r=i.sent();I.k.warn("set rc presence happen fail, retry time:"+(n+1));if(n===j-1){throw r}return[3,5];case 5:++n;return[3,1];case 6:return[2]}}))}))};RCPresenceProxy.prototype.setSelfRemotePresence=function(e){return this.setSelfPresence(e)};RCPresenceProxy.prototype.getSelfPresence=function(){var e,t;return k(this,void 0,Promise,(function(){var n,i,u,c;return Y(this,(function(s){switch(s.label){case 0:n=(t=(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.GET_RC_PRESENCE);if(!n)return[3,4];return[4,this.getUserId()];case 1:i=s.sent();return[4,n.getAction()];case 2:u=s.sent();return[4,u(i)];case 3:c=s.sent();return[2,RCPresenceProxy.transformRCPresenceToUnify(c)];case 4:return[2,undefined]}}))}))};RCPresenceProxy.prototype.getUserId=function(){var e;return k(this,void 0,Promise,(function(){return Y(this,(function(t){switch(t.label){case 0:return[4,(e=(0,D.gT)())===null||e===void 0?void 0:e.userConfig.getExtensionId()];case 1:return[2,t.sent()]}}))}))};RCPresenceProxy.prototype._doSetSelfPresence=function(e){return k(this,void 0,void 0,(function(){var t,n;return Y(this,(function(i){switch(i.label){case 0:t=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE).getKeyActionService().get(o.ACTION_KEY.SET_RC_PRESENCE);return[4,t===null||t===void 0?void 0:t.getAction()];case 1:n=i.sent();n(e);return[2]}}))}))};RCPresenceProxy.prototype.monitorPresenceChange=function(){return k(this,void 0,Promise,(function(){var e;return Y(this,(function(t){switch(t.label){case 0:e=this;return[4,this.getSelfPresence()];case 1:e._latestStatus=t.sent();r.notificationCenter.on(O.QT.RC_PRESENCE,this._onPresenceChange);return[2]}}))}))};RCPresenceProxy.prototype.disposeMonitorPresenceChange=function(){r.notificationCenter.off(O.QT.RC_PRESENCE,this._onPresenceChange);this._latestStatus=undefined};RCPresenceProxy.transformRCPresenceToUnify=function(e){if(e){if(K.DND_STATUS.DoNotAcceptAnyCalls===e.dndStatus){return O.FU.DND}if(K.PRESENCE_STATUS.Offline===e.presenceStatus){return O.FU.UNAVAILABLE}if(K.TELEPHONY_STATUS.NoCall!==e.telephonyStatus&&!!e.telephonyStatus){return O.FU.AVAILABLE}if(K.PRESENCE_MEETING_STATUS.Connected===e.meetingStatus){return O.FU.AVAILABLE}if(K.PRESENCE_STATUS.Busy===e.presenceStatus){return O.FU.BUSY}if(K.PRESENCE_STATUS.Available===e.presenceStatus){return O.FU.AVAILABLE}}return O.FU.NOTREADY};RCPresenceProxy.transformUnifyToRCPresence=function(e){var t={};switch(e){case O.FU.AVAILABLE:case O.FU.INMEETING:case O.FU.ONCALL:t.userStatus=K.USER_STATUS.Available;break;case O.FU.UNAVAILABLE:t.userStatus=K.USER_STATUS.Offline;break;case O.FU.BUSY:t.userStatus=K.USER_STATUS.Busy;break;case O.FU.DND:t.dndStatus=K.DND_STATUS.DoNotAcceptAnyCalls;break;default:t.userStatus=K.USER_STATUS.Offline}return t};return RCPresenceProxy}(T);var F=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var J=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var H=function(){function MeetPresenceController(){}MeetPresenceController.prototype.subscribeSelfPresenceChange=function(e){return F(this,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return[4,this.getPresenceProxy()];case 1:return[4,t.sent().subscribeSelfPresenceChange(e)];case 2:t.sent();return[2]}}))}))};MeetPresenceController.prototype.unsubscribeSelfPresenceChange=function(e){return F(this,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return[4,this.getPresenceProxy()];case 1:t.sent().unsubscribeSelfPresenceChange(e);return[2]}}))}))};MeetPresenceController.prototype.setSelfPresence=function(e){return F(this,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return[4,this.getPresenceProxy()];case 1:return[2,t.sent().setSelfPresence(e)]}}))}))};MeetPresenceController.prototype.setSelfRemotePresence=function(e){return F(this,void 0,void 0,(function(){return J(this,(function(t){switch(t.label){case 0:return[4,this.getPresenceProxy()];case 1:return[2,t.sent().setSelfRemotePresence(e)]}}))}))};MeetPresenceController.prototype.getSelfPresence=function(){return F(this,void 0,Promise,(function(){return J(this,(function(e){switch(e.label){case 0:return[4,this.getPresenceProxy()];case 1:return[2,e.sent().getSelfPresence()]}}))}))};MeetPresenceController.prototype.isRcOnlyAccount=function(){var e,t;return F(this,void 0,Promise,(function(){var n,r,i;return J(this,(function(u){switch(u.label){case 0:n=(t=(e=(0,m.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.IS_RC_ONLY_ACCOUNT);if(!n)return[3,4];u.label=1;case 1:u.trys.push([1,3,,4]);return[4,n.getAction()];case 2:r=u.sent();return[2,r];case 3:i=u.sent();I.k.warn("get rc only type by key action fail",i);return[3,4];case 4:return[2,false]}}))}))};MeetPresenceController.prototype.getPresenceProxy=function(){return F(this,void 0,Promise,(function(){var e;return J(this,(function(t){switch(t.label){case 0:if(!!this._presenceProxy)return[3,2];return[4,this.isRcOnlyAccount()];case 1:e=t.sent();if(!e){this._presenceProxy=new L}else{this._presenceProxy=new B}t.label=2;case 2:return[2,this._presenceProxy]}}))}))};return MeetPresenceController}();var z=n(260666);var Q=n(696206);var W=n(707938);var Z=n(470033);var q=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var X=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var $=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var ee=function(e){q(VideoServiceSettingItemProvider,e);function VideoServiceSettingItemProvider(t){var n=e.call(this,{id:z.H.Video_Service})||this;n._dbConfig=t;return n}VideoServiceSettingItemProvider.prototype.buildValueProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return X(e,void 0,void 0,(function(){var e;var t;return $(this,(function(n){switch(n.label){case 0:return[4,this._getVideoServiceAction()];case 1:return[4,(t=n.sent())===null||t===void 0?void 0:t.get()];case 2:e=n.sent();if(!(e===undefined))return[3,4];return[4,this._dbConfig.getVideoService()];case 3:e=n.sent();n.label=4;case 4:return[2,e]}}))}))},setter:function(t){return X(e,void 0,void 0,(function(){var e;return $(this,(function(n){switch(n.label){case 0:return[4,this._getVideoServiceAction()];case 1:return[4,(e=n.sent())===null||e===void 0?void 0:e.set(c.K1.VIDEO_SERVICE,t)];case 2:n.sent();return[4,this._dbConfig.setVideoService(t)];case 3:n.sent();return[2]}}))}))}})};VideoServiceSettingItemProvider.prototype.buildSourceProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return X(e,void 0,void 0,(function(){var e;return $(this,(function(t){switch(t.label){case 0:return[4,this._getVideoServiceAction()];case 1:return[4,(e=t.sent())===null||e===void 0?void 0:e.availableVideoService()];case 2:return[2,t.sent()]}}))}))}})};VideoServiceSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return X(e,void 0,void 0,(function(){var e;var t;return $(this,(function(n){switch(n.label){case 0:return[4,this._isMeetingPermissionEnabled()];case 1:if(!n.sent()){return[2,Q.ESettingItemState.INVISIBLE]}e=(t=(0,r.getCurrentAccount)())===null||t===void 0?void 0:t.context.entitlement.get(Z.H3.RCExtensionFeaturesId.EditMeetingsProvider);if(e){return[2,Q.ESettingItemState.ENABLE]}return[2,Q.ESettingItemState.INVISIBLE]}}))}))}})};VideoServiceSettingItemProvider.prototype.onLoad=function(){var e=this;var t,n,r,i,u,c;var handleChange=function(){e.getSourceProvider().notifyChange();e.getStateProvider().notifyChange();e.getValueProvider().notifyChange()};var videoServiceObserverDisposer=function(){};var observeVideoServiceChange=function(){var t;videoServiceObserverDisposer();(t=e._getVideoServiceAction())===null||t===void 0?void 0:t.then((function(e){var t=e.observe;videoServiceObserverDisposer=t(handleChange)}))};observeVideoServiceChange();var s=this._getKeyActionService();if(s){s.on(o.ACTION_KEY.VIDEO_SERVICE,(function(){observeVideoServiceChange();handleChange()}));(n=(t=s.get(o.ACTION_KEY.VIDEO_CONFERENCING))===null||t===void 0?void 0:t.getAction())===null||n===void 0?void 0:n.then((function(e){var t=e.observe;return t(handleChange)}));(i=(r=s.get(o.ACTION_KEY.PERMISSION_MEETINGS))===null||r===void 0?void 0:r.getAction())===null||i===void 0?void 0:i.then((function(e){var t=e.observe;return t(handleChange)}));(c=(u=s.get(o.ACTION_KEY.VIDEO_PROVIDER))===null||u===void 0?void 0:u.getAction())===null||c===void 0?void 0:c.then((function(e){var t=e.observe;return t(handleChange)}))}};VideoServiceSettingItemProvider.prototype._getVideoServiceAction=function(){var e,t;return(t=(e=this._getKeyActionService())===null||e===void 0?void 0:e.get(o.ACTION_KEY.VIDEO_SERVICE))===null||t===void 0?void 0:t.getAction()};VideoServiceSettingItemProvider.prototype._isMeetingPermissionEnabled=function(){var e,t,n;return X(this,void 0,Promise,(function(){return $(this,(function(r){switch(r.label){case 0:return[4,(t=(e=this._getKeyActionService())===null||e===void 0?void 0:e.get(o.ACTION_KEY.VIDEO_CONFERENCING))===null||t===void 0?void 0:t.getAction()];case 1:return[4,(n=r.sent())===null||n===void 0?void 0:n.get()];case 2:return[2,!!r.sent()]}}))}))};VideoServiceSettingItemProvider.prototype._getKeyActionService=function(){var e;return(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService()};return VideoServiceSettingItemProvider}(W.t);var te=n(531616);var ne=n(306502);var re=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var ie=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var oe=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var ue=function(e){re(MeetSoundsSettingItemProvider,e);function MeetSoundsSettingItemProvider(t){var n=e.call(this,{id:z.H.Video_IncomingCalls,source:{type:i.Pe.CONSTANT,defaultValue:ne.RingsList}})||this;n._dbConfig=t;return n}MeetSoundsSettingItemProvider.prototype.buildValueProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return ie(e,void 0,void 0,(function(){var e;return oe(this,(function(t){switch(t.label){case 0:return[4,this._dbConfig.getMeetSoundSetting()];case 1:e=t.sent()||ne.RINGS_TYPE.High_Gong;return[2,ne.RingsList.find((function(t){return t.id===e}))]}}))}))},setter:function(t){return ie(e,void 0,void 0,(function(){var e,n;var r,i,u;return oe(this,(function(s){switch(s.label){case 0:I.k.info("Update meet audio notification to ",t);return[4,(i=(r=this._getKeyActionService())===null||r===void 0?void 0:r.get(o.ACTION_KEY.PROFILE_SETTINGS))===null||i===void 0?void 0:i.getAction()];case 1:e=(u=s.sent())===null||u===void 0?void 0:u.set;return[4,e===null||e===void 0?void 0:e([{key:c.K1.MEETING_AUDIO_NOTIFICATIONS,value:t.id}])];case 2:n=s.sent();if(!!n)return[3,4];I.k.info("Save the meet audio notification to local");return[4,this._dbConfig.setMeetSoundSetting({id:t.id,url:t.url})];case 3:s.sent();s.label=4;case 4:return[2]}}))}))}})};MeetSoundsSettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return ie(e,void 0,void 0,(function(){var e;var t;return oe(this,(function(n){switch(n.label){case 0:e=(t=this._getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.VIDEO_CONFERENCING);if(!e)return[3,3];return[4,e.getAction()];case 1:return[4,n.sent().get()];case 2:return[2,n.sent()?te.Ye.ENABLE:te.Ye.INVISIBLE];case 3:return[2,te.Ye.ENABLE]}}))}))}})};MeetSoundsSettingItemProvider.prototype.onLoad=function(){var e=this;var t,n;var r=this._getKeyActionService();if(r){r.on(o.ACTION_KEY.VIDEO_CONFERENCING,(function(){e.getStateProvider().notifyChange()}));(n=(t=r.get(o.ACTION_KEY.PROFILE_SETTINGS))===null||t===void 0?void 0:t.getAction())===null||n===void 0?void 0:n.then((function(t){var n=t.observe;return n(c.K1.MEETING_AUDIO_NOTIFICATIONS,(function(){e.getStateProvider().notifyChange();e.getValueProvider().notifyChange()}))}))}};MeetSoundsSettingItemProvider.prototype._getKeyActionService=function(){var e;return(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService()};return MeetSoundsSettingItemProvider}(W.t);var ce=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var se=function(e){ce(ScreenSharingDNDSettingItemProvider,e);function ScreenSharingDNDSettingItemProvider(){return e.call(this,{id:z.H.Video_ScreenSharingDND,value:{type:Q.Pe.STORAGE,defaultValue:false},source:{type:Q.Pe.CONSTANT,defaultValue:[true,false]}})||this}ScreenSharingDNDSettingItemProvider.prototype.buildStateProvider=function(){return this.buildBaseItemValueProvider({getter:function(){return Promise.resolve(s.Pal.instance.getPlatformUtils().isElectron()?Q.ESettingItemState.ENABLE:Q.ESettingItemState.INVISIBLE)}})};return ScreenSharingDNDSettingItemProvider}(W.t);var ae=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var le=function(e){ae(MeetSettingManager,e);function MeetSettingManager(t){var n=e.call(this)||this;n._dbConfig=t;return n}MeetSettingManager.prototype.getProviderMap=function(){var e;return e={},e[z.H.Video_Service]=new ee(this._dbConfig),e[z.H.Video_IncomingCalls]=new ue(this._dbConfig),e[z.H.Video_ScreenSharingDND]=new se,e};return MeetSettingManager}(Q.AbstractModuleSettingProviderManager);var fe=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var de=function(e){fe(IsUsingRCVKeyAction,e);function IsUsingRCVKeyAction(t){if(t===void 0){t=r.ActionWeight.NORMAL}return e.call(this,t)||this}Object.defineProperty(IsUsingRCVKeyAction.prototype,"meetModule",{get:function(){if(!this._meetModule){this._meetModule=(0,r.getModule)(c.oF)}return this._meetModule},enumerable:true,configurable:true});IsUsingRCVKeyAction.prototype.getAction=function(){return this.meetModule.isUsingRCV()};return IsUsingRCVKeyAction}(r.AbstractKeyAction);var ve=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var pe=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var he=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=u[0]&2?i["return"]:u[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;if(i=0,o)u=[u[0]&2,o.value];switch(u[0]){case 0:case 1:o=u;break;case 4:n.label++;return{value:u[1],done:false};case 5:n.label++;i=u[1];u=[0];continue;case 7:u=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){n.label=u[1];break}if(u[0]===6&&n.label<o[1]){n.label=o[1];o=u;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(u);break}if(o[2])n.ops.pop();n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e];i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:true}}};var _e=function(e){ve(MeetModule,e);function MeetModule(t){var n=e.call(this,t)||this;n.handleSDKLogin=function(e){if(e.success){n.getSettingManager().load()}};return n}MeetModule.prototype.onLoad=function(){return pe(this,void 0,Promise,(function(){var e=this;return he(this,(function(t){switch(t.label){case 0:(0,r.getCurrentAccount)().onLoginResult((function(t){e.handleSDKLogin(t)}));this.getHealthController().registerItemMap({isEmbedded:function(){return e.isEmbedded()},isUsingRCV:function(){return pe(e,void 0,void 0,(function(){return he(this,(function(e){switch(e.label){case 0:return[4,this.isUsingRCV()];case 1:return[2,e.sent()]}}))}))},selfPresence:function(){return pe(e,void 0,void 0,(function(){return he(this,(function(e){switch(e.label){case 0:return[4,this.getSelfPresence()];case 1:return[2,e.sent()]}}))}))},hasMeetingPermission:function(){return e.hasMeetingPermission()},videoServiceValue:function(){return pe(e,void 0,void 0,(function(){return he(this,(function(e){switch(e.label){case 0:return[4,this.getVideoService()];case 1:return[2,e.sent()]}}))}))},videoServiceSource:function(){return pe(e,void 0,void 0,(function(){return he(this,(function(e){switch(e.label){case 0:return[4,this.getVideoServiceSource()];case 1:return[2,e.sent()]}}))}))}});this._initCommonKeyAction();this._dbConfig=new y;return[4,this._dbConfig.init()];case 1:t.sent();return[2]}}))}))};MeetModule.prototype.onUnload=function(){this.getSettingManager().unload();this._dbConfig.dispose()};MeetModule.prototype.onDBRecoverRequire=function(){I.k.warn("DB integrity check failed. Meet provider will fallback to the default value.")};Object.defineProperty(MeetModule.prototype,"recentMeetController",{get:function(){if(!this._recentMeetController){this._recentMeetController=new M(this._dbConfig)}return this._recentMeetController},enumerable:true,configurable:true});Object.defineProperty(MeetModule.prototype,"joinNameController",{get:function(){if(!this._joinNameController){this._joinNameController=new w(this._dbConfig)}return this._joinNameController},enumerable:true,configurable:true});Object.defineProperty(MeetModule.prototype,"meetPresenceController",{get:function(){if(!this._meetPresenceController){this._meetPresenceController=new H}return this._meetPresenceController},enumerable:true,configurable:true});MeetModule.prototype.moduleName=function(){return c.oF};MeetModule.prototype.getCanonical=function(e){return(0,r.getModule)(u.PHONE_PARSER_MODULE).getPhoneParser(e).then((function(t){return t?t.getCanonical():e}))};MeetModule.prototype.getCurrentPersonName=function(){return pe(this,void 0,Promise,(function(){var e;return he(this,(function(t){switch(t.label){case 0:return[4,(0,r.getCurrentAccount)().getUserInfo()];case 1:e=t.sent();if(e){return[2,{firstName:e.firstName,lastName:e.lastName,email:e.email}]}return[2,null]}}))}))};MeetModule.prototype.scheduleCalendarEvent=function(e,t,n,i,u){var c,s;return pe(this,void 0,Promise,(function(){var a,l;return he(this,(function(f){switch(f.label){case 0:a=(s=(c=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||c===void 0?void 0:c.getKeyActionService())===null||s===void 0?void 0:s.get(o.ACTION_KEY.CALENDAR_EVENT);if(!a)return[3,3];return[4,a.getAction()];case 1:return[4,f.sent().schedule({providerId:e,startDate:t.startDate,endDate:t.endDate,location:t.meetingUrl,subject:t.meetingName,description:n,attendees:u,timezone:t.timezone,createEventDirectly:i})];case 2:l=f.sent();return[2,{url:l.url}];case 3:return[2,{url:""}]}}))}))};MeetModule.prototype.getVideoService=function(){return pe(this,void 0,void 0,(function(){var e;return he(this,(function(t){switch(t.label){case 0:return[4,this._getVideoServiceEntity()];case 1:e=t.sent();return[2,e?e.value:null]}}))}))};MeetModule.prototype.getVideoServiceSource=function(){return pe(this,void 0,void 0,(function(){var e;return he(this,(function(t){switch(t.label){case 0:return[4,this._getVideoServiceEntity()];case 1:e=t.sent();return[2,e?e.source:null]}}))}))};MeetModule.prototype.getUserId=function(){var e,t,n,i;return pe(this,void 0,Promise,(function(){return he(this,(function(u){switch(u.label){case 0:return[4,(n=(t=(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.GET_GLIP_ACCOUNT_USER_CONFIG))===null||n===void 0?void 0:n.getAction()];case 1:return[2,(i=u.sent())===null||i===void 0?void 0:i.getUserId()]}}))}))};MeetModule.prototype.isEmbedded=function(){return s.Pal.instance.getPlatformUtils().isElectron()};MeetModule.prototype.upsertRecentMeetItem=function(e){return this.recentMeetController.upsertRecentMeetItem(e)};MeetModule.prototype.getRecentMeetItems=function(){return this.recentMeetController.getRecentMeetItems()};MeetModule.prototype.hasMeetingPermission=function(){var e,t,n;return pe(this,void 0,Promise,(function(){var i;return he(this,(function(u){switch(u.label){case 0:i=(t=(e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE))===null||e===void 0?void 0:e.getKeyActionService())===null||t===void 0?void 0:t.get(o.ACTION_KEY.VIDEO_CONFERENCING);return[4,i===null||i===void 0?void 0:i.getAction()];case 1:return[4,(n=u.sent())===null||n===void 0?void 0:n.get()];case 2:return[2,!!u.sent()]}}))}))};MeetModule.prototype.getLatestJoinName=function(){return this.joinNameController.getLatestJoinName()};MeetModule.prototype.updateJoinName=function(e){return this.joinNameController.updateJoinName(e)};MeetModule.prototype.getSelfPresence=function(){return this.meetPresenceController.getSelfPresence()};MeetModule.prototype.setSelfPresence=function(e){return this.meetPresenceController.setSelfPresence(e)};MeetModule.prototype.subscribeSelfPresenceChange=function(e){return this.meetPresenceController.subscribeSelfPresenceChange(e)};MeetModule.prototype.unsubscribeSelfPresenceChange=function(e){return this.meetPresenceController.unsubscribeSelfPresenceChange(e)};MeetModule.prototype.updateSelfRemotePresence=function(e){return this.meetPresenceController.setSelfRemotePresence(e)};MeetModule.prototype._getVideoServiceEntity=function(){return pe(this,void 0,void 0,(function(){var e,t;return he(this,(function(n){switch(n.label){case 0:e=(0,r.getModule)(i.oF);return[4,e.getById(z.H.Video_Service).catch((function(e){I.k.warn("getVideoService Fail.",{error:e})}))];case 1:t=n.sent();return[2,t]}}))}))};MeetModule.prototype.isUsingRCV=function(){return pe(this,void 0,Promise,(function(){var e;return he(this,(function(t){switch(t.label){case 0:return[4,(0,r.getModule)(i.oF).getById(z.H.Video_Service)];case 1:e=t.sent();return[2,[c.ZE.RINGCENTRAL_VIDEO,c.ZE.RINGCENTRAL_VIDEO_EMBEDDED].includes(e===null||e===void 0?void 0:e.value)]}}))}))};MeetModule.prototype.getSettingManager=function(){if(!this._settingManager){this._settingManager=new le(this._dbConfig)}return this._settingManager};MeetModule.prototype._initCommonKeyAction=function(){var e=(0,r.getModule)(o.COMMON_KEY_ACTION_MODULE).getKeyActionService();e.register(o.ACTION_KEY.IS_USING_RCV,new de)};return MeetModule}(r.AbstractModule)},370040:(e,t,n)=>{n.d(t,{k:()=>c});var r=n(862926);var i=n.n(r);var o=n(204285);var u="[MEET][CORE]";var c=r.ModuleLogger.getLogger(u,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),o.VIDEO_EVENT_DATA_FEATURE_KEY)}}]);