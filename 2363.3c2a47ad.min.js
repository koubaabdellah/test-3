/*! For license information please see 2363.3c2a47ad.min.js.LICENSE.txt */
(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[2363,7073],{333464:(r,i,s)=>{"use strict";s.d(i,{Jn:()=>Q,qX:()=>_getProvider,Xd:()=>_registerComponent,Mq:()=>getApp,ZF:()=>initializeApp,KN:()=>registerVersion});var a=s(879455);var l=s(853031);var c=s(329901);class PlatformLoggerServiceImpl{constructor(r){this.container=r}getPlatformInfoString(){const r=this.container.getProviders();return r.map((r=>{if(isVersionServiceProvider(r)){const i=r.getImmediate();return`${i.library}/${i.version}`}else{return null}})).filter((r=>r)).join(" ")}}function isVersionServiceProvider(r){const i=r.getComponent();return(i===null||i===void 0?void 0:i.type)==="VERSION"}const h="@firebase/app";const u="0.7.4";const d=new l.Yd("@firebase/app");const p="@firebase/app-compat";const f="@firebase/analytics-compat";const m="@firebase/analytics";const _="@firebase/app-check-compat";const y="@firebase/app-check";const g="@firebase/auth";const v="@firebase/auth-compat";const C="@firebase/database";const w="@firebase/database-compat";const E="@firebase/functions";const T="@firebase/functions-compat";const b="@firebase/installations";const P="@firebase/installations-compat";const S="@firebase/messaging";const I="@firebase/messaging-compat";const N="@firebase/performance";const k="@firebase/performance-compat";const x="@firebase/remote-config";const R="@firebase/remote-config-compat";const A="@firebase/storage";const F="@firebase/storage-compat";const O="@firebase/firestore";const D="@firebase/firestore-compat";const M="firebase";const L="9.1.3";const W="[DEFAULT]";const q={[h]:"fire-core",[p]:"fire-core-compat",[m]:"fire-analytics",[f]:"fire-analytics-compat",[y]:"fire-app-check",[_]:"fire-app-check-compat",[g]:"fire-auth",[v]:"fire-auth-compat",[C]:"fire-rtdb",[w]:"fire-rtdb-compat",[E]:"fire-fn",[T]:"fire-fn-compat",[b]:"fire-iid",[P]:"fire-iid-compat",[S]:"fire-fcm",[I]:"fire-fcm-compat",[N]:"fire-perf",[k]:"fire-perf-compat",[x]:"fire-rc",[R]:"fire-rc-compat",[A]:"fire-gcs",[F]:"fire-gcs-compat",[O]:"fire-fst",[D]:"fire-fst-compat","fire-js":"fire-js",[M]:"fire-js-all"};const V=new Map;const G=new Map;function _addComponent(r,i){try{r.container.addComponent(i)}catch(s){d.debug(`Component ${i.name} failed to register with FirebaseApp ${r.name}`,s)}}function _addOrOverwriteComponent(r,i){r.container.addOrOverwriteComponent(i)}function _registerComponent(r){const i=r.name;if(G.has(i)){d.debug(`There were multiple attempts to register component ${i}.`);return false}G.set(i,r);for(const i of V.values()){_addComponent(i,r)}return true}function _getProvider(r,i){return r.container.getProvider(i)}function _removeServiceInstance(r,i,s=W){_getProvider(r,i).clearInstance(s)}function _clearComponents(){G.clear()}const U={["no-app"]:"No Firebase App '{$appName}' has been created - "+"call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a "+"Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."};const B=new c.LL("app","Firebase",U);class FirebaseAppImpl{constructor(r,i,s){this._isDeleted=false;this._options=Object.assign({},r);this._config=Object.assign({},i);this._name=i.name;this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled;this._container=s;this.container.addComponent(new a.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){this.checkDestroyed();return this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(r){this.checkDestroyed();this._automaticDataCollectionEnabled=r}get name(){this.checkDestroyed();return this._name}get options(){this.checkDestroyed();return this._options}get config(){this.checkDestroyed();return this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(r){this._isDeleted=r}checkDestroyed(){if(this.isDeleted){throw B.create("app-deleted",{appName:this._name})}}}const Q=L;function initializeApp(r,i={}){if(typeof i!=="object"){const r=i;i={name:r}}const s=Object.assign({name:W,automaticDataCollectionEnabled:false},i);const l=s.name;if(typeof l!=="string"||!l){throw B.create("bad-app-name",{appName:String(l)})}const h=V.get(l);if(h){if((0,c.vZ)(r,h.options)&&(0,c.vZ)(s,h.config)){return h}else{throw B.create("duplicate-app",{appName:l})}}const u=new a.H0(l);for(const r of G.values()){u.addComponent(r)}const d=new FirebaseAppImpl(r,s,u);V.set(l,d);return d}function getApp(r=W){const i=V.get(r);if(!i){throw B.create("no-app",{appName:r})}return i}function getApps(){return Array.from(V.values())}async function deleteApp(r){const i=r.name;if(V.has(i)){V.delete(i);await Promise.all(r.container.getProviders().map((r=>r.delete())));r.isDeleted=true}}function registerVersion(r,i,s){var l;let c=(l=q[r])!==null&&l!==void 0?l:r;if(s){c+=`-${s}`}const h=c.match(/\s|\//);const u=i.match(/\s|\//);if(h||u){const r=[`Unable to register library "${c}" with version "${i}":`];if(h){r.push(`library name "${c}" contains illegal characters (whitespace or "/")`)}if(h&&u){r.push("and")}if(u){r.push(`version name "${i}" contains illegal characters (whitespace or "/")`)}d.warn(r.join(" "));return}_registerComponent(new a.wA(`${c}-version`,(()=>({library:c,version:i})),"VERSION"))}function onLog(r,i){if(r!==null&&typeof r!=="function"){throw B.create("invalid-log-argument")}setUserLogHandler(r,i)}function setLogLevel(r){setLogLevel$1(r)}function registerCoreComponents(r){_registerComponent(new a.wA("platform-logger",(r=>new PlatformLoggerServiceImpl(r)),"PRIVATE"));registerVersion(h,u,r);registerVersion(h,u,"esm2017");registerVersion("fire-js","")}registerCoreComponents("")},879455:(r,i,s)=>{"use strict";s.d(i,{wA:()=>c,H0:()=>d});var a=s(759312);var l=s(329901);var c=function(){function Component(r,i,s){this.name=r;this.instanceFactory=i;this.type=s;this.multipleInstances=false;this.serviceProps={};this.instantiationMode="LAZY";this.onInstanceCreated=null}Component.prototype.setInstantiationMode=function(r){this.instantiationMode=r;return this};Component.prototype.setMultipleInstances=function(r){this.multipleInstances=r;return this};Component.prototype.setServiceProps=function(r){this.serviceProps=r;return this};Component.prototype.setInstanceCreatedCallback=function(r){this.onInstanceCreated=r;return this};return Component}();var h="[DEFAULT]";var u=function(){function Provider(r,i){this.name=r;this.container=i;this.component=null;this.instances=new Map;this.instancesDeferred=new Map;this.instancesOptions=new Map;this.onInitCallbacks=new Map}Provider.prototype.get=function(r){var i=this.normalizeInstanceIdentifier(r);if(!this.instancesDeferred.has(i)){var s=new l.BH;this.instancesDeferred.set(i,s);if(this.isInitialized(i)||this.shouldAutoInitialize()){try{var a=this.getOrInitializeService({instanceIdentifier:i});if(a){s.resolve(a)}}catch(r){}}}return this.instancesDeferred.get(i).promise};Provider.prototype.getImmediate=function(r){var i;var s=this.normalizeInstanceIdentifier(r===null||r===void 0?void 0:r.identifier);var a=(i=r===null||r===void 0?void 0:r.optional)!==null&&i!==void 0?i:false;if(this.isInitialized(s)||this.shouldAutoInitialize()){try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(a){return null}else{throw r}}}else{if(a){return null}else{throw Error("Service "+this.name+" is not available")}}};Provider.prototype.getComponent=function(){return this.component};Provider.prototype.setComponent=function(r){var i,s;if(r.name!==this.name){throw Error("Mismatching Component "+r.name+" for Provider "+this.name+".")}if(this.component){throw Error("Component for "+this.name+" has already been provided")}this.component=r;if(!this.shouldAutoInitialize()){return}if(isComponentEager(r)){try{this.getOrInitializeService({instanceIdentifier:h})}catch(r){}}try{for(var l=(0,a.XA)(this.instancesDeferred.entries()),c=l.next();!c.done;c=l.next()){var u=(0,a.CR)(c.value,2),d=u[0],p=u[1];var f=this.normalizeInstanceIdentifier(d);try{var m=this.getOrInitializeService({instanceIdentifier:f});p.resolve(m)}catch(r){}}}catch(r){i={error:r}}finally{try{if(c&&!c.done&&(s=l.return))s.call(l)}finally{if(i)throw i.error}}};Provider.prototype.clearInstance=function(r){if(r===void 0){r=h}this.instancesDeferred.delete(r);this.instancesOptions.delete(r);this.instances.delete(r)};Provider.prototype.delete=function(){return(0,a.mG)(this,void 0,void 0,(function(){var r;return(0,a.Jh)(this,(function(i){switch(i.label){case 0:r=Array.from(this.instances.values());return[4,Promise.all((0,a.ev)((0,a.ev)([],(0,a.CR)(r.filter((function(r){return"INTERNAL"in r})).map((function(r){return r.INTERNAL.delete()})))),(0,a.CR)(r.filter((function(r){return"_delete"in r})).map((function(r){return r._delete()})))))];case 1:i.sent();return[2]}}))}))};Provider.prototype.isComponentSet=function(){return this.component!=null};Provider.prototype.isInitialized=function(r){if(r===void 0){r=h}return this.instances.has(r)};Provider.prototype.getOptions=function(r){if(r===void 0){r=h}return this.instancesOptions.get(r)||{}};Provider.prototype.initialize=function(r){var i,s;if(r===void 0){r={}}var l=r.options,c=l===void 0?{}:l;var h=this.normalizeInstanceIdentifier(r.instanceIdentifier);if(this.isInitialized(h)){throw Error(this.name+"("+h+") has already been initialized")}if(!this.isComponentSet()){throw Error("Component "+this.name+" has not been registered yet")}var u=this.getOrInitializeService({instanceIdentifier:h,options:c});try{for(var d=(0,a.XA)(this.instancesDeferred.entries()),p=d.next();!p.done;p=d.next()){var f=(0,a.CR)(p.value,2),m=f[0],_=f[1];var y=this.normalizeInstanceIdentifier(m);if(h===y){_.resolve(u)}}}catch(r){i={error:r}}finally{try{if(p&&!p.done&&(s=d.return))s.call(d)}finally{if(i)throw i.error}}return u};Provider.prototype.onInit=function(r,i){var s;var a=this.normalizeInstanceIdentifier(i);var l=(s=this.onInitCallbacks.get(a))!==null&&s!==void 0?s:new Set;l.add(r);this.onInitCallbacks.set(a,l);var c=this.instances.get(a);if(c){r(c,a)}return function(){l.delete(r)}};Provider.prototype.invokeOnInitCallbacks=function(r,i){var s,l;var c=this.onInitCallbacks.get(i);if(!c){return}try{for(var h=(0,a.XA)(c),u=h.next();!u.done;u=h.next()){var d=u.value;try{d(r,i)}catch(r){}}}catch(r){s={error:r}}finally{try{if(u&&!u.done&&(l=h.return))l.call(h)}finally{if(s)throw s.error}}};Provider.prototype.getOrInitializeService=function(r){var i=r.instanceIdentifier,s=r.options,a=s===void 0?{}:s;var l=this.instances.get(i);if(!l&&this.component){l=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(i),options:a});this.instances.set(i,l);this.instancesOptions.set(i,a);this.invokeOnInitCallbacks(l,i);if(this.component.onInstanceCreated){try{this.component.onInstanceCreated(this.container,i,l)}catch(r){}}}return l||null};Provider.prototype.normalizeInstanceIdentifier=function(r){if(r===void 0){r=h}if(this.component){return this.component.multipleInstances?r:h}else{return r}};Provider.prototype.shouldAutoInitialize=function(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"};return Provider}();function normalizeIdentifierForFactory(r){return r===h?undefined:r}function isComponentEager(r){return r.instantiationMode==="EAGER"}var d=function(){function ComponentContainer(r){this.name=r;this.providers=new Map}ComponentContainer.prototype.addComponent=function(r){var i=this.getProvider(r.name);if(i.isComponentSet()){throw new Error("Component "+r.name+" has already been registered with "+this.name)}i.setComponent(r)};ComponentContainer.prototype.addOrOverwriteComponent=function(r){var i=this.getProvider(r.name);if(i.isComponentSet()){this.providers.delete(r.name)}this.addComponent(r)};ComponentContainer.prototype.getProvider=function(r){if(this.providers.has(r)){return this.providers.get(r)}var i=new u(r,this);this.providers.set(r,i);return i};ComponentContainer.prototype.getProviders=function(){return Array.from(this.providers.values())};return ComponentContainer}()},853031:(r,i,s)=>{"use strict";s.d(i,{in:()=>l,Yd:()=>Logger});const a=[];var l;(function(r){r[r["DEBUG"]=0]="DEBUG";r[r["VERBOSE"]=1]="VERBOSE";r[r["INFO"]=2]="INFO";r[r["WARN"]=3]="WARN";r[r["ERROR"]=4]="ERROR";r[r["SILENT"]=5]="SILENT"})(l||(l={}));const c={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT};const h=l.INFO;const u={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"};const defaultLogHandler=(r,i,...s)=>{if(i<r.logLevel){return}const a=(new Date).toISOString();const l=u[i];if(l){console[l](`[${a}]  ${r.name}:`,...s)}else{throw new Error(`Attempted to log a message with an invalid logType (value: ${i})`)}};class Logger{constructor(r){this.name=r;this._logLevel=h;this._logHandler=defaultLogHandler;this._userLogHandler=null;a.push(this)}get logLevel(){return this._logLevel}set logLevel(r){if(!(r in l)){throw new TypeError(`Invalid value "${r}" assigned to \`logLevel\``)}this._logLevel=r}setLogLevel(r){this._logLevel=typeof r==="string"?c[r]:r}get logHandler(){return this._logHandler}set logHandler(r){if(typeof r!=="function"){throw new TypeError("Value assigned to `logHandler` must be a function")}this._logHandler=r}get userLogHandler(){return this._userLogHandler}set userLogHandler(r){this._userLogHandler=r}debug(...r){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...r);this._logHandler(this,l.DEBUG,...r)}log(...r){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...r);this._logHandler(this,l.VERBOSE,...r)}info(...r){this._userLogHandler&&this._userLogHandler(this,l.INFO,...r);this._logHandler(this,l.INFO,...r)}warn(...r){this._userLogHandler&&this._userLogHandler(this,l.WARN,...r);this._logHandler(this,l.WARN,...r)}error(...r){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...r);this._logHandler(this,l.ERROR,...r)}}function setLogLevel(r){a.forEach((i=>{i.setLogLevel(r)}))}function setUserLogHandler(r,i){for(const s of a){let a=null;if(i&&i.level){a=c[i.level]}if(r===null){s.userLogHandler=null}else{s.userLogHandler=(i,s,...c)=>{const h=c.map((r=>{if(r==null){return null}else if(typeof r==="string"){return r}else if(typeof r==="number"||typeof r==="boolean"){return r.toString()}else if(r instanceof Error){return r.message}else{try{return JSON.stringify(r)}catch(r){return null}}})).filter((r=>r)).join(" ");if(s>=(a!==null&&a!==void 0?a:i.logLevel)){r({level:l[s].toLowerCase(),message:h,args:c,type:i.name})}}}}}},329901:(r,i,s)=>{"use strict";s.d(i,{BH:()=>Deferred,LL:()=>ErrorFactory,gQ:()=>Sha1,hu:()=>assert,g5:()=>assertionError,US:()=>l,h$:()=>base64Encode,r3:()=>contains,p$:()=>deepCopy,vZ:()=>deepEqual,gK:()=>errorPrefix,m9:()=>getModularInstance,GJ:()=>isAdmin,xb:()=>isEmpty,uI:()=>isMobileCordova,Yr:()=>isNodeSdk,b$:()=>isReactNative,w9:()=>isValidFormat,cI:()=>jsonEval,UI:()=>map,xO:()=>querystring,DV:()=>safeGet,ug:()=>stringLength,dS:()=>stringToByteArray,Pz:()=>stringify});const a={NODE_CLIENT:false,NODE_ADMIN:false,SDK_VERSION:"${JSCORE_VERSION}"};const assert=function(r,i){if(!r){throw assertionError(i)}};const assertionError=function(r){return new Error("Firebase Database ("+a.SDK_VERSION+") INTERNAL ASSERT FAILED: "+r)};const stringToByteArray$1=function(r){const i=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);if(l<128){i[s++]=l}else if(l<2048){i[s++]=l>>6|192;i[s++]=l&63|128}else if((l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320){l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023);i[s++]=l>>18|240;i[s++]=l>>12&63|128;i[s++]=l>>6&63|128;i[s++]=l&63|128}else{i[s++]=l>>12|224;i[s++]=l>>6&63|128;i[s++]=l&63|128}}return i};const byteArrayToString=function(r){const i=[];let s=0,a=0;while(s<r.length){const l=r[s++];if(l<128){i[a++]=String.fromCharCode(l)}else if(l>191&&l<224){const c=r[s++];i[a++]=String.fromCharCode((l&31)<<6|c&63)}else if(l>239&&l<365){const c=r[s++];const h=r[s++];const u=r[s++];const d=((l&7)<<18|(c&63)<<12|(h&63)<<6|u&63)-65536;i[a++]=String.fromCharCode(55296+(d>>10));i[a++]=String.fromCharCode(56320+(d&1023))}else{const c=r[s++];const h=r[s++];i[a++]=String.fromCharCode((l&15)<<12|(c&63)<<6|h&63)}}return i.join("")};const l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz"+"0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray(r,i){if(!Array.isArray(r)){throw Error("encodeByteArray takes an array as a parameter")}this.init_();const s=i?this.byteToCharMapWebSafe_:this.byteToCharMap_;const a=[];for(let i=0;i<r.length;i+=3){const l=r[i];const c=i+1<r.length;const h=c?r[i+1]:0;const u=i+2<r.length;const d=u?r[i+2]:0;const p=l>>2;const f=(l&3)<<4|h>>4;let m=(h&15)<<2|d>>6;let _=d&63;if(!u){_=64;if(!c){m=64}}a.push(s[p],s[f],s[m],s[_])}return a.join("")},encodeString(r,i){if(this.HAS_NATIVE_SUPPORT&&!i){return btoa(r)}return this.encodeByteArray(stringToByteArray$1(r),i)},decodeString(r,i){if(this.HAS_NATIVE_SUPPORT&&!i){return atob(r)}return byteArrayToString(this.decodeStringToByteArray(r,i))},decodeStringToByteArray(r,i){this.init_();const s=i?this.charToByteMapWebSafe_:this.charToByteMap_;const a=[];for(let i=0;i<r.length;){const l=s[r.charAt(i++)];const c=i<r.length;const h=c?s[r.charAt(i)]:0;++i;const u=i<r.length;const d=u?s[r.charAt(i)]:64;++i;const p=i<r.length;const f=p?s[r.charAt(i)]:64;++i;if(l==null||h==null||d==null||f==null){throw Error()}const m=l<<2|h>>4;a.push(m);if(d!==64){const r=h<<4&240|d>>2;a.push(r);if(f!==64){const r=d<<6&192|f;a.push(r)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++){this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r);this.charToByteMap_[this.byteToCharMap_[r]]=r;this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r;if(r>=this.ENCODED_VALS_BASE.length){this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r;this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r}}}}};const base64Encode=function(r){const i=stringToByteArray$1(r);return l.encodeByteArray(i,true)};const base64urlEncodeWithoutPadding=function(r){return base64Encode(r).replace(/\./g,"")};const base64Decode=function(r){try{return l.decodeString(r,true)}catch(r){console.error("base64Decode failed: ",r)}return null};function deepCopy(r){return deepExtend(undefined,r)}function deepExtend(r,i){if(!(i instanceof Object)){return i}switch(i.constructor){case Date:const s=i;return new Date(s.getTime());case Object:if(r===undefined){r={}}break;case Array:r=[];break;default:return i}for(const s in i){if(!i.hasOwnProperty(s)||!isValidKey(s)){continue}r[s]=deepExtend(r[s],i[s])}return r}function isValidKey(r){return r!=="__proto__"}class Deferred{constructor(){this.reject=()=>{};this.resolve=()=>{};this.promise=new Promise(((r,i)=>{this.resolve=r;this.reject=i}))}wrapCallback(r){return(i,s)=>{if(i){this.reject(i)}else{this.resolve(s)}if(typeof r==="function"){this.promise.catch((()=>{}));if(r.length===1){r(i)}else{r(i,s)}}}}}function createMockUserToken(r,i){if(r.uid){throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.')}const s={alg:"none",type:"JWT"};const a=i||"demo-project";const l=r.iat||0;const c=r.sub||r.user_id;if(!c){throw new Error("mockUserToken must contain 'sub' or 'user_id' field!")}const h=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:c,user_id:c,firebase:{sign_in_provider:"custom",identities:{}}},r);const u="";return[base64urlEncodeWithoutPadding(JSON.stringify(s)),base64urlEncodeWithoutPadding(JSON.stringify(h)),u].join(".")}function getUA(){if(typeof navigator!=="undefined"&&typeof navigator["userAgent"]==="string"){return navigator["userAgent"]}else{return""}}function isMobileCordova(){return typeof window!=="undefined"&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isNode(){try{return Object.prototype.toString.call(s.g.process)==="[object process]"}catch(r){return false}}function isBrowser(){return typeof self==="object"&&self.self===self}function isBrowserExtension(){const r=typeof chrome==="object"?chrome.runtime:typeof browser==="object"?browser.runtime:undefined;return typeof r==="object"&&r.id!==undefined}function isReactNative(){return typeof navigator==="object"&&navigator["product"]==="ReactNative"}function isElectron(){return getUA().indexOf("Electron/")>=0}function isIE(){const r=getUA();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function isUWP(){return getUA().indexOf("MSAppHost/")>=0}function isNodeSdk(){return a.NODE_CLIENT===true||a.NODE_ADMIN===true}function isSafari(){return!isNode()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){return typeof indexedDB==="object"}function validateIndexedDBOpenable(){return new Promise(((r,i)=>{try{let s=true;const a="validate-browser-context-for-indexeddb-analytics-module";const l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close();if(!s){self.indexedDB.deleteDatabase(a)}r(true)};l.onupgradeneeded=()=>{s=false};l.onerror=()=>{var r;i(((r=l.error)===null||r===void 0?void 0:r.message)||"")}}catch(r){i(r)}}))}function areCookiesEnabled(){if(typeof navigator==="undefined"||!navigator.cookieEnabled){return false}return true}function getGlobal(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof s.g!=="undefined"){return s.g}throw new Error("Unable to locate global object.")}const c="FirebaseError";class FirebaseError extends Error{constructor(r,i,s){super(i);this.code=r;this.customData=s;this.name=c;Object.setPrototypeOf(this,FirebaseError.prototype);if(Error.captureStackTrace){Error.captureStackTrace(this,ErrorFactory.prototype.create)}}}class ErrorFactory{constructor(r,i,s){this.service=r;this.serviceName=i;this.errors=s}create(r,...i){const s=i[0]||{};const a=`${this.service}/${r}`;const l=this.errors[r];const c=l?replaceTemplate(l,s):"Error";const h=`${this.serviceName}: ${c} (${a}).`;const u=new FirebaseError(a,h,s);return u}}function replaceTemplate(r,i){return r.replace(h,((r,s)=>{const a=i[s];return a!=null?String(a):`<${s}?>`}))}const h=/\{\$([^}]+)}/g;function jsonEval(r){return JSON.parse(r)}function stringify(r){return JSON.stringify(r)}const decode=function(r){let i={},s={},a={},l="";try{const c=r.split(".");i=jsonEval(base64Decode(c[0])||"");s=jsonEval(base64Decode(c[1])||"");l=c[2];a=s["d"]||{};delete s["d"]}catch(r){}return{header:i,claims:s,data:a,signature:l}};const isValidTimestamp=function(r){const i=decode(r).claims;const s=Math.floor((new Date).getTime()/1e3);let a=0,l=0;if(typeof i==="object"){if(i.hasOwnProperty("nbf")){a=i["nbf"]}else if(i.hasOwnProperty("iat")){a=i["iat"]}if(i.hasOwnProperty("exp")){l=i["exp"]}else{l=a+86400}}return!!s&&!!a&&!!l&&s>=a&&s<=l};const issuedAtTime=function(r){const i=decode(r).claims;if(typeof i==="object"&&i.hasOwnProperty("iat")){return i["iat"]}return null};const isValidFormat=function(r){const i=decode(r),s=i.claims;return!!s&&typeof s==="object"&&s.hasOwnProperty("iat")};const isAdmin=function(r){const i=decode(r).claims;return typeof i==="object"&&i["admin"]===true};function contains(r,i){return Object.prototype.hasOwnProperty.call(r,i)}function safeGet(r,i){if(Object.prototype.hasOwnProperty.call(r,i)){return r[i]}else{return undefined}}function isEmpty(r){for(const i in r){if(Object.prototype.hasOwnProperty.call(r,i)){return false}}return true}function map(r,i,s){const a={};for(const l in r){if(Object.prototype.hasOwnProperty.call(r,l)){a[l]=i.call(s,r[l],l,r)}}return a}function deepEqual(r,i){if(r===i){return true}const s=Object.keys(r);const a=Object.keys(i);for(const l of s){if(!a.includes(l)){return false}const s=r[l];const c=i[l];if(isObject(s)&&isObject(c)){if(!deepEqual(s,c)){return false}}else if(s!==c){return false}}for(const r of a){if(!s.includes(r)){return false}}return true}function isObject(r){return r!==null&&typeof r==="object"}function querystring(r){const i=[];for(const[s,a]of Object.entries(r)){if(Array.isArray(a)){a.forEach((r=>{i.push(encodeURIComponent(s)+"="+encodeURIComponent(r))}))}else{i.push(encodeURIComponent(s)+"="+encodeURIComponent(a))}}return i.length?"&"+i.join("&"):""}function querystringDecode(r){const i={};const s=r.replace(/^\?/,"").split("&");s.forEach((r=>{if(r){const[s,a]=r.split("=");i[decodeURIComponent(s)]=decodeURIComponent(a)}}));return i}function extractQuerystring(r){const i=r.indexOf("?");if(!i){return""}const s=r.indexOf("#",i);return r.substring(i,s>0?s:undefined)}class Sha1{constructor(){this.chain_=[];this.buf_=[];this.W_=[];this.pad_=[];this.inbuf_=0;this.total_=0;this.blockSize=512/8;this.pad_[0]=128;for(let r=1;r<this.blockSize;++r){this.pad_[r]=0}this.reset()}reset(){this.chain_[0]=1732584193;this.chain_[1]=4023233417;this.chain_[2]=2562383102;this.chain_[3]=271733878;this.chain_[4]=3285377520;this.inbuf_=0;this.total_=0}compress_(r,i){if(!i){i=0}const s=this.W_;if(typeof r==="string"){for(let a=0;a<16;a++){s[a]=r.charCodeAt(i)<<24|r.charCodeAt(i+1)<<16|r.charCodeAt(i+2)<<8|r.charCodeAt(i+3);i+=4}}else{for(let a=0;a<16;a++){s[a]=r[i]<<24|r[i+1]<<16|r[i+2]<<8|r[i+3];i+=4}}for(let r=16;r<80;r++){const i=s[r-3]^s[r-8]^s[r-14]^s[r-16];s[r]=(i<<1|i>>>31)&4294967295}let a=this.chain_[0];let l=this.chain_[1];let c=this.chain_[2];let h=this.chain_[3];let u=this.chain_[4];let d,p;for(let r=0;r<80;r++){if(r<40){if(r<20){d=h^l&(c^h);p=1518500249}else{d=l^c^h;p=1859775393}}else{if(r<60){d=l&c|h&(l|c);p=2400959708}else{d=l^c^h;p=3395469782}}const i=(a<<5|a>>>27)+d+u+p+s[r]&4294967295;u=h;h=c;c=(l<<30|l>>>2)&4294967295;l=a;a=i}this.chain_[0]=this.chain_[0]+a&4294967295;this.chain_[1]=this.chain_[1]+l&4294967295;this.chain_[2]=this.chain_[2]+c&4294967295;this.chain_[3]=this.chain_[3]+h&4294967295;this.chain_[4]=this.chain_[4]+u&4294967295}update(r,i){if(r==null){return}if(i===undefined){i=r.length}const s=i-this.blockSize;let a=0;const l=this.buf_;let c=this.inbuf_;while(a<i){if(c===0){while(a<=s){this.compress_(r,a);a+=this.blockSize}}if(typeof r==="string"){while(a<i){l[c]=r.charCodeAt(a);++c;++a;if(c===this.blockSize){this.compress_(l);c=0;break}}}else{while(a<i){l[c]=r[a];++c;++a;if(c===this.blockSize){this.compress_(l);c=0;break}}}}this.inbuf_=c;this.total_+=i}digest(){const r=[];let i=this.total_*8;if(this.inbuf_<56){this.update(this.pad_,56-this.inbuf_)}else{this.update(this.pad_,this.blockSize-(this.inbuf_-56))}for(let r=this.blockSize-1;r>=56;r--){this.buf_[r]=i&255;i/=256}this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++){for(let a=24;a>=0;a-=8){r[s]=this.chain_[i]>>a&255;++s}}return r}}function createSubscribe(r,i){const s=new ObserverProxy(r,i);return s.subscribe.bind(s)}class ObserverProxy{constructor(r,i){this.observers=[];this.unsubscribes=[];this.observerCount=0;this.task=Promise.resolve();this.finalized=false;this.onNoObservers=i;this.task.then((()=>{r(this)})).catch((r=>{this.error(r)}))}next(r){this.forEachObserver((i=>{i.next(r)}))}error(r){this.forEachObserver((i=>{i.error(r)}));this.close(r)}complete(){this.forEachObserver((r=>{r.complete()}));this.close()}subscribe(r,i,s){let a;if(r===undefined&&i===undefined&&s===undefined){throw new Error("Missing Observer.")}if(implementsAnyMethods(r,["next","error","complete"])){a=r}else{a={next:r,error:i,complete:s}}if(a.next===undefined){a.next=noop}if(a.error===undefined){a.error=noop}if(a.complete===undefined){a.complete=noop}const l=this.unsubscribeOne.bind(this,this.observers.length);if(this.finalized){this.task.then((()=>{try{if(this.finalError){a.error(this.finalError)}else{a.complete()}}catch(r){}return}))}this.observers.push(a);return l}unsubscribeOne(r){if(this.observers===undefined||this.observers[r]===undefined){return}delete this.observers[r];this.observerCount-=1;if(this.observerCount===0&&this.onNoObservers!==undefined){this.onNoObservers(this)}}forEachObserver(r){if(this.finalized){return}for(let i=0;i<this.observers.length;i++){this.sendOne(i,r)}}sendOne(r,i){this.task.then((()=>{if(this.observers!==undefined&&this.observers[r]!==undefined){try{i(this.observers[r])}catch(r){if(typeof console!=="undefined"&&console.error){console.error(r)}}}}))}close(r){if(this.finalized){return}this.finalized=true;if(r!==undefined){this.finalError=r}this.task.then((()=>{this.observers=undefined;this.onNoObservers=undefined}))}}function async(r,i){return(...s)=>{Promise.resolve(true).then((()=>{r(...s)})).catch((r=>{if(i){i(r)}}))}}function implementsAnyMethods(r,i){if(typeof r!=="object"||r===null){return false}for(const s of i){if(s in r&&typeof r[s]==="function"){return true}}return false}function noop(){}const validateArgCount=function(r,i,s,a){let l;if(a<i){l="at least "+i}else if(a>s){l=s===0?"none":"no more than "+s}if(l){const i=r+" failed: Was called with "+a+(a===1?" argument.":" arguments.")+" Expects "+l+".";throw new Error(i)}};function errorPrefix(r,i){return`${r} failed: ${i} argument `}function validateNamespace(r,i,s){if(s&&!i){return}if(typeof i!=="string"){throw new Error(errorPrefix(r,"namespace")+"must be a valid firebase namespace.")}}function validateCallback(r,i,s,a){if(a&&!s){return}if(typeof s!=="function"){throw new Error(errorPrefix(r,i)+"must be a valid function.")}}function validateContextObject(r,i,s,a){if(a&&!s){return}if(typeof s!=="object"||s===null){throw new Error(errorPrefix(r,i)+"must be a valid context object.")}}const stringToByteArray=function(r){const i=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);if(l>=55296&&l<=56319){const i=l-55296;a++;assert(a<r.length,"Surrogate pair missing trail surrogate.");const s=r.charCodeAt(a)-56320;l=65536+(i<<10)+s}if(l<128){i[s++]=l}else if(l<2048){i[s++]=l>>6|192;i[s++]=l&63|128}else if(l<65536){i[s++]=l>>12|224;i[s++]=l>>6&63|128;i[s++]=l&63|128}else{i[s++]=l>>18|240;i[s++]=l>>12&63|128;i[s++]=l>>6&63|128;i[s++]=l&63|128}}return i};const stringLength=function(r){let i=0;for(let s=0;s<r.length;s++){const a=r.charCodeAt(s);if(a<128){i++}else if(a<2048){i+=2}else if(a>=55296&&a<=56319){i+=4;s++}else{i+=3}}return i};const u=1e3;const d=2;const p=null&&4*60*60*1e3;const f=.5;function calculateBackoffMillis(r,i=u,s=d){const a=i*Math.pow(s,r);const l=Math.round(f*a*(Math.random()-.5)*2);return Math.min(p,a+l)}function ordinal(r){if(!Number.isFinite(r)){return`${r}`}return r+indicator(r)}function indicator(r){r=Math.abs(r);const i=r%100;if(i>=10&&i<=20){return"th"}const s=r%10;if(s===1){return"st"}if(s===2){return"nd"}if(s===3){return"rd"}return"th"}function getModularInstance(r){if(r&&r._delegate){return r._delegate}else{return r}}},530713:(r,i,s)=>{"use strict";s.d(i,{Z:()=>d});var a=s(305406);var l=s.n(a);var c,h;function _extends(){_extends=Object.assign||function(r){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s){if(Object.prototype.hasOwnProperty.call(s,a)){r[a]=s[a]}}}return r};return _extends.apply(this,arguments)}var u=function SvgErrorD(r){return a.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:1280,height:228,viewBox:"0 0 1280 228"},r),c||(c=a.createElement("defs",null,a.createElement("path",{id:"error-D_svg__a",d:"M0 0h1280v208.522H0z"}),a.createElement("path",{id:"error-D_svg__c",d:"M0 11.906C21.25-2.999 49.533-3.91 84.846 9.176c52.97 19.627 128.99 71.209 227.914 71.209 26.39 0 60.6 18.136 102.626 54.408H0V11.906z"}),a.createElement("path",{id:"error-D_svg__e",d:"M0 0l26.446 19.532L52.676 0l26.81 19.532L102.5 0v72.427L79.486 91.914l-26.8-19.487-26.24 19.487L0 72.427z"}))),h||(h=a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("mask",{id:"error-D_svg__b",fill:"#fff"},a.createElement("use",{xlinkHref:"#error-D_svg__a"})),a.createElement("use",{fill:"#282A32",xlinkHref:"#error-D_svg__a"}),a.createElement("ellipse",{cx:287.442,cy:71.848,fill:"#44464E",mask:"url(#error-D_svg__b)",rx:14.391,ry:14.387}),a.createElement("g",{mask:"url(#error-D_svg__b)"},a.createElement("g",{transform:"translate(0 75.176)"},a.createElement("mask",{id:"error-D_svg__d",fill:"#fff"},a.createElement("use",{xlinkHref:"#error-D_svg__c"})),a.createElement("use",{fill:"#383A43",xlinkHref:"#error-D_svg__c"}),a.createElement("path",{stroke:"#44464E",strokeWidth:2.877,d:"M40.599-2.202s94.995 60.637 119.895 138.5M52.974-2.202s94.995 60.637 119.895 138.5",mask:"url(#error-D_svg__d)"}))),a.createElement("g",{mask:"url(#error-D_svg__b)"},a.createElement("g",{transform:"translate(190.916 68.891)"},a.createElement("path",{fill:"#383A43",d:"M872.4 50.027h66.76c12.402 0 22.456 10.054 22.456 22.456h54.154v67.508H872.4V50.027z"}),a.createElement("path",{fill:"#44464E",d:"M596.6 0c-8.522 0-13.715 4.116-15.58 12.347H444.085v30.64h-.659l.659 51.26H296.377V67.174l-26.63 27.073h-35.662v46.617h692.42L899.335 1.302l-20.91.21-14.921 99.773h-66v-62.2h-14.017v62.2h-41.032V26.404h-113.01V12.347h-17.827C610.128 4.116 605.122 0 596.6 0zm586.242 47.563v26.94h-51.08c-2.038-12.2-8.254-18.3-18.647-18.3-10.393 0-16.47 6.1-18.23 18.3h-55.244v8.175H980.93l.533.021v58.165l491.623-.801V87.506l-79.317.8v12.98h-45.183V65.053l-21.559 9.45v26.783h-16.485V74.503h-39.46v32.85h-56.865v-59.79h-31.374z"}),a.createElement("path",{fill:"#383A43",d:"M431.057 32.946h64v91.368h-64zM501.15 53.619v86.909h132V89.252h-73.824V53.619z"}),a.createElement("circle",{cx:723.584,cy:42.96,r:2.5,fill:"#383A43"}),a.createElement("circle",{cx:710.584,cy:42.96,r:2.5,fill:"#383A43"}),a.createElement("circle",{cx:697.584,cy:42.96,r:2.5,fill:"#383A43"}),a.createElement("ellipse",{cx:449.584,cy:49.998,fill:"#C1D8FD",rx:2.5,ry:2.51}),a.createElement("ellipse",{cx:469.584,cy:49.998,fill:"#C1D8FD",rx:2.5,ry:2.51}),a.createElement("ellipse",{cx:459.584,cy:60.038,fill:"#C1D8FD",rx:2.5,ry:2.51}),a.createElement("path",{fill:"#A5C4FE",d:"M442.738 94.411l18.346 30.091h33.61v15.393l-111.193.679-.997-46.855z"}),a.createElement("path",{fill:"#C1D8FD",d:"M405.026 140.335H208.084V52.983h166.228v34.432l15.177-12.057L405.006 93.9z"}),a.createElement("path",{fill:"#44464E",d:"M0 141.077c15.071-20.332 40.616-33.318 76.636-38.959 54.029-8.46 59.621-12.43 126.653-54.772C270.321 5.004 362.644-3.842 417.202 29.763c0 24.362.272 61.466.816 111.314H0z"}),a.createElement("g",{transform:"translate(155.058 41.132)"},a.createElement("ellipse",{cx:36.456,cy:36.446,fill:"#383A43",rx:36.456,ry:36.446}),a.createElement("path",{stroke:"#54565F",strokeLinecap:"square",strokeWidth:2.877,d:"M36.771 22.17v77.501"}),a.createElement("path",{stroke:"#54565F",strokeWidth:2.877,d:"M44.416 37.865l-7.645 9.89"}),a.createElement("path",{stroke:"#54565F",strokeLinecap:"square",strokeWidth:2.877,d:"M28.812 48.923l7.644 9.891m-7.644-31.95l7.644 9.89"})),a.createElement("g",{transform:"translate(710.584 70.432)"},a.createElement("ellipse",{cx:25.5,cy:25.493,fill:"#383A43",rx:25.5,ry:25.493}),a.createElement("path",{stroke:"#4A4D58",strokeLinecap:"square",strokeWidth:2.013,d:"M25.72 15.507v54.209"}),a.createElement("path",{stroke:"#4A4D58",strokeWidth:2.013,d:"M31.067 29.985l-5.347 6.918"}),a.createElement("path",{stroke:"#4A4D58",strokeLinecap:"square",strokeWidth:2.013,d:"M20.153 22.29l5.347 6.918"})),a.createElement("g",{transform:"translate(797.504 39.088)"},a.createElement("path",{fill:"#383A43",d:"M45.389 0H0v111.014l45.389.178z"}),a.createElement("path",{fill:"#44464E",d:"M0 42.959h45.389v5.008H0z"}),a.createElement("ellipse",{cx:37.52,cy:11.804,fill:"#44464E",rx:2.5,ry:2.504}),a.createElement("rect",{width:5,height:13.523,x:35.02,y:19.025,fill:"#44464E",rx:2.5})),a.createElement("g",{transform:"translate(944.084 98.868)"},a.createElement("ellipse",{cx:15,cy:14.996,fill:"#44464E",rx:15,ry:14.996}),a.createElement("path",{stroke:"#282A32",strokeLinecap:"square",strokeWidth:1.184,d:"M15.129 9.122V41.01"}),a.createElement("path",{stroke:"#282A32",strokeWidth:1.184,d:"M18.275 17.638l-3.146 4.07"}),a.createElement("path",{stroke:"#282A32",strokeLinecap:"square",strokeWidth:1.184,d:"M11.855 13.112L15 17.181"})),a.createElement("path",{fill:"#4A4D58",d:"M184.2 141.077c31.56-20.573 63.446-33.582 95.656-39.025 32.21-5.443 75.985-7.24 131.325-5.393v44.418H184.2z"}),a.createElement("path",{fill:"#383A43",d:"M1041 71.637h53v40.343h-53z"}),a.createElement("path",{fill:"#44464E",d:"M981.462 140.464l169.736.333v-34.532h-110.28v-67.18h-50.123V16.542l-9.333-4.197v128.119z"}),a.createElement("g",{transform:"translate(1018.107 45.629)",fill:"#383A43"},a.createElement("rect",{width:5,height:11.52,x:11,rx:2.5}),a.createElement("ellipse",{cx:13.5,cy:19.426,rx:2.5,ry:2.504}),a.createElement("ellipse",{cx:2.5,cy:2.504,rx:2.5,ry:2.504})))),a.createElement("g",{transform:"translate(553.974 37.098)"},a.createElement("path",{fill:"#CD6E0D",d:"M102.84 53.123c-.178 2.378 4.521-5.237 7.798-4.27v44.57c-3.126-.173-7.916-.219-14.37-.136-6.453.083-13.845-.001-22.176-.252.428-.779.777-1.506 1.045-2.183.784-1.983.083-5.239.736-6.973 1.483-3.934 4.26-3.017 4.818-6.108.317-1.763-1.647-2.546-.662-5.424.984-2.875 3.697-2.274 4.653-5.122 1.364-4.067-1.995-4.121.214-8.854 1.466-3.14 3.232-2.89 3.327-3.794.405-3.86-1.152-6.266.718-11.054 1.858-4.76 6.208-6.986 9.735-8.081 6.838-2.124 12.49-.357 16.959 5.298.158 1.98-.929 3.73-3.26 5.25-3.37 2.198-4.908 5.92-6.23 7.24-1.445-2.235-3.21-1.38-3.305-.107z"}),a.createElement("path",{fill:"#E8C9B8",d:"M127.397 62.407l-5.65-9.558c-4.212-3.67-6.695-6.044-7.449-7.121-.753-1.077.323-1.194 3.23-.35 1.717 2.642 4.046 3.963 6.986 3.963 4.41 0 6.451-6.2 6.451-6.2s2.706 15.72 4.298 17.114c1.061.93-1.56 1.647-7.866 2.152z"}),a.createElement("path",{fill:"#1032A9",d:"M82.209 67.62s15.461 3.372 20.148 6.938c13.415 10.208 24.483 31.172 24.483 31.172 1.728-5.517-.243-36.35 0-43.323 4.992-.685 7.949-1.47 8.87-2.356 11.043 30.971 14.955 51.537 11.737 61.696-3.218 10.16-24.952 3.435-65.201-20.174l-.037-33.954z"}),a.createElement("path",{fill:"#183BB6",d:"M97.264 69.927c8.954 4.25 14.104 13.477 15.45 27.684 1.346 14.206 3.348 38.8 6.005 73.783h-72.65c-3.323-33.348-1.76-59.178 4.69-77.488C60.433 66.44 75.323 66.44 80.208 65.818c3.256-.414 8.941.955 17.056 4.109z"}),a.createElement("path",{fill:"#F2D3C2",d:"M93.47 57.783c-.017-.938 5.401 4.985 10.38 2.486 6.307-3.167 8.794-18.266 8.794-21.964 0-9.326-2.343-18.611-4.87-21.847-5.62-7.19-25.918-7.714-30.456 2.926-4.54 10.64-2.283 17.402 1.233 33.83l.229 13.142c.022 1.29 5.74 5.303 9.783 5.232 3.657-.064 5.102-2.576 5.082-3.7l-.176-10.105z"}),a.createElement("g",{transform:"translate(72.884 98.967)"},a.createElement("mask",{id:"error-D_svg__f",fill:"#fff"},a.createElement("use",{xlinkHref:"#error-D_svg__e"})),a.createElement("use",{fill:"#FFEED2",xlinkHref:"#error-D_svg__e"}),a.createElement("path",{fill:"#FCE0B3",d:"M-2.697-1.086h28.772v93.371H-2.697zm55.479-.016l26.688-.155v93.371l-26.688.155z",mask:"url(#error-D_svg__f)"})),a.createElement("path",{fill:"#183BB6",d:"M80.574 79.768c-12.295-2.48-25.332 2.27-39.113 14.253-20.67 17.974-52.15 72.449-37.86 81.85 9.525 6.268 29.269-4.337 59.23-31.815l-4.72-11.263-13.736 5.58c7.4-12.981 12.126-22.966 14.178-29.956 2.053-6.99 9.393-16.54 22.021-28.649z"}),a.createElement("path",{stroke:"#4063DF",strokeWidth:2,d:"M24.026 145.015l35.122-14.669"}),a.createElement("path",{fill:"#E8C9B8",d:"M58.32 130.25c4.38-5.554 7.893-9.016 10.537-10.385 2.54-1.315 9.011-1.608 19.414-.88a1 1 0 01.86 1.364c-1.553 3.94-4.471 6.51-8.755 7.705-4.727 1.32-10.55 6-17.471 14.042l-4.586-11.846z"}),a.createElement("path",{fill:"#F80",d:"M77.137 34.325c-2.622 3.153-.613 6.434 3.437 10.76 2.065 2.207 5.452 5.281 5.555 11.598.053 3.29.053 15.202 0 35.736h-42.46c2.448-39.785 7.665-65.894 15.65-78.326C67.745.973 84.455-2.41 94.726 1.567c12.22 4.731 18.737 13.1 19.548 25.11-17.726 5.705-27.666 9.054-29.82 10.046-2.372-4.086-5.913-4.086-7.317-2.398z"}),a.createElement("g",{transform:"translate(92.729 33.299)"},a.createElement("path",{fill:"#5F5F5F",d:"M17.944 0H14.39a8.745 8.745 0 00-8.745 8.745 8.893 8.893 0 008.893 8.893h3.405V0zm18.163.474h-6.028c-4.18 1.532-6.27 4.283-6.27 8.253a8.34 8.34 0 008.34 8.34h3.958V.474z"}),a.createElement("ellipse",{cx:36.028,cy:8.745,fill:"#7F7F7F",rx:7.535,ry:8.322}),a.createElement("ellipse",{cx:36.028,cy:8.745,fill:"#A0A0A0",rx:6.028,ry:6.809}),a.createElement("path",{fill:"#5F5F5F",d:"M8.08 3.424L1.065 5.425C.355 6.257 0 7.388 0 8.82c0 1.43.355 2.574 1.065 3.43l7.015 2.383V3.424z"})),a.createElement("path",{fill:"#E6B9A1",d:"M127.488 33.798c-.55-1.237-1.903-1.856-4.057-1.856-3.233 0-3.346.34-4.775 2.496-.953 1.437-1.418 2.984-1.397 4.641l3.545-3.847a4 4 0 012.79-1.286l3.894-.148z"}),a.createElement("ellipse",{cx:110.624,cy:42.118,fill:"#7F7F7F",rx:7.638,ry:8.819}),a.createElement("ellipse",{cx:110.658,cy:42.061,fill:"#A0A0A0",rx:6.11,ry:6.902})),a.createElement("path",{fill:"#44464E",d:"M1079.767 50.204c.557 0 1.008.451 1.008 1.008v27.625h-2.017V51.212c0-.557.451-1.008 1.009-1.008z"}),a.createElement("ellipse",{cx:1079.766,cy:68.269,fill:"#44464E",rx:3.494,ry:3.5}))))};const d=u},252059:(r,i,s)=>{"use strict";s.d(i,{Z:()=>d});var a=s(305406);var l=s.n(a);var c,h;function _extends(){_extends=Object.assign||function(r){for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var a in s){if(Object.prototype.hasOwnProperty.call(s,a)){r[a]=s[a]}}}return r};return _extends.apply(this,arguments)}var u=function SvgError(r){return a.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:1280,height:228,viewBox:"0 0 1280 228"},r),c||(c=a.createElement("defs",null,a.createElement("path",{id:"error_svg__a",d:"M0 0h1280v208.522H0z"}),a.createElement("path",{id:"error_svg__c",d:"M0 11.906C21.25-2.999 49.533-3.91 84.846 9.176c52.97 19.627 128.99 71.209 227.914 71.209 26.39 0 60.6 18.136 102.626 54.408H0V11.906z"}),a.createElement("path",{id:"error_svg__e",d:"M0 0l26.446 19.532L52.676 0l26.81 19.532L102.5 0v72.427L79.486 91.914l-26.8-19.487-26.24 19.487L0 72.427z"}))),h||(h=a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("mask",{id:"error_svg__b",fill:"#fff"},a.createElement("use",{xlinkHref:"#error_svg__a"})),a.createElement("use",{fill:"#DCE7F1",xlinkHref:"#error_svg__a"}),a.createElement("ellipse",{cx:287.442,cy:71.848,fill:"#FFF",mask:"url(#error_svg__b)",rx:14.391,ry:14.387}),a.createElement("g",{mask:"url(#error_svg__b)"},a.createElement("g",{transform:"translate(0 75.176)"},a.createElement("mask",{id:"error_svg__d",fill:"#fff"},a.createElement("use",{xlinkHref:"#error_svg__c"})),a.createElement("use",{fill:"#A5C4FE",xlinkHref:"#error_svg__c"}),a.createElement("path",{stroke:"#C0D8FD",strokeWidth:2.877,d:"M40.599-2.202s94.995 60.637 119.895 138.5M52.974-2.202s94.995 60.637 119.895 138.5",mask:"url(#error_svg__d)"}))),a.createElement("g",{mask:"url(#error_svg__b)"},a.createElement("g",{transform:"translate(190.916 68.891)"},a.createElement("path",{fill:"#E4EEFF",d:"M872.4 50.027h66.76c12.402 0 22.456 10.054 22.456 22.456h54.154v67.508H872.4V50.027z"}),a.createElement("path",{fill:"#C1D8FD",d:"M596.6 0c-8.522 0-13.715 4.116-15.58 12.347H444.085v30.64h-.659l.659 51.26H296.377V67.174l-26.63 27.073h-35.662v46.617h692.42L899.335 1.302l-20.91.21-14.921 99.773h-66v-62.2h-14.017v62.2h-41.032V26.404h-113.01V12.347h-17.827C610.128 4.116 605.122 0 596.6 0zm586.242 47.563v26.94h-51.08c-2.038-12.2-8.254-18.3-18.647-18.3-10.393 0-16.47 6.1-18.23 18.3h-55.244v8.175H980.93l.533.021v58.165l491.623-.801V87.506l-79.317.8v12.98h-45.183V65.053l-21.559 9.45v26.783h-16.485V74.503h-39.46v32.85h-56.865v-59.79h-31.374z"}),a.createElement("path",{fill:"#C1D8FD",d:"M431.057 32.946h64v91.368h-64z"}),a.createElement("path",{fill:"#A5C4FE",d:"M501.15 53.619v86.909h132V89.252h-73.824V53.619z"}),a.createElement("circle",{cx:723.584,cy:42.96,r:2.5,fill:"#E4EEFF"}),a.createElement("circle",{cx:710.584,cy:42.96,r:2.5,fill:"#E4EEFF"}),a.createElement("circle",{cx:697.584,cy:42.96,r:2.5,fill:"#E4EEFF"}),a.createElement("ellipse",{cx:449.584,cy:49.998,fill:"#C1D8FD",rx:2.5,ry:2.51}),a.createElement("ellipse",{cx:469.584,cy:49.998,fill:"#C1D8FD",rx:2.5,ry:2.51}),a.createElement("ellipse",{cx:459.584,cy:60.038,fill:"#C1D8FD",rx:2.5,ry:2.51}),a.createElement("path",{fill:"#A5C4FE",d:"M442.738 94.411l18.346 30.091h33.61v15.393l-111.193.679-.997-46.855z"}),a.createElement("path",{fill:"#C1D8FD",d:"M405.026 140.335H208.084V52.983h166.228v34.432l15.177-12.057L405.006 93.9z"}),a.createElement("path",{fill:"#C1D8FD",d:"M0 141.077c15.071-20.332 40.616-33.318 76.636-38.959 54.029-8.46 59.621-12.43 126.653-54.772C270.321 5.004 362.644-3.842 417.202 29.763c0 24.362.272 61.466.816 111.314H0z"}),a.createElement("g",{transform:"translate(155.058 41.132)"},a.createElement("ellipse",{cx:36.456,cy:36.446,fill:"#A5C4FE",rx:36.456,ry:36.446}),a.createElement("path",{stroke:"#D4E3FF",strokeLinecap:"square",strokeWidth:2.877,d:"M36.771 22.17v77.501"}),a.createElement("path",{stroke:"#D4E3FF",strokeWidth:2.877,d:"M44.416 37.865l-7.645 9.89"}),a.createElement("path",{stroke:"#D4E3FF",strokeLinecap:"square",strokeWidth:2.877,d:"M28.812 48.923l7.644 9.891m-7.644-31.95l7.644 9.89"})),a.createElement("g",{transform:"translate(710.584 70.432)"},a.createElement("ellipse",{cx:25.5,cy:25.493,fill:"#A5C4FE",rx:25.5,ry:25.493}),a.createElement("path",{stroke:"#D4E3FF",strokeLinecap:"square",strokeWidth:2.013,d:"M25.72 15.507v54.209"}),a.createElement("path",{stroke:"#D4E3FF",strokeWidth:2.013,d:"M31.067 29.985l-5.347 6.918"}),a.createElement("path",{stroke:"#D4E3FF",strokeLinecap:"square",strokeWidth:2.013,d:"M20.153 22.29l5.347 6.918"})),a.createElement("g",{transform:"translate(797.504 39.088)"},a.createElement("path",{fill:"#A5C4FE",d:"M45.389 0H0v111.014l45.389.178z"}),a.createElement("path",{fill:"#C1D8FD",d:"M0 42.959h45.389v5.008H0z"}),a.createElement("ellipse",{cx:37.52,cy:11.804,fill:"#C1D8FD",rx:2.5,ry:2.504}),a.createElement("rect",{width:5,height:13.523,x:35.02,y:19.025,fill:"#C1D8FD",rx:2.5})),a.createElement("g",{transform:"translate(944.084 98.868)"},a.createElement("ellipse",{cx:15,cy:14.996,fill:"#C1D8FD",rx:15,ry:14.996}),a.createElement("path",{stroke:"#D4E3FF",strokeLinecap:"square",strokeWidth:1.184,d:"M15.129 9.122V41.01"}),a.createElement("path",{stroke:"#D4E3FF",strokeWidth:1.184,d:"M18.275 17.638l-3.146 4.07"}),a.createElement("path",{stroke:"#D4E3FF",strokeLinecap:"square",strokeWidth:1.184,d:"M11.855 13.112L15 17.181"})),a.createElement("path",{fill:"#E4EEFF",d:"M184.2 141.077c31.56-20.573 63.446-33.582 95.656-39.025 32.21-5.443 75.985-7.24 131.325-5.393v44.418H184.2z"}),a.createElement("path",{fill:"#A5C4FE",d:"M1041 71.637h53v40.343h-53z"}),a.createElement("path",{fill:"#C1D8FD",d:"M981.462 140.464l169.736.333v-34.532h-110.28v-67.18h-50.123V16.542l-9.333-4.197v128.119z"}),a.createElement("rect",{width:5,height:11.52,x:920.084,y:34.109,fill:"#DCE8F1",rx:2.5}),a.createElement("ellipse",{cx:922.584,cy:53.535,fill:"#DCE8F1",rx:2.5,ry:2.504}),a.createElement("ellipse",{cx:911.584,cy:36.613,fill:"#DCE8F1",rx:2.5,ry:2.504}),a.createElement("g",{transform:"translate(1018.107 45.629)",fill:"#DCE8F1"},a.createElement("rect",{width:5,height:11.52,x:11,rx:2.5}),a.createElement("ellipse",{cx:13.5,cy:19.426,rx:2.5,ry:2.504}),a.createElement("ellipse",{cx:2.5,cy:2.504,rx:2.5,ry:2.504})))),a.createElement("g",{transform:"translate(553.974 37.098)"},a.createElement("path",{fill:"#CD6E0D",d:"M102.84 53.123c-.178 2.378 4.521-5.237 7.798-4.27v44.57c-3.126-.173-7.916-.219-14.37-.136-6.453.083-13.845-.001-22.176-.252.428-.779.777-1.506 1.045-2.183.784-1.983.083-5.239.736-6.973 1.483-3.934 4.26-3.017 4.818-6.108.317-1.763-1.647-2.546-.662-5.424.984-2.875 3.697-2.274 4.653-5.122 1.364-4.067-1.995-4.121.214-8.854 1.466-3.14 3.232-2.89 3.327-3.794.405-3.86-1.152-6.266.718-11.054 1.858-4.76 6.208-6.986 9.735-8.081 6.838-2.124 12.49-.357 16.959 5.298.158 1.98-.929 3.73-3.26 5.25-3.37 2.198-4.908 5.92-6.23 7.24-1.445-2.235-3.21-1.38-3.305-.107z"}),a.createElement("path",{fill:"#E8C9B8",d:"M127.397 62.407l-5.65-9.558c-4.212-3.67-6.695-6.044-7.449-7.121-.753-1.077.323-1.194 3.23-.35 1.717 2.642 4.046 3.963 6.986 3.963 4.41 0 6.451-6.2 6.451-6.2s2.706 15.72 4.298 17.114c1.061.93-1.56 1.647-7.866 2.152z"}),a.createElement("path",{fill:"#1032A9",d:"M82.209 67.62s15.461 3.372 20.148 6.938c13.415 10.208 24.483 31.172 24.483 31.172 1.728-5.517-.243-36.35 0-43.323 4.992-.685 7.949-1.47 8.87-2.356 11.043 30.971 14.955 51.537 11.737 61.696-3.218 10.16-24.952 3.435-65.201-20.174l-.037-33.954z"}),a.createElement("path",{fill:"#183BB6",d:"M97.264 69.927c8.954 4.25 14.104 13.477 15.45 27.684 1.346 14.206 3.348 38.8 6.005 73.783h-72.65c-3.323-33.348-1.76-59.178 4.69-77.488C60.433 66.44 75.323 66.44 80.208 65.818c3.256-.414 8.941.955 17.056 4.109z"}),a.createElement("path",{fill:"#F2D3C2",d:"M93.47 57.783c-.017-.938 5.401 4.985 10.38 2.486 6.307-3.167 8.794-18.266 8.794-21.964 0-9.326-2.343-18.611-4.87-21.847-5.62-7.19-25.918-7.714-30.456 2.926-4.54 10.64-2.283 17.402 1.233 33.83l.229 13.142c.022 1.29 5.74 5.303 9.783 5.232 3.657-.064 5.102-2.576 5.082-3.7l-.176-10.105z"}),a.createElement("g",{transform:"translate(72.884 98.967)"},a.createElement("mask",{id:"error_svg__f",fill:"#fff"},a.createElement("use",{xlinkHref:"#error_svg__e"})),a.createElement("use",{fill:"#FFEED2",xlinkHref:"#error_svg__e"}),a.createElement("path",{fill:"#FCE0B3",d:"M-2.697-1.086h28.772v93.371H-2.697zm55.479-.016l26.688-.155v93.371l-26.688.155z",mask:"url(#error_svg__f)"})),a.createElement("path",{fill:"#183BB6",d:"M80.574 79.768c-12.295-2.48-25.332 2.27-39.113 14.253-20.67 17.974-52.15 72.449-37.86 81.85 9.525 6.268 29.269-4.337 59.23-31.815l-4.72-11.263-13.736 5.58c7.4-12.981 12.126-22.966 14.178-29.956 2.053-6.99 9.393-16.54 22.021-28.649z"}),a.createElement("path",{stroke:"#4063DF",strokeWidth:2,d:"M24.026 145.015l35.122-14.669"}),a.createElement("path",{fill:"#E8C9B8",d:"M58.32 130.25c4.38-5.554 7.893-9.016 10.537-10.385 2.54-1.315 9.011-1.608 19.414-.88a1 1 0 01.86 1.364c-1.553 3.94-4.471 6.51-8.755 7.705-4.727 1.32-10.55 6-17.471 14.042l-4.586-11.846z"}),a.createElement("path",{fill:"#F80",d:"M77.137 34.325c-2.622 3.153-.613 6.434 3.437 10.76 2.065 2.207 5.452 5.281 5.555 11.598.053 3.29.053 15.202 0 35.736h-42.46c2.448-39.785 7.665-65.894 15.65-78.326C67.745.973 84.455-2.41 94.726 1.567c12.22 4.731 18.737 13.1 19.548 25.11-17.726 5.705-27.666 9.054-29.82 10.046-2.372-4.086-5.913-4.086-7.317-2.398z"}),a.createElement("g",{transform:"translate(92.729 33.299)"},a.createElement("path",{fill:"#5F5F5F",d:"M17.944 0H14.39a8.745 8.745 0 00-8.745 8.745 8.893 8.893 0 008.893 8.893h3.405V0zm18.163.474h-6.028c-4.18 1.532-6.27 4.283-6.27 8.253a8.34 8.34 0 008.34 8.34h3.958V.474z"}),a.createElement("ellipse",{cx:36.028,cy:8.745,fill:"#7F7F7F",rx:7.535,ry:8.322}),a.createElement("ellipse",{cx:36.028,cy:8.745,fill:"#A0A0A0",rx:6.028,ry:6.809}),a.createElement("path",{fill:"#5F5F5F",d:"M8.08 3.424L1.065 5.425C.355 6.257 0 7.388 0 8.82c0 1.43.355 2.574 1.065 3.43l7.015 2.383V3.424z"})),a.createElement("path",{fill:"#E6B9A1",d:"M127.488 33.798c-.55-1.237-1.903-1.856-4.057-1.856-3.233 0-3.346.34-4.775 2.496-.953 1.437-1.418 2.984-1.397 4.641l3.545-3.847a4 4 0 012.79-1.286l3.894-.148z"}),a.createElement("ellipse",{cx:110.624,cy:42.118,fill:"#7F7F7F",rx:7.638,ry:8.819}),a.createElement("ellipse",{cx:110.658,cy:42.061,fill:"#A0A0A0",rx:6.11,ry:6.902})),a.createElement("path",{fill:"#C1D8FD",d:"M1079.767 50.204c.557 0 1.008.451 1.008 1.008v27.625h-2.017V51.212c0-.557.451-1.008 1.009-1.008z"}),a.createElement("ellipse",{cx:1079.766,cy:68.269,fill:"#C1D8FD",rx:3.494,ry:3.5}))))};const d=u},639051:function(r,i){var s,a,l;(function(c,h){if(true){!(a=[],s=h,l=typeof s==="function"?s.apply(i,a):s,l!==undefined&&(r.exports=l))}else{}})(this,(function(){var r=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function indexOrEnd(r,i){return r.indexOf(i)===-1?r.length:r.indexOf(i)}function split(r){var i=r.replace(/^v/,"").replace(/\+.*$/,"");var s=indexOrEnd(i,"-");var a=i.substring(0,s).split(".");a.push(i.substring(s+1));return a}function tryParse(r){return isNaN(Number(r))?r:Number(r)}function validate(i){if(typeof i!=="string"){throw new TypeError("Invalid argument expected string")}if(!r.test(i)){throw new Error("Invalid argument not valid semver ('"+i+"' received)")}}function compareVersions(r,i){[r,i].forEach(validate);var s=split(r);var a=split(i);for(var l=0;l<Math.max(s.length-1,a.length-1);l++){var c=parseInt(s[l]||0,10);var h=parseInt(a[l]||0,10);if(c>h)return 1;if(h>c)return-1}var u=s[s.length-1];var d=a[a.length-1];if(u&&d){var p=u.split(".").map(tryParse);var f=d.split(".").map(tryParse);for(l=0;l<Math.max(p.length,f.length);l++){if(p[l]===undefined||typeof f[l]==="string"&&typeof p[l]==="number")return-1;if(f[l]===undefined||typeof p[l]==="string"&&typeof f[l]==="number")return 1;if(p[l]>f[l])return 1;if(f[l]>p[l])return-1}}else if(u||d){return u?-1:1}return 0}var i=[">",">=","=","<","<="];var s={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function validateOperator(r){if(typeof r!=="string"){throw new TypeError("Invalid operator type, expected string but got "+typeof r)}if(i.indexOf(r)===-1){throw new TypeError("Invalid operator, expected one of "+i.join("|"))}}compareVersions.validate=function(i){return typeof i==="string"&&r.test(i)};compareVersions.compare=function(r,i,a){validateOperator(a);var l=compareVersions(r,i);return s[a].indexOf(l)>-1};return compareVersions}))},442671:(r,i,s)=>{"use strict";s.d(i,{ZF:()=>a.ZF});var a=s(333464);var l="firebase";var c="9.1.3";(0,a.KN)(l,c,"app")},461602:(r,i,s)=>{"use strict";s.d(i,{iU:()=>child,U2:()=>get,N8:()=>getDatabase,Sb:()=>goOffline,$o:()=>goOnline,iH:()=>ref});var a=s(333464);var l=s(879455);var c=s(329901);var h=s(853031);const u="@firebase/database";const d="0.12.2";let p="";function setSDKVersion(r){p=r}class DOMStorageWrapper{constructor(r){this.domStorage_=r;this.prefix_="firebase:"}set(r,i){if(i==null){this.domStorage_.removeItem(this.prefixedName_(r))}else{this.domStorage_.setItem(this.prefixedName_(r),(0,c.Pz)(i))}}get(r){const i=this.domStorage_.getItem(this.prefixedName_(r));if(i==null){return null}else{return(0,c.cI)(i)}}remove(r){this.domStorage_.removeItem(this.prefixedName_(r))}prefixedName_(r){return this.prefix_+r}toString(){return this.domStorage_.toString()}}class MemoryStorage{constructor(){this.cache_={};this.isInMemoryStorage=true}set(r,i){if(i==null){delete this.cache_[r]}else{this.cache_[r]=i}}get(r){if((0,c.r3)(this.cache_,r)){return this.cache_[r]}return null}remove(r){delete this.cache_[r]}}const createStoragefor=function(r){try{if(typeof window!=="undefined"&&typeof window[r]!=="undefined"){const i=window[r];i.setItem("firebase:sentinel","cache");i.removeItem("firebase:sentinel");return new DOMStorageWrapper(i)}}catch(r){}return new MemoryStorage};const f=createStoragefor("localStorage");const m=createStoragefor("sessionStorage");const _=new h.Yd("@firebase/database");const y=function(){let r=1;return function(){return r++}}();const sha1=function(r){const i=(0,c.dS)(r);const s=new c.gQ;s.update(i);const a=s.digest();return c.US.encodeByteArray(a)};const buildLogMessage_=function(...r){let i="";for(let s=0;s<r.length;s++){const a=r[s];if(Array.isArray(a)||a&&typeof a==="object"&&typeof a.length==="number"){i+=buildLogMessage_.apply(null,a)}else if(typeof a==="object"){i+=(0,c.Pz)(a)}else{i+=a}i+=" "}return i};let g=null;let v=true;const enableLogging$1=function(r,i){(0,c.hu)(!i||r===true||r===false,"Can't turn on custom loggers persistently.");if(r===true){_.logLevel=h["in"].VERBOSE;g=_.log.bind(_);if(i){m.set("logging_enabled",true)}}else if(typeof r==="function"){g=r}else{g=null;m.remove("logging_enabled")}};const log=function(...r){if(v===true){v=false;if(g===null&&m.get("logging_enabled")===true){enableLogging$1(true)}}if(g){const i=buildLogMessage_.apply(null,r);g(i)}};const logWrapper=function(r){return function(...i){log(r,...i)}};const error=function(...r){const i="FIREBASE INTERNAL ERROR: "+buildLogMessage_(...r);_.error(i)};const fatal=function(...r){const i=`FIREBASE FATAL ERROR: ${buildLogMessage_(...r)}`;_.error(i);throw new Error(i)};const warn=function(...r){const i="FIREBASE WARNING: "+buildLogMessage_(...r);_.warn(i)};const warnIfPageIsSecure=function(){if(typeof window!=="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1){warn("Insecure Firebase access from a secure page. "+"Please use https in calls to new Firebase().")}};const isInvalidJSONNumber=function(r){return typeof r==="number"&&(r!==r||r===Number.POSITIVE_INFINITY||r===Number.NEGATIVE_INFINITY)};const executeWhenDOMReady=function(r){if((0,c.Yr)()||document.readyState==="complete"){r()}else{let i=false;const wrappedFn=function(){if(!document.body){setTimeout(wrappedFn,Math.floor(10));return}if(!i){i=true;r()}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",wrappedFn,false);window.addEventListener("load",wrappedFn,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",(()=>{if(document.readyState==="complete"){wrappedFn()}}));window.attachEvent("onload",wrappedFn)}}};const C="[MIN_NAME]";const w="[MAX_NAME]";const nameCompare=function(r,i){if(r===i){return 0}else if(r===C||i===w){return-1}else if(i===C||r===w){return 1}else{const s=tryParseInt(r),a=tryParseInt(i);if(s!==null){if(a!==null){return s-a===0?r.length-i.length:s-a}else{return-1}}else if(a!==null){return 1}else{return r<i?-1:1}}};const stringCompare=function(r,i){if(r===i){return 0}else if(r<i){return-1}else{return 1}};const requireKey=function(r,i){if(i&&r in i){return i[r]}else{throw new Error("Missing required key ("+r+") in object: "+(0,c.Pz)(i))}};const ObjectToUniqueKey=function(r){if(typeof r!=="object"||r===null){return(0,c.Pz)(r)}const i=[];for(const s in r){i.push(s)}i.sort();let s="{";for(let a=0;a<i.length;a++){if(a!==0){s+=","}s+=(0,c.Pz)(i[a]);s+=":";s+=ObjectToUniqueKey(r[i[a]])}s+="}";return s};const splitStringBySize=function(r,i){const s=r.length;if(s<=i){return[r]}const a=[];for(let l=0;l<s;l+=i){if(l+i>s){a.push(r.substring(l,s))}else{a.push(r.substring(l,l+i))}}return a};function each(r,i){for(const s in r){if(r.hasOwnProperty(s)){i(s,r[s])}}}const doubleToIEEE754String=function(r){(0,c.hu)(!isInvalidJSONNumber(r),"Invalid JSON number");const i=11,s=52;const a=(1<<i-1)-1;let l,h,u,d,p;if(r===0){h=0;u=0;l=1/r===-Infinity?1:0}else{l=r<0;r=Math.abs(r);if(r>=Math.pow(2,1-a)){d=Math.min(Math.floor(Math.log(r)/Math.LN2),a);h=d+a;u=Math.round(r*Math.pow(2,s-d)-Math.pow(2,s))}else{h=0;u=Math.round(r/Math.pow(2,1-a-s))}}const f=[];for(p=s;p;p-=1){f.push(u%2?1:0);u=Math.floor(u/2)}for(p=i;p;p-=1){f.push(h%2?1:0);h=Math.floor(h/2)}f.push(l?1:0);f.reverse();const m=f.join("");let _="";for(p=0;p<64;p+=8){let r=parseInt(m.substr(p,8),2).toString(16);if(r.length===1){r="0"+r}_=_+r}return _.toLowerCase()};const isChromeExtensionContentScript=function(){return!!(typeof window==="object"&&window["chrome"]&&window["chrome"]["extension"]&&!/^chrome/.test(window.location.href))};const isWindowsStoreApp=function(){return typeof Windows==="object"&&typeof Windows.UI==="object"};function errorForServerCode(r,i){let s="Unknown Error";if(r==="too_big"){s="The data requested exceeds the maximum size "+"that can be accessed with a single request."}else if(r==="permission_denied"){s="Client doesn't have permission to access the desired data."}else if(r==="unavailable"){s="The service is unavailable"}const a=new Error(r+" at "+i._path.toString()+": "+s);a.code=r.toUpperCase();return a}const E=new RegExp("^-?(0*)\\d{1,10}$");const T=-2147483648;const b=2147483647;const tryParseInt=function(r){if(E.test(r)){const i=Number(r);if(i>=T&&i<=b){return i}}return null};const exceptionGuard=function(r){try{r()}catch(r){setTimeout((()=>{const i=r.stack||"";warn("Exception was thrown by user callback.",i);throw r}),Math.floor(0))}};const beingCrawled=function(){const r=typeof window==="object"&&window["navigator"]&&window["navigator"]["userAgent"]||"";return r.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0};const setTimeoutNonBlocking=function(r,i){const s=setTimeout(r,i);if(typeof s==="object"&&s["unref"]){s["unref"]()}return s};class AppCheckTokenProvider{constructor(r,i){this.appName_=r;this.appCheckProvider=i;this.appCheck=i===null||i===void 0?void 0:i.getImmediate({optional:true});if(!this.appCheck){i===null||i===void 0?void 0:i.get().then((r=>this.appCheck=r))}}getToken(r){if(!this.appCheck){return new Promise(((i,s)=>{setTimeout((()=>{if(this.appCheck){this.getToken(r).then(i,s)}else{i(null)}}),0)}))}return this.appCheck.getToken(r)}addTokenChangeListener(r){var i;(i=this.appCheckProvider)===null||i===void 0?void 0:i.get().then((i=>i.addTokenListener(r)))}notifyForInvalidToken(){warn(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class FirebaseAuthTokenProvider{constructor(r,i,s){this.appName_=r;this.firebaseOptions_=i;this.authProvider_=s;this.auth_=null;this.auth_=s.getImmediate({optional:true});if(!this.auth_){s.onInit((r=>this.auth_=r))}}getToken(r){if(!this.auth_){return new Promise(((i,s)=>{setTimeout((()=>{if(this.auth_){this.getToken(r).then(i,s)}else{i(null)}}),0)}))}return this.auth_.getToken(r).catch((r=>{if(r&&r.code==="auth/token-not-initialized"){log("Got auth/token-not-initialized error.  Treating as null token.");return null}else{return Promise.reject(r)}}))}addTokenChangeListener(r){if(this.auth_){this.auth_.addAuthTokenListener(r)}else{this.authProvider_.get().then((i=>i.addAuthTokenListener(r)))}}removeTokenChangeListener(r){this.authProvider_.get().then((i=>i.removeAuthTokenListener(r)))}notifyForInvalidToken(){let r='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not '+"initialized correctly. ";if("credential"in this.firebaseOptions_){r+='Make sure the "credential" property provided to initializeApp() '+'is authorized to access the specified "databaseURL" and is from the correct '+"project."}else if("serviceAccount"in this.firebaseOptions_){r+='Make sure the "serviceAccount" property provided to initializeApp() '+'is authorized to access the specified "databaseURL" and is from the correct '+"project."}else{r+='Make sure the "apiKey" and "databaseURL" properties provided to '+"initializeApp() match the values provided for your app at "+"https://console.firebase.google.com/."}warn(r)}}class EmulatorTokenProvider{constructor(r){this.accessToken=r}getToken(r){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(r){r(this.accessToken)}removeTokenChangeListener(r){}notifyForInvalidToken(){}}EmulatorTokenProvider.OWNER="owner";const P="5";const S="v";const I="s";const N="r";const k="f";const x=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/;const R="ls";const A="p";const F="ac";const O="websocket";const D="long_polling";class RepoInfo{constructor(r,i,s,a,l=false,c="",h=false){this.secure=i;this.namespace=s;this.webSocketOnly=a;this.nodeAdmin=l;this.persistenceKey=c;this.includeNamespaceInQueryParams=h;this._host=r.toLowerCase();this._domain=this._host.substr(this._host.indexOf(".")+1);this.internalHost=f.get("host:"+r)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(r){if(r!==this.internalHost){this.internalHost=r;if(this.isCacheableHost()){f.set("host:"+this._host,this.internalHost)}}}toString(){let r=this.toURLString();if(this.persistenceKey){r+="<"+this.persistenceKey+">"}return r}toURLString(){const r=this.secure?"https://":"http://";const i=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${r}${this.host}/${i}`}}function repoInfoNeedsQueryParam(r){return r.host!==r.internalHost||r.isCustomHost()||r.includeNamespaceInQueryParams}function repoInfoConnectionURL(r,i,s){(0,c.hu)(typeof i==="string","typeof type must == string");(0,c.hu)(typeof s==="object","typeof params must == object");let a;if(i===O){a=(r.secure?"wss://":"ws://")+r.internalHost+"/.ws?"}else if(i===D){a=(r.secure?"https://":"http://")+r.internalHost+"/.lp?"}else{throw new Error("Unknown connection type: "+i)}if(repoInfoNeedsQueryParam(r)){s["ns"]=r.namespace}const l=[];each(s,((r,i)=>{l.push(r+"="+i)}));return a+l.join("&")}class StatsCollection{constructor(){this.counters_={}}incrementCounter(r,i=1){if(!(0,c.r3)(this.counters_,r)){this.counters_[r]=0}this.counters_[r]+=i}get(){return(0,c.p$)(this.counters_)}}const M={};const L={};function statsManagerGetCollection(r){const i=r.toString();if(!M[i]){M[i]=new StatsCollection}return M[i]}function statsManagerGetOrCreateReporter(r,i){const s=r.toString();if(!L[s]){L[s]=i()}return L[s]}class PacketReceiver{constructor(r){this.onMessage_=r;this.pendingResponses=[];this.currentResponseNum=0;this.closeAfterResponse=-1;this.onClose=null}closeAfter(r,i){this.closeAfterResponse=r;this.onClose=i;if(this.closeAfterResponse<this.currentResponseNum){this.onClose();this.onClose=null}}handleResponse(r,i){this.pendingResponses[r]=i;while(this.pendingResponses[this.currentResponseNum]){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i){if(r[i]){exceptionGuard((()=>{this.onMessage_(r[i])}))}}if(this.currentResponseNum===this.closeAfterResponse){if(this.onClose){this.onClose();this.onClose=null}break}this.currentResponseNum++}}}const W="start";const q="close";const V="pLPCommand";const G="pRTLPCB";const U="id";const B="pw";const Q="ser";const z="cb";const H="seg";const j="ts";const $="d";const Y="dframe";const K=1870;const J=30;const X=K-J;const Z=25e3;const ee=3e4;class BrowserPollConnection{constructor(r,i,s,a,l,c,h){this.connId=r;this.repoInfo=i;this.applicationId=s;this.appCheckToken=a;this.authToken=l;this.transportSessionId=c;this.lastSessionId=h;this.bytesSent=0;this.bytesReceived=0;this.everConnected_=false;this.log_=logWrapper(r);this.stats_=statsManagerGetCollection(i);this.urlFn=r=>{if(this.appCheckToken){r[F]=this.appCheckToken}return repoInfoConnectionURL(i,D,r)}}open(r,i){this.curSegmentNum=0;this.onDisconnect_=i;this.myPacketOrderer=new PacketReceiver(r);this.isClosed_=false;this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect.");this.onClosed_();this.connectTimeoutTimer_=null}),Math.floor(ee));executeWhenDOMReady((()=>{if(this.isClosed_){return}this.scriptTagHolder=new FirebaseIFrameScriptHolder(((...r)=>{const[i,s,a,l,c]=r;this.incrementIncomingBytes_(r);if(!this.scriptTagHolder){return}if(this.connectTimeoutTimer_){clearTimeout(this.connectTimeoutTimer_);this.connectTimeoutTimer_=null}this.everConnected_=true;if(i===W){this.id=s;this.password=a}else if(i===q){if(s){this.scriptTagHolder.sendNewPolls=false;this.myPacketOrderer.closeAfter(s,(()=>{this.onClosed_()}))}else{this.onClosed_()}}else{throw new Error("Unrecognized command received: "+i)}}),((...r)=>{const[i,s]=r;this.incrementIncomingBytes_(r);this.myPacketOrderer.handleResponse(i,s)}),(()=>{this.onClosed_()}),this.urlFn);const r={};r[W]="t";r[Q]=Math.floor(Math.random()*1e8);if(this.scriptTagHolder.uniqueCallbackIdentifier){r[z]=this.scriptTagHolder.uniqueCallbackIdentifier}r[S]=P;if(this.transportSessionId){r[I]=this.transportSessionId}if(this.lastSessionId){r[R]=this.lastSessionId}if(this.applicationId){r[A]=this.applicationId}if(this.appCheckToken){r[F]=this.appCheckToken}if(typeof location!=="undefined"&&location.hostname&&x.test(location.hostname)){r[N]=k}const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i);this.scriptTagHolder.addTag(i,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password);this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){BrowserPollConnection.forceAllow_=true}static forceDisallow(){BrowserPollConnection.forceDisallow_=true}static isAvailable(){if((0,c.Yr)()){return false}else if(BrowserPollConnection.forceAllow_){return true}else{return!BrowserPollConnection.forceDisallow_&&typeof document!=="undefined"&&document.createElement!=null&&!isChromeExtensionContentScript()&&!isWindowsStoreApp()}}markConnectionHealthy(){}shutdown_(){this.isClosed_=true;if(this.scriptTagHolder){this.scriptTagHolder.close();this.scriptTagHolder=null}if(this.myDisconnFrame){document.body.removeChild(this.myDisconnFrame);this.myDisconnFrame=null}if(this.connectTimeoutTimer_){clearTimeout(this.connectTimeoutTimer_);this.connectTimeoutTimer_=null}}onClosed_(){if(!this.isClosed_){this.log_("Longpoll is closing itself");this.shutdown_();if(this.onDisconnect_){this.onDisconnect_(this.everConnected_);this.onDisconnect_=null}}}close(){if(!this.isClosed_){this.log_("Longpoll is being closed.");this.shutdown_()}}send(r){const i=(0,c.Pz)(r);this.bytesSent+=i.length;this.stats_.incrementCounter("bytes_sent",i.length);const s=(0,c.h$)(i);const a=splitStringBySize(s,X);for(let r=0;r<a.length;r++){this.scriptTagHolder.enqueueSegment(this.curSegmentNum,a.length,a[r]);this.curSegmentNum++}}addDisconnectPingFrame(r,i){if((0,c.Yr)()){return}this.myDisconnFrame=document.createElement("iframe");const s={};s[Y]="t";s[U]=r;s[B]=i;this.myDisconnFrame.src=this.urlFn(s);this.myDisconnFrame.style.display="none";document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(r){const i=(0,c.Pz)(r).length;this.bytesReceived+=i;this.stats_.incrementCounter("bytes_received",i)}}class FirebaseIFrameScriptHolder{constructor(r,i,s,a){this.onDisconnect=s;this.urlFn=a;this.outstandingRequests=new Set;this.pendingSegs=[];this.currentSerial=Math.floor(Math.random()*1e8);this.sendNewPolls=true;if(!(0,c.Yr)()){this.uniqueCallbackIdentifier=y();window[V+this.uniqueCallbackIdentifier]=r;window[G+this.uniqueCallbackIdentifier]=i;this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();let s="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,"javascript:".length)==="javascript:"){const r=document.domain;s='<script>document.domain="'+r+'";<\/script>'}const a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open();this.myIFrame.doc.write(a);this.myIFrame.doc.close()}catch(r){log("frame writing exception");if(r.stack){log(r.stack)}log(r)}}else{this.commandCB=r;this.onMessageCB=i}}static createIFrame_(){const r=document.createElement("iframe");r.style.display="none";if(document.body){document.body.appendChild(r);try{const i=r.contentWindow.document;if(!i){log("No IE domain setting required")}}catch(i){const s=document.domain;r.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else{throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready."}if(r.contentDocument){r.doc=r.contentDocument}else if(r.contentWindow){r.doc=r.contentWindow.document}else if(r.document){r.doc=r.document}return r}close(){this.alive=false;if(this.myIFrame){this.myIFrame.doc.body.innerHTML="";setTimeout((()=>{if(this.myIFrame!==null){document.body.removeChild(this.myIFrame);this.myIFrame=null}}),Math.floor(0))}const r=this.onDisconnect;if(r){this.onDisconnect=null;r()}}startLongPoll(r,i){this.myID=r;this.myPW=i;this.alive=true;while(this.newRequest_()){}}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const r={};r[U]=this.myID;r[B]=this.myPW;r[Q]=this.currentSerial;let i=this.urlFn(r);let s="";let a=0;while(this.pendingSegs.length>0){const r=this.pendingSegs[0];if(r.d.length+J+s.length<=K){const r=this.pendingSegs.shift();s=s+"&"+H+a+"="+r.seg+"&"+j+a+"="+r.ts+"&"+$+a+"="+r.d;a++}else{break}}i=i+s;this.addLongPollTag_(i,this.currentSerial);return true}else{return false}}enqueueSegment(r,i,s){this.pendingSegs.push({seg:r,ts:i,d:s});if(this.alive){this.newRequest_()}}addLongPollTag_(r,i){this.outstandingRequests.add(i);const doNewRequest=()=>{this.outstandingRequests.delete(i);this.newRequest_()};const s=setTimeout(doNewRequest,Math.floor(Z));const readyStateCB=()=>{clearTimeout(s);doNewRequest()};this.addTag(r,readyStateCB)}addTag(r,i){if((0,c.Yr)()){this.doNodeLongPoll(r,i)}else{setTimeout((()=>{try{if(!this.sendNewPolls){return}const s=this.myIFrame.doc.createElement("script");s.type="text/javascript";s.async=true;s.src=r;s.onload=s.onreadystatechange=function(){const r=s.readyState;if(!r||r==="loaded"||r==="complete"){s.onload=s.onreadystatechange=null;if(s.parentNode){s.parentNode.removeChild(s)}i()}};s.onerror=()=>{log("Long-poll script failed to load: "+r);this.sendNewPolls=false;this.close()};this.myIFrame.doc.body.appendChild(s)}catch(r){}}),Math.floor(1))}}}const te=16384;const ne=45e3;let re=null;if(typeof MozWebSocket!=="undefined"){re=MozWebSocket}else if(typeof WebSocket!=="undefined"){re=WebSocket}class WebSocketConnection{constructor(r,i,s,a,l,c,h){this.connId=r;this.applicationId=s;this.appCheckToken=a;this.authToken=l;this.keepaliveTimer=null;this.frames=null;this.totalFrames=0;this.bytesSent=0;this.bytesReceived=0;this.log_=logWrapper(this.connId);this.stats_=statsManagerGetCollection(i);this.connURL=WebSocketConnection.connectionURL_(i,c,h,a);this.nodeAdmin=i.nodeAdmin}static connectionURL_(r,i,s,a){const l={};l[S]=P;if(!(0,c.Yr)()&&typeof location!=="undefined"&&location.hostname&&x.test(location.hostname)){l[N]=k}if(i){l[I]=i}if(s){l[R]=s}if(a){l[F]=a}return repoInfoConnectionURL(r,O,l)}open(r,i){this.onDisconnect=i;this.onMessage=r;this.log_("Websocket connecting to "+this.connURL);this.everConnected_=false;f.set("previous_websocket_failure",true);try{if((0,c.Yr)()){const r=this.nodeAdmin?"AdminNode":"Node";const i={headers:{"User-Agent":`Firebase/${P}/${p}/${"linux"}/${r}`,"X-Firebase-GMPID":this.applicationId||""}};if(this.authToken){i.headers["Authorization"]=`Bearer ${this.authToken}`}if(this.appCheckToken){i.headers["X-Firebase-AppCheck"]=this.appCheckToken}const s={NODE_ENV:"production",PUBLIC_URL:"",APP_ENV:undefined};const a=this.connURL.indexOf("wss://")===0?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];if(a){i["proxy"]={origin:a}}this.mySock=new re(this.connURL,[],i)}else{const r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new re(this.connURL,[],r)}}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;if(i){this.log_(i)}this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected.");this.everConnected_=true};this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected.");this.mySock=null;this.onClosed_()};this.mySock.onmessage=r=>{this.handleIncomingFrame(r)};this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;if(i){this.log_(i)}this.onClosed_()}}start(){}static forceDisallow(){WebSocketConnection.forceDisallow_=true}static isAvailable(){let r=false;if(typeof navigator!=="undefined"&&navigator.userAgent){const i=/Android ([0-9]{0,}\.[0-9]{0,})/;const s=navigator.userAgent.match(i);if(s&&s.length>1){if(parseFloat(s[1])<4.4){r=true}}}return!r&&re!==null&&!WebSocketConnection.forceDisallow_}static previouslyFailed(){return f.isInMemoryStorage||f.get("previous_websocket_failure")===true}markConnectionHealthy(){f.remove("previous_websocket_failure")}appendFrame_(r){this.frames.push(r);if(this.frames.length===this.totalFrames){const r=this.frames.join("");this.frames=null;const i=(0,c.cI)(r);this.onMessage(i)}}handleNewFrameCount_(r){this.totalFrames=r;this.frames=[]}extractFrameCount_(r){(0,c.hu)(this.frames===null,"We already have a frame buffer");if(r.length<=6){const i=Number(r);if(!isNaN(i)){this.handleNewFrameCount_(i);return null}}this.handleNewFrameCount_(1);return r}handleIncomingFrame(r){if(this.mySock===null){return}const i=r["data"];this.bytesReceived+=i.length;this.stats_.incrementCounter("bytes_received",i.length);this.resetKeepAlive();if(this.frames!==null){this.appendFrame_(i)}else{const r=this.extractFrameCount_(i);if(r!==null){this.appendFrame_(r)}}}send(r){this.resetKeepAlive();const i=(0,c.Pz)(r);this.bytesSent+=i.length;this.stats_.incrementCounter("bytes_sent",i.length);const s=splitStringBySize(i,te);if(s.length>1){this.sendString_(String(s.length))}for(let r=0;r<s.length;r++){this.sendString_(s[r])}}shutdown_(){this.isClosed_=true;if(this.keepaliveTimer){clearInterval(this.keepaliveTimer);this.keepaliveTimer=null}if(this.mySock){this.mySock.close();this.mySock=null}}onClosed_(){if(!this.isClosed_){this.log_("WebSocket is closing itself");this.shutdown_();if(this.onDisconnect){this.onDisconnect(this.everConnected_);this.onDisconnect=null}}}close(){if(!this.isClosed_){this.log_("WebSocket is being closed");this.shutdown_()}}resetKeepAlive(){clearInterval(this.keepaliveTimer);this.keepaliveTimer=setInterval((()=>{if(this.mySock){this.sendString_("0")}this.resetKeepAlive()}),Math.floor(ne))}sendString_(r){try{this.mySock.send(r)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection.");setTimeout(this.onClosed_.bind(this),0)}}}WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;class TransportManager{constructor(r){this.initTransports_(r)}static get ALL_TRANSPORTS(){return[BrowserPollConnection,WebSocketConnection]}initTransports_(r){const i=WebSocketConnection&&WebSocketConnection["isAvailable"]();let s=i&&!WebSocketConnection.previouslyFailed();if(r.webSocketOnly){if(!i){warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway.")}s=true}if(s){this.transports_=[WebSocketConnection]}else{const r=this.transports_=[];for(const i of TransportManager.ALL_TRANSPORTS){if(i&&i["isAvailable"]()){r.push(i)}}}}initialTransport(){if(this.transports_.length>0){return this.transports_[0]}else{throw new Error("No transports available")}}upgradeTransport(){if(this.transports_.length>1){return this.transports_[1]}else{return null}}}const ie=6e4;const se=5e3;const oe=10*1024;const ae=100*1024;const le="t";const ce="d";const he="s";const ue="r";const de="e";const pe="o";const fe="a";const me="n";const _e="p";const ye="h";class Connection{constructor(r,i,s,a,l,c,h,u,d,p){this.id=r;this.repoInfo_=i;this.applicationId_=s;this.appCheckToken_=a;this.authToken_=l;this.onMessage_=c;this.onReady_=h;this.onDisconnect_=u;this.onKill_=d;this.lastSessionId=p;this.connectionCount=0;this.pendingDataMessages=[];this.state_=0;this.log_=logWrapper("c:"+this.id+":");this.transportManager_=new TransportManager(i);this.log_("Connection created");this.start_()}start_(){const r=this.transportManager_.initialTransport();this.conn_=new r(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId);this.primaryResponsesRequired_=r["responsesRequiredToBeHealthy"]||0;const i=this.connReceiver_(this.conn_);const s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_;this.rx_=this.conn_;this.secondaryConn_=null;this.isHealthy_=false;setTimeout((()=>{this.conn_&&this.conn_.open(i,s)}),Math.floor(0));const a=r["healthyTimeout"]||0;if(a>0){this.healthyTimeout_=setTimeoutNonBlocking((()=>{this.healthyTimeout_=null;if(!this.isHealthy_){if(this.conn_&&this.conn_.bytesReceived>ae){this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy.");this.isHealthy_=true;this.conn_.markConnectionHealthy()}else if(this.conn_&&this.conn_.bytesSent>oe){this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive.")}else{this.log_("Closing unhealthy connection after timeout.");this.close()}}}),Math.floor(a))}}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(r){return i=>{if(r===this.conn_){this.onConnectionLost_(i)}else if(r===this.secondaryConn_){this.log_("Secondary connection lost.");this.onSecondaryConnectionLost_()}else{this.log_("closing an old connection")}}}connReceiver_(r){return i=>{if(this.state_!==2){if(r===this.rx_){this.onPrimaryMessageReceived_(i)}else if(r===this.secondaryConn_){this.onSecondaryMessageReceived_(i)}else{this.log_("message on old connection")}}}}sendRequest(r){const i={t:"d",d:r};this.sendData_(i)}tryCleanupConnection(){if(this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_){this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId);this.conn_=this.secondaryConn_;this.secondaryConn_=null}}onSecondaryControl_(r){if(le in r){const i=r[le];if(i===fe){this.upgradeIfSecondaryHealthy_()}else if(i===ue){this.log_("Got a reset on secondary, closing it");this.secondaryConn_.close();if(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_){this.close()}}else if(i===pe){this.log_("got pong on secondary.");this.secondaryResponsesRequired_--;this.upgradeIfSecondaryHealthy_()}}}onSecondaryMessageReceived_(r){const i=requireKey("t",r);const s=requireKey("d",r);if(i==="c"){this.onSecondaryControl_(s)}else if(i==="d"){this.pendingDataMessages.push(s)}else{throw new Error("Unknown protocol layer: "+i)}}upgradeIfSecondaryHealthy_(){if(this.secondaryResponsesRequired_<=0){this.log_("Secondary connection is healthy.");this.isHealthy_=true;this.secondaryConn_.markConnectionHealthy();this.proceedWithUpgrade_()}else{this.log_("sending ping on secondary.");this.secondaryConn_.send({t:"c",d:{t:_e,d:{}}})}}proceedWithUpgrade_(){this.secondaryConn_.start();this.log_("sending client ack on secondary");this.secondaryConn_.send({t:"c",d:{t:fe,d:{}}});this.log_("Ending transmission on primary");this.conn_.send({t:"c",d:{t:me,d:{}}});this.tx_=this.secondaryConn_;this.tryCleanupConnection()}onPrimaryMessageReceived_(r){const i=requireKey("t",r);const s=requireKey("d",r);if(i==="c"){this.onControl_(s)}else if(i==="d"){this.onDataMessage_(s)}}onDataMessage_(r){this.onPrimaryResponse_();this.onMessage_(r)}onPrimaryResponse_(){if(!this.isHealthy_){this.primaryResponsesRequired_--;if(this.primaryResponsesRequired_<=0){this.log_("Primary connection is healthy.");this.isHealthy_=true;this.conn_.markConnectionHealthy()}}}onControl_(r){const i=requireKey(le,r);if(ce in r){const s=r[ce];if(i===ye){this.onHandshake_(s)}else if(i===me){this.log_("recvd end transmission on primary");this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r){this.onDataMessage_(this.pendingDataMessages[r])}this.pendingDataMessages=[];this.tryCleanupConnection()}else if(i===he){this.onConnectionShutdown_(s)}else if(i===ue){this.onReset_(s)}else if(i===de){error("Server Error: "+s)}else if(i===pe){this.log_("got pong on primary.");this.onPrimaryResponse_();this.sendPingOnPrimaryIfNecessary_()}else{error("Unknown control packet command: "+i)}}}onHandshake_(r){const i=r.ts;const s=r.v;const a=r.h;this.sessionId=r.s;this.repoInfo_.host=a;if(this.state_===0){this.conn_.start();this.onConnectionEstablished_(this.conn_,i);if(P!==s){warn("Protocol version mismatch detected")}this.tryStartUpgrade_()}}tryStartUpgrade_(){const r=this.transportManager_.upgradeTransport();if(r){this.startUpgrade_(r)}}startUpgrade_(r){this.secondaryConn_=new r(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId);this.secondaryResponsesRequired_=r["responsesRequiredToBeHealthy"]||0;const i=this.connReceiver_(this.secondaryConn_);const s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(i,s);setTimeoutNonBlocking((()=>{if(this.secondaryConn_){this.log_("Timed out trying to upgrade.");this.secondaryConn_.close()}}),Math.floor(ie))}onReset_(r){this.log_("Reset packet received.  New host: "+r);this.repoInfo_.host=r;if(this.state_===1){this.close()}else{this.closeConnections_();this.start_()}}onConnectionEstablished_(r,i){this.log_("Realtime connection established.");this.conn_=r;this.state_=1;if(this.onReady_){this.onReady_(i,this.sessionId);this.onReady_=null}if(this.primaryResponsesRequired_===0){this.log_("Primary connection is healthy.");this.isHealthy_=true}else{setTimeoutNonBlocking((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(se))}}sendPingOnPrimaryIfNecessary_(){if(!this.isHealthy_&&this.state_===1){this.log_("sending ping on primary.");this.sendData_({t:"c",d:{t:_e,d:{}}})}}onSecondaryConnectionLost_(){const r=this.secondaryConn_;this.secondaryConn_=null;if(this.tx_===r||this.rx_===r){this.close()}}onConnectionLost_(r){this.conn_=null;if(!r&&this.state_===0){this.log_("Realtime connection failed.");if(this.repoInfo_.isCacheableHost()){f.remove("host:"+this.repoInfo_.host);this.repoInfo_.internalHost=this.repoInfo_.host}}else if(this.state_===1){this.log_("Realtime connection lost.")}this.close()}onConnectionShutdown_(r){this.log_("Connection shutdown command received. Shutting down...");if(this.onKill_){this.onKill_(r);this.onKill_=null}this.onDisconnect_=null;this.close()}sendData_(r){if(this.state_!==1){throw"Connection is not connected"}else{this.tx_.send(r)}}close(){if(this.state_!==2){this.log_("Closing realtime connection.");this.state_=2;this.closeConnections_();if(this.onDisconnect_){this.onDisconnect_();this.onDisconnect_=null}}}closeConnections_(){this.log_("Shutting down all connections");if(this.conn_){this.conn_.close();this.conn_=null}if(this.secondaryConn_){this.secondaryConn_.close();this.secondaryConn_=null}if(this.healthyTimeout_){clearTimeout(this.healthyTimeout_);this.healthyTimeout_=null}}}class ServerActions{put(r,i,s,a){}merge(r,i,s,a){}refreshAuthToken(r){}refreshAppCheckToken(r){}onDisconnectPut(r,i,s){}onDisconnectMerge(r,i,s){}onDisconnectCancel(r,i){}reportStats(r){}}class EventEmitter{constructor(r){this.allowedEvents_=r;this.listeners_={};(0,c.hu)(Array.isArray(r)&&r.length>0,"Requires a non-empty array")}trigger(r,...i){if(Array.isArray(this.listeners_[r])){const s=[...this.listeners_[r]];for(let r=0;r<s.length;r++){s[r].callback.apply(s[r].context,i)}}}on(r,i,s){this.validateEventType_(r);this.listeners_[r]=this.listeners_[r]||[];this.listeners_[r].push({callback:i,context:s});const a=this.getInitialEvent(r);if(a){i.apply(s,a)}}off(r,i,s){this.validateEventType_(r);const a=this.listeners_[r]||[];for(let r=0;r<a.length;r++){if(a[r].callback===i&&(!s||s===a[r].context)){a.splice(r,1);return}}}validateEventType_(r){(0,c.hu)(this.allowedEvents_.find((i=>i===r)),"Unknown event: "+r)}}class OnlineMonitor extends EventEmitter{constructor(){super(["online"]);this.online_=true;if(typeof window!=="undefined"&&typeof window.addEventListener!=="undefined"&&!(0,c.uI)()){window.addEventListener("online",(()=>{if(!this.online_){this.online_=true;this.trigger("online",true)}}),false);window.addEventListener("offline",(()=>{if(this.online_){this.online_=false;this.trigger("online",false)}}),false)}}static getInstance(){return new OnlineMonitor}getInitialEvent(r){(0,c.hu)(r==="online","Unknown event type: "+r);return[this.online_]}currentlyOnline(){return this.online_}}const ge=32;const ve=768;class Path{constructor(r,i){if(i===void 0){this.pieces_=r.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++){if(this.pieces_[r].length>0){this.pieces_[i]=this.pieces_[r];i++}}this.pieces_.length=i;this.pieceNum_=0}else{this.pieces_=r;this.pieceNum_=i}}toString(){let r="";for(let i=this.pieceNum_;i<this.pieces_.length;i++){if(this.pieces_[i]!==""){r+="/"+this.pieces_[i]}}return r||"/"}}function newEmptyPath(){return new Path("")}function pathGetFront(r){if(r.pieceNum_>=r.pieces_.length){return null}return r.pieces_[r.pieceNum_]}function pathGetLength(r){return r.pieces_.length-r.pieceNum_}function pathPopFront(r){let i=r.pieceNum_;if(i<r.pieces_.length){i++}return new Path(r.pieces_,i)}function pathGetBack(r){if(r.pieceNum_<r.pieces_.length){return r.pieces_[r.pieces_.length-1]}return null}function pathToUrlEncodedString(r){let i="";for(let s=r.pieceNum_;s<r.pieces_.length;s++){if(r.pieces_[s]!==""){i+="/"+encodeURIComponent(String(r.pieces_[s]))}}return i||"/"}function pathSlice(r,i=0){return r.pieces_.slice(r.pieceNum_+i)}function pathParent(r){if(r.pieceNum_>=r.pieces_.length){return null}const i=[];for(let s=r.pieceNum_;s<r.pieces_.length-1;s++){i.push(r.pieces_[s])}return new Path(i,0)}function pathChild(r,i){const s=[];for(let i=r.pieceNum_;i<r.pieces_.length;i++){s.push(r.pieces_[i])}if(i instanceof Path){for(let r=i.pieceNum_;r<i.pieces_.length;r++){s.push(i.pieces_[r])}}else{const r=i.split("/");for(let i=0;i<r.length;i++){if(r[i].length>0){s.push(r[i])}}}return new Path(s,0)}function pathIsEmpty(r){return r.pieceNum_>=r.pieces_.length}function newRelativePath(r,i){const s=pathGetFront(r),a=pathGetFront(i);if(s===null){return i}else if(s===a){return newRelativePath(pathPopFront(r),pathPopFront(i))}else{throw new Error("INTERNAL ERROR: innerPath ("+i+") is not within "+"outerPath ("+r+")")}}function pathCompare(r,i){const s=pathSlice(r,0);const a=pathSlice(i,0);for(let r=0;r<s.length&&r<a.length;r++){const i=nameCompare(s[r],a[r]);if(i!==0){return i}}if(s.length===a.length){return 0}return s.length<a.length?-1:1}function pathEquals(r,i){if(pathGetLength(r)!==pathGetLength(i)){return false}for(let s=r.pieceNum_,a=i.pieceNum_;s<=r.pieces_.length;s++,a++){if(r.pieces_[s]!==i.pieces_[a]){return false}}return true}function pathContains(r,i){let s=r.pieceNum_;let a=i.pieceNum_;if(pathGetLength(r)>pathGetLength(i)){return false}while(s<r.pieces_.length){if(r.pieces_[s]!==i.pieces_[a]){return false}++s;++a}return true}class ValidationPath{constructor(r,i){this.errorPrefix_=i;this.parts_=pathSlice(r,0);this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++){this.byteLength_+=(0,c.ug)(this.parts_[r])}validationPathCheckValid(this)}}function validationPathPush(r,i){if(r.parts_.length>0){r.byteLength_+=1}r.parts_.push(i);r.byteLength_+=(0,c.ug)(i);validationPathCheckValid(r)}function validationPathPop(r){const i=r.parts_.pop();r.byteLength_-=(0,c.ug)(i);if(r.parts_.length>0){r.byteLength_-=1}}function validationPathCheckValid(r){if(r.byteLength_>ve){throw new Error(r.errorPrefix_+"has a key path longer than "+ve+" bytes ("+r.byteLength_+").")}if(r.parts_.length>ge){throw new Error(r.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ge+") or object contains a cycle "+validationPathToErrorString(r))}}function validationPathToErrorString(r){if(r.parts_.length===0){return""}return"in property '"+r.parts_.join(".")+"'"}class VisibilityMonitor extends EventEmitter{constructor(){super(["visible"]);let r;let i;if(typeof document!=="undefined"&&typeof document.addEventListener!=="undefined"){if(typeof document["hidden"]!=="undefined"){i="visibilitychange";r="hidden"}else if(typeof document["mozHidden"]!=="undefined"){i="mozvisibilitychange";r="mozHidden"}else if(typeof document["msHidden"]!=="undefined"){i="msvisibilitychange";r="msHidden"}else if(typeof document["webkitHidden"]!=="undefined"){i="webkitvisibilitychange";r="webkitHidden"}}this.visible_=true;if(i){document.addEventListener(i,(()=>{const i=!document[r];if(i!==this.visible_){this.visible_=i;this.trigger("visible",i)}}),false)}}static getInstance(){return new VisibilityMonitor}getInitialEvent(r){(0,c.hu)(r==="visible","Unknown event type: "+r);return[this.visible_]}}const Ce=1e3;const we=60*5*1e3;const Ee=3*1e3;const Te=30*1e3;const be=1.3;const Pe=3e4;const Se="server_kill";const Ie=3;class PersistentConnection extends ServerActions{constructor(r,i,s,a,l,h,u,d){super();this.repoInfo_=r;this.applicationId_=i;this.onDataUpdate_=s;this.onConnectStatus_=a;this.onServerInfoUpdate_=l;this.authTokenProvider_=h;this.appCheckTokenProvider_=u;this.authOverride_=d;this.id=PersistentConnection.nextPersistentConnectionId_++;this.log_=logWrapper("p:"+this.id+":");this.interruptReasons_={};this.listens=new Map;this.outstandingPuts_=[];this.outstandingGets_=[];this.outstandingPutCount_=0;this.outstandingGetCount_=0;this.onDisconnectRequestQueue_=[];this.connected_=false;this.reconnectDelay_=Ce;this.maxReconnectDelay_=we;this.securityDebugCallback_=null;this.lastSessionId=null;this.establishConnectionTimer_=null;this.visible_=false;this.requestCBHash_={};this.requestNumber_=0;this.realtime_=null;this.authToken_=null;this.appCheckToken_=null;this.forceTokenRefresh_=false;this.invalidAuthTokenCount_=0;this.invalidAppCheckTokenCount_=0;this.firstConnection_=true;this.lastConnectionAttemptTime_=null;this.lastConnectionEstablishedTime_=null;if(d&&!(0,c.Yr)()){throw new Error("Auth override specified in options, but not supported on non Node.js platforms")}VisibilityMonitor.getInstance().on("visible",this.onVisible_,this);if(r.host.indexOf("fblocal")===-1){OnlineMonitor.getInstance().on("online",this.onOnline_,this)}}sendRequest(r,i,s){const a=++this.requestNumber_;const l={r:a,a:r,b:i};this.log_((0,c.Pz)(l));(0,c.hu)(this.connected_,"sendRequest call when we're not connected not allowed.");this.realtime_.sendRequest(l);if(s){this.requestCBHash_[a]=s}}get(r){this.initConnection_();const i=new c.BH;const s={p:r._path.toString(),q:r._queryObject};const a={action:"g",request:s,onComplete:r=>{const a=r["d"];if(r["s"]==="ok"){this.onDataUpdate_(s["p"],a,false,null);i.resolve(a)}else{i.reject(a)}}};this.outstandingGets_.push(a);this.outstandingGetCount_++;const l=this.outstandingGets_.length-1;if(!this.connected_){setTimeout((()=>{const r=this.outstandingGets_[l];if(r===undefined||a!==r){return}delete this.outstandingGets_[l];this.outstandingGetCount_--;if(this.outstandingGetCount_===0){this.outstandingGets_=[]}this.log_("get "+l+" timed out on connection");i.reject(new Error("Client is offline."))}),Ee)}if(this.connected_){this.sendGet_(l)}return i.promise}listen(r,i,s,a){this.initConnection_();const l=r._queryIdentifier;const h=r._path.toString();this.log_("Listen called for "+h+" "+l);if(!this.listens.has(h)){this.listens.set(h,new Map)}(0,c.hu)(r._queryParams.isDefault()||!r._queryParams.loadsAllData(),"listen() called for non-default but complete query");(0,c.hu)(!this.listens.get(h).has(l),"listen() called twice for same path/queryId.");const u={onComplete:a,hashFn:i,query:r,tag:s};this.listens.get(h).set(l,u);if(this.connected_){this.sendListen_(u)}}sendGet_(r){const i=this.outstandingGets_[r];this.sendRequest("g",i.request,(s=>{delete this.outstandingGets_[r];this.outstandingGetCount_--;if(this.outstandingGetCount_===0){this.outstandingGets_=[]}if(i.onComplete){i.onComplete(s)}}))}sendListen_(r){const i=r.query;const s=i._path.toString();const a=i._queryIdentifier;this.log_("Listen on "+s+" for "+a);const l={p:s};const c="q";if(r.tag){l["q"]=i._queryObject;l["t"]=r.tag}l["h"]=r.hashFn();this.sendRequest(c,l,(l=>{const c=l["d"];const h=l["s"];PersistentConnection.warnOnListenWarnings_(c,i);const u=this.listens.get(s)&&this.listens.get(s).get(a);if(u===r){this.log_("listen response",l);if(h!=="ok"){this.removeListen_(s,a)}if(r.onComplete){r.onComplete(h,c)}}}))}static warnOnListenWarnings_(r,i){if(r&&typeof r==="object"&&(0,c.r3)(r,"w")){const s=(0,c.DV)(r,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+i._queryParams.getIndex().toString()+'"';const s=i._path.toString();warn(`Using an unspecified index. Your data will be downloaded and `+`filtered on the client. Consider adding ${r} at `+`${s} to your security rules for better performance.`)}}}refreshAuthToken(r){this.authToken_=r;this.log_("Auth token refreshed");if(this.authToken_){this.tryAuth()}else{if(this.connected_){this.sendRequest("unauth",{},(()=>{}))}}this.reduceReconnectDelayIfAdminCredential_(r)}reduceReconnectDelayIfAdminCredential_(r){const i=r&&r.length===40;if(i||(0,c.GJ)(r)){this.log_("Admin auth credential detected.  Reducing max reconnect time.");this.maxReconnectDelay_=Te}}refreshAppCheckToken(r){this.appCheckToken_=r;this.log_("App check token refreshed");if(this.appCheckToken_){this.tryAppCheck()}else{if(this.connected_){this.sendRequest("unappeck",{},(()=>{}))}}}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;const i=(0,c.w9)(r)?"auth":"gauth";const s={cred:r};if(this.authOverride_===null){s["noauth"]=true}else if(typeof this.authOverride_==="object"){s["authvar"]=this.authOverride_}this.sendRequest(i,s,(i=>{const s=i["s"];const a=i["d"]||"error";if(this.authToken_===r){if(s==="ok"){this.invalidAuthTokenCount_=0}else{this.onAuthRevoked_(s,a)}}}))}}tryAppCheck(){if(this.connected_&&this.appCheckToken_){this.sendRequest("appcheck",{token:this.appCheckToken_},(r=>{const i=r["s"];const s=r["d"]||"error";if(i==="ok"){this.invalidAppCheckTokenCount_=0}else{this.onAppCheckRevoked_(i,s)}}))}}unlisten(r,i){const s=r._path.toString();const a=r._queryIdentifier;this.log_("Unlisten called for "+s+" "+a);(0,c.hu)(r._queryParams.isDefault()||!r._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");const l=this.removeListen_(s,a);if(l&&this.connected_){this.sendUnlisten_(s,a,r._queryObject,i)}}sendUnlisten_(r,i,s,a){this.log_("Unlisten on "+r+" for "+i);const l={p:r};const c="n";if(a){l["q"]=s;l["t"]=a}this.sendRequest(c,l)}onDisconnectPut(r,i,s){this.initConnection_();if(this.connected_){this.sendOnDisconnect_("o",r,i,s)}else{this.onDisconnectRequestQueue_.push({pathString:r,action:"o",data:i,onComplete:s})}}onDisconnectMerge(r,i,s){this.initConnection_();if(this.connected_){this.sendOnDisconnect_("om",r,i,s)}else{this.onDisconnectRequestQueue_.push({pathString:r,action:"om",data:i,onComplete:s})}}onDisconnectCancel(r,i){this.initConnection_();if(this.connected_){this.sendOnDisconnect_("oc",r,null,i)}else{this.onDisconnectRequestQueue_.push({pathString:r,action:"oc",data:null,onComplete:i})}}sendOnDisconnect_(r,i,s,a){const l={p:i,d:s};this.log_("onDisconnect "+r,l);this.sendRequest(r,l,(r=>{if(a){setTimeout((()=>{a(r["s"],r["d"])}),Math.floor(0))}}))}put(r,i,s,a){this.putInternal("p",r,i,s,a)}merge(r,i,s,a){this.putInternal("m",r,i,s,a)}putInternal(r,i,s,a,l){this.initConnection_();const c={p:i,d:s};if(l!==undefined){c["h"]=l}this.outstandingPuts_.push({action:r,request:c,onComplete:a});this.outstandingPutCount_++;const h=this.outstandingPuts_.length-1;if(this.connected_){this.sendPut_(h)}else{this.log_("Buffering put: "+i)}}sendPut_(r){const i=this.outstandingPuts_[r].action;const s=this.outstandingPuts_[r].request;const a=this.outstandingPuts_[r].onComplete;this.outstandingPuts_[r].queued=this.connected_;this.sendRequest(i,s,(s=>{this.log_(i+" response",s);delete this.outstandingPuts_[r];this.outstandingPutCount_--;if(this.outstandingPutCount_===0){this.outstandingPuts_=[]}if(a){a(s["s"],s["d"])}}))}reportStats(r){if(this.connected_){const i={c:r};this.log_("reportStats",i);this.sendRequest("s",i,(r=>{const i=r["s"];if(i!=="ok"){const i=r["d"];this.log_("reportStats","Error sending stats: "+i)}}))}}onDataMessage_(r){if("r"in r){this.log_("from server: "+(0,c.Pz)(r));const i=r["r"];const s=this.requestCBHash_[i];if(s){delete this.requestCBHash_[i];s(r["b"])}}else if("error"in r){throw"A server-side error has occurred: "+r["error"]}else if("a"in r){this.onDataPush_(r["a"],r["b"])}}onDataPush_(r,i){this.log_("handleServerMessage",r,i);if(r==="d"){this.onDataUpdate_(i["p"],i["d"],false,i["t"])}else if(r==="m"){this.onDataUpdate_(i["p"],i["d"],true,i["t"])}else if(r==="c"){this.onListenRevoked_(i["p"],i["q"])}else if(r==="ac"){this.onAuthRevoked_(i["s"],i["d"])}else if(r==="apc"){this.onAppCheckRevoked_(i["s"],i["d"])}else if(r==="sd"){this.onSecurityDebugPacket_(i)}else{error("Unrecognized action received from server: "+(0,c.Pz)(r)+"\nAre you using the latest client?")}}onReady_(r,i){this.log_("connection ready");this.connected_=true;this.lastConnectionEstablishedTime_=(new Date).getTime();this.handleTimestamp_(r);this.lastSessionId=i;if(this.firstConnection_){this.sendConnectStats_()}this.restoreState_();this.firstConnection_=false;this.onConnectStatus_(true)}scheduleConnect_(r){(0,c.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?");if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_)}this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null;this.establishConnection_()}),Math.floor(r))}initConnection_(){if(!this.realtime_&&this.firstConnection_){this.scheduleConnect_(0)}}onVisible_(r){if(r&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_){this.log_("Window became visible.  Reducing delay.");this.reconnectDelay_=Ce;if(!this.realtime_){this.scheduleConnect_(0)}}this.visible_=r}onOnline_(r){if(r){this.log_("Browser went online.");this.reconnectDelay_=Ce;if(!this.realtime_){this.scheduleConnect_(0)}}else{this.log_("Browser went offline.  Killing connection.");if(this.realtime_){this.realtime_.close()}}}onRealtimeDisconnect_(){this.log_("data client disconnected");this.connected_=false;this.realtime_=null;this.cancelSentTransactions_();this.requestCBHash_={};if(this.shouldReconnect_()){if(!this.visible_){this.log_("Window isn't visible.  Delaying reconnect.");this.reconnectDelay_=this.maxReconnectDelay_;this.lastConnectionAttemptTime_=(new Date).getTime()}else if(this.lastConnectionEstablishedTime_){const r=(new Date).getTime()-this.lastConnectionEstablishedTime_;if(r>Pe){this.reconnectDelay_=Ce}this.lastConnectionEstablishedTime_=null}const r=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-r);i=Math.random()*i;this.log_("Trying to reconnect in "+i+"ms");this.scheduleConnect_(i);this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*be)}this.onConnectStatus_(false)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt");this.lastConnectionAttemptTime_=(new Date).getTime();this.lastConnectionEstablishedTime_=null;const r=this.onDataMessage_.bind(this);const i=this.onReady_.bind(this);const s=this.onRealtimeDisconnect_.bind(this);const a=this.id+":"+PersistentConnection.nextConnectionId_++;const l=this.lastSessionId;let h=false;let u=null;const closeFn=function(){if(u){u.close()}else{h=true;s()}};const sendRequestFn=function(r){(0,c.hu)(u,"sendRequest call when we're not connected not allowed.");u.sendRequest(r)};this.realtime_={close:closeFn,sendRequest:sendRequestFn};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=false;try{const[c,p]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);if(!h){log("getToken() completed. Creating connection.");this.authToken_=c&&c.accessToken;this.appCheckToken_=p&&p.token;u=new Connection(a,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,r,i,s,(r=>{warn(r+" ("+this.repoInfo_.toString()+")");this.interrupt(Se)}),l)}else{log("getToken() completed but was canceled")}}catch(r){this.log_("Failed to get token: "+r);if(!h){if(this.repoInfo_.nodeAdmin){warn(r)}closeFn()}}}}interrupt(r){log("Interrupting connection for reason: "+r);this.interruptReasons_[r]=true;if(this.realtime_){this.realtime_.close()}else{if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_);this.establishConnectionTimer_=null}if(this.connected_){this.onRealtimeDisconnect_()}}}resume(r){log("Resuming connection for reason: "+r);delete this.interruptReasons_[r];if((0,c.xb)(this.interruptReasons_)){this.reconnectDelay_=Ce;if(!this.realtime_){this.scheduleConnect_(0)}}}handleTimestamp_(r){const i=r-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let r=0;r<this.outstandingPuts_.length;r++){const i=this.outstandingPuts_[r];if(i&&"h"in i.request&&i.queued){if(i.onComplete){i.onComplete("disconnect")}delete this.outstandingPuts_[r];this.outstandingPutCount_--}}if(this.outstandingPutCount_===0){this.outstandingPuts_=[]}}onListenRevoked_(r,i){let s;if(!i){s="default"}else{s=i.map((r=>ObjectToUniqueKey(r))).join("$")}const a=this.removeListen_(r,s);if(a&&a.onComplete){a.onComplete("permission_denied")}}removeListen_(r,i){const s=new Path(r).toString();let a;if(this.listens.has(s)){const r=this.listens.get(s);a=r.get(i);r.delete(i);if(r.size===0){this.listens.delete(s)}}else{a=undefined}return a}onAuthRevoked_(r,i){log("Auth token revoked: "+r+"/"+i);this.authToken_=null;this.forceTokenRefresh_=true;this.realtime_.close();if(r==="invalid_token"||r==="permission_denied"){this.invalidAuthTokenCount_++;if(this.invalidAuthTokenCount_>=Ie){this.reconnectDelay_=Te;this.authTokenProvider_.notifyForInvalidToken()}}}onAppCheckRevoked_(r,i){log("App check token revoked: "+r+"/"+i);this.appCheckToken_=null;this.forceTokenRefresh_=true;if(r==="invalid_token"||r==="permission_denied"){this.invalidAppCheckTokenCount_++;if(this.invalidAppCheckTokenCount_>=Ie){this.appCheckTokenProvider_.notifyForInvalidToken()}}}onSecurityDebugPacket_(r){if(this.securityDebugCallback_){this.securityDebugCallback_(r)}else{if("msg"in r){console.log("FIREBASE: "+r["msg"].replace("\n","\nFIREBASE: "))}}}restoreState_(){this.tryAuth();this.tryAppCheck();for(const r of this.listens.values()){for(const i of r.values()){this.sendListen_(i)}}for(let r=0;r<this.outstandingPuts_.length;r++){if(this.outstandingPuts_[r]){this.sendPut_(r)}}while(this.onDisconnectRequestQueue_.length){const r=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(r.action,r.pathString,r.data,r.onComplete)}for(let r=0;r<this.outstandingGets_.length;r++){if(this.outstandingGets_[r]){this.sendGet_(r)}}}sendConnectStats_(){const r={};let i="js";if((0,c.Yr)()){if(this.repoInfo_.nodeAdmin){i="admin_node"}else{i="node"}}r["sdk."+i+"."+p.replace(/\./g,"-")]=1;if((0,c.uI)()){r["framework.cordova"]=1}else if((0,c.b$)()){r["framework.reactnative"]=1}this.reportStats(r)}shouldReconnect_(){const r=OnlineMonitor.getInstance().currentlyOnline();return(0,c.xb)(this.interruptReasons_)&&r}}PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;class NamedNode{constructor(r,i){this.name=r;this.node=i}static Wrap(r,i){return new NamedNode(r,i)}}class Index{getCompare(){return this.compare.bind(this)}indexedValueChanged(r,i){const s=new NamedNode(C,r);const a=new NamedNode(C,i);return this.compare(s,a)!==0}minPost(){return NamedNode.MIN}}let Ne;class KeyIndex extends Index{static get __EMPTY_NODE(){return Ne}static set __EMPTY_NODE(r){Ne=r}compare(r,i){return nameCompare(r.name,i.name)}isDefinedOn(r){throw(0,c.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(r,i){return false}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(w,Ne)}makePost(r,i){(0,c.hu)(typeof r==="string","KeyIndex indexValue must always be a string.");return new NamedNode(r,Ne)}toString(){return".key"}}const ke=new KeyIndex;class SortedMapIterator{constructor(r,i,s,a,l=null){this.isReverse_=a;this.resultGenerator_=l;this.nodeStack_=[];let c=1;while(!r.isEmpty()){r=r;c=i?s(r.key,i):1;if(a){c*=-1}if(c<0){if(this.isReverse_){r=r.left}else{r=r.right}}else if(c===0){this.nodeStack_.push(r);break}else{this.nodeStack_.push(r);if(this.isReverse_){r=r.right}else{r=r.left}}}}getNext(){if(this.nodeStack_.length===0){return null}let r=this.nodeStack_.pop();let i;if(this.resultGenerator_){i=this.resultGenerator_(r.key,r.value)}else{i={key:r.key,value:r.value}}if(this.isReverse_){r=r.left;while(!r.isEmpty()){this.nodeStack_.push(r);r=r.right}}else{r=r.right;while(!r.isEmpty()){this.nodeStack_.push(r);r=r.left}}return i}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0){return null}const r=this.nodeStack_[this.nodeStack_.length-1];if(this.resultGenerator_){return this.resultGenerator_(r.key,r.value)}else{return{key:r.key,value:r.value}}}}class LLRBNode{constructor(r,i,s,a,l){this.key=r;this.value=i;this.color=s!=null?s:LLRBNode.RED;this.left=a!=null?a:SortedMap.EMPTY_NODE;this.right=l!=null?l:SortedMap.EMPTY_NODE}copy(r,i,s,a,l){return new LLRBNode(r!=null?r:this.key,i!=null?i:this.value,s!=null?s:this.color,a!=null?a:this.left,l!=null?l:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return false}inorderTraversal(r){return this.left.inorderTraversal(r)||!!r(this.key,this.value)||this.right.inorderTraversal(r)}reverseTraversal(r){return this.right.reverseTraversal(r)||r(this.key,this.value)||this.left.reverseTraversal(r)}min_(){if(this.left.isEmpty()){return this}else{return this.left.min_()}}minKey(){return this.min_().key}maxKey(){if(this.right.isEmpty()){return this.key}else{return this.right.maxKey()}}insert(r,i,s){let a=this;const l=s(r,a.key);if(l<0){a=a.copy(null,null,null,a.left.insert(r,i,s),null)}else if(l===0){a=a.copy(null,i,null,null,null)}else{a=a.copy(null,null,null,null,a.right.insert(r,i,s))}return a.fixUp_()}removeMin_(){if(this.left.isEmpty()){return SortedMap.EMPTY_NODE}let r=this;if(!r.left.isRed_()&&!r.left.left.isRed_()){r=r.moveRedLeft_()}r=r.copy(null,null,null,r.left.removeMin_(),null);return r.fixUp_()}remove(r,i){let s,a;s=this;if(i(r,s.key)<0){if(!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()){s=s.moveRedLeft_()}s=s.copy(null,null,null,s.left.remove(r,i),null)}else{if(s.left.isRed_()){s=s.rotateRight_()}if(!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()){s=s.moveRedRight_()}if(i(r,s.key)===0){if(s.right.isEmpty()){return SortedMap.EMPTY_NODE}else{a=s.right.min_();s=s.copy(a.key,a.value,null,null,s.right.removeMin_())}}s=s.copy(null,null,null,null,s.right.remove(r,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let r=this;if(r.right.isRed_()&&!r.left.isRed_()){r=r.rotateLeft_()}if(r.left.isRed_()&&r.left.left.isRed_()){r=r.rotateRight_()}if(r.left.isRed_()&&r.right.isRed_()){r=r.colorFlip_()}return r}moveRedLeft_(){let r=this.colorFlip_();if(r.right.left.isRed_()){r=r.copy(null,null,null,null,r.right.rotateRight_());r=r.rotateLeft_();r=r.colorFlip_()}return r}moveRedRight_(){let r=this.colorFlip_();if(r.left.left.isRed_()){r=r.rotateRight_();r=r.colorFlip_()}return r}rotateLeft_(){const r=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,r,null)}rotateRight_(){const r=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,r)}colorFlip_(){const r=this.left.copy(null,null,!this.left.color,null,null);const i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,r,i)}checkMaxDepth_(){const r=this.check_();return Math.pow(2,r)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_()){throw new Error("Red node has red child("+this.key+","+this.value+")")}if(this.right.isRed_()){throw new Error("Right child of ("+this.key+","+this.value+") is red")}const r=this.left.check_();if(r!==this.right.check_()){throw new Error("Black depths differ")}else{return r+(this.isRed_()?0:1)}}}LLRBNode.RED=true;LLRBNode.BLACK=false;class LLRBEmptyNode{copy(r,i,s,a,l){return this}insert(r,i,s){return new LLRBNode(r,i,null)}remove(r,i){return this}count(){return 0}isEmpty(){return true}inorderTraversal(r){return false}reverseTraversal(r){return false}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return false}}class SortedMap{constructor(r,i=SortedMap.EMPTY_NODE){this.comparator_=r;this.root_=i}insert(r,i){return new SortedMap(this.comparator_,this.root_.insert(r,i,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}remove(r){return new SortedMap(this.comparator_,this.root_.remove(r,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))}get(r){let i;let s=this.root_;while(!s.isEmpty()){i=this.comparator_(r,s.key);if(i===0){return s.value}else if(i<0){s=s.left}else if(i>0){s=s.right}}return null}getPredecessorKey(r){let i,s=this.root_,a=null;while(!s.isEmpty()){i=this.comparator_(r,s.key);if(i===0){if(!s.left.isEmpty()){s=s.left;while(!s.right.isEmpty()){s=s.right}return s.key}else if(a){return a.key}else{return null}}else if(i<0){s=s.left}else if(i>0){a=s;s=s.right}}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(r){return this.root_.inorderTraversal(r)}reverseTraversal(r){return this.root_.reverseTraversal(r)}getIterator(r){return new SortedMapIterator(this.root_,null,this.comparator_,false,r)}getIteratorFrom(r,i){return new SortedMapIterator(this.root_,r,this.comparator_,false,i)}getReverseIteratorFrom(r,i){return new SortedMapIterator(this.root_,r,this.comparator_,true,i)}getReverseIterator(r){return new SortedMapIterator(this.root_,null,this.comparator_,true,r)}}SortedMap.EMPTY_NODE=new LLRBEmptyNode;function NAME_ONLY_COMPARATOR(r,i){return nameCompare(r.name,i.name)}function NAME_COMPARATOR(r,i){return nameCompare(r,i)}let xe;function setMaxNode$1(r){xe=r}const priorityHashText=function(r){if(typeof r==="number"){return"number:"+doubleToIEEE754String(r)}else{return"string:"+r}};const validatePriorityNode=function(r){if(r.isLeafNode()){const i=r.val();(0,c.hu)(typeof i==="string"||typeof i==="number"||typeof i==="object"&&(0,c.r3)(i,".sv"),"Priority must be a string or number.")}else{(0,c.hu)(r===xe||r.isEmpty(),"priority of unexpected type.")}(0,c.hu)(r===xe||r.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Re;class LeafNode{constructor(r,i=LeafNode.__childrenNodeConstructor.EMPTY_NODE){this.value_=r;this.priorityNode_=i;this.lazyHash_=null;(0,c.hu)(this.value_!==undefined&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value.");validatePriorityNode(this.priorityNode_)}static set __childrenNodeConstructor(r){Re=r}static get __childrenNodeConstructor(){return Re}isLeafNode(){return true}getPriority(){return this.priorityNode_}updatePriority(r){return new LeafNode(this.value_,r)}getImmediateChild(r){if(r===".priority"){return this.priorityNode_}else{return LeafNode.__childrenNodeConstructor.EMPTY_NODE}}getChild(r){if(pathIsEmpty(r)){return this}else if(pathGetFront(r)===".priority"){return this.priorityNode_}else{return LeafNode.__childrenNodeConstructor.EMPTY_NODE}}hasChild(){return false}getPredecessorChildName(r,i){return null}updateImmediateChild(r,i){if(r===".priority"){return this.updatePriority(i)}else if(i.isEmpty()&&r!==".priority"){return this}else{return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(r,i).updatePriority(this.priorityNode_)}}updateChild(r,i){const s=pathGetFront(r);if(s===null){return i}else if(i.isEmpty()&&s!==".priority"){return this}else{(0,c.hu)(s!==".priority"||pathGetLength(r)===1,".priority must be the last token in a path");return this.updateImmediateChild(s,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(r),i))}}isEmpty(){return false}numChildren(){return 0}forEachChild(r,i){return false}val(r){if(r&&!this.getPriority().isEmpty()){return{".value":this.getValue(),".priority":this.getPriority().val()}}else{return this.getValue()}}hash(){if(this.lazyHash_===null){let r="";if(!this.priorityNode_.isEmpty()){r+="priority:"+priorityHashText(this.priorityNode_.val())+":"}const i=typeof this.value_;r+=i+":";if(i==="number"){r+=doubleToIEEE754String(this.value_)}else{r+=this.value_}this.lazyHash_=sha1(r)}return this.lazyHash_}getValue(){return this.value_}compareTo(r){if(r===LeafNode.__childrenNodeConstructor.EMPTY_NODE){return 1}else if(r instanceof LeafNode.__childrenNodeConstructor){return-1}else{(0,c.hu)(r.isLeafNode(),"Unknown node type");return this.compareToLeafNode_(r)}}compareToLeafNode_(r){const i=typeof r.value_;const s=typeof this.value_;const a=LeafNode.VALUE_TYPE_ORDER.indexOf(i);const l=LeafNode.VALUE_TYPE_ORDER.indexOf(s);(0,c.hu)(a>=0,"Unknown leaf type: "+i);(0,c.hu)(l>=0,"Unknown leaf type: "+s);if(a===l){if(s==="object"){return 0}else{if(this.value_<r.value_){return-1}else if(this.value_===r.value_){return 0}else{return 1}}}else{return l-a}}withIndex(){return this}isIndexed(){return true}equals(r){if(r===this){return true}else if(r.isLeafNode()){const i=r;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else{return false}}}LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Ae;let Fe;function setNodeFromJSON(r){Ae=r}function setMaxNode(r){Fe=r}class PriorityIndex extends Index{compare(r,i){const s=r.node.getPriority();const a=i.node.getPriority();const l=s.compareTo(a);if(l===0){return nameCompare(r.name,i.name)}else{return l}}isDefinedOn(r){return!r.getPriority().isEmpty()}indexedValueChanged(r,i){return!r.getPriority().equals(i.getPriority())}minPost(){return NamedNode.MIN}maxPost(){return new NamedNode(w,new LeafNode("[PRIORITY-POST]",Fe))}makePost(r,i){const s=Ae(r);return new NamedNode(i,new LeafNode("[PRIORITY-POST]",s))}toString(){return".priority"}}const Oe=new PriorityIndex;const De=Math.log(2);class Base12Num{constructor(r){const logBase2=r=>parseInt(Math.log(r)/De,10);const bitMask=r=>parseInt(Array(r+1).join("1"),2);this.count=logBase2(r+1);this.current_=this.count-1;const i=bitMask(this.count);this.bits_=r+1&i}nextBitIsOne(){const r=!(this.bits_&1<<this.current_);this.current_--;return r}}const buildChildSet=function(r,i,s,a){r.sort(i);const buildBalancedTree=function(i,a){const l=a-i;let c;let h;if(l===0){return null}else if(l===1){c=r[i];h=s?s(c):c;return new LLRBNode(h,c.node,LLRBNode.BLACK,null,null)}else{const u=parseInt(l/2,10)+i;const d=buildBalancedTree(i,u);const p=buildBalancedTree(u+1,a);c=r[u];h=s?s(c):c;return new LLRBNode(h,c.node,LLRBNode.BLACK,d,p)}};const buildFrom12Array=function(i){let a=null;let l=null;let c=r.length;const buildPennant=function(i,a){const l=c-i;const h=c;c-=i;const u=buildBalancedTree(l+1,h);const d=r[l];const p=s?s(d):d;attachPennant(new LLRBNode(p,d.node,a,null,u))};const attachPennant=function(r){if(a){a.left=r;a=r}else{l=r;a=r}};for(let r=0;r<i.count;++r){const s=i.nextBitIsOne();const a=Math.pow(2,i.count-(r+1));if(s){buildPennant(a,LLRBNode.BLACK)}else{buildPennant(a,LLRBNode.BLACK);buildPennant(a,LLRBNode.RED)}}return l};const l=new Base12Num(r.length);const c=buildFrom12Array(l);return new SortedMap(a||i,c)};let Me;const Le={};class IndexMap{constructor(r,i){this.indexes_=r;this.indexSet_=i}static get Default(){(0,c.hu)(Le&&Oe,"ChildrenNode.ts has not been loaded");Me=Me||new IndexMap({".priority":Le},{".priority":Oe});return Me}get(r){const i=(0,c.DV)(this.indexes_,r);if(!i){throw new Error("No index defined for "+r)}if(i instanceof SortedMap){return i}else{return null}}hasIndex(r){return(0,c.r3)(this.indexSet_,r.toString())}addIndex(r,i){(0,c.hu)(r!==ke,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let a=false;const l=i.getIterator(NamedNode.Wrap);let h=l.getNext();while(h){a=a||r.isDefinedOn(h.node);s.push(h);h=l.getNext()}let u;if(a){u=buildChildSet(s,r.getCompare())}else{u=Le}const d=r.toString();const p=Object.assign({},this.indexSet_);p[d]=r;const f=Object.assign({},this.indexes_);f[d]=u;return new IndexMap(f,p)}addToIndexes(r,i){const s=(0,c.UI)(this.indexes_,((s,a)=>{const l=(0,c.DV)(this.indexSet_,a);(0,c.hu)(l,"Missing index implementation for "+a);if(s===Le){if(l.isDefinedOn(r.node)){const s=[];const a=i.getIterator(NamedNode.Wrap);let c=a.getNext();while(c){if(c.name!==r.name){s.push(c)}c=a.getNext()}s.push(r);return buildChildSet(s,l.getCompare())}else{return Le}}else{const a=i.get(r.name);let l=s;if(a){l=l.remove(new NamedNode(r.name,a))}return l.insert(r,r.node)}}));return new IndexMap(s,this.indexSet_)}removeFromIndexes(r,i){const s=(0,c.UI)(this.indexes_,(s=>{if(s===Le){return s}else{const a=i.get(r.name);if(a){return s.remove(new NamedNode(r.name,a))}else{return s}}}));return new IndexMap(s,this.indexSet_)}}let We;class ChildrenNode{constructor(r,i,s){this.children_=r;this.priorityNode_=i;this.indexMap_=s;this.lazyHash_=null;if(this.priorityNode_){validatePriorityNode(this.priorityNode_)}if(this.children_.isEmpty()){(0,c.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}}static get EMPTY_NODE(){return We||(We=new ChildrenNode(new SortedMap(NAME_COMPARATOR),null,IndexMap.Default))}isLeafNode(){return false}getPriority(){return this.priorityNode_||We}updatePriority(r){if(this.children_.isEmpty()){return this}else{return new ChildrenNode(this.children_,r,this.indexMap_)}}getImmediateChild(r){if(r===".priority"){return this.getPriority()}else{const i=this.children_.get(r);return i===null?We:i}}getChild(r){const i=pathGetFront(r);if(i===null){return this}return this.getImmediateChild(i).getChild(pathPopFront(r))}hasChild(r){return this.children_.get(r)!==null}updateImmediateChild(r,i){(0,c.hu)(i,"We should always be passing snapshot nodes");if(r===".priority"){return this.updatePriority(i)}else{const s=new NamedNode(r,i);let a,l;if(i.isEmpty()){a=this.children_.remove(r);l=this.indexMap_.removeFromIndexes(s,this.children_)}else{a=this.children_.insert(r,i);l=this.indexMap_.addToIndexes(s,this.children_)}const c=a.isEmpty()?We:this.priorityNode_;return new ChildrenNode(a,c,l)}}updateChild(r,i){const s=pathGetFront(r);if(s===null){return i}else{(0,c.hu)(pathGetFront(r)!==".priority"||pathGetLength(r)===1,".priority must be the last token in a path");const a=this.getImmediateChild(s).updateChild(pathPopFront(r),i);return this.updateImmediateChild(s,a)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(r){if(this.isEmpty()){return null}const i={};let s=0,a=0,l=true;this.forEachChild(Oe,((c,h)=>{i[c]=h.val(r);s++;if(l&&ChildrenNode.INTEGER_REGEXP_.test(c)){a=Math.max(a,Number(c))}else{l=false}}));if(!r&&l&&a<2*s){const r=[];for(const s in i){r[s]=i[s]}return r}else{if(r&&!this.getPriority().isEmpty()){i[".priority"]=this.getPriority().val()}return i}}hash(){if(this.lazyHash_===null){let r="";if(!this.getPriority().isEmpty()){r+="priority:"+priorityHashText(this.getPriority().val())+":"}this.forEachChild(Oe,((i,s)=>{const a=s.hash();if(a!==""){r+=":"+i+":"+a}}));this.lazyHash_=r===""?"":sha1(r)}return this.lazyHash_}getPredecessorChildName(r,i,s){const a=this.resolveIndex_(s);if(a){const s=a.getPredecessorKey(new NamedNode(r,i));return s?s.name:null}else{return this.children_.getPredecessorKey(r)}}getFirstChildName(r){const i=this.resolveIndex_(r);if(i){const r=i.minKey();return r&&r.name}else{return this.children_.minKey()}}getFirstChild(r){const i=this.getFirstChildName(r);if(i){return new NamedNode(i,this.children_.get(i))}else{return null}}getLastChildName(r){const i=this.resolveIndex_(r);if(i){const r=i.maxKey();return r&&r.name}else{return this.children_.maxKey()}}getLastChild(r){const i=this.getLastChildName(r);if(i){return new NamedNode(i,this.children_.get(i))}else{return null}}forEachChild(r,i){const s=this.resolveIndex_(r);if(s){return s.inorderTraversal((r=>i(r.name,r.node)))}else{return this.children_.inorderTraversal(i)}}getIterator(r){return this.getIteratorFrom(r.minPost(),r)}getIteratorFrom(r,i){const s=this.resolveIndex_(i);if(s){return s.getIteratorFrom(r,(r=>r))}else{const s=this.children_.getIteratorFrom(r.name,NamedNode.Wrap);let a=s.peek();while(a!=null&&i.compare(a,r)<0){s.getNext();a=s.peek()}return s}}getReverseIterator(r){return this.getReverseIteratorFrom(r.maxPost(),r)}getReverseIteratorFrom(r,i){const s=this.resolveIndex_(i);if(s){return s.getReverseIteratorFrom(r,(r=>r))}else{const s=this.children_.getReverseIteratorFrom(r.name,NamedNode.Wrap);let a=s.peek();while(a!=null&&i.compare(a,r)>0){s.getNext();a=s.peek()}return s}}compareTo(r){if(this.isEmpty()){if(r.isEmpty()){return 0}else{return-1}}else if(r.isLeafNode()||r.isEmpty()){return 1}else if(r===qe){return-1}else{return 0}}withIndex(r){if(r===ke||this.indexMap_.hasIndex(r)){return this}else{const i=this.indexMap_.addIndex(r,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,i)}}isIndexed(r){return r===ke||this.indexMap_.hasIndex(r)}equals(r){if(r===this){return true}else if(r.isLeafNode()){return false}else{const i=r;if(!this.getPriority().equals(i.getPriority())){return false}else if(this.children_.count()===i.children_.count()){const r=this.getIterator(Oe);const s=i.getIterator(Oe);let a=r.getNext();let l=s.getNext();while(a&&l){if(a.name!==l.name||!a.node.equals(l.node)){return false}a=r.getNext();l=s.getNext()}return a===null&&l===null}else{return false}}}resolveIndex_(r){if(r===ke){return null}else{return this.indexMap_.get(r.toString())}}}ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MaxNode extends ChildrenNode{constructor(){super(new SortedMap(NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap.Default)}compareTo(r){if(r===this){return 0}else{return 1}}equals(r){return r===this}getPriority(){return this}getImmediateChild(r){return ChildrenNode.EMPTY_NODE}isEmpty(){return false}}const qe=new MaxNode;Object.defineProperties(NamedNode,{MIN:{value:new NamedNode(C,ChildrenNode.EMPTY_NODE)},MAX:{value:new NamedNode(w,qe)}});KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode.__childrenNodeConstructor=ChildrenNode;setMaxNode$1(qe);setMaxNode(qe);const Ve=true;function nodeFromJSON(r,i=null){if(r===null){return ChildrenNode.EMPTY_NODE}if(typeof r==="object"&&".priority"in r){i=r[".priority"]}(0,c.hu)(i===null||typeof i==="string"||typeof i==="number"||typeof i==="object"&&".sv"in i,"Invalid priority type found: "+typeof i);if(typeof r==="object"&&".value"in r&&r[".value"]!==null){r=r[".value"]}if(typeof r!=="object"||".sv"in r){const s=r;return new LeafNode(s,nodeFromJSON(i))}if(!(r instanceof Array)&&Ve){const s=[];let a=false;const l=r;each(l,((r,i)=>{if(r.substring(0,1)!=="."){const l=nodeFromJSON(i);if(!l.isEmpty()){a=a||!l.getPriority().isEmpty();s.push(new NamedNode(r,l))}}}));if(s.length===0){return ChildrenNode.EMPTY_NODE}const c=buildChildSet(s,NAME_ONLY_COMPARATOR,(r=>r.name),NAME_COMPARATOR);if(a){const r=buildChildSet(s,Oe.getCompare());return new ChildrenNode(c,nodeFromJSON(i),new IndexMap({".priority":r},{".priority":Oe}))}else{return new ChildrenNode(c,nodeFromJSON(i),IndexMap.Default)}}else{let s=ChildrenNode.EMPTY_NODE;each(r,((i,a)=>{if((0,c.r3)(r,i)){if(i.substring(0,1)!=="."){const r=nodeFromJSON(a);if(r.isLeafNode()||!r.isEmpty()){s=s.updateImmediateChild(i,r)}}}}));return s.updatePriority(nodeFromJSON(i))}}setNodeFromJSON(nodeFromJSON);class PathIndex extends Index{constructor(r){super();this.indexPath_=r;(0,c.hu)(!pathIsEmpty(r)&&pathGetFront(r)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(r){return r.getChild(this.indexPath_)}isDefinedOn(r){return!r.getChild(this.indexPath_).isEmpty()}compare(r,i){const s=this.extractChild(r.node);const a=this.extractChild(i.node);const l=s.compareTo(a);if(l===0){return nameCompare(r.name,i.name)}else{return l}}makePost(r,i){const s=nodeFromJSON(r);const a=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,s);return new NamedNode(i,a)}maxPost(){const r=ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,qe);return new NamedNode(w,r)}toString(){return pathSlice(this.indexPath_,0).join("/")}}class ValueIndex extends Index{compare(r,i){const s=r.node.compareTo(i.node);if(s===0){return nameCompare(r.name,i.name)}else{return s}}isDefinedOn(r){return true}indexedValueChanged(r,i){return!r.equals(i)}minPost(){return NamedNode.MIN}maxPost(){return NamedNode.MAX}makePost(r,i){const s=nodeFromJSON(r);return new NamedNode(i,s)}toString(){return".value"}}const Ge=new ValueIndex;const Ue="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";const Be="-";const Qe="z";const ze=786;const He=function(){let r=0;const i=[];return function(s){const a=s===r;r=s;let l;const h=new Array(8);for(l=7;l>=0;l--){h[l]=Ue.charAt(s%64);s=Math.floor(s/64)}(0,c.hu)(s===0,"Cannot push at time == 0");let u=h.join("");if(!a){for(l=0;l<12;l++){i[l]=Math.floor(Math.random()*64)}}else{for(l=11;l>=0&&i[l]===63;l--){i[l]=0}i[l]++}for(l=0;l<12;l++){u+=Ue.charAt(i[l])}(0,c.hu)(u.length===20,"nextPushId: Length should be 20.");return u}}();const successor=function(r){if(r===""+b){return Be}const i=tryParseInt(r);if(i!=null){return""+(i+1)}const s=new Array(r.length);for(let i=0;i<s.length;i++){s[i]=r.charAt(i)}if(s.length<ze){s.push(Be);return s.join("")}let a=s.length-1;while(a>=0&&s[a]===Qe){a--}if(a===-1){return w}const l=s[a];const c=Ue.charAt(Ue.indexOf(l)+1);s[a]=c;return s.slice(0,a+1).join("")};const predecessor=function(r){if(r===""+T){return C}const i=tryParseInt(r);if(i!=null){return""+(i-1)}const s=new Array(r.length);for(let i=0;i<s.length;i++){s[i]=r.charAt(i)}if(s[s.length-1]===Be){if(s.length===1){return""+b}delete s[s.length-1];return s.join("")}s[s.length-1]=Ue.charAt(Ue.indexOf(s[s.length-1])-1);return s.join("")+Qe.repeat(ze-s.length)};function changeValue(r){return{type:"value",snapshotNode:r}}function changeChildAdded(r,i){return{type:"child_added",snapshotNode:i,childName:r}}function changeChildRemoved(r,i){return{type:"child_removed",snapshotNode:i,childName:r}}function changeChildChanged(r,i,s){return{type:"child_changed",snapshotNode:i,childName:r,oldSnap:s}}function changeChildMoved(r,i){return{type:"child_moved",snapshotNode:i,childName:r}}class IndexedFilter{constructor(r){this.index_=r}updateChild(r,i,s,a,l,h){(0,c.hu)(r.isIndexed(this.index_),"A node must be indexed if only a child is updated");const u=r.getImmediateChild(i);if(u.getChild(a).equals(s.getChild(a))){if(u.isEmpty()===s.isEmpty()){return r}}if(h!=null){if(s.isEmpty()){if(r.hasChild(i)){h.trackChildChange(changeChildRemoved(i,u))}else{(0,c.hu)(r.isLeafNode(),"A child remove without an old child only makes sense on a leaf node")}}else if(u.isEmpty()){h.trackChildChange(changeChildAdded(i,s))}else{h.trackChildChange(changeChildChanged(i,s,u))}}if(r.isLeafNode()&&s.isEmpty()){return r}else{return r.updateImmediateChild(i,s).withIndex(this.index_)}}updateFullNode(r,i,s){if(s!=null){if(!r.isLeafNode()){r.forEachChild(Oe,((r,a)=>{if(!i.hasChild(r)){s.trackChildChange(changeChildRemoved(r,a))}}))}if(!i.isLeafNode()){i.forEachChild(Oe,((i,a)=>{if(r.hasChild(i)){const l=r.getImmediateChild(i);if(!l.equals(a)){s.trackChildChange(changeChildChanged(i,a,l))}}else{s.trackChildChange(changeChildAdded(i,a))}}))}}return i.withIndex(this.index_)}updatePriority(r,i){if(r.isEmpty()){return ChildrenNode.EMPTY_NODE}else{return r.updatePriority(i)}}filtersNodes(){return false}getIndexedFilter(){return this}getIndex(){return this.index_}}class RangedFilter{constructor(r){this.indexedFilter_=new IndexedFilter(r.getIndex());this.index_=r.getIndex();this.startPost_=RangedFilter.getStartPost_(r);this.endPost_=RangedFilter.getEndPost_(r)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(r){return this.index_.compare(this.getStartPost(),r)<=0&&this.index_.compare(r,this.getEndPost())<=0}updateChild(r,i,s,a,l,c){if(!this.matches(new NamedNode(i,s))){s=ChildrenNode.EMPTY_NODE}return this.indexedFilter_.updateChild(r,i,s,a,l,c)}updateFullNode(r,i,s){if(i.isLeafNode()){i=ChildrenNode.EMPTY_NODE}let a=i.withIndex(this.index_);a=a.updatePriority(ChildrenNode.EMPTY_NODE);const l=this;i.forEachChild(Oe,((r,i)=>{if(!l.matches(new NamedNode(r,i))){a=a.updateImmediateChild(r,ChildrenNode.EMPTY_NODE)}}));return this.indexedFilter_.updateFullNode(r,a,s)}updatePriority(r,i){return r}filtersNodes(){return true}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(r){if(r.hasStart()){const i=r.getIndexStartName();return r.getIndex().makePost(r.getIndexStartValue(),i)}else{return r.getIndex().minPost()}}static getEndPost_(r){if(r.hasEnd()){const i=r.getIndexEndName();return r.getIndex().makePost(r.getIndexEndValue(),i)}else{return r.getIndex().maxPost()}}}class LimitedFilter{constructor(r){this.rangedFilter_=new RangedFilter(r);this.index_=r.getIndex();this.limit_=r.getLimit();this.reverse_=!r.isViewFromLeft()}updateChild(r,i,s,a,l,c){if(!this.rangedFilter_.matches(new NamedNode(i,s))){s=ChildrenNode.EMPTY_NODE}if(r.getImmediateChild(i).equals(s)){return r}else if(r.numChildren()<this.limit_){return this.rangedFilter_.getIndexedFilter().updateChild(r,i,s,a,l,c)}else{return this.fullLimitUpdateChild_(r,i,s,l,c)}}updateFullNode(r,i,s){let a;if(i.isLeafNode()||i.isEmpty()){a=ChildrenNode.EMPTY_NODE.withIndex(this.index_)}else{if(this.limit_*2<i.numChildren()&&i.isIndexed(this.index_)){a=ChildrenNode.EMPTY_NODE.withIndex(this.index_);let r;if(this.reverse_){r=i.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_)}else{r=i.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_)}let s=0;while(r.hasNext()&&s<this.limit_){const i=r.getNext();let l;if(this.reverse_){l=this.index_.compare(this.rangedFilter_.getStartPost(),i)<=0}else{l=this.index_.compare(i,this.rangedFilter_.getEndPost())<=0}if(l){a=a.updateImmediateChild(i.name,i.node);s++}else{break}}}else{a=i.withIndex(this.index_);a=a.updatePriority(ChildrenNode.EMPTY_NODE);let r;let s;let l;let c;if(this.reverse_){c=a.getReverseIterator(this.index_);r=this.rangedFilter_.getEndPost();s=this.rangedFilter_.getStartPost();const i=this.index_.getCompare();l=(r,s)=>i(s,r)}else{c=a.getIterator(this.index_);r=this.rangedFilter_.getStartPost();s=this.rangedFilter_.getEndPost();l=this.index_.getCompare()}let h=0;let u=false;while(c.hasNext()){const i=c.getNext();if(!u&&l(r,i)<=0){u=true}const d=u&&h<this.limit_&&l(i,s)<=0;if(d){h++}else{a=a.updateImmediateChild(i.name,ChildrenNode.EMPTY_NODE)}}}}return this.rangedFilter_.getIndexedFilter().updateFullNode(r,a,s)}updatePriority(r,i){return r}filtersNodes(){return true}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(r,i,s,a,l){let h;if(this.reverse_){const r=this.index_.getCompare();h=(i,s)=>r(s,i)}else{h=this.index_.getCompare()}const u=r;(0,c.hu)(u.numChildren()===this.limit_,"");const d=new NamedNode(i,s);const p=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_);const f=this.rangedFilter_.matches(d);if(u.hasChild(i)){const r=u.getImmediateChild(i);let c=a.getChildAfterChild(this.index_,p,this.reverse_);while(c!=null&&(c.name===i||u.hasChild(c.name))){c=a.getChildAfterChild(this.index_,c,this.reverse_)}const m=c==null?1:h(c,d);const _=f&&!s.isEmpty()&&m>=0;if(_){if(l!=null){l.trackChildChange(changeChildChanged(i,s,r))}return u.updateImmediateChild(i,s)}else{if(l!=null){l.trackChildChange(changeChildRemoved(i,r))}const s=u.updateImmediateChild(i,ChildrenNode.EMPTY_NODE);const a=c!=null&&this.rangedFilter_.matches(c);if(a){if(l!=null){l.trackChildChange(changeChildAdded(c.name,c.node))}return s.updateImmediateChild(c.name,c.node)}else{return s}}}else if(s.isEmpty()){return r}else if(f){if(h(p,d)>=0){if(l!=null){l.trackChildChange(changeChildRemoved(p.name,p.node));l.trackChildChange(changeChildAdded(i,s))}return u.updateImmediateChild(i,s).updateImmediateChild(p.name,ChildrenNode.EMPTY_NODE)}else{return r}}else{return r}}}class QueryParams{constructor(){this.limitSet_=false;this.startSet_=false;this.startNameSet_=false;this.startAfterSet_=false;this.endSet_=false;this.endNameSet_=false;this.endBeforeSet_=false;this.limit_=0;this.viewFrom_="";this.indexStartValue_=null;this.indexStartName_="";this.indexEndValue_=null;this.indexEndName_="";this.index_=Oe}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){if(this.viewFrom_===""){return this.startSet_}else{return this.viewFrom_==="l"}}getIndexStartValue(){(0,c.hu)(this.startSet_,"Only valid if start has been set");return this.indexStartValue_}getIndexStartName(){(0,c.hu)(this.startSet_,"Only valid if start has been set");if(this.startNameSet_){return this.indexStartName_}else{return C}}hasEnd(){return this.endSet_}getIndexEndValue(){(0,c.hu)(this.endSet_,"Only valid if end has been set");return this.indexEndValue_}getIndexEndName(){(0,c.hu)(this.endSet_,"Only valid if end has been set");if(this.endNameSet_){return this.indexEndName_}else{return w}}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){(0,c.hu)(this.limitSet_,"Only valid if limit has been set");return this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Oe}copy(){const r=new QueryParams;r.limitSet_=this.limitSet_;r.limit_=this.limit_;r.startSet_=this.startSet_;r.indexStartValue_=this.indexStartValue_;r.startNameSet_=this.startNameSet_;r.indexStartName_=this.indexStartName_;r.endSet_=this.endSet_;r.indexEndValue_=this.indexEndValue_;r.endNameSet_=this.endNameSet_;r.indexEndName_=this.indexEndName_;r.index_=this.index_;r.viewFrom_=this.viewFrom_;return r}}function queryParamsGetNodeFilter(r){if(r.loadsAllData()){return new IndexedFilter(r.getIndex())}else if(r.hasLimit()){return new LimitedFilter(r)}else{return new RangedFilter(r)}}function queryParamsLimitToFirst(r,i){const s=r.copy();s.limitSet_=true;s.limit_=i;s.viewFrom_="l";return s}function queryParamsLimitToLast(r,i){const s=r.copy();s.limitSet_=true;s.limit_=i;s.viewFrom_="r";return s}function queryParamsStartAt(r,i,s){const a=r.copy();a.startSet_=true;if(i===undefined){i=null}a.indexStartValue_=i;if(s!=null){a.startNameSet_=true;a.indexStartName_=s}else{a.startNameSet_=false;a.indexStartName_=""}return a}function queryParamsStartAfter(r,i,s){let a;if(r.index_===ke){if(typeof i==="string"){i=successor(i)}a=queryParamsStartAt(r,i,s)}else{let l;if(s==null){l=w}else{l=successor(s)}a=queryParamsStartAt(r,i,l)}a.startAfterSet_=true;return a}function queryParamsEndAt(r,i,s){const a=r.copy();a.endSet_=true;if(i===undefined){i=null}a.indexEndValue_=i;if(s!==undefined){a.endNameSet_=true;a.indexEndName_=s}else{a.endNameSet_=false;a.indexEndName_=""}return a}function queryParamsEndBefore(r,i,s){let a;let l;if(r.index_===ke){if(typeof i==="string"){i=predecessor(i)}l=queryParamsEndAt(r,i,s)}else{if(s==null){a=C}else{a=predecessor(s)}l=queryParamsEndAt(r,i,a)}l.endBeforeSet_=true;return l}function queryParamsOrderBy(r,i){const s=r.copy();s.index_=i;return s}function queryParamsToRestQueryStringParameters(r){const i={};if(r.isDefault()){return i}let s;if(r.index_===Oe){s="$priority"}else if(r.index_===Ge){s="$value"}else if(r.index_===ke){s="$key"}else{(0,c.hu)(r.index_ instanceof PathIndex,"Unrecognized index type!");s=r.index_.toString()}i["orderBy"]=(0,c.Pz)(s);if(r.startSet_){i["startAt"]=(0,c.Pz)(r.indexStartValue_);if(r.startNameSet_){i["startAt"]+=","+(0,c.Pz)(r.indexStartName_)}}if(r.endSet_){i["endAt"]=(0,c.Pz)(r.indexEndValue_);if(r.endNameSet_){i["endAt"]+=","+(0,c.Pz)(r.indexEndName_)}}if(r.limitSet_){if(r.isViewFromLeft()){i["limitToFirst"]=r.limit_}else{i["limitToLast"]=r.limit_}}return i}function queryParamsGetQueryObject(r){const i={};if(r.startSet_){i["sp"]=r.indexStartValue_;if(r.startNameSet_){i["sn"]=r.indexStartName_}}if(r.endSet_){i["ep"]=r.indexEndValue_;if(r.endNameSet_){i["en"]=r.indexEndName_}}if(r.limitSet_){i["l"]=r.limit_;let s=r.viewFrom_;if(s===""){if(r.isViewFromLeft()){s="l"}else{s="r"}}i["vf"]=s}if(r.index_!==Oe){i["i"]=r.index_.toString()}return i}class ReadonlyRestClient extends ServerActions{constructor(r,i,s,a){super();this.repoInfo_=r;this.onDataUpdate_=i;this.authTokenProvider_=s;this.appCheckTokenProvider_=a;this.log_=logWrapper("p:rest:");this.listens_={}}reportStats(r){throw new Error("Method not implemented.")}static getListenId_(r,i){if(i!==undefined){return"tag$"+i}else{(0,c.hu)(r._queryParams.isDefault(),"should have a tag if it's not a default query.");return r._path.toString()}}listen(r,i,s,a){const l=r._path.toString();this.log_("Listen called for "+l+" "+r._queryIdentifier);const h=ReadonlyRestClient.getListenId_(r,s);const u={};this.listens_[h]=u;const d=queryParamsToRestQueryStringParameters(r._queryParams);this.restRequest_(l+".json",d,((r,i)=>{let d=i;if(r===404){d=null;r=null}if(r===null){this.onDataUpdate_(l,d,false,s)}if((0,c.DV)(this.listens_,h)===u){let i;if(!r){i="ok"}else if(r===401){i="permission_denied"}else{i="rest_error:"+r}a(i,null)}}))}unlisten(r,i){const s=ReadonlyRestClient.getListenId_(r,i);delete this.listens_[s]}get(r){const i=queryParamsToRestQueryStringParameters(r._queryParams);const s=r._path.toString();const a=new c.BH;this.restRequest_(s+".json",i,((r,i)=>{let l=i;if(r===404){l=null;r=null}if(r===null){this.onDataUpdate_(s,l,false,null);a.resolve(l)}else{a.reject(new Error(l))}}));return a.promise}refreshAuthToken(r){}restRequest_(r,i={},s){i["format"]="export";return Promise.all([this.authTokenProvider_.getToken(false),this.appCheckTokenProvider_.getToken(false)]).then((([a,l])=>{if(a&&a.accessToken){i["auth"]=a.accessToken}if(l&&l.token){i["ac"]=l.token}const h=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+r+"?"+"ns="+this.repoInfo_.namespace+(0,c.xO)(i);this.log_("Sending REST request for "+h);const u=new XMLHttpRequest;u.onreadystatechange=()=>{if(s&&u.readyState===4){this.log_("REST Response for "+h+" received. status:",u.status,"response:",u.responseText);let r=null;if(u.status>=200&&u.status<300){try{r=(0,c.cI)(u.responseText)}catch(r){warn("Failed to parse JSON response for "+h+": "+u.responseText)}s(null,r)}else{if(u.status!==401&&u.status!==404){warn("Got unsuccessful REST response for "+h+" Status: "+u.status)}s(u.status)}s=null}};u.open("GET",h,true);u.send()}))}}class SnapshotHolder{constructor(){this.rootNode_=ChildrenNode.EMPTY_NODE}getNode(r){return this.rootNode_.getChild(r)}updateSnapshot(r,i){this.rootNode_=this.rootNode_.updateChild(r,i)}}function newSparseSnapshotTree(){return{value:null,children:new Map}}function sparseSnapshotTreeRemember(r,i,s){if(pathIsEmpty(i)){r.value=s;r.children.clear()}else if(r.value!==null){r.value=r.value.updateChild(i,s)}else{const a=pathGetFront(i);if(!r.children.has(a)){r.children.set(a,newSparseSnapshotTree())}const l=r.children.get(a);i=pathPopFront(i);sparseSnapshotTreeRemember(l,i,s)}}function sparseSnapshotTreeForget(r,i){if(pathIsEmpty(i)){r.value=null;r.children.clear();return true}else{if(r.value!==null){if(r.value.isLeafNode()){return false}else{const s=r.value;r.value=null;s.forEachChild(Oe,((i,s)=>{sparseSnapshotTreeRemember(r,new Path(i),s)}));return sparseSnapshotTreeForget(r,i)}}else if(r.children.size>0){const s=pathGetFront(i);i=pathPopFront(i);if(r.children.has(s)){const a=sparseSnapshotTreeForget(r.children.get(s),i);if(a){r.children.delete(s)}}return r.children.size===0}else{return true}}}function sparseSnapshotTreeForEachTree(r,i,s){if(r.value!==null){s(i,r.value)}else{sparseSnapshotTreeForEachChild(r,((r,a)=>{const l=new Path(i.toString()+"/"+r);sparseSnapshotTreeForEachTree(a,l,s)}))}}function sparseSnapshotTreeForEachChild(r,i){r.children.forEach(((r,s)=>{i(s,r)}))}class StatsListener{constructor(r){this.collection_=r;this.last_=null}get(){const r=this.collection_.get();const i=Object.assign({},r);if(this.last_){each(this.last_,((r,s)=>{i[r]=i[r]-s}))}this.last_=r;return i}}const je=10*1e3;const $e=30*1e3;const Ye=5*60*1e3;class StatsReporter{constructor(r,i){this.server_=i;this.statsToReport_={};this.statsListener_=new StatsListener(r);const s=je+($e-je)*Math.random();setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const r=this.statsListener_.get();const i={};let s=false;each(r,((r,a)=>{if(a>0&&(0,c.r3)(this.statsToReport_,r)){i[r]=a;s=true}}));if(s){this.server_.reportStats(i)}setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*Ye))}}var Ke;(function(r){r[r["OVERWRITE"]=0]="OVERWRITE";r[r["MERGE"]=1]="MERGE";r[r["ACK_USER_WRITE"]=2]="ACK_USER_WRITE";r[r["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(Ke||(Ke={}));function newOperationSourceUser(){return{fromUser:true,fromServer:false,queryId:null,tagged:false}}function newOperationSourceServer(){return{fromUser:false,fromServer:true,queryId:null,tagged:false}}function newOperationSourceServerTaggedQuery(r){return{fromUser:false,fromServer:true,queryId:r,tagged:true}}class AckUserWrite{constructor(r,i,s){this.path=r;this.affectedTree=i;this.revert=s;this.type=Ke.ACK_USER_WRITE;this.source=newOperationSourceUser()}operationForChild(r){if(!pathIsEmpty(this.path)){(0,c.hu)(pathGetFront(this.path)===r,"operationForChild called for unrelated child.");return new AckUserWrite(pathPopFront(this.path),this.affectedTree,this.revert)}else if(this.affectedTree.value!=null){(0,c.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths.");return this}else{const i=this.affectedTree.subtree(new Path(r));return new AckUserWrite(newEmptyPath(),i,this.revert)}}}class ListenComplete{constructor(r,i){this.source=r;this.path=i;this.type=Ke.LISTEN_COMPLETE}operationForChild(r){if(pathIsEmpty(this.path)){return new ListenComplete(this.source,newEmptyPath())}else{return new ListenComplete(this.source,pathPopFront(this.path))}}}class Overwrite{constructor(r,i,s){this.source=r;this.path=i;this.snap=s;this.type=Ke.OVERWRITE}operationForChild(r){if(pathIsEmpty(this.path)){return new Overwrite(this.source,newEmptyPath(),this.snap.getImmediateChild(r))}else{return new Overwrite(this.source,pathPopFront(this.path),this.snap)}}}class Merge{constructor(r,i,s){this.source=r;this.path=i;this.children=s;this.type=Ke.MERGE}operationForChild(r){if(pathIsEmpty(this.path)){const i=this.children.subtree(new Path(r));if(i.isEmpty()){return null}else if(i.value){return new Overwrite(this.source,newEmptyPath(),i.value)}else{return new Merge(this.source,newEmptyPath(),i)}}else{(0,c.hu)(pathGetFront(this.path)===r,"Can't get a merge for a child not on the path of the operation");return new Merge(this.source,pathPopFront(this.path),this.children)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class CacheNode{constructor(r,i,s){this.node_=r;this.fullyInitialized_=i;this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(r){if(pathIsEmpty(r)){return this.isFullyInitialized()&&!this.filtered_}const i=pathGetFront(r);return this.isCompleteForChild(i)}isCompleteForChild(r){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(r)}getNode(){return this.node_}}class EventGenerator{constructor(r){this.query_=r;this.index_=this.query_._queryParams.getIndex()}}function eventGeneratorGenerateEventsForChanges(r,i,s,a){const l=[];const c=[];i.forEach((i=>{if(i.type==="child_changed"&&r.index_.indexedValueChanged(i.oldSnap,i.snapshotNode)){c.push(changeChildMoved(i.childName,i.snapshotNode))}}));eventGeneratorGenerateEventsForType(r,l,"child_removed",i,a,s);eventGeneratorGenerateEventsForType(r,l,"child_added",i,a,s);eventGeneratorGenerateEventsForType(r,l,"child_moved",c,a,s);eventGeneratorGenerateEventsForType(r,l,"child_changed",i,a,s);eventGeneratorGenerateEventsForType(r,l,"value",i,a,s);return l}function eventGeneratorGenerateEventsForType(r,i,s,a,l,c){const h=a.filter((r=>r.type===s));h.sort(((i,s)=>eventGeneratorCompareChanges(r,i,s)));h.forEach((s=>{const a=eventGeneratorMaterializeSingleChange(r,s,c);l.forEach((l=>{if(l.respondsTo(s.type)){i.push(l.createEvent(a,r.query_))}}))}))}function eventGeneratorMaterializeSingleChange(r,i,s){if(i.type==="value"||i.type==="child_removed"){return i}else{i.prevName=s.getPredecessorChildName(i.childName,i.snapshotNode,r.index_);return i}}function eventGeneratorCompareChanges(r,i,s){if(i.childName==null||s.childName==null){throw(0,c.g5)("Should only compare child_ events.")}const a=new NamedNode(i.childName,i.snapshotNode);const l=new NamedNode(s.childName,s.snapshotNode);return r.index_.compare(a,l)}function newViewCache(r,i){return{eventCache:r,serverCache:i}}function viewCacheUpdateEventSnap(r,i,s,a){return newViewCache(new CacheNode(i,s,a),r.serverCache)}function viewCacheUpdateServerSnap(r,i,s,a){return newViewCache(r.eventCache,new CacheNode(i,s,a))}function viewCacheGetCompleteEventSnap(r){return r.eventCache.isFullyInitialized()?r.eventCache.getNode():null}function viewCacheGetCompleteServerSnap(r){return r.serverCache.isFullyInitialized()?r.serverCache.getNode():null}let Je;const EmptyChildren=()=>{if(!Je){Je=new SortedMap(stringCompare)}return Je};class ImmutableTree{constructor(r,i=EmptyChildren()){this.value=r;this.children=i}static fromObject(r){let i=new ImmutableTree(null);each(r,((r,s)=>{i=i.set(new Path(r),s)}));return i}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(r,i){if(this.value!=null&&i(this.value)){return{path:newEmptyPath(),value:this.value}}else{if(pathIsEmpty(r)){return null}else{const s=pathGetFront(r);const a=this.children.get(s);if(a!==null){const l=a.findRootMostMatchingPathAndValue(pathPopFront(r),i);if(l!=null){const r=pathChild(new Path(s),l.path);return{path:r,value:l.value}}else{return null}}else{return null}}}}findRootMostValueAndPath(r){return this.findRootMostMatchingPathAndValue(r,(()=>true))}subtree(r){if(pathIsEmpty(r)){return this}else{const i=pathGetFront(r);const s=this.children.get(i);if(s!==null){return s.subtree(pathPopFront(r))}else{return new ImmutableTree(null)}}}set(r,i){if(pathIsEmpty(r)){return new ImmutableTree(i,this.children)}else{const s=pathGetFront(r);const a=this.children.get(s)||new ImmutableTree(null);const l=a.set(pathPopFront(r),i);const c=this.children.insert(s,l);return new ImmutableTree(this.value,c)}}remove(r){if(pathIsEmpty(r)){if(this.children.isEmpty()){return new ImmutableTree(null)}else{return new ImmutableTree(null,this.children)}}else{const i=pathGetFront(r);const s=this.children.get(i);if(s){const a=s.remove(pathPopFront(r));let l;if(a.isEmpty()){l=this.children.remove(i)}else{l=this.children.insert(i,a)}if(this.value===null&&l.isEmpty()){return new ImmutableTree(null)}else{return new ImmutableTree(this.value,l)}}else{return this}}}get(r){if(pathIsEmpty(r)){return this.value}else{const i=pathGetFront(r);const s=this.children.get(i);if(s){return s.get(pathPopFront(r))}else{return null}}}setTree(r,i){if(pathIsEmpty(r)){return i}else{const s=pathGetFront(r);const a=this.children.get(s)||new ImmutableTree(null);const l=a.setTree(pathPopFront(r),i);let c;if(l.isEmpty()){c=this.children.remove(s)}else{c=this.children.insert(s,l)}return new ImmutableTree(this.value,c)}}fold(r){return this.fold_(newEmptyPath(),r)}fold_(r,i){const s={};this.children.inorderTraversal(((a,l)=>{s[a]=l.fold_(pathChild(r,a),i)}));return i(r,this.value,s)}findOnPath(r,i){return this.findOnPath_(r,newEmptyPath(),i)}findOnPath_(r,i,s){const a=this.value?s(i,this.value):false;if(a){return a}else{if(pathIsEmpty(r)){return null}else{const a=pathGetFront(r);const l=this.children.get(a);if(l){return l.findOnPath_(pathPopFront(r),pathChild(i,a),s)}else{return null}}}}foreachOnPath(r,i){return this.foreachOnPath_(r,newEmptyPath(),i)}foreachOnPath_(r,i,s){if(pathIsEmpty(r)){return this}else{if(this.value){s(i,this.value)}const a=pathGetFront(r);const l=this.children.get(a);if(l){return l.foreachOnPath_(pathPopFront(r),pathChild(i,a),s)}else{return new ImmutableTree(null)}}}foreach(r){this.foreach_(newEmptyPath(),r)}foreach_(r,i){this.children.inorderTraversal(((s,a)=>{a.foreach_(pathChild(r,s),i)}));if(this.value){i(r,this.value)}}foreachChild(r){this.children.inorderTraversal(((i,s)=>{if(s.value){r(i,s.value)}}))}}class CompoundWrite{constructor(r){this.writeTree_=r}static empty(){return new CompoundWrite(new ImmutableTree(null))}}function compoundWriteAddWrite(r,i,s){if(pathIsEmpty(i)){return new CompoundWrite(new ImmutableTree(s))}else{const a=r.writeTree_.findRootMostValueAndPath(i);if(a!=null){const l=a.path;let c=a.value;const h=newRelativePath(l,i);c=c.updateChild(h,s);return new CompoundWrite(r.writeTree_.set(l,c))}else{const a=new ImmutableTree(s);const l=r.writeTree_.setTree(i,a);return new CompoundWrite(l)}}}function compoundWriteAddWrites(r,i,s){let a=r;each(s,((r,s)=>{a=compoundWriteAddWrite(a,pathChild(i,r),s)}));return a}function compoundWriteRemoveWrite(r,i){if(pathIsEmpty(i)){return CompoundWrite.empty()}else{const s=r.writeTree_.setTree(i,new ImmutableTree(null));return new CompoundWrite(s)}}function compoundWriteHasCompleteWrite(r,i){return compoundWriteGetCompleteNode(r,i)!=null}function compoundWriteGetCompleteNode(r,i){const s=r.writeTree_.findRootMostValueAndPath(i);if(s!=null){return r.writeTree_.get(s.path).getChild(newRelativePath(s.path,i))}else{return null}}function compoundWriteGetCompleteChildren(r){const i=[];const s=r.writeTree_.value;if(s!=null){if(!s.isLeafNode()){s.forEachChild(Oe,((r,s)=>{i.push(new NamedNode(r,s))}))}}else{r.writeTree_.children.inorderTraversal(((r,s)=>{if(s.value!=null){i.push(new NamedNode(r,s.value))}}))}return i}function compoundWriteChildCompoundWrite(r,i){if(pathIsEmpty(i)){return r}else{const s=compoundWriteGetCompleteNode(r,i);if(s!=null){return new CompoundWrite(new ImmutableTree(s))}else{return new CompoundWrite(r.writeTree_.subtree(i))}}}function compoundWriteIsEmpty(r){return r.writeTree_.isEmpty()}function compoundWriteApply(r,i){return applySubtreeWrite(newEmptyPath(),r.writeTree_,i)}function applySubtreeWrite(r,i,s){if(i.value!=null){return s.updateChild(r,i.value)}else{let a=null;i.children.inorderTraversal(((i,l)=>{if(i===".priority"){(0,c.hu)(l.value!==null,"Priority writes must always be leaf nodes");a=l.value}else{s=applySubtreeWrite(pathChild(r,i),l,s)}}));if(!s.getChild(r).isEmpty()&&a!==null){s=s.updateChild(pathChild(r,".priority"),a)}return s}}function writeTreeChildWrites(r,i){return newWriteTreeRef(i,r)}function writeTreeAddOverwrite(r,i,s,a,l){(0,c.hu)(a>r.lastWriteId,"Stacking an older write on top of newer ones");if(l===undefined){l=true}r.allWrites.push({path:i,snap:s,writeId:a,visible:l});if(l){r.visibleWrites=compoundWriteAddWrite(r.visibleWrites,i,s)}r.lastWriteId=a}function writeTreeAddMerge(r,i,s,a){assert(a>r.lastWriteId,"Stacking an older merge on top of newer ones");r.allWrites.push({path:i,children:s,writeId:a,visible:true});r.visibleWrites=compoundWriteAddWrites(r.visibleWrites,i,s);r.lastWriteId=a}function writeTreeGetWrite(r,i){for(let s=0;s<r.allWrites.length;s++){const a=r.allWrites[s];if(a.writeId===i){return a}}return null}function writeTreeRemoveWrite(r,i){const s=r.allWrites.findIndex((r=>r.writeId===i));(0,c.hu)(s>=0,"removeWrite called with nonexistent writeId.");const a=r.allWrites[s];r.allWrites.splice(s,1);let l=a.visible;let h=false;let u=r.allWrites.length-1;while(l&&u>=0){const i=r.allWrites[u];if(i.visible){if(u>=s&&writeTreeRecordContainsPath_(i,a.path)){l=false}else if(pathContains(a.path,i.path)){h=true}}u--}if(!l){return false}else if(h){writeTreeResetTree_(r);return true}else{if(a.snap){r.visibleWrites=compoundWriteRemoveWrite(r.visibleWrites,a.path)}else{const i=a.children;each(i,(i=>{r.visibleWrites=compoundWriteRemoveWrite(r.visibleWrites,pathChild(a.path,i))}))}return true}}function writeTreeRecordContainsPath_(r,i){if(r.snap){return pathContains(r.path,i)}else{for(const s in r.children){if(r.children.hasOwnProperty(s)&&pathContains(pathChild(r.path,s),i)){return true}}return false}}function writeTreeResetTree_(r){r.visibleWrites=writeTreeLayerTree_(r.allWrites,writeTreeDefaultFilter_,newEmptyPath());if(r.allWrites.length>0){r.lastWriteId=r.allWrites[r.allWrites.length-1].writeId}else{r.lastWriteId=-1}}function writeTreeDefaultFilter_(r){return r.visible}function writeTreeLayerTree_(r,i,s){let a=CompoundWrite.empty();for(let l=0;l<r.length;++l){const h=r[l];if(i(h)){const r=h.path;let i;if(h.snap){if(pathContains(s,r)){i=newRelativePath(s,r);a=compoundWriteAddWrite(a,i,h.snap)}else if(pathContains(r,s)){i=newRelativePath(r,s);a=compoundWriteAddWrite(a,newEmptyPath(),h.snap.getChild(i))}else;}else if(h.children){if(pathContains(s,r)){i=newRelativePath(s,r);a=compoundWriteAddWrites(a,i,h.children)}else if(pathContains(r,s)){i=newRelativePath(r,s);if(pathIsEmpty(i)){a=compoundWriteAddWrites(a,newEmptyPath(),h.children)}else{const r=(0,c.DV)(h.children,pathGetFront(i));if(r){const s=r.getChild(pathPopFront(i));a=compoundWriteAddWrite(a,newEmptyPath(),s)}}}else;}else{throw(0,c.g5)("WriteRecord should have .snap or .children")}}}return a}function writeTreeCalcCompleteEventCache(r,i,s,a,l){if(!a&&!l){const a=compoundWriteGetCompleteNode(r.visibleWrites,i);if(a!=null){return a}else{const a=compoundWriteChildCompoundWrite(r.visibleWrites,i);if(compoundWriteIsEmpty(a)){return s}else if(s==null&&!compoundWriteHasCompleteWrite(a,newEmptyPath())){return null}else{const r=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(a,r)}}}else{const c=compoundWriteChildCompoundWrite(r.visibleWrites,i);if(!l&&compoundWriteIsEmpty(c)){return s}else{if(!l&&s==null&&!compoundWriteHasCompleteWrite(c,newEmptyPath())){return null}else{const filter=function(r){return(r.visible||l)&&(!a||!~a.indexOf(r.writeId))&&(pathContains(r.path,i)||pathContains(i,r.path))};const c=writeTreeLayerTree_(r.allWrites,filter,i);const h=s||ChildrenNode.EMPTY_NODE;return compoundWriteApply(c,h)}}}}function writeTreeCalcCompleteEventChildren(r,i,s){let a=ChildrenNode.EMPTY_NODE;const l=compoundWriteGetCompleteNode(r.visibleWrites,i);if(l){if(!l.isLeafNode()){l.forEachChild(Oe,((r,i)=>{a=a.updateImmediateChild(r,i)}))}return a}else if(s){const l=compoundWriteChildCompoundWrite(r.visibleWrites,i);s.forEachChild(Oe,((r,i)=>{const s=compoundWriteApply(compoundWriteChildCompoundWrite(l,new Path(r)),i);a=a.updateImmediateChild(r,s)}));compoundWriteGetCompleteChildren(l).forEach((r=>{a=a.updateImmediateChild(r.name,r.node)}));return a}else{const s=compoundWriteChildCompoundWrite(r.visibleWrites,i);compoundWriteGetCompleteChildren(s).forEach((r=>{a=a.updateImmediateChild(r.name,r.node)}));return a}}function writeTreeCalcEventCacheAfterServerOverwrite(r,i,s,a,l){(0,c.hu)(a||l,"Either existingEventSnap or existingServerSnap must exist");const h=pathChild(i,s);if(compoundWriteHasCompleteWrite(r.visibleWrites,h)){return null}else{const i=compoundWriteChildCompoundWrite(r.visibleWrites,h);if(compoundWriteIsEmpty(i)){return l.getChild(s)}else{return compoundWriteApply(i,l.getChild(s))}}}function writeTreeCalcCompleteChild(r,i,s,a){const l=pathChild(i,s);const c=compoundWriteGetCompleteNode(r.visibleWrites,l);if(c!=null){return c}else{if(a.isCompleteForChild(s)){const i=compoundWriteChildCompoundWrite(r.visibleWrites,l);return compoundWriteApply(i,a.getNode().getImmediateChild(s))}else{return null}}}function writeTreeShadowingWrite(r,i){return compoundWriteGetCompleteNode(r.visibleWrites,i)}function writeTreeCalcIndexedSlice(r,i,s,a,l,c,h){let u;const d=compoundWriteChildCompoundWrite(r.visibleWrites,i);const p=compoundWriteGetCompleteNode(d,newEmptyPath());if(p!=null){u=p}else if(s!=null){u=compoundWriteApply(d,s)}else{return[]}u=u.withIndex(h);if(!u.isEmpty()&&!u.isLeafNode()){const r=[];const i=h.getCompare();const s=c?u.getReverseIteratorFrom(a,h):u.getIteratorFrom(a,h);let d=s.getNext();while(d&&r.length<l){if(i(d,a)!==0){r.push(d)}d=s.getNext()}return r}else{return[]}}function newWriteTree(){return{visibleWrites:CompoundWrite.empty(),allWrites:[],lastWriteId:-1}}function writeTreeRefCalcCompleteEventCache(r,i,s,a){return writeTreeCalcCompleteEventCache(r.writeTree,r.treePath,i,s,a)}function writeTreeRefCalcCompleteEventChildren(r,i){return writeTreeCalcCompleteEventChildren(r.writeTree,r.treePath,i)}function writeTreeRefCalcEventCacheAfterServerOverwrite(r,i,s,a){return writeTreeCalcEventCacheAfterServerOverwrite(r.writeTree,r.treePath,i,s,a)}function writeTreeRefShadowingWrite(r,i){return writeTreeShadowingWrite(r.writeTree,pathChild(r.treePath,i))}function writeTreeRefCalcIndexedSlice(r,i,s,a,l,c){return writeTreeCalcIndexedSlice(r.writeTree,r.treePath,i,s,a,l,c)}function writeTreeRefCalcCompleteChild(r,i,s){return writeTreeCalcCompleteChild(r.writeTree,r.treePath,i,s)}function writeTreeRefChild(r,i){return newWriteTreeRef(pathChild(r.treePath,i),r.writeTree)}function newWriteTreeRef(r,i){return{treePath:r,writeTree:i}}class ChildChangeAccumulator{constructor(){this.changeMap=new Map}trackChildChange(r){const i=r.type;const s=r.childName;(0,c.hu)(i==="child_added"||i==="child_changed"||i==="child_removed","Only child changes supported for tracking");(0,c.hu)(s!==".priority","Only non-priority child changes can be tracked.");const a=this.changeMap.get(s);if(a){const l=a.type;if(i==="child_added"&&l==="child_removed"){this.changeMap.set(s,changeChildChanged(s,r.snapshotNode,a.snapshotNode))}else if(i==="child_removed"&&l==="child_added"){this.changeMap.delete(s)}else if(i==="child_removed"&&l==="child_changed"){this.changeMap.set(s,changeChildRemoved(s,a.oldSnap))}else if(i==="child_changed"&&l==="child_added"){this.changeMap.set(s,changeChildAdded(s,r.snapshotNode))}else if(i==="child_changed"&&l==="child_changed"){this.changeMap.set(s,changeChildChanged(s,r.snapshotNode,a.oldSnap))}else{throw(0,c.g5)("Illegal combination of changes: "+r+" occurred after "+a)}}else{this.changeMap.set(s,r)}}getChanges(){return Array.from(this.changeMap.values())}}class NoCompleteChildSource_{getCompleteChild(r){return null}getChildAfterChild(r,i,s){return null}}const Xe=new NoCompleteChildSource_;class WriteTreeCompleteChildSource{constructor(r,i,s=null){this.writes_=r;this.viewCache_=i;this.optCompleteServerCache_=s}getCompleteChild(r){const i=this.viewCache_.eventCache;if(i.isCompleteForChild(r)){return i.getNode().getImmediateChild(r)}else{const i=this.optCompleteServerCache_!=null?new CacheNode(this.optCompleteServerCache_,true,false):this.viewCache_.serverCache;return writeTreeRefCalcCompleteChild(this.writes_,r,i)}}getChildAfterChild(r,i,s){const a=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:viewCacheGetCompleteServerSnap(this.viewCache_);const l=writeTreeRefCalcIndexedSlice(this.writes_,a,i,1,s,r);if(l.length===0){return null}else{return l[0]}}}function newViewProcessor(r){return{filter:r}}function viewProcessorAssertIndexed(r,i){(0,c.hu)(i.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed");(0,c.hu)(i.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed")}function viewProcessorApplyOperation(r,i,s,a,l){const h=new ChildChangeAccumulator;let u,d;if(s.type===Ke.OVERWRITE){const p=s;if(p.source.fromUser){u=viewProcessorApplyUserOverwrite(r,i,p.path,p.snap,a,l,h)}else{(0,c.hu)(p.source.fromServer,"Unknown source.");d=p.source.tagged||i.serverCache.isFiltered()&&!pathIsEmpty(p.path);u=viewProcessorApplyServerOverwrite(r,i,p.path,p.snap,a,l,d,h)}}else if(s.type===Ke.MERGE){const p=s;if(p.source.fromUser){u=viewProcessorApplyUserMerge(r,i,p.path,p.children,a,l,h)}else{(0,c.hu)(p.source.fromServer,"Unknown source.");d=p.source.tagged||i.serverCache.isFiltered();u=viewProcessorApplyServerMerge(r,i,p.path,p.children,a,l,d,h)}}else if(s.type===Ke.ACK_USER_WRITE){const c=s;if(!c.revert){u=viewProcessorAckUserWrite(r,i,c.path,c.affectedTree,a,l,h)}else{u=viewProcessorRevertUserWrite(r,i,c.path,a,l,h)}}else if(s.type===Ke.LISTEN_COMPLETE){u=viewProcessorListenComplete(r,i,s.path,a,h)}else{throw(0,c.g5)("Unknown operation type: "+s.type)}const p=h.getChanges();viewProcessorMaybeAddValueEvent(i,u,p);return{viewCache:u,changes:p}}function viewProcessorMaybeAddValueEvent(r,i,s){const a=i.eventCache;if(a.isFullyInitialized()){const l=a.getNode().isLeafNode()||a.getNode().isEmpty();const c=viewCacheGetCompleteEventSnap(r);if(s.length>0||!r.eventCache.isFullyInitialized()||l&&!a.getNode().equals(c)||!a.getNode().getPriority().equals(c.getPriority())){s.push(changeValue(viewCacheGetCompleteEventSnap(i)))}}}function viewProcessorGenerateEventCacheAfterServerEvent(r,i,s,a,l,h){const u=i.eventCache;if(writeTreeRefShadowingWrite(a,s)!=null){return i}else{let d,p;if(pathIsEmpty(s)){(0,c.hu)(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data");if(i.serverCache.isFiltered()){const s=viewCacheGetCompleteServerSnap(i);const l=s instanceof ChildrenNode?s:ChildrenNode.EMPTY_NODE;const c=writeTreeRefCalcCompleteEventChildren(a,l);d=r.filter.updateFullNode(i.eventCache.getNode(),c,h)}else{const s=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));d=r.filter.updateFullNode(i.eventCache.getNode(),s,h)}}else{const f=pathGetFront(s);if(f===".priority"){(0,c.hu)(pathGetLength(s)===1,"Can't have a priority with additional path components");const l=u.getNode();p=i.serverCache.getNode();const h=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,l,p);if(h!=null){d=r.filter.updatePriority(l,h)}else{d=u.getNode()}}else{const c=pathPopFront(s);let m;if(u.isCompleteForChild(f)){p=i.serverCache.getNode();const r=writeTreeRefCalcEventCacheAfterServerOverwrite(a,s,u.getNode(),p);if(r!=null){m=u.getNode().getImmediateChild(f).updateChild(c,r)}else{m=u.getNode().getImmediateChild(f)}}else{m=writeTreeRefCalcCompleteChild(a,f,i.serverCache)}if(m!=null){d=r.filter.updateChild(u.getNode(),f,m,c,l,h)}else{d=u.getNode()}}}return viewCacheUpdateEventSnap(i,d,u.isFullyInitialized()||pathIsEmpty(s),r.filter.filtersNodes())}}function viewProcessorApplyServerOverwrite(r,i,s,a,l,c,h,u){const d=i.serverCache;let p;const f=h?r.filter:r.filter.getIndexedFilter();if(pathIsEmpty(s)){p=f.updateFullNode(d.getNode(),a,null)}else if(f.filtersNodes()&&!d.isFiltered()){const r=d.getNode().updateChild(s,a);p=f.updateFullNode(d.getNode(),r,null)}else{const r=pathGetFront(s);if(!d.isCompleteForPath(s)&&pathGetLength(s)>1){return i}const l=pathPopFront(s);const c=d.getNode().getImmediateChild(r);const h=c.updateChild(l,a);if(r===".priority"){p=f.updatePriority(d.getNode(),h)}else{p=f.updateChild(d.getNode(),r,h,l,Xe,null)}}const m=viewCacheUpdateServerSnap(i,p,d.isFullyInitialized()||pathIsEmpty(s),f.filtersNodes());const _=new WriteTreeCompleteChildSource(l,m,c);return viewProcessorGenerateEventCacheAfterServerEvent(r,m,s,l,_,u)}function viewProcessorApplyUserOverwrite(r,i,s,a,l,c,h){const u=i.eventCache;let d,p;const f=new WriteTreeCompleteChildSource(l,i,c);if(pathIsEmpty(s)){p=r.filter.updateFullNode(i.eventCache.getNode(),a,h);d=viewCacheUpdateEventSnap(i,p,true,r.filter.filtersNodes())}else{const l=pathGetFront(s);if(l===".priority"){p=r.filter.updatePriority(i.eventCache.getNode(),a);d=viewCacheUpdateEventSnap(i,p,u.isFullyInitialized(),u.isFiltered())}else{const c=pathPopFront(s);const p=u.getNode().getImmediateChild(l);let m;if(pathIsEmpty(c)){m=a}else{const r=f.getCompleteChild(l);if(r!=null){if(pathGetBack(c)===".priority"&&r.getChild(pathParent(c)).isEmpty()){m=r}else{m=r.updateChild(c,a)}}else{m=ChildrenNode.EMPTY_NODE}}if(!p.equals(m)){const s=r.filter.updateChild(u.getNode(),l,m,c,f,h);d=viewCacheUpdateEventSnap(i,s,u.isFullyInitialized(),r.filter.filtersNodes())}else{d=i}}}return d}function viewProcessorCacheHasChild(r,i){return r.eventCache.isCompleteForChild(i)}function viewProcessorApplyUserMerge(r,i,s,a,l,c,h){let u=i;a.foreach(((a,d)=>{const p=pathChild(s,a);if(viewProcessorCacheHasChild(i,pathGetFront(p))){u=viewProcessorApplyUserOverwrite(r,u,p,d,l,c,h)}}));a.foreach(((a,d)=>{const p=pathChild(s,a);if(!viewProcessorCacheHasChild(i,pathGetFront(p))){u=viewProcessorApplyUserOverwrite(r,u,p,d,l,c,h)}}));return u}function viewProcessorApplyMerge(r,i,s){s.foreach(((r,s)=>{i=i.updateChild(r,s)}));return i}function viewProcessorApplyServerMerge(r,i,s,a,l,c,h,u){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized()){return i}let d=i;let p;if(pathIsEmpty(s)){p=a}else{p=new ImmutableTree(null).setTree(s,a)}const f=i.serverCache.getNode();p.children.inorderTraversal(((s,a)=>{if(f.hasChild(s)){const p=i.serverCache.getNode().getImmediateChild(s);const f=viewProcessorApplyMerge(r,p,a);d=viewProcessorApplyServerOverwrite(r,d,new Path(s),f,l,c,h,u)}}));p.children.inorderTraversal(((s,a)=>{const p=!i.serverCache.isCompleteForChild(s)&&a.value===undefined;if(!f.hasChild(s)&&!p){const p=i.serverCache.getNode().getImmediateChild(s);const f=viewProcessorApplyMerge(r,p,a);d=viewProcessorApplyServerOverwrite(r,d,new Path(s),f,l,c,h,u)}}));return d}function viewProcessorAckUserWrite(r,i,s,a,l,c,h){if(writeTreeRefShadowingWrite(l,s)!=null){return i}const u=i.serverCache.isFiltered();const d=i.serverCache;if(a.value!=null){if(pathIsEmpty(s)&&d.isFullyInitialized()||d.isCompleteForPath(s)){return viewProcessorApplyServerOverwrite(r,i,s,d.getNode().getChild(s),l,c,u,h)}else if(pathIsEmpty(s)){let a=new ImmutableTree(null);d.getNode().forEachChild(ke,((r,i)=>{a=a.set(new Path(r),i)}));return viewProcessorApplyServerMerge(r,i,s,a,l,c,u,h)}else{return i}}else{let p=new ImmutableTree(null);a.foreach(((r,i)=>{const a=pathChild(s,r);if(d.isCompleteForPath(a)){p=p.set(r,d.getNode().getChild(a))}}));return viewProcessorApplyServerMerge(r,i,s,p,l,c,u,h)}}function viewProcessorListenComplete(r,i,s,a,l){const c=i.serverCache;const h=viewCacheUpdateServerSnap(i,c.getNode(),c.isFullyInitialized()||pathIsEmpty(s),c.isFiltered());return viewProcessorGenerateEventCacheAfterServerEvent(r,h,s,a,Xe,l)}function viewProcessorRevertUserWrite(r,i,s,a,l,h){let u;if(writeTreeRefShadowingWrite(a,s)!=null){return i}else{const d=new WriteTreeCompleteChildSource(a,i,l);const p=i.eventCache.getNode();let f;if(pathIsEmpty(s)||pathGetFront(s)===".priority"){let s;if(i.serverCache.isFullyInitialized()){s=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i))}else{const r=i.serverCache.getNode();(0,c.hu)(r instanceof ChildrenNode,"serverChildren would be complete if leaf node");s=writeTreeRefCalcCompleteEventChildren(a,r)}s=s;f=r.filter.updateFullNode(p,s,h)}else{const l=pathGetFront(s);let c=writeTreeRefCalcCompleteChild(a,l,i.serverCache);if(c==null&&i.serverCache.isCompleteForChild(l)){c=p.getImmediateChild(l)}if(c!=null){f=r.filter.updateChild(p,l,c,pathPopFront(s),d,h)}else if(i.eventCache.getNode().hasChild(l)){f=r.filter.updateChild(p,l,ChildrenNode.EMPTY_NODE,pathPopFront(s),d,h)}else{f=p}if(f.isEmpty()&&i.serverCache.isFullyInitialized()){u=writeTreeRefCalcCompleteEventCache(a,viewCacheGetCompleteServerSnap(i));if(u.isLeafNode()){f=r.filter.updateFullNode(f,u,h)}}}u=i.serverCache.isFullyInitialized()||writeTreeRefShadowingWrite(a,newEmptyPath())!=null;return viewCacheUpdateEventSnap(i,f,u,r.filter.filtersNodes())}}class View{constructor(r,i){this.query_=r;this.eventRegistrations_=[];const s=this.query_._queryParams;const a=new IndexedFilter(s.getIndex());const l=queryParamsGetNodeFilter(s);this.processor_=newViewProcessor(l);const c=i.serverCache;const h=i.eventCache;const u=a.updateFullNode(ChildrenNode.EMPTY_NODE,c.getNode(),null);const d=l.updateFullNode(ChildrenNode.EMPTY_NODE,h.getNode(),null);const p=new CacheNode(u,c.isFullyInitialized(),a.filtersNodes());const f=new CacheNode(d,h.isFullyInitialized(),l.filtersNodes());this.viewCache_=newViewCache(f,p);this.eventGenerator_=new EventGenerator(this.query_)}get query(){return this.query_}}function viewGetServerCache(r){return r.viewCache_.serverCache.getNode()}function viewGetCompleteNode(r){return viewCacheGetCompleteEventSnap(r.viewCache_)}function viewGetCompleteServerCache(r,i){const s=viewCacheGetCompleteServerSnap(r.viewCache_);if(s){if(r.query._queryParams.loadsAllData()||!pathIsEmpty(i)&&!s.getImmediateChild(pathGetFront(i)).isEmpty()){return s.getChild(i)}}return null}function viewIsEmpty(r){return r.eventRegistrations_.length===0}function viewAddEventRegistration(r,i){r.eventRegistrations_.push(i)}function viewRemoveEventRegistration(r,i,s){const a=[];if(s){assert(i==null,"A cancel should cancel all event registrations.");const l=r.query._path;r.eventRegistrations_.forEach((r=>{const i=r.createCancelEvent(s,l);if(i){a.push(i)}}))}if(i){let s=[];for(let a=0;a<r.eventRegistrations_.length;++a){const l=r.eventRegistrations_[a];if(!l.matches(i)){s.push(l)}else if(i.hasAnyCallback()){s=s.concat(r.eventRegistrations_.slice(a+1));break}}r.eventRegistrations_=s}else{r.eventRegistrations_=[]}return a}function viewApplyOperation(r,i,s,a){if(i.type===Ke.MERGE&&i.source.queryId!==null){(0,c.hu)(viewCacheGetCompleteServerSnap(r.viewCache_),"We should always have a full cache before handling merges");(0,c.hu)(viewCacheGetCompleteEventSnap(r.viewCache_),"Missing event cache, even though we have a server cache")}const l=r.viewCache_;const h=viewProcessorApplyOperation(r.processor_,l,i,s,a);viewProcessorAssertIndexed(r.processor_,h.viewCache);(0,c.hu)(h.viewCache.serverCache.isFullyInitialized()||!l.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back");r.viewCache_=h.viewCache;return viewGenerateEventsForChanges_(r,h.changes,h.viewCache.eventCache.getNode(),null)}function viewGetInitialEvents(r,i){const s=r.viewCache_.eventCache;const a=[];if(!s.getNode().isLeafNode()){const r=s.getNode();r.forEachChild(Oe,((r,i)=>{a.push(changeChildAdded(r,i))}))}if(s.isFullyInitialized()){a.push(changeValue(s.getNode()))}return viewGenerateEventsForChanges_(r,a,s.getNode(),i)}function viewGenerateEventsForChanges_(r,i,s,a){const l=a?[a]:r.eventRegistrations_;return eventGeneratorGenerateEventsForChanges(r.eventGenerator_,i,s,l)}let Ze;class SyncPoint{constructor(){this.views=new Map}}function syncPointSetReferenceConstructor(r){(0,c.hu)(!Ze,"__referenceConstructor has already been defined");Ze=r}function syncPointGetReferenceConstructor(){assert(Ze,"Reference.ts has not been loaded");return Ze}function syncPointIsEmpty(r){return r.views.size===0}function syncPointApplyOperation(r,i,s,a){const l=i.source.queryId;if(l!==null){const h=r.views.get(l);(0,c.hu)(h!=null,"SyncTree gave us an op for an invalid query.");return viewApplyOperation(h,i,s,a)}else{let l=[];for(const c of r.views.values()){l=l.concat(viewApplyOperation(c,i,s,a))}return l}}function syncPointGetView(r,i,s,a,l){const c=i._queryIdentifier;const h=r.views.get(c);if(!h){let r=writeTreeRefCalcCompleteEventCache(s,l?a:null);let c=false;if(r){c=true}else if(a instanceof ChildrenNode){r=writeTreeRefCalcCompleteEventChildren(s,a);c=false}else{r=ChildrenNode.EMPTY_NODE;c=false}const h=newViewCache(new CacheNode(r,c,false),new CacheNode(a,l,false));return new View(i,h)}return h}function syncPointAddEventRegistration(r,i,s,a,l,c){const h=syncPointGetView(r,i,a,l,c);if(!r.views.has(i._queryIdentifier)){r.views.set(i._queryIdentifier,h)}viewAddEventRegistration(h,s);return viewGetInitialEvents(h,s)}function syncPointRemoveEventRegistration(r,i,s,a){const l=i._queryIdentifier;const c=[];let h=[];const u=syncPointHasCompleteView(r);if(l==="default"){for(const[i,l]of r.views.entries()){h=h.concat(viewRemoveEventRegistration(l,s,a));if(viewIsEmpty(l)){r.views.delete(i);if(!l.query._queryParams.loadsAllData()){c.push(l.query)}}}}else{const i=r.views.get(l);if(i){h=h.concat(viewRemoveEventRegistration(i,s,a));if(viewIsEmpty(i)){r.views.delete(l);if(!i.query._queryParams.loadsAllData()){c.push(i.query)}}}}if(u&&!syncPointHasCompleteView(r)){c.push(new(syncPointGetReferenceConstructor())(i._repo,i._path))}return{removed:c,events:h}}function syncPointGetQueryViews(r){const i=[];for(const s of r.views.values()){if(!s.query._queryParams.loadsAllData()){i.push(s)}}return i}function syncPointGetCompleteServerCache(r,i){let s=null;for(const a of r.views.values()){s=s||viewGetCompleteServerCache(a,i)}return s}function syncPointViewForQuery(r,i){const s=i._queryParams;if(s.loadsAllData()){return syncPointGetCompleteView(r)}else{const s=i._queryIdentifier;return r.views.get(s)}}function syncPointViewExistsForQuery(r,i){return syncPointViewForQuery(r,i)!=null}function syncPointHasCompleteView(r){return syncPointGetCompleteView(r)!=null}function syncPointGetCompleteView(r){for(const i of r.views.values()){if(i.query._queryParams.loadsAllData()){return i}}return null}let et;function syncTreeSetReferenceConstructor(r){(0,c.hu)(!et,"__referenceConstructor has already been defined");et=r}function syncTreeGetReferenceConstructor(){assert(et,"Reference.ts has not been loaded");return et}let tt=1;class SyncTree{constructor(r){this.listenProvider_=r;this.syncPointTree_=new ImmutableTree(null);this.pendingWriteTree_=newWriteTree();this.tagToQueryMap=new Map;this.queryToTagMap=new Map}}function syncTreeApplyUserOverwrite(r,i,s,a,l){writeTreeAddOverwrite(r.pendingWriteTree_,i,s,a,l);if(!l){return[]}else{return syncTreeApplyOperationToSyncPoints_(r,new Overwrite(newOperationSourceUser(),i,s))}}function syncTreeApplyUserMerge(r,i,s,a){writeTreeAddMerge(r.pendingWriteTree_,i,s,a);const l=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(r,new Merge(newOperationSourceUser(),i,l))}function syncTreeAckUserWrite(r,i,s=false){const a=writeTreeGetWrite(r.pendingWriteTree_,i);const l=writeTreeRemoveWrite(r.pendingWriteTree_,i);if(!l){return[]}else{let i=new ImmutableTree(null);if(a.snap!=null){i=i.set(newEmptyPath(),true)}else{each(a.children,(r=>{i=i.set(new Path(r),true)}))}return syncTreeApplyOperationToSyncPoints_(r,new AckUserWrite(a.path,i,s))}}function syncTreeApplyServerOverwrite(r,i,s){return syncTreeApplyOperationToSyncPoints_(r,new Overwrite(newOperationSourceServer(),i,s))}function syncTreeApplyServerMerge(r,i,s){const a=ImmutableTree.fromObject(s);return syncTreeApplyOperationToSyncPoints_(r,new Merge(newOperationSourceServer(),i,a))}function syncTreeApplyListenComplete(r,i){return syncTreeApplyOperationToSyncPoints_(r,new ListenComplete(newOperationSourceServer(),i))}function syncTreeApplyTaggedListenComplete(r,i,s){const a=syncTreeQueryKeyForTag_(r,s);if(a){const s=syncTreeParseQueryKey_(a);const l=s.path,c=s.queryId;const h=newRelativePath(l,i);const u=new ListenComplete(newOperationSourceServerTaggedQuery(c),h);return syncTreeApplyTaggedOperation_(r,l,u)}else{return[]}}function syncTreeRemoveEventRegistration(r,i,s,a){const l=i._path;const c=r.syncPointTree_.get(l);let h=[];if(c&&(i._queryIdentifier==="default"||syncPointViewExistsForQuery(c,i))){const u=syncPointRemoveEventRegistration(c,i,s,a);if(syncPointIsEmpty(c)){r.syncPointTree_=r.syncPointTree_.remove(l)}const d=u.removed;h=u.events;const p=-1!==d.findIndex((r=>r._queryParams.loadsAllData()));const f=r.syncPointTree_.findOnPath(l,((r,i)=>syncPointHasCompleteView(i)));if(p&&!f){const i=r.syncPointTree_.subtree(l);if(!i.isEmpty()){const s=syncTreeCollectDistinctViewsForSubTree_(i);for(let i=0;i<s.length;++i){const a=s[i],l=a.query;const c=syncTreeCreateListenerForView_(r,a);r.listenProvider_.startListening(syncTreeQueryForListening_(l),syncTreeTagForQuery_(r,l),c.hashFn,c.onComplete)}}}if(!f&&d.length>0&&!a){if(p){const s=null;r.listenProvider_.stopListening(syncTreeQueryForListening_(i),s)}else{d.forEach((i=>{const s=r.queryToTagMap.get(syncTreeMakeQueryKey_(i));r.listenProvider_.stopListening(syncTreeQueryForListening_(i),s)}))}}syncTreeRemoveTags_(r,d)}return h}function syncTreeApplyTaggedQueryOverwrite(r,i,s,a){const l=syncTreeQueryKeyForTag_(r,a);if(l!=null){const a=syncTreeParseQueryKey_(l);const c=a.path,h=a.queryId;const u=newRelativePath(c,i);const d=new Overwrite(newOperationSourceServerTaggedQuery(h),u,s);return syncTreeApplyTaggedOperation_(r,c,d)}else{return[]}}function syncTreeApplyTaggedQueryMerge(r,i,s,a){const l=syncTreeQueryKeyForTag_(r,a);if(l){const a=syncTreeParseQueryKey_(l);const c=a.path,h=a.queryId;const u=newRelativePath(c,i);const d=ImmutableTree.fromObject(s);const p=new Merge(newOperationSourceServerTaggedQuery(h),u,d);return syncTreeApplyTaggedOperation_(r,c,p)}else{return[]}}function syncTreeAddEventRegistration(r,i,s){const a=i._path;let l=null;let c=false;r.syncPointTree_.foreachOnPath(a,((r,i)=>{const s=newRelativePath(r,a);l=l||syncPointGetCompleteServerCache(i,s);c=c||syncPointHasCompleteView(i)}));let h=r.syncPointTree_.get(a);if(!h){h=new SyncPoint;r.syncPointTree_=r.syncPointTree_.set(a,h)}else{c=c||syncPointHasCompleteView(h);l=l||syncPointGetCompleteServerCache(h,newEmptyPath())}let u;if(l!=null){u=true}else{u=false;l=ChildrenNode.EMPTY_NODE;const i=r.syncPointTree_.subtree(a);i.foreachChild(((r,i)=>{const s=syncPointGetCompleteServerCache(i,newEmptyPath());if(s){l=l.updateImmediateChild(r,s)}}))}const d=syncPointViewExistsForQuery(h,i);if(!d&&!i._queryParams.loadsAllData()){const s=syncTreeMakeQueryKey_(i);assert(!r.queryToTagMap.has(s),"View does not exist, but we have a tag");const a=syncTreeGetNextQueryTag_();r.queryToTagMap.set(s,a);r.tagToQueryMap.set(a,s)}const p=writeTreeChildWrites(r.pendingWriteTree_,a);let f=syncPointAddEventRegistration(h,i,s,p,l,u);if(!d&&!c){const s=syncPointViewForQuery(h,i);f=f.concat(syncTreeSetupListener_(r,i,s))}return f}function syncTreeCalcCompleteEventCache(r,i,s){const a=true;const l=r.pendingWriteTree_;const c=r.syncPointTree_.findOnPath(i,((r,s)=>{const a=newRelativePath(r,i);const l=syncPointGetCompleteServerCache(s,a);if(l){return l}}));return writeTreeCalcCompleteEventCache(l,i,c,s,a)}function syncTreeGetServerValue(r,i){const s=i._path;let a=null;r.syncPointTree_.foreachOnPath(s,((r,i)=>{const l=newRelativePath(r,s);a=a||syncPointGetCompleteServerCache(i,l)}));let l=r.syncPointTree_.get(s);if(!l){l=new SyncPoint;r.syncPointTree_=r.syncPointTree_.set(s,l)}else{a=a||syncPointGetCompleteServerCache(l,newEmptyPath())}const c=a!=null;const h=c?new CacheNode(a,true,false):null;const u=writeTreeChildWrites(r.pendingWriteTree_,i._path);const d=syncPointGetView(l,i,u,c?h.getNode():ChildrenNode.EMPTY_NODE,c);return viewGetCompleteNode(d)}function syncTreeApplyOperationToSyncPoints_(r,i){return syncTreeApplyOperationHelper_(i,r.syncPointTree_,null,writeTreeChildWrites(r.pendingWriteTree_,newEmptyPath()))}function syncTreeApplyOperationHelper_(r,i,s,a){if(pathIsEmpty(r.path)){return syncTreeApplyOperationDescendantsHelper_(r,i,s,a)}else{const l=i.get(newEmptyPath());if(s==null&&l!=null){s=syncPointGetCompleteServerCache(l,newEmptyPath())}let c=[];const h=pathGetFront(r.path);const u=r.operationForChild(h);const d=i.children.get(h);if(d&&u){const r=s?s.getImmediateChild(h):null;const i=writeTreeRefChild(a,h);c=c.concat(syncTreeApplyOperationHelper_(u,d,r,i))}if(l){c=c.concat(syncPointApplyOperation(l,r,a,s))}return c}}function syncTreeApplyOperationDescendantsHelper_(r,i,s,a){const l=i.get(newEmptyPath());if(s==null&&l!=null){s=syncPointGetCompleteServerCache(l,newEmptyPath())}let c=[];i.children.inorderTraversal(((i,l)=>{const h=s?s.getImmediateChild(i):null;const u=writeTreeRefChild(a,i);const d=r.operationForChild(i);if(d){c=c.concat(syncTreeApplyOperationDescendantsHelper_(d,l,h,u))}}));if(l){c=c.concat(syncPointApplyOperation(l,r,a,s))}return c}function syncTreeCreateListenerForView_(r,i){const s=i.query;const a=syncTreeTagForQuery_(r,s);return{hashFn:()=>{const r=viewGetServerCache(i)||ChildrenNode.EMPTY_NODE;return r.hash()},onComplete:i=>{if(i==="ok"){if(a){return syncTreeApplyTaggedListenComplete(r,s._path,a)}else{return syncTreeApplyListenComplete(r,s._path)}}else{const a=errorForServerCode(i,s);return syncTreeRemoveEventRegistration(r,s,null,a)}}}}function syncTreeTagForQuery_(r,i){const s=syncTreeMakeQueryKey_(i);return r.queryToTagMap.get(s)}function syncTreeMakeQueryKey_(r){return r._path.toString()+"$"+r._queryIdentifier}function syncTreeQueryKeyForTag_(r,i){return r.tagToQueryMap.get(i)}function syncTreeParseQueryKey_(r){const i=r.indexOf("$");(0,c.hu)(i!==-1&&i<r.length-1,"Bad queryKey.");return{queryId:r.substr(i+1),path:new Path(r.substr(0,i))}}function syncTreeApplyTaggedOperation_(r,i,s){const a=r.syncPointTree_.get(i);(0,c.hu)(a,"Missing sync point for query tag that we're tracking");const l=writeTreeChildWrites(r.pendingWriteTree_,i);return syncPointApplyOperation(a,s,l,null)}function syncTreeCollectDistinctViewsForSubTree_(r){return r.fold(((r,i,s)=>{if(i&&syncPointHasCompleteView(i)){const r=syncPointGetCompleteView(i);return[r]}else{let r=[];if(i){r=syncPointGetQueryViews(i)}each(s,((i,s)=>{r=r.concat(s)}));return r}}))}function syncTreeQueryForListening_(r){if(r._queryParams.loadsAllData()&&!r._queryParams.isDefault()){return new(syncTreeGetReferenceConstructor())(r._repo,r._path)}else{return r}}function syncTreeRemoveTags_(r,i){for(let s=0;s<i.length;++s){const a=i[s];if(!a._queryParams.loadsAllData()){const i=syncTreeMakeQueryKey_(a);const s=r.queryToTagMap.get(i);r.queryToTagMap.delete(i);r.tagToQueryMap.delete(s)}}}function syncTreeGetNextQueryTag_(){return tt++}function syncTreeSetupListener_(r,i,s){const a=i._path;const l=syncTreeTagForQuery_(r,i);const c=syncTreeCreateListenerForView_(r,s);const h=r.listenProvider_.startListening(syncTreeQueryForListening_(i),l,c.hashFn,c.onComplete);const u=r.syncPointTree_.subtree(a);if(l){assert(!syncPointHasCompleteView(u.value),"If we're adding a query, it shouldn't be shadowed")}else{const i=u.fold(((r,i,s)=>{if(!pathIsEmpty(r)&&i&&syncPointHasCompleteView(i)){return[syncPointGetCompleteView(i).query]}else{let r=[];if(i){r=r.concat(syncPointGetQueryViews(i).map((r=>r.query)))}each(s,((i,s)=>{r=r.concat(s)}));return r}}));for(let s=0;s<i.length;++s){const a=i[s];r.listenProvider_.stopListening(syncTreeQueryForListening_(a),syncTreeTagForQuery_(r,a))}}return h}class ExistingValueProvider{constructor(r){this.node_=r}getImmediateChild(r){const i=this.node_.getImmediateChild(r);return new ExistingValueProvider(i)}node(){return this.node_}}class DeferredValueProvider{constructor(r,i){this.syncTree_=r;this.path_=i}getImmediateChild(r){const i=pathChild(this.path_,r);return new DeferredValueProvider(this.syncTree_,i)}node(){return syncTreeCalcCompleteEventCache(this.syncTree_,this.path_)}}const generateWithValues=function(r){r=r||{};r["timestamp"]=r["timestamp"]||(new Date).getTime();return r};const resolveDeferredLeafValue=function(r,i,s){if(!r||typeof r!=="object"){return r}(0,c.hu)(".sv"in r,"Unexpected leaf node or priority contents");if(typeof r[".sv"]==="string"){return resolveScalarDeferredValue(r[".sv"],i,s)}else if(typeof r[".sv"]==="object"){return resolveComplexDeferredValue(r[".sv"],i)}else{(0,c.hu)(false,"Unexpected server value: "+JSON.stringify(r,null,2))}};const resolveScalarDeferredValue=function(r,i,s){switch(r){case"timestamp":return s["timestamp"];default:(0,c.hu)(false,"Unexpected server value: "+r)}};const resolveComplexDeferredValue=function(r,i,s){if(!r.hasOwnProperty("increment")){(0,c.hu)(false,"Unexpected server value: "+JSON.stringify(r,null,2))}const a=r["increment"];if(typeof a!=="number"){(0,c.hu)(false,"Unexpected increment value: "+a)}const l=i.node();(0,c.hu)(l!==null&&typeof l!=="undefined","Expected ChildrenNode.EMPTY_NODE for nulls");if(!l.isLeafNode()){return a}const h=l;const u=h.getValue();if(typeof u!=="number"){return a}return u+a};const resolveDeferredValueTree=function(r,i,s,a){return resolveDeferredValue(i,new DeferredValueProvider(s,r),a)};const resolveDeferredValueSnapshot=function(r,i,s){return resolveDeferredValue(r,new ExistingValueProvider(i),s)};function resolveDeferredValue(r,i,s){const a=r.getPriority().val();const l=resolveDeferredLeafValue(a,i.getImmediateChild(".priority"),s);let c;if(r.isLeafNode()){const a=r;const c=resolveDeferredLeafValue(a.getValue(),i,s);if(c!==a.getValue()||l!==a.getPriority().val()){return new LeafNode(c,nodeFromJSON(l))}else{return r}}else{const a=r;c=a;if(l!==a.getPriority().val()){c=c.updatePriority(new LeafNode(l))}a.forEachChild(Oe,((r,a)=>{const l=resolveDeferredValue(a,i.getImmediateChild(r),s);if(l!==a){c=c.updateImmediateChild(r,l)}}));return c}}class Tree{constructor(r="",i=null,s={children:{},childCount:0}){this.name=r;this.parent=i;this.node=s}}function treeSubTree(r,i){let s=i instanceof Path?i:new Path(i);let a=r,l=pathGetFront(s);while(l!==null){const r=(0,c.DV)(a.node.children,l)||{children:{},childCount:0};a=new Tree(l,a,r);s=pathPopFront(s);l=pathGetFront(s)}return a}function treeGetValue(r){return r.node.value}function treeSetValue(r,i){r.node.value=i;treeUpdateParents(r)}function treeHasChildren(r){return r.node.childCount>0}function treeIsEmpty(r){return treeGetValue(r)===undefined&&!treeHasChildren(r)}function treeForEachChild(r,i){each(r.node.children,((s,a)=>{i(new Tree(s,r,a))}))}function treeForEachDescendant(r,i,s,a){if(s&&!a){i(r)}treeForEachChild(r,(r=>{treeForEachDescendant(r,i,true,a)}));if(s&&a){i(r)}}function treeForEachAncestor(r,i,s){let a=s?r:r.parent;while(a!==null){if(i(a)){return true}a=a.parent}return false}function treeGetPath(r){return new Path(r.parent===null?r.name:treeGetPath(r.parent)+"/"+r.name)}function treeUpdateParents(r){if(r.parent!==null){treeUpdateChild(r.parent,r.name,r)}}function treeUpdateChild(r,i,s){const a=treeIsEmpty(s);const l=(0,c.r3)(r.node.children,i);if(a&&l){delete r.node.children[i];r.node.childCount--;treeUpdateParents(r)}else if(!a&&!l){r.node.children[i]=s.node;r.node.childCount++;treeUpdateParents(r)}}const nt=/[\[\].#$\/\u0000-\u001F\u007F]/;const rt=/[\[\].#$\u0000-\u001F\u007F]/;const it=10*1024*1024;const isValidKey=function(r){return typeof r==="string"&&r.length!==0&&!nt.test(r)};const isValidPathString=function(r){return typeof r==="string"&&r.length!==0&&!rt.test(r)};const isValidRootPathString=function(r){if(r){r=r.replace(/^\/*\.info(\/|$)/,"/")}return isValidPathString(r)};const isValidPriority=function(r){return r===null||typeof r==="string"||typeof r==="number"&&!isInvalidJSONNumber(r)||r&&typeof r==="object"&&contains(r,".sv")};const validateFirebaseDataArg=function(r,i,s,a){if(a&&i===undefined){return}validateFirebaseData(errorPrefix(r,"value"),i,s)};const validateFirebaseData=function(r,i,s){const a=s instanceof Path?new ValidationPath(s,r):s;if(i===undefined){throw new Error(r+"contains undefined "+validationPathToErrorString(a))}if(typeof i==="function"){throw new Error(r+"contains a function "+validationPathToErrorString(a)+" with contents = "+i.toString())}if(isInvalidJSONNumber(i)){throw new Error(r+"contains "+i.toString()+" "+validationPathToErrorString(a))}if(typeof i==="string"&&i.length>it/3&&(0,c.ug)(i)>it){throw new Error(r+"contains a string greater than "+it+" utf8 bytes "+validationPathToErrorString(a)+" ('"+i.substring(0,50)+"...')")}if(i&&typeof i==="object"){let s=false;let l=false;each(i,((i,c)=>{if(i===".value"){s=true}else if(i!==".priority"&&i!==".sv"){l=true;if(!isValidKey(i)){throw new Error(r+" contains an invalid key ("+i+") "+validationPathToErrorString(a)+".  Keys must be non-empty strings "+'and can\'t contain ".", "#", "$", "/", "[", or "]"')}}validationPathPush(a,i);validateFirebaseData(r,c,a);validationPathPop(a)}));if(s&&l){throw new Error(r+' contains ".value" child '+validationPathToErrorString(a)+" in addition to actual children.")}}};const validateFirebaseMergePaths=function(r,i){let s,a;for(s=0;s<i.length;s++){a=i[s];const l=pathSlice(a);for(let i=0;i<l.length;i++){if(l[i]===".priority"&&i===l.length-1);else if(!isValidKey(l[i])){throw new Error(r+"contains an invalid key ("+l[i]+") in path "+a.toString()+". Keys must be non-empty strings "+'and can\'t contain ".", "#", "$", "/", "[", or "]"')}}}i.sort(pathCompare);let l=null;for(s=0;s<i.length;s++){a=i[s];if(l!==null&&pathContains(l,a)){throw new Error(r+"contains a path "+l.toString()+" that is ancestor of another path "+a.toString())}l=a}};const validateFirebaseMergeDataArg=function(r,i,s,a){if(a&&i===undefined){return}const l=errorPrefix(r,"values");if(!(i&&typeof i==="object")||Array.isArray(i)){throw new Error(l+" must be an object containing the children to replace.")}const c=[];each(i,((r,i)=>{const a=new Path(r);validateFirebaseData(l,i,pathChild(s,a));if(pathGetBack(a)===".priority"){if(!isValidPriority(i)){throw new Error(l+"contains an invalid value for '"+a.toString()+"', which must be a valid "+"Firebase priority (a string, finite number, server value, or null).")}}c.push(a)}));validateFirebaseMergePaths(l,c)};const validatePriority=function(r,i,s){if(s&&i===undefined){return}if(isInvalidJSONNumber(i)){throw new Error(errorPrefix(r,"priority")+"is "+i.toString()+", but must be a valid Firebase priority (a string, finite number, "+"server value, or null).")}if(!isValidPriority(i)){throw new Error(errorPrefix(r,"priority")+"must be a valid Firebase priority "+"(a string, finite number, server value, or null).")}};const validateKey=function(r,i,s,a){if(a&&s===undefined){return}if(!isValidKey(s)){throw new Error(errorPrefix(r,i)+'was an invalid key = "'+s+'".  Firebase keys must be non-empty strings and '+'can\'t contain ".", "#", "$", "/", "[", or "]").')}};const validatePathString=function(r,i,s,a){if(a&&s===undefined){return}if(!isValidPathString(s)){throw new Error((0,c.gK)(r,i)+'was an invalid path = "'+s+'". Paths must be non-empty strings and '+'can\'t contain ".", "#", "$", "[", or "]"')}};const validateRootPathString=function(r,i,s,a){if(s){s=s.replace(/^\/*\.info(\/|$)/,"/")}validatePathString(r,i,s,a)};const validateWritablePath=function(r,i){if(pathGetFront(i)===".info"){throw new Error(r+" failed = Can't modify data under /.info/")}};const validateUrl=function(r,i){const s=i.path.toString();if(!(typeof i.repoInfo.host==="string")||i.repoInfo.host.length===0||!isValidKey(i.repoInfo.namespace)&&i.repoInfo.host.split(":")[0]!=="localhost"||s.length!==0&&!isValidRootPathString(s)){throw new Error((0,c.gK)(r,"url")+"must be a valid firebase URL and "+'the path can\'t contain ".", "#", "$", "[", or "]".')}};class EventQueue{constructor(){this.eventLists_=[];this.recursionDepth_=0}}function eventQueueQueueEvents(r,i){let s=null;for(let a=0;a<i.length;a++){const l=i[a];const c=l.getPath();if(s!==null&&!pathEquals(c,s.path)){r.eventLists_.push(s);s=null}if(s===null){s={events:[],path:c}}s.events.push(l)}if(s){r.eventLists_.push(s)}}function eventQueueRaiseEventsAtPath(r,i,s){eventQueueQueueEvents(r,s);eventQueueRaiseQueuedEventsMatchingPredicate(r,(r=>pathEquals(r,i)))}function eventQueueRaiseEventsForChangedPath(r,i,s){eventQueueQueueEvents(r,s);eventQueueRaiseQueuedEventsMatchingPredicate(r,(r=>pathContains(r,i)||pathContains(i,r)))}function eventQueueRaiseQueuedEventsMatchingPredicate(r,i){r.recursionDepth_++;let s=true;for(let a=0;a<r.eventLists_.length;a++){const l=r.eventLists_[a];if(l){const c=l.path;if(i(c)){eventListRaise(r.eventLists_[a]);r.eventLists_[a]=null}else{s=false}}}if(s){r.eventLists_=[]}r.recursionDepth_--}function eventListRaise(r){for(let i=0;i<r.events.length;i++){const s=r.events[i];if(s!==null){r.events[i]=null;const a=s.getEventRunner();if(g){log("event: "+s.toString())}exceptionGuard(a)}}}const st="repo_interrupt";const ot=25;class Repo{constructor(r,i,s,a){this.repoInfo_=r;this.forceRestClient_=i;this.authTokenProvider_=s;this.appCheckProvider_=a;this.dataUpdateCount=0;this.statsListener_=null;this.eventQueue_=new EventQueue;this.nextWriteId_=1;this.interceptServerDataCallback_=null;this.onDisconnect_=newSparseSnapshotTree();this.transactionQueueTree_=new Tree;this.persistentConnection_=null;this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function repoStart(r,i,s){r.stats_=statsManagerGetCollection(r.repoInfo_);if(r.forceRestClient_||beingCrawled()){r.server_=new ReadonlyRestClient(r.repoInfo_,((i,s,a,l)=>{repoOnDataUpdate(r,i,s,a,l)}),r.authTokenProvider_,r.appCheckProvider_);setTimeout((()=>repoOnConnectStatus(r,true)),0)}else{if(typeof s!=="undefined"&&s!==null){if(typeof s!=="object"){throw new Error("Only objects are supported for option databaseAuthVariableOverride")}try{(0,c.Pz)(s)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}r.persistentConnection_=new PersistentConnection(r.repoInfo_,i,((i,s,a,l)=>{repoOnDataUpdate(r,i,s,a,l)}),(i=>{repoOnConnectStatus(r,i)}),(i=>{repoOnServerInfoUpdate(r,i)}),r.authTokenProvider_,r.appCheckProvider_,s);r.server_=r.persistentConnection_}r.authTokenProvider_.addTokenChangeListener((i=>{r.server_.refreshAuthToken(i)}));r.appCheckProvider_.addTokenChangeListener((i=>{r.server_.refreshAppCheckToken(i.token)}));r.statsReporter_=statsManagerGetOrCreateReporter(r.repoInfo_,(()=>new StatsReporter(r.stats_,r.server_)));r.infoData_=new SnapshotHolder;r.infoSyncTree_=new SyncTree({startListening:(i,s,a,l)=>{let c=[];const h=r.infoData_.getNode(i._path);if(!h.isEmpty()){c=syncTreeApplyServerOverwrite(r.infoSyncTree_,i._path,h);setTimeout((()=>{l("ok")}),0)}return c},stopListening:()=>{}});repoUpdateInfo(r,"connected",false);r.serverSyncTree_=new SyncTree({startListening:(i,s,a,l)=>{r.server_.listen(i,a,s,((s,a)=>{const c=l(s,a);eventQueueRaiseEventsForChangedPath(r.eventQueue_,i._path,c)}));return[]},stopListening:(i,s)=>{r.server_.unlisten(i,s)}})}function repoServerTime(r){const i=r.infoData_.getNode(new Path(".info/serverTimeOffset"));const s=i.val()||0;return(new Date).getTime()+s}function repoGenerateServerValues(r){return generateWithValues({timestamp:repoServerTime(r)})}function repoOnDataUpdate(r,i,s,a,l){r.dataUpdateCount++;const h=new Path(i);s=r.interceptServerDataCallback_?r.interceptServerDataCallback_(i,s):s;let u=[];if(l){if(a){const i=(0,c.UI)(s,(r=>nodeFromJSON(r)));u=syncTreeApplyTaggedQueryMerge(r.serverSyncTree_,h,i,l)}else{const i=nodeFromJSON(s);u=syncTreeApplyTaggedQueryOverwrite(r.serverSyncTree_,h,i,l)}}else if(a){const i=(0,c.UI)(s,(r=>nodeFromJSON(r)));u=syncTreeApplyServerMerge(r.serverSyncTree_,h,i)}else{const i=nodeFromJSON(s);u=syncTreeApplyServerOverwrite(r.serverSyncTree_,h,i)}let d=h;if(u.length>0){d=repoRerunTransactions(r,h)}eventQueueRaiseEventsForChangedPath(r.eventQueue_,d,u)}function repoOnConnectStatus(r,i){repoUpdateInfo(r,"connected",i);if(i===false){repoRunOnDisconnectEvents(r)}}function repoOnServerInfoUpdate(r,i){each(i,((i,s)=>{repoUpdateInfo(r,i,s)}))}function repoUpdateInfo(r,i,s){const a=new Path("/.info/"+i);const l=nodeFromJSON(s);r.infoData_.updateSnapshot(a,l);const c=syncTreeApplyServerOverwrite(r.infoSyncTree_,a,l);eventQueueRaiseEventsForChangedPath(r.eventQueue_,a,c)}function repoGetNextWriteId(r){return r.nextWriteId_++}function repoGetValue(r,i){const s=syncTreeGetServerValue(r.serverSyncTree_,i);if(s!=null){return Promise.resolve(s)}return r.server_.get(i).then((s=>{const a=nodeFromJSON(s).withIndex(i._queryParams.getIndex());const l=syncTreeApplyServerOverwrite(r.serverSyncTree_,i._path,a);eventQueueRaiseEventsAtPath(r.eventQueue_,i._path,l);return Promise.resolve(a)}),(s=>{repoLog(r,"get for query "+(0,c.Pz)(i)+" failed: "+s);return Promise.reject(new Error(s))}))}function repoSetWithPriority(r,i,s,a,l){repoLog(r,"set",{path:i.toString(),value:s,priority:a});const c=repoGenerateServerValues(r);const h=nodeFromJSON(s,a);const u=syncTreeCalcCompleteEventCache(r.serverSyncTree_,i);const d=resolveDeferredValueSnapshot(h,u,c);const p=repoGetNextWriteId(r);const f=syncTreeApplyUserOverwrite(r.serverSyncTree_,i,d,p,true);eventQueueQueueEvents(r.eventQueue_,f);r.server_.put(i.toString(),h.val(true),((s,a)=>{const c=s==="ok";if(!c){warn("set at "+i+" failed: "+s)}const h=syncTreeAckUserWrite(r.serverSyncTree_,p,!c);eventQueueRaiseEventsForChangedPath(r.eventQueue_,i,h);repoCallOnCompleteCallback(r,l,s,a)}));const m=repoAbortTransactions(r,i);repoRerunTransactions(r,m);eventQueueRaiseEventsForChangedPath(r.eventQueue_,m,[])}function repoUpdate(r,i,s,a){repoLog(r,"update",{path:i.toString(),value:s});let l=true;const c=repoGenerateServerValues(r);const h={};each(s,((s,a)=>{l=false;h[s]=resolveDeferredValueTree(pathChild(i,s),nodeFromJSON(a),r.serverSyncTree_,c)}));if(!l){const l=repoGetNextWriteId(r);const c=syncTreeApplyUserMerge(r.serverSyncTree_,i,h,l);eventQueueQueueEvents(r.eventQueue_,c);r.server_.merge(i.toString(),s,((s,c)=>{const h=s==="ok";if(!h){warn("update at "+i+" failed: "+s)}const u=syncTreeAckUserWrite(r.serverSyncTree_,l,!h);const d=u.length>0?repoRerunTransactions(r,i):i;eventQueueRaiseEventsForChangedPath(r.eventQueue_,d,u);repoCallOnCompleteCallback(r,a,s,c)}));each(s,(s=>{const a=repoAbortTransactions(r,pathChild(i,s));repoRerunTransactions(r,a)}));eventQueueRaiseEventsForChangedPath(r.eventQueue_,i,[])}else{log("update() called with empty data.  Don't do anything.");repoCallOnCompleteCallback(r,a,"ok",undefined)}}function repoRunOnDisconnectEvents(r){repoLog(r,"onDisconnectEvents");const i=repoGenerateServerValues(r);const s=newSparseSnapshotTree();sparseSnapshotTreeForEachTree(r.onDisconnect_,newEmptyPath(),((a,l)=>{const c=resolveDeferredValueTree(a,l,r.serverSyncTree_,i);sparseSnapshotTreeRemember(s,a,c)}));let a=[];sparseSnapshotTreeForEachTree(s,newEmptyPath(),((i,s)=>{a=a.concat(syncTreeApplyServerOverwrite(r.serverSyncTree_,i,s));const l=repoAbortTransactions(r,i);repoRerunTransactions(r,l)}));r.onDisconnect_=newSparseSnapshotTree();eventQueueRaiseEventsForChangedPath(r.eventQueue_,newEmptyPath(),a)}function repoOnDisconnectCancel(r,i,s){r.server_.onDisconnectCancel(i.toString(),((a,l)=>{if(a==="ok"){sparseSnapshotTreeForget(r.onDisconnect_,i)}repoCallOnCompleteCallback(r,s,a,l)}))}function repoOnDisconnectSet(r,i,s,a){const l=nodeFromJSON(s);r.server_.onDisconnectPut(i.toString(),l.val(true),((s,c)=>{if(s==="ok"){sparseSnapshotTreeRemember(r.onDisconnect_,i,l)}repoCallOnCompleteCallback(r,a,s,c)}))}function repoOnDisconnectSetWithPriority(r,i,s,a,l){const c=nodeFromJSON(s,a);r.server_.onDisconnectPut(i.toString(),c.val(true),((s,a)=>{if(s==="ok"){sparseSnapshotTreeRemember(r.onDisconnect_,i,c)}repoCallOnCompleteCallback(r,l,s,a)}))}function repoOnDisconnectUpdate(r,i,s,a){if(isEmpty(s)){log("onDisconnect().update() called with empty data.  Don't do anything.");repoCallOnCompleteCallback(r,a,"ok",undefined);return}r.server_.onDisconnectMerge(i.toString(),s,((l,c)=>{if(l==="ok"){each(s,((s,a)=>{const l=nodeFromJSON(a);sparseSnapshotTreeRemember(r.onDisconnect_,pathChild(i,s),l)}))}repoCallOnCompleteCallback(r,a,l,c)}))}function repoAddEventCallbackForQuery(r,i,s){let a;if(pathGetFront(i._path)===".info"){a=syncTreeAddEventRegistration(r.infoSyncTree_,i,s)}else{a=syncTreeAddEventRegistration(r.serverSyncTree_,i,s)}eventQueueRaiseEventsAtPath(r.eventQueue_,i._path,a)}function repoRemoveEventCallbackForQuery(r,i,s){let a;if(pathGetFront(i._path)===".info"){a=syncTreeRemoveEventRegistration(r.infoSyncTree_,i,s)}else{a=syncTreeRemoveEventRegistration(r.serverSyncTree_,i,s)}eventQueueRaiseEventsAtPath(r.eventQueue_,i._path,a)}function repoInterrupt(r){if(r.persistentConnection_){r.persistentConnection_.interrupt(st)}}function repoResume(r){if(r.persistentConnection_){r.persistentConnection_.resume(st)}}function repoLog(r,...i){let s="";if(r.persistentConnection_){s=r.persistentConnection_.id+":"}log(s,...i)}function repoCallOnCompleteCallback(r,i,s,a){if(i){exceptionGuard((()=>{if(s==="ok"){i(null)}else{const r=(s||"error").toUpperCase();let l=r;if(a){l+=": "+a}const c=new Error(l);c.code=r;i(c)}}))}}function repoStartTransaction(r,i,s,a,l,c){repoLog(r,"transaction on "+i);const h={path:i,update:s,onComplete:a,status:null,order:y(),applyLocally:c,retryCount:0,unwatcher:l,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null};const u=repoGetLatestState(r,i,undefined);h.currentInputSnapshot=u;const d=h.update(u.val());if(d===undefined){h.unwatcher();h.currentOutputSnapshotRaw=null;h.currentOutputSnapshotResolved=null;if(h.onComplete){h.onComplete(null,false,h.currentInputSnapshot)}}else{validateFirebaseData("transaction failed: Data returned ",d,h.path);h.status=0;const s=treeSubTree(r.transactionQueueTree_,i);const a=treeGetValue(s)||[];a.push(h);treeSetValue(s,a);let l;if(typeof d==="object"&&d!==null&&contains(d,".priority")){l=safeGet(d,".priority");assert(isValidPriority(l),"Invalid priority returned by transaction. "+"Priority must be a valid string, finite number, server value, or null.")}else{const s=syncTreeCalcCompleteEventCache(r.serverSyncTree_,i)||ChildrenNode.EMPTY_NODE;l=s.getPriority().val()}const c=repoGenerateServerValues(r);const p=nodeFromJSON(d,l);const f=resolveDeferredValueSnapshot(p,u,c);h.currentOutputSnapshotRaw=p;h.currentOutputSnapshotResolved=f;h.currentWriteId=repoGetNextWriteId(r);const m=syncTreeApplyUserOverwrite(r.serverSyncTree_,i,f,h.currentWriteId,h.applyLocally);eventQueueRaiseEventsForChangedPath(r.eventQueue_,i,m);repoSendReadyTransactions(r,r.transactionQueueTree_)}}function repoGetLatestState(r,i,s){return syncTreeCalcCompleteEventCache(r.serverSyncTree_,i,s)||ChildrenNode.EMPTY_NODE}function repoSendReadyTransactions(r,i=r.transactionQueueTree_){if(!i){repoPruneCompletedTransactionsBelowNode(r,i)}if(treeGetValue(i)){const s=repoBuildTransactionQueue(r,i);(0,c.hu)(s.length>0,"Sending zero length transaction queue");const a=s.every((r=>r.status===0));if(a){repoSendTransactionQueue(r,treeGetPath(i),s)}}else if(treeHasChildren(i)){treeForEachChild(i,(i=>{repoSendReadyTransactions(r,i)}))}}function repoSendTransactionQueue(r,i,s){const a=s.map((r=>r.currentWriteId));const l=repoGetLatestState(r,i,a);let h=l;const u=l.hash();for(let r=0;r<s.length;r++){const a=s[r];(0,c.hu)(a.status===0,"tryToSendTransactionQueue_: items in queue should all be run.");a.status=1;a.retryCount++;const l=newRelativePath(i,a.path);h=h.updateChild(l,a.currentOutputSnapshotRaw)}const d=h.val(true);const p=i;r.server_.put(p.toString(),d,(a=>{repoLog(r,"transaction put response",{path:p.toString(),status:a});let l=[];if(a==="ok"){const a=[];for(let i=0;i<s.length;i++){s[i].status=2;l=l.concat(syncTreeAckUserWrite(r.serverSyncTree_,s[i].currentWriteId));if(s[i].onComplete){a.push((()=>s[i].onComplete(null,true,s[i].currentOutputSnapshotResolved)))}s[i].unwatcher()}repoPruneCompletedTransactionsBelowNode(r,treeSubTree(r.transactionQueueTree_,i));repoSendReadyTransactions(r,r.transactionQueueTree_);eventQueueRaiseEventsForChangedPath(r.eventQueue_,i,l);for(let r=0;r<a.length;r++){exceptionGuard(a[r])}}else{if(a==="datastale"){for(let r=0;r<s.length;r++){if(s[r].status===3){s[r].status=4}else{s[r].status=0}}}else{warn("transaction at "+p.toString()+" failed: "+a);for(let r=0;r<s.length;r++){s[r].status=4;s[r].abortReason=a}}repoRerunTransactions(r,i)}}),u)}function repoRerunTransactions(r,i){const s=repoGetAncestorTransactionNode(r,i);const a=treeGetPath(s);const l=repoBuildTransactionQueue(r,s);repoRerunTransactionQueue(r,l,a);return a}function repoRerunTransactionQueue(r,i,s){if(i.length===0){return}const a=[];let l=[];const h=i.filter((r=>r.status===0));const u=h.map((r=>r.currentWriteId));for(let h=0;h<i.length;h++){const d=i[h];const p=newRelativePath(s,d.path);let f=false,m;(0,c.hu)(p!==null,"rerunTransactionsUnderNode_: relativePath should not be null.");if(d.status===4){f=true;m=d.abortReason;l=l.concat(syncTreeAckUserWrite(r.serverSyncTree_,d.currentWriteId,true))}else if(d.status===0){if(d.retryCount>=ot){f=true;m="maxretry";l=l.concat(syncTreeAckUserWrite(r.serverSyncTree_,d.currentWriteId,true))}else{const s=repoGetLatestState(r,d.path,u);d.currentInputSnapshot=s;const a=i[h].update(s.val());if(a!==undefined){validateFirebaseData("transaction failed: Data returned ",a,d.path);let i=nodeFromJSON(a);const h=typeof a==="object"&&a!=null&&(0,c.r3)(a,".priority");if(!h){i=i.updatePriority(s.getPriority())}const p=d.currentWriteId;const f=repoGenerateServerValues(r);const m=resolveDeferredValueSnapshot(i,s,f);d.currentOutputSnapshotRaw=i;d.currentOutputSnapshotResolved=m;d.currentWriteId=repoGetNextWriteId(r);u.splice(u.indexOf(p),1);l=l.concat(syncTreeApplyUserOverwrite(r.serverSyncTree_,d.path,m,d.currentWriteId,d.applyLocally));l=l.concat(syncTreeAckUserWrite(r.serverSyncTree_,p,true))}else{f=true;m="nodata";l=l.concat(syncTreeAckUserWrite(r.serverSyncTree_,d.currentWriteId,true))}}}eventQueueRaiseEventsForChangedPath(r.eventQueue_,s,l);l=[];if(f){i[h].status=2;(function(r){setTimeout(r,Math.floor(0))})(i[h].unwatcher);if(i[h].onComplete){if(m==="nodata"){a.push((()=>i[h].onComplete(null,false,i[h].currentInputSnapshot)))}else{a.push((()=>i[h].onComplete(new Error(m),false,null)))}}}}repoPruneCompletedTransactionsBelowNode(r,r.transactionQueueTree_);for(let r=0;r<a.length;r++){exceptionGuard(a[r])}repoSendReadyTransactions(r,r.transactionQueueTree_)}function repoGetAncestorTransactionNode(r,i){let s;let a=r.transactionQueueTree_;s=pathGetFront(i);while(s!==null&&treeGetValue(a)===undefined){a=treeSubTree(a,s);i=pathPopFront(i);s=pathGetFront(i)}return a}function repoBuildTransactionQueue(r,i){const s=[];repoAggregateTransactionQueuesForNode(r,i,s);s.sort(((r,i)=>r.order-i.order));return s}function repoAggregateTransactionQueuesForNode(r,i,s){const a=treeGetValue(i);if(a){for(let r=0;r<a.length;r++){s.push(a[r])}}treeForEachChild(i,(i=>{repoAggregateTransactionQueuesForNode(r,i,s)}))}function repoPruneCompletedTransactionsBelowNode(r,i){const s=treeGetValue(i);if(s){let r=0;for(let i=0;i<s.length;i++){if(s[i].status!==2){s[r]=s[i];r++}}s.length=r;treeSetValue(i,s.length>0?s:undefined)}treeForEachChild(i,(i=>{repoPruneCompletedTransactionsBelowNode(r,i)}))}function repoAbortTransactions(r,i){const s=treeGetPath(repoGetAncestorTransactionNode(r,i));const a=treeSubTree(r.transactionQueueTree_,i);treeForEachAncestor(a,(i=>{repoAbortTransactionsOnNode(r,i)}));repoAbortTransactionsOnNode(r,a);treeForEachDescendant(a,(i=>{repoAbortTransactionsOnNode(r,i)}));return s}function repoAbortTransactionsOnNode(r,i){const s=treeGetValue(i);if(s){const a=[];let l=[];let h=-1;for(let i=0;i<s.length;i++){if(s[i].status===3);else if(s[i].status===1){(0,c.hu)(h===i-1,"All SENT items should be at beginning of queue.");h=i;s[i].status=3;s[i].abortReason="set"}else{(0,c.hu)(s[i].status===0,"Unexpected transaction status in abort");s[i].unwatcher();l=l.concat(syncTreeAckUserWrite(r.serverSyncTree_,s[i].currentWriteId,true));if(s[i].onComplete){a.push(s[i].onComplete.bind(null,new Error("set"),false,null))}}}if(h===-1){treeSetValue(i,undefined)}else{s.length=h+1}eventQueueRaiseEventsForChangedPath(r.eventQueue_,treeGetPath(i),l);for(let r=0;r<a.length;r++){exceptionGuard(a[r])}}}function decodePath(r){let i="";const s=r.split("/");for(let r=0;r<s.length;r++){if(s[r].length>0){let a=s[r];try{a=decodeURIComponent(a.replace(/\+/g," "))}catch(r){}i+="/"+a}}return i}function decodeQuery(r){const i={};if(r.charAt(0)==="?"){r=r.substring(1)}for(const s of r.split("&")){if(s.length===0){continue}const a=s.split("=");if(a.length===2){i[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}else{warn(`Invalid query segment '${s}' in query '${r}'`)}}return i}const parseRepoInfo=function(r,i){const s=parseDatabaseURL(r),a=s.namespace;if(s.domain==="firebase.com"){fatal(s.host+" is no longer supported. "+"Please use <YOUR FIREBASE>.firebaseio.com instead")}if((!a||a==="undefined")&&s.domain!=="localhost"){fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com")}if(!s.secure){warnIfPageIsSecure()}const l=s.scheme==="ws"||s.scheme==="wss";return{repoInfo:new RepoInfo(s.host,s.secure,a,i,l,"",a!==s.subdomain),path:new Path(s.pathString)}};const parseDatabaseURL=function(r){let i="",s="",a="",l="",c="";let h=true,u="https",d=443;if(typeof r==="string"){let p=r.indexOf("//");if(p>=0){u=r.substring(0,p-1);r=r.substring(p+2)}let f=r.indexOf("/");if(f===-1){f=r.length}let m=r.indexOf("?");if(m===-1){m=r.length}i=r.substring(0,Math.min(f,m));if(f<m){l=decodePath(r.substring(f,m))}const _=decodeQuery(r.substring(Math.min(r.length,m)));p=i.indexOf(":");if(p>=0){h=u==="https"||u==="wss";d=parseInt(i.substring(p+1),10)}else{p=i.length}const y=i.slice(0,p);if(y.toLowerCase()==="localhost"){s="localhost"}else if(y.split(".").length<=2){s=y}else{const r=i.indexOf(".");a=i.substring(0,r).toLowerCase();s=i.substring(r+1);c=a}if("ns"in _){c=_["ns"]}}return{host:i,port:d,domain:s,subdomain:a,secure:h,scheme:u,pathString:l,namespace:c}};class DataEvent{constructor(r,i,s,a){this.eventType=r;this.eventRegistration=i;this.snapshot=s;this.prevName=a}getPath(){const r=this.snapshot.ref;if(this.eventType==="value"){return r._path}else{return r.parent._path}}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class CancelEvent{constructor(r,i,s){this.eventRegistration=r;this.error=i;this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class CallbackContext{constructor(r,i){this.snapshotCallback=r;this.cancelCallback=i}onValue(r,i){this.snapshotCallback.call(null,r,i)}onCancel(r){assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback");return this.cancelCallback.call(null,r)}get hasCancelCallback(){return!!this.cancelCallback}matches(r){return this.snapshotCallback===r.snapshotCallback||this.snapshotCallback.userCallback!==undefined&&this.snapshotCallback.userCallback===r.snapshotCallback.userCallback&&this.snapshotCallback.context===r.snapshotCallback.context}}class OnDisconnect{constructor(r,i){this._repo=r;this._path=i}cancel(){const r=new Deferred;repoOnDisconnectCancel(this._repo,this._path,r.wrapCallback((()=>{})));return r.promise}remove(){validateWritablePath("OnDisconnect.remove",this._path);const r=new Deferred;repoOnDisconnectSet(this._repo,this._path,null,r.wrapCallback((()=>{})));return r.promise}set(r){validateWritablePath("OnDisconnect.set",this._path);validateFirebaseDataArg("OnDisconnect.set",r,this._path,false);const i=new Deferred;repoOnDisconnectSet(this._repo,this._path,r,i.wrapCallback((()=>{})));return i.promise}setWithPriority(r,i){validateWritablePath("OnDisconnect.setWithPriority",this._path);validateFirebaseDataArg("OnDisconnect.setWithPriority",r,this._path,false);validatePriority("OnDisconnect.setWithPriority",i,false);const s=new Deferred;repoOnDisconnectSetWithPriority(this._repo,this._path,r,i,s.wrapCallback((()=>{})));return s.promise}update(r){validateWritablePath("OnDisconnect.update",this._path);validateFirebaseMergeDataArg("OnDisconnect.update",r,this._path,false);const i=new Deferred;repoOnDisconnectUpdate(this._repo,this._path,r,i.wrapCallback((()=>{})));return i.promise}}class QueryImpl{constructor(r,i,s,a){this._repo=r;this._path=i;this._queryParams=s;this._orderByCalled=a}get key(){if(pathIsEmpty(this._path)){return null}else{return pathGetBack(this._path)}}get ref(){return new ReferenceImpl(this._repo,this._path)}get _queryIdentifier(){const r=queryParamsGetQueryObject(this._queryParams);const i=ObjectToUniqueKey(r);return i==="{}"?"default":i}get _queryObject(){return queryParamsGetQueryObject(this._queryParams)}isEqual(r){r=(0,c.m9)(r);if(!(r instanceof QueryImpl)){return false}const i=this._repo===r._repo;const s=pathEquals(this._path,r._path);const a=this._queryIdentifier===r._queryIdentifier;return i&&s&&a}toJSON(){return this.toString()}toString(){return this._repo.toString()+pathToUrlEncodedString(this._path)}}function validateNoPreviousOrderByCall(r,i){if(r._orderByCalled===true){throw new Error(i+": You can't combine multiple orderBy calls.")}}function validateQueryEndpoints(r){let i=null;let s=null;if(r.hasStart()){i=r.getIndexStartValue()}if(r.hasEnd()){s=r.getIndexEndValue()}if(r.getIndex()===ke){const a="Query: When ordering by key, you may only pass one argument to "+"startAt(), endAt(), or equalTo().";const l="Query: When ordering by key, the argument passed to startAt(), startAfter(), "+"endAt(), endBefore(), or equalTo() must be a string.";if(r.hasStart()){const s=r.getIndexStartName();if(s!==C){throw new Error(a)}else if(typeof i!=="string"){throw new Error(l)}}if(r.hasEnd()){const i=r.getIndexEndName();if(i!==w){throw new Error(a)}else if(typeof s!=="string"){throw new Error(l)}}}else if(r.getIndex()===Oe){if(i!=null&&!isValidPriority(i)||s!=null&&!isValidPriority(s)){throw new Error("Query: When ordering by priority, the first argument passed to startAt(), "+"startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value "+"(null, a number, or a string).")}}else{assert(r.getIndex()instanceof PathIndex||r.getIndex()===Ge,"unknown index type.");if(i!=null&&typeof i==="object"||s!=null&&typeof s==="object"){throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or "+"equalTo() cannot be an object.")}}}function validateLimit(r){if(r.hasStart()&&r.hasEnd()&&r.hasLimit()&&!r.hasAnchoredLimit()){throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use "+"limitToFirst() or limitToLast() instead.")}}class ReferenceImpl extends QueryImpl{constructor(r,i){super(r,i,new QueryParams,false)}get parent(){const r=pathParent(this._path);return r===null?null:new ReferenceImpl(this._repo,r)}get root(){let r=this;while(r.parent!==null){r=r.parent}return r}}class DataSnapshot{constructor(r,i,s){this._node=r;this.ref=i;this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(r){const i=new Path(r);const s=child(this.ref,r);return new DataSnapshot(this._node.getChild(i),s,Oe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(true)}forEach(r){if(this._node.isLeafNode()){return false}const i=this._node;return!!i.forEachChild(this._index,((i,s)=>r(new DataSnapshot(s,child(this.ref,i),Oe))))}hasChild(r){const i=new Path(r);return!this._node.getChild(i).isEmpty()}hasChildren(){if(this._node.isLeafNode()){return false}else{return!this._node.isEmpty()}}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ref(r,i){r=(0,c.m9)(r);r._checkNotDeleted("ref");return i!==undefined?child(r._root,i):r._root}function refFromURL(r,i){r=getModularInstance(r);r._checkNotDeleted("refFromURL");const s=parseRepoInfo(i,r._repo.repoInfo_.nodeAdmin);validateUrl("refFromURL",s);const a=s.repoInfo;if(!r._repo.repoInfo_.isCustomHost()&&a.host!==r._repo.repoInfo_.host){fatal("refFromURL"+": Host name does not match the current database: "+"(found "+a.host+" but expected "+r._repo.repoInfo_.host+")")}return ref(r,s.path.toString())}function child(r,i){r=(0,c.m9)(r);if(pathGetFront(r._path)===null){validateRootPathString("child","path",i,false)}else{validatePathString("child","path",i,false)}return new ReferenceImpl(r._repo,pathChild(r._path,i))}function onDisconnect(r){r=getModularInstance(r);return new OnDisconnect(r._repo,r._path)}function push(r,i){r=getModularInstance(r);validateWritablePath("push",r._path);validateFirebaseDataArg("push",i,r._path,true);const s=repoServerTime(r._repo);const a=He(s);const l=child(r,a);const c=child(r,a);let h;if(i!=null){h=set(c,i).then((()=>c))}else{h=Promise.resolve(c)}l.then=h.then.bind(h);l.catch=h.then.bind(h,undefined);return l}function remove(r){validateWritablePath("remove",r._path);return set(r,null)}function set(r,i){r=getModularInstance(r);validateWritablePath("set",r._path);validateFirebaseDataArg("set",i,r._path,false);const s=new Deferred;repoSetWithPriority(r._repo,r._path,i,null,s.wrapCallback((()=>{})));return s.promise}function setPriority(r,i){r=getModularInstance(r);validateWritablePath("setPriority",r._path);validatePriority("setPriority",i,false);const s=new Deferred;repoSetWithPriority(r._repo,pathChild(r._path,".priority"),i,null,s.wrapCallback((()=>{})));return s.promise}function setWithPriority(r,i,s){validateWritablePath("setWithPriority",r._path);validateFirebaseDataArg("setWithPriority",i,r._path,false);validatePriority("setWithPriority",s,false);if(r.key===".length"||r.key===".keys"){throw"setWithPriority failed: "+r.key+" is a read-only object."}const a=new Deferred;repoSetWithPriority(r._repo,r._path,i,s,a.wrapCallback((()=>{})));return a.promise}function update(r,i){validateFirebaseMergeDataArg("update",i,r._path,false);const s=new Deferred;repoUpdate(r._repo,r._path,i,s.wrapCallback((()=>{})));return s.promise}function get(r){r=(0,c.m9)(r);return repoGetValue(r._repo,r).then((i=>new DataSnapshot(i,new ReferenceImpl(r._repo,r._path),r._queryParams.getIndex())))}class ValueEventRegistration{constructor(r){this.callbackContext=r}respondsTo(r){return r==="value"}createEvent(r,i){const s=i._queryParams.getIndex();return new DataEvent("value",this,new DataSnapshot(r.snapshotNode,new ReferenceImpl(i._repo,i._path),s))}getEventRunner(r){if(r.getEventType()==="cancel"){return()=>this.callbackContext.onCancel(r.error)}else{return()=>this.callbackContext.onValue(r.snapshot,null)}}createCancelEvent(r,i){if(this.callbackContext.hasCancelCallback){return new CancelEvent(this,r,i)}else{return null}}matches(r){if(!(r instanceof ValueEventRegistration)){return false}else if(!r.callbackContext||!this.callbackContext){return true}else{return r.callbackContext.matches(this.callbackContext)}}hasAnyCallback(){return this.callbackContext!==null}}class ChildEventRegistration{constructor(r,i){this.eventType=r;this.callbackContext=i}respondsTo(r){let i=r==="children_added"?"child_added":r;i=i==="children_removed"?"child_removed":i;return this.eventType===i}createCancelEvent(r,i){if(this.callbackContext.hasCancelCallback){return new CancelEvent(this,r,i)}else{return null}}createEvent(r,i){assert(r.childName!=null,"Child events should have a childName.");const s=child(new ReferenceImpl(i._repo,i._path),r.childName);const a=i._queryParams.getIndex();return new DataEvent(r.type,this,new DataSnapshot(r.snapshotNode,s,a),r.prevName)}getEventRunner(r){if(r.getEventType()==="cancel"){return()=>this.callbackContext.onCancel(r.error)}else{return()=>this.callbackContext.onValue(r.snapshot,r.prevName)}}matches(r){if(r instanceof ChildEventRegistration){return this.eventType===r.eventType&&(!this.callbackContext||!r.callbackContext||this.callbackContext.matches(r.callbackContext))}return false}hasAnyCallback(){return!!this.callbackContext}}function addEventListener(r,i,s,a,l){let c;if(typeof a==="object"){c=undefined;l=a}if(typeof a==="function"){c=a}if(l&&l.onlyOnce){const i=s;const onceCallback=(s,a)=>{repoRemoveEventCallbackForQuery(r._repo,r,u);i(s,a)};onceCallback.userCallback=s.userCallback;onceCallback.context=s.context;s=onceCallback}const h=new CallbackContext(s,c||undefined);const u=i==="value"?new ValueEventRegistration(h):new ChildEventRegistration(i,h);repoAddEventCallbackForQuery(r._repo,r,u);return()=>repoRemoveEventCallbackForQuery(r._repo,r,u)}function onValue(r,i,s,a){return addEventListener(r,"value",i,s,a)}function onChildAdded(r,i,s,a){return addEventListener(r,"child_added",i,s,a)}function onChildChanged(r,i,s,a){return addEventListener(r,"child_changed",i,s,a)}function onChildMoved(r,i,s,a){return addEventListener(r,"child_moved",i,s,a)}function onChildRemoved(r,i,s,a){return addEventListener(r,"child_removed",i,s,a)}function off(r,i,s){let a=null;const l=s?new CallbackContext(s):null;if(i==="value"){a=new ValueEventRegistration(l)}else if(i){a=new ChildEventRegistration(i,l)}repoRemoveEventCallbackForQuery(r._repo,r,a)}class QueryConstraint{}class QueryEndAtConstraint extends(null&&QueryConstraint){constructor(r,i){super();this._value=r;this._key=i}_apply(r){validateFirebaseDataArg("endAt",this._value,r._path,true);const i=queryParamsEndAt(r._queryParams,this._value,this._key);validateLimit(i);validateQueryEndpoints(i);if(r._queryParams.hasEnd()){throw new Error("endAt: Starting point was already set (by another call to endAt, "+"endBefore or equalTo).")}return new QueryImpl(r._repo,r._path,i,r._orderByCalled)}}function endAt(r,i){validateKey("endAt","key",i,true);return new QueryEndAtConstraint(r,i)}class QueryEndBeforeConstraint extends(null&&QueryConstraint){constructor(r,i){super();this._value=r;this._key=i}_apply(r){validateFirebaseDataArg("endBefore",this._value,r._path,false);const i=queryParamsEndBefore(r._queryParams,this._value,this._key);validateLimit(i);validateQueryEndpoints(i);if(r._queryParams.hasEnd()){throw new Error("endBefore: Starting point was already set (by another call to endAt, "+"endBefore or equalTo).")}return new QueryImpl(r._repo,r._path,i,r._orderByCalled)}}function endBefore(r,i){validateKey("endBefore","key",i,true);return new QueryEndBeforeConstraint(r,i)}class QueryStartAtConstraint extends(null&&QueryConstraint){constructor(r,i){super();this._value=r;this._key=i}_apply(r){validateFirebaseDataArg("startAt",this._value,r._path,true);const i=queryParamsStartAt(r._queryParams,this._value,this._key);validateLimit(i);validateQueryEndpoints(i);if(r._queryParams.hasStart()){throw new Error("startAt: Starting point was already set (by another call to startAt, "+"startBefore or equalTo).")}return new QueryImpl(r._repo,r._path,i,r._orderByCalled)}}function startAt(r=null,i){validateKey("startAt","key",i,true);return new QueryStartAtConstraint(r,i)}class QueryStartAfterConstraint extends(null&&QueryConstraint){constructor(r,i){super();this._value=r;this._key=i}_apply(r){validateFirebaseDataArg("startAfter",this._value,r._path,false);const i=queryParamsStartAfter(r._queryParams,this._value,this._key);validateLimit(i);validateQueryEndpoints(i);if(r._queryParams.hasStart()){throw new Error("startAfter: Starting point was already set (by another call to startAt, "+"startAfter, or equalTo).")}return new QueryImpl(r._repo,r._path,i,r._orderByCalled)}}function startAfter(r,i){validateKey("startAfter","key",i,true);return new QueryStartAfterConstraint(r,i)}class QueryLimitToFirstConstraint extends(null&&QueryConstraint){constructor(r){super();this._limit=r}_apply(r){if(r._queryParams.hasLimit()){throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst "+"or limitToLast).")}return new QueryImpl(r._repo,r._path,queryParamsLimitToFirst(r._queryParams,this._limit),r._orderByCalled)}}function limitToFirst(r){if(typeof r!=="number"||Math.floor(r)!==r||r<=0){throw new Error("limitToFirst: First argument must be a positive integer.")}return new QueryLimitToFirstConstraint(r)}class QueryLimitToLastConstraint extends(null&&QueryConstraint){constructor(r){super();this._limit=r}_apply(r){if(r._queryParams.hasLimit()){throw new Error("limitToLast: Limit was already set (by another call to limitToFirst "+"or limitToLast).")}return new QueryImpl(r._repo,r._path,queryParamsLimitToLast(r._queryParams,this._limit),r._orderByCalled)}}function limitToLast(r){if(typeof r!=="number"||Math.floor(r)!==r||r<=0){throw new Error("limitToLast: First argument must be a positive integer.")}return new QueryLimitToLastConstraint(r)}class QueryOrderByChildConstraint extends(null&&QueryConstraint){constructor(r){super();this._path=r}_apply(r){validateNoPreviousOrderByCall(r,"orderByChild");const i=new Path(this._path);if(pathIsEmpty(i)){throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.")}const s=new PathIndex(i);const a=queryParamsOrderBy(r._queryParams,s);validateQueryEndpoints(a);return new QueryImpl(r._repo,r._path,a,true)}}function orderByChild(r){if(r==="$key"){throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.')}else if(r==="$priority"){throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.')}else if(r==="$value"){throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.')}validatePathString("orderByChild","path",r,false);return new QueryOrderByChildConstraint(r)}class QueryOrderByKeyConstraint extends(null&&QueryConstraint){_apply(r){validateNoPreviousOrderByCall(r,"orderByKey");const i=queryParamsOrderBy(r._queryParams,ke);validateQueryEndpoints(i);return new QueryImpl(r._repo,r._path,i,true)}}function orderByKey(){return new QueryOrderByKeyConstraint}class QueryOrderByPriorityConstraint extends(null&&QueryConstraint){_apply(r){validateNoPreviousOrderByCall(r,"orderByPriority");const i=queryParamsOrderBy(r._queryParams,Oe);validateQueryEndpoints(i);return new QueryImpl(r._repo,r._path,i,true)}}function orderByPriority(){return new QueryOrderByPriorityConstraint}class QueryOrderByValueConstraint extends(null&&QueryConstraint){_apply(r){validateNoPreviousOrderByCall(r,"orderByValue");const i=queryParamsOrderBy(r._queryParams,Ge);validateQueryEndpoints(i);return new QueryImpl(r._repo,r._path,i,true)}}function orderByValue(){return new QueryOrderByValueConstraint}class QueryEqualToValueConstraint extends(null&&QueryConstraint){constructor(r,i){super();this._value=r;this._key=i}_apply(r){validateFirebaseDataArg("equalTo",this._value,r._path,false);if(r._queryParams.hasStart()){throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or "+"equalTo).")}if(r._queryParams.hasEnd()){throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or "+"equalTo).")}return new QueryEndAtConstraint(this._value,this._key)._apply(new QueryStartAtConstraint(this._value,this._key)._apply(r))}}function equalTo(r,i){validateKey("equalTo","key",i,true);return new QueryEqualToValueConstraint(r,i)}function query(r,...i){let s=getModularInstance(r);for(const r of i){s=r._apply(s)}return s}syncPointSetReferenceConstructor(ReferenceImpl);syncTreeSetReferenceConstructor(ReferenceImpl);const at="FIREBASE_DATABASE_EMULATOR_HOST";const lt={};let ct=false;function repoManagerApplyEmulatorSettings(r,i,s,a){r.repoInfo_=new RepoInfo(`${i}:${s}`,false,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams);if(a){r.authTokenProvider_=a}}function repoManagerDatabaseFromApp(r,i,s,a,l){let c=a||r.options.databaseURL;if(c===undefined){if(!r.options.projectId){fatal("Can't determine Firebase Database URL. Be sure to include "+" a Project ID when calling firebase.initializeApp().")}log("Using default host for project ",r.options.projectId);c=`${r.options.projectId}-default-rtdb.firebaseio.com`}let h=parseRepoInfo(c,l);let u=h.repoInfo;let d;let p=undefined;if(typeof process!=="undefined"){p={NODE_ENV:"production",PUBLIC_URL:"",APP_ENV:undefined}[at]}if(p){d=true;c=`http://${p}?ns=${u.namespace}`;h=parseRepoInfo(c,l);u=h.repoInfo}else{d=!h.repoInfo.secure}const f=l&&d?new EmulatorTokenProvider(EmulatorTokenProvider.OWNER):new FirebaseAuthTokenProvider(r.name,r.options,i);validateUrl("Invalid Firebase Database URL",h);if(!pathIsEmpty(h.path)){fatal("Database URL must point to the root of a Firebase Database "+"(not including a child path).")}const m=repoManagerCreateRepo(u,r,f,new AppCheckTokenProvider(r.name,s));return new Database(m,r)}function repoManagerDeleteRepo(r,i){const s=lt[i];if(!s||s[r.key]!==r){fatal(`Database ${i}(${r.repoInfo_}) has already been deleted.`)}repoInterrupt(r);delete s[r.key]}function repoManagerCreateRepo(r,i,s,a){let l=lt[i.name];if(!l){l={};lt[i.name]=l}let c=l[r.toURLString()];if(c){fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.")}c=new Repo(r,ct,s,a);l[r.toURLString()]=c;return c}function repoManagerForceRestClient(r){ct=r}class Database{constructor(r,i){this._repoInternal=r;this.app=i;this["type"]="database";this._instanceStarted=false}get _repo(){if(!this._instanceStarted){repoStart(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]);this._instanceStarted=true}return this._repoInternal}get _root(){if(!this._rootInternal){this._rootInternal=new ReferenceImpl(this._repo,newEmptyPath())}return this._rootInternal}_delete(){if(this._rootInternal!==null){repoManagerDeleteRepo(this._repo,this.app.name);this._repoInternal=null;this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(r){if(this._rootInternal===null){fatal("Cannot call "+r+" on a deleted database.")}}}function getDatabase(r=(0,a.Mq)(),i){return(0,a.qX)(r,"database").getImmediate({identifier:i})}function connectDatabaseEmulator(r,i,s,a={}){r=getModularInstance(r);r._checkNotDeleted("useEmulator");if(r._instanceStarted){fatal("Cannot call useEmulator() after instance has already been initialized.")}const l=r._repoInternal;let c=undefined;if(l.repoInfo_.nodeAdmin){if(a.mockUserToken){fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".')}c=new EmulatorTokenProvider(EmulatorTokenProvider.OWNER)}else if(a.mockUserToken){const i=typeof a.mockUserToken==="string"?a.mockUserToken:createMockUserToken(a.mockUserToken,r.app.options.projectId);c=new EmulatorTokenProvider(i)}repoManagerApplyEmulatorSettings(l,i,s,c)}function goOffline(r){r=(0,c.m9)(r);r._checkNotDeleted("goOffline");repoInterrupt(r._repo)}function goOnline(r){r=(0,c.m9)(r);r._checkNotDeleted("goOnline");repoResume(r._repo)}function enableLogging(r,i){enableLogging$1(r,i)}function registerDatabase(r){setSDKVersion(a.Jn);(0,a.Xd)(new l.wA("database",((r,{instanceIdentifier:i})=>{const s=r.getProvider("app").getImmediate();const a=r.getProvider("auth-internal");const l=r.getProvider("app-check-internal");return repoManagerDatabaseFromApp(s,a,l,i)}),"PUBLIC").setMultipleInstances(true));(0,a.KN)(u,d,r);(0,a.KN)(u,d,"esm2017")}const ht={".sv":"timestamp"};function serverTimestamp(){return ht}function increment(r){return{".sv":{increment:r}}}class TransactionResult{constructor(r,i){this.committed=r;this.snapshot=i}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function runTransaction(r,i,s){var a;r=getModularInstance(r);validateWritablePath("Reference.transaction",r._path);if(r.key===".length"||r.key===".keys"){throw"Reference.transaction failed: "+r.key+" is a read-only object."}const l=(a=s===null||s===void 0?void 0:s.applyLocally)!==null&&a!==void 0?a:true;const c=new Deferred;const promiseComplete=(i,s,a)=>{let l=null;if(i){c.reject(i)}else{l=new DataSnapshot(a,new ReferenceImpl(r._repo,r._path),Oe);c.resolve(new TransactionResult(s,l))}};const h=onValue(r,(()=>{}));repoStartTransaction(r._repo,r._path,i,promiseComplete,h,l);return c.promise}PersistentConnection;PersistentConnection.prototype.simpleListen=function(r,i){this.sendRequest("q",{p:r},i)};PersistentConnection.prototype.echo=function(r,i){this.sendRequest("echo",{d:r},i)};Connection;const hijackHash=function(r){const i=PersistentConnection.prototype.put;PersistentConnection.prototype.put=function(s,a,l,c){if(c!==undefined){c=r()}i.call(this,s,a,l,c)};return function(){PersistentConnection.prototype.put=i}};RepoInfo;const forceRestClient=function(r){repoManagerForceRestClient(r)};registerDatabase()},226601:(r,i,s)=>{"use strict";s.d(i,{Z:()=>l});function e(r){this.message=r}e.prototype=new Error,e.prototype.name="InvalidCharacterError";var a="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var i=String(r).replace(/=+$/,"");if(i.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var s,a,l=0,c=0,h="";a=i.charAt(c++);~a&&(s=l%4?64*s+a:a,l++%4)?h+=String.fromCharCode(255&s>>(-2*l&6)):0)a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a);return h};function t(r){var i=r.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return function(r){return decodeURIComponent(a(r).replace(/(.)/g,(function(r,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s})))}(i)}catch(r){return a(i)}}function n(r){this.message=r}function o(r,i){if("string"!=typeof r)throw new n("Invalid token specified");var s=!0===(i=i||{}).header?0:1;try{return JSON.parse(t(r.split(".")[s]))}catch(r){throw new n("Invalid token specified: "+r.message)}}n.prototype=new Error,n.prototype.name="InvalidTokenError";const l=o},906446:r=>{function arrayReduce(r,i,s,a){var l=-1,c=r==null?0:r.length;if(a&&c){s=r[++l]}while(++l<c){s=i(s,r[l],l,r)}return s}r.exports=arrayReduce},240585:r=>{var i=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function asciiWords(r){return r.match(i)||[]}r.exports=asciiWords},573140:(r,i,s)=>{var a=s(688799),l=s(985638);function assignMergeValue(r,i,s){if(s!==undefined&&!l(r[i],s)||s===undefined&&!(i in r)){a(r,i,s)}}r.exports=assignMergeValue},740015:(r,i,s)=>{var a=s(223694),l=s(573140),c=s(749819),h=s(368867),u=s(911611),d=s(953893),p=s(997494);function baseMerge(r,i,s,f,m){if(r===i){return}c(i,(function(c,d){m||(m=new a);if(u(c)){h(r,i,d,s,baseMerge,f,m)}else{var _=f?f(p(r,d),c,d+"",r,i,m):undefined;if(_===undefined){_=c}l(r,d,_)}}),d)}r.exports=baseMerge},368867:(r,i,s)=>{var a=s(573140),l=s(302734),c=s(163428),h=s(37561),u=s(697635),d=s(802900),p=s(719785),f=s(536468),m=s(643854),_=s(828338),y=s(911611),g=s(540861),v=s(248519),C=s(997494),w=s(589328);function baseMergeDeep(r,i,s,E,T,b,P){var S=C(r,s),I=C(i,s),N=P.get(I);if(N){a(r,s,N);return}var k=b?b(S,I,s+"",r,i,P):undefined;var x=k===undefined;if(x){var R=p(I),A=!R&&m(I),F=!R&&!A&&v(I);k=I;if(R||A||F){if(p(S)){k=S}else if(f(S)){k=h(S)}else if(A){x=false;k=l(I,true)}else if(F){x=false;k=c(I,true)}else{k=[]}}else if(g(I)||d(I)){k=S;if(d(S)){k=w(S)}else if(!y(S)||_(S)){k=u(I)}}else{x=false}}if(x){P.set(I,k);T(k,I,E,b,P);P["delete"](I)}a(r,s,k)}r.exports=baseMergeDeep},317646:r=>{function basePropertyOf(r){return function(i){return r==null?undefined:r[i]}}r.exports=basePropertyOf},107270:(r,i,s)=>{var a=s(401197),l=s(557535);function createAssigner(r){return a((function(i,s){var a=-1,c=s.length,h=c>1?s[c-1]:undefined,u=c>2?s[2]:undefined;h=r.length>3&&typeof h=="function"?(c--,h):undefined;if(u&&l(s[0],s[1],u)){h=c<3?undefined:h;c=1}i=Object(i);while(++a<c){var d=s[a];if(d){r(i,d,a,h)}}return i}))}r.exports=createAssigner},368267:(r,i,s)=>{var a=s(906446),l=s(69689),c=s(93254);var h="['\u2019]";var u=RegExp(h,"g");function createCompounder(r){return function(i){return a(c(l(i).replace(u,"")),r,"")}}r.exports=createCompounder},604248:(r,i,s)=>{var a=s(317646);var l={\u00c0:"A",\u00c1:"A",\u00c2:"A",\u00c3:"A",\u00c4:"A",\u00c5:"A",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u00e3:"a",\u00e4:"a",\u00e5:"a",\u00c7:"C",\u00e7:"c",\u00d0:"D",\u00f0:"d",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u00cb:"E",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u00eb:"e",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u00cf:"I",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u00ef:"i",\u00d1:"N",\u00f1:"n",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u00d5:"O",\u00d6:"O",\u00d8:"O",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u00f5:"o",\u00f6:"o",\u00f8:"o",\u00d9:"U",\u00da:"U",\u00db:"U",\u00dc:"U",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u00fc:"u",\u00dd:"Y",\u00fd:"y",\u00ff:"y",\u00c6:"Ae",\u00e6:"ae",\u00de:"Th",\u00fe:"th",\u00df:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u010e:"D",\u0110:"D",\u010f:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011a:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011b:"e",\u011c:"G",\u011e:"G",\u0120:"G",\u0122:"G",\u011d:"g",\u011f:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012a:"I",\u012c:"I",\u012e:"I",\u0130:"I",\u0129:"i",\u012b:"i",\u012d:"i",\u012f:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013b:"L",\u013d:"L",\u013f:"L",\u0141:"L",\u013a:"l",\u013c:"l",\u013e:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014a:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014b:"n",\u014c:"O",\u014e:"O",\u0150:"O",\u014d:"o",\u014f:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015a:"S",\u015c:"S",\u015e:"S",\u0160:"S",\u015b:"s",\u015d:"s",\u015f:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016a:"U",\u016c:"U",\u016e:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016b:"u",\u016d:"u",\u016f:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017b:"Z",\u017d:"Z",\u017a:"z",\u017c:"z",\u017e:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017f:"s"};var c=a(l);r.exports=c},173909:r=>{var i=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function hasUnicodeWord(r){return i.test(r)}r.exports=hasUnicodeWord},557535:(r,i,s)=>{var a=s(985638),l=s(280068),c=s(442383),h=s(911611);function isIterateeCall(r,i,s){if(!h(s)){return false}var u=typeof i;if(u=="number"?l(s)&&c(i,s.length):u=="string"&&i in s){return a(s[i],r)}return false}r.exports=isIterateeCall},997494:r=>{function safeGet(r,i){if(i==="constructor"&&typeof r[i]==="function"){return}if(i=="__proto__"){return}return r[i]}r.exports=safeGet},797025:r=>{var i="\\ud800-\\udfff",s="\\u0300-\\u036f",a="\\ufe20-\\ufe2f",l="\\u20d0-\\u20ff",c=s+a+l,h="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",d="\\xac\\xb1\\xd7\\xf7",p="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",f="\\u2000-\\u206f",m=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_="A-Z\\xc0-\\xd6\\xd8-\\xde",y="\\ufe0e\\ufe0f",g=d+p+f+m;var v="['\u2019]",C="["+g+"]",w="["+c+"]",E="\\d+",T="["+h+"]",b="["+u+"]",P="[^"+i+g+E+h+u+_+"]",S="\\ud83c[\\udffb-\\udfff]",I="(?:"+w+"|"+S+")",N="[^"+i+"]",k="(?:\\ud83c[\\udde6-\\uddff]){2}",x="[\\ud800-\\udbff][\\udc00-\\udfff]",R="["+_+"]",A="\\u200d";var F="(?:"+b+"|"+P+")",O="(?:"+R+"|"+P+")",D="(?:"+v+"(?:d|ll|m|re|s|t|ve))?",M="(?:"+v+"(?:D|LL|M|RE|S|T|VE))?",L=I+"?",W="["+y+"]?",q="(?:"+A+"(?:"+[N,k,x].join("|")+")"+W+L+")*",V="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",G="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",U=W+L+q,B="(?:"+[T,k,x].join("|")+")"+U;var Q=RegExp([R+"?"+b+"+"+D+"(?="+[C,R,"$"].join("|")+")",O+"+"+M+"(?="+[C,R+F,"$"].join("|")+")",R+"?"+F+"+"+D,R+"+"+M,G,V,E,B].join("|"),"g");function unicodeWords(r){return r.match(Q)||[]}r.exports=unicodeWords},69689:(r,i,s)=>{var a=s(604248),l=s(365567);var c=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var h="\\u0300-\\u036f",u="\\ufe20-\\ufe2f",d="\\u20d0-\\u20ff",p=h+u+d;var f="["+p+"]";var m=RegExp(f,"g");function deburr(r){r=l(r);return r&&r.replace(c,a).replace(m,"")}r.exports=deburr},915409:(r,i,s)=>{var a=s(740015),l=s(107270);var c=l((function(r,i,s){a(r,i,s)}));r.exports=c},732526:(r,i,s)=>{var a=s(368267);var l=a((function(r,i,s){return r+(s?"_":"")+i.toLowerCase()}));r.exports=l},589328:(r,i,s)=>{var a=s(335159),l=s(953893);function toPlainObject(r){return a(r,l(r))}r.exports=toPlainObject},93254:(r,i,s)=>{var a=s(240585),l=s(173909),c=s(365567),h=s(797025);function words(r,i,s){r=c(r);i=s?undefined:i;if(i===undefined){return l(r)?h(r):a(r)}return r.match(i)||[]}r.exports=words},277666:(r,i,s)=>{"use strict";s.d(i,{Z:()=>u});var a=s(759312);var l=s(305406);var c=s.n(l);var h=(0,l.memo)((0,l.forwardRef)((function(r,i){return c().createElement("svg",(0,a.pi)({viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",ref:i},r),c().createElement("path",{d:"M14.899 6.101a.999.999 0 010 1.414L7.413 15h19.586a1 1 0 010 2H7.411l7.488 7.486a.999.999 0 11-1.414 1.414l-9.192-9.192a.999.999 0 010-1.414l9.192-9.192a.999.999 0 011.414 0z"}))})));h.displayName="Previous";h["iconName"]="previous";const u=h},711987:(r,i,s)=>{"use strict";s.d(i,{aV:()=>generateState,mk:()=>generatePair});var a=s(952830);var l=s.n(a);var c=s(254458);var h=s.n(c);var u=32;function base64URLEncode(r){return r.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function generateRandomString(r){return base64URLEncode(l()(r))}function sha256(r){return h()("sha256").update(r).digest()}function generateCodeVerifier(r){if(r===void 0){r=u}return generateRandomString(r)}function generateState(r){if(r===void 0){r=u}return generateRandomString(r)}function generateCodeChallenge(r,i){if(i==="plain"){return r}return base64URLEncode(sha256(r))}function generatePair(r,i){if(i===void 0){i=u}var s=generateCodeVerifier(i);var a=generateCodeChallenge(s,r);return{codeVerifier:s,codeChallenge:a}}}}]);