"use strict";(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[8629],{678629:(e,t,r)=>{r.r(t);r.d(t,{VoicemailModule:()=>se});var n=r(461197);var gen=function(e,t,r){if(e===void 0){e="id"}if(t===void 0){t=[]}return{unique:e,indices:t,onUpgrade:r}};var o={name:"Voicemail",version:1,schema:{1:{voicemail:gen("id"),voicemailView:gen("id",["__timestamp"]),userConfigs:gen("key")}}};var i=r(551047);var a=r(667489);var c=r(158820);var l=r(587040);var u=r(228164);var s=r(862926);var f=r(827027);var p="[VOICEMAIL][CORE]";var d=s.ModuleLogger.getLogger(p,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),f.PHONE_EVENT_DATA_FEATURE_KEY);var h=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var v=function(e){h(VoicemailApi,e);function VoicemailApi(){return e!==null&&e.apply(this,arguments)||this}VoicemailApi.downloadTranscription=function(e,t){var r={path:s.RequestPath.buildRequestPath(t),host:e,via:s.NETWORK_VIA.HTTP,method:s.NETWORK_METHOD.GET,authFree:false,pathPrefix:"",HAPriority:s.HA_PRIORITY.HIGH};return this.networkClient.http(r)};return VoicemailApi}(c.BaseRCItemApi);var _=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var m=undefined&&undefined.__assign||function(){m=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return m.apply(this,arguments)};var y=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var b=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var w="VoicemailActionController";var C=function(e){_(VoicemailActionController,e);function VoicemailActionController(t,r){return e.call(this,w,v.rcItemCommonApi,t,r)||this}VoicemailActionController.prototype.downloadTranscription=function(e){return y(this,void 0,void 0,(function(){var t,r,n,o,i,a;return b(this,(function(l){switch(l.label){case 0:return[4,this.entitySourceController.get(e)];case 1:t=l.sent();if(!t){d.tags(w).warn("no entity found for message "+e);return[2]}if(t.transcriptDownloaded){d.tags(w).info("Transcription has already been downloaded for message "+e);return[2]}if(!(t.vmTranscriptionStatus===c.VM_TRANSCRIPTION_STATUS.COMPLETED||t.vmTranscriptionStatus===c.VM_TRANSCRIPTION_STATUS.COMPLETED_PARTIALLY))return[3,5];r=t.attachments&&t.attachments.find((function(e){return e.type===c.ATTACHMENT_TYPE.AUDIO_TRANSCRIPTION_}));if(!r)return[3,4];d.tags(w).info("Start to download transcription for message "+e);n=new URL(r.uri);return[4,v.downloadTranscription(n.origin,n.pathname)];case 2:o=l.sent();i=function(e){return m(m({},e),{transcriptDownloaded:true,transcription:o})};a=function(e){return Promise.resolve(e)};return[4,this.partialModifyController.updatePartially({preHandlePartialEntity:i,doUpdateEntity:a,entityId:e})];case 3:l.sent();l.label=4;case 4:return[3,6];case 5:d.tags(w).info("Invalid transcription status: "+t.vmTranscriptionStatus+" message: "+e);l.label=6;case 6:return[2]}}))}))};return VoicemailActionController}(c.RcMessageActionController);var g;(function(e){e["FETCH_VOICEMAILS_FROM_DB"]="fetch_voicemails_from_db";e["FILTER_AND_SORT_VOICEMAIL"]="filter_and_sort_voicemail";e["FETCH_VOICEMAILS"]="fetch_voicemails";e["CLEAR_ALL_VOICEMAILS"]="clear_all_voicemails";e["CLEAR_ALL_VOICEMAILS_FROM_SERVER"]="clear_all_voicemails_from_server";e["INIT_VOICEMAIL_BADGE"]="init_voicemail_badge"})(g||(g={}));var V=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var T=d.tags("[VoicemailBadgeController]");var S=function(e){V(VoicemailBadgeController,e);function VoicemailBadgeController(t){var r=e.call(this,{badgeId:i.DX,badgeConfigName:i.FY.ENTITY.VOICEMAIL,entityKey:i.FY.ENTITY.VOICEMAIL,lazyInitialization:true,traceLoadPerformance:{key:g.INIT_VOICEMAIL_BADGE,level:s.LOG_CONTROL_LEVEL.HIGH}})||this;r._sourceController=t;return r}VoicemailBadgeController.prototype.getAllEntities=function(){return this._sourceController.getEntities()};VoicemailBadgeController.prototype.getEntityBadge=function(e){return e.availability===c.MESSAGE_AVAILABILITY.ALIVE&&e.readStatus===c.READ_STATUS.UNREAD?1:0};Object.defineProperty(VoicemailBadgeController.prototype,"logger",{get:function(){return T},enumerable:true,configurable:true});return VoicemailBadgeController}(f.AbstractEntityBadgeController);var E=r(470033);var I=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var A=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var O=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var P="VoicemailFetchController";var M=function(e){I(VoicemailFetchController,e);function VoicemailFetchController(t,r,n,o){return e.call(this,{api:v.rcItemCommonApi,userConfig:t,entitySourceController:r,badgeController:n,messageType:f.RC_MESSAGE_TYPE.VOICEMAIL,moduleName:P,rcItemDao:o})||this}VoicemailFetchController.prototype.hasPermission=function(){return A(this,void 0,Promise,(function(){var t,r;return O(this,(function(n){switch(n.label){case 0:return[4,e.prototype.hasPermission.call(this)];case 1:if(!n.sent()){return[2,false]}t=a.accountManager.getCurrent().context.entitlement;r=!!t.get(E.H3.RCExtensionFeaturesId.Voicemail);return[2,Promise.resolve(r)]}}))}))};return VoicemailFetchController}(c.RCMessageFetchController);var F=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var D=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var L=function(){function VoicemailHandleDataController(e,t){var r=this;this._notificationController=e;this._sourceController=t;this.handleVoicemailEvent=function(e){return F(r,void 0,void 0,(function(){var t;return D(this,(function(r){switch(r.label){case 0:return[4,this._sourceController.get(e.id)];case 1:t=r.sent()?false:true;e.__timestamp=Date.parse(e.creationTime);return[4,this._sourceController.update(e)];case 2:r.sent();a.notificationCenter.emitEntityUpdate(this._sourceController.getEntityNotificationKey(),[e]);if(t&&e.availability===c.MESSAGE_AVAILABILITY.ALIVE){this._notificationController.onReceivedNotification([e])}return[2]}}))}))}}return VoicemailHandleDataController}();var R=undefined&&undefined.__assign||function(){R=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return R.apply(this,arguments)};var N=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var x=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var j=d.tags("TranscriptionFetchController");var k="PREFETCH_VM_TRANSCRIPTION";var B=function(){function FetchTranscriptionProcessor(e,t,r){this._name=e;this._processFn=t;this.autoDownload=r}FetchTranscriptionProcessor.prototype.name=function(){return this._name};FetchTranscriptionProcessor.prototype.process=function(){return N(this,void 0,Promise,(function(){return x(this,(function(e){switch(e.label){case 0:return[4,this._processFn()];case 1:e.sent();return[2,Promise.resolve(true)]}}))}))};return FetchTranscriptionProcessor}();var H=function(){function TranscriptionFetchController(e,t){this._partialModifyController=e;this._entitySourceController=t;this._fetchQueue=new a.SequenceProcessorHandler({name:k,addProcessorStrategy:function(e,t,r){var n=e;if(t.autoDownload&&!r){n=e.concat([t])}else if(!t.autoDownload){var o=r?e.filter((function(e){return e.name()!==t.name()})):e;n=[t].concat(o)}return n}})}TranscriptionFetchController.prototype.startFetchTranscriptions=function(e){var t=this;j.log("trigger voicemailIds",e);var r=[];e.forEach((function(e){if(!t._fetchQueue.isProcessorExisted(t._getProcessorName(e))){r.push(t._createFetchProcessor(e,true))}}));this._fetchQueue.addProcessors(r)};TranscriptionFetchController.prototype.stopFetchTranscriptions=function(e){var t=this;j.log("trigger stopFetchTranscriptions",e);e.forEach((function(e){return t._fetchQueue.removeProcessorByName(t._getProcessorName(e))}))};TranscriptionFetchController.prototype._createFetchProcessor=function(e,t,r){var n=this;return new B(this._getProcessorName(e),(function(){return N(n,void 0,void 0,(function(){var t;return x(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);return[4,this._requestTranscription(e)];case 1:n.sent();r&&r.resolve();return[3,3];case 2:t=n.sent();j.info("failed to download transcription",e);r&&r.reject(t);return[3,3];case 3:return[2]}}))}))}),t)};TranscriptionFetchController.prototype.downloadTranscription=function(e){var t=this;j.log("trigger downloadTranscription",e);return new Promise((function(r,n){var o=t._createFetchProcessor(e,false,{resolve:r,reject:n});t._fetchQueue.addProcessor(o)}))};TranscriptionFetchController.prototype._requestTranscription=function(e){return N(this,void 0,void 0,(function(){var t,r,n,o,i,a;return x(this,(function(l){switch(l.label){case 0:return[4,this._entitySourceController.get(e)];case 1:t=l.sent();if(!t){j.warn("no entity found for message "+e);return[2]}if(t.transcriptDownloaded){j.info("Transcription has already been downloaded for message "+e);return[2]}if(!(t.vmTranscriptionStatus===c.VM_TRANSCRIPTION_STATUS.COMPLETED||t.vmTranscriptionStatus===c.VM_TRANSCRIPTION_STATUS.COMPLETED_PARTIALLY))return[3,5];r=t.attachments&&t.attachments.find((function(e){return e.type===c.ATTACHMENT_TYPE.AUDIO_TRANSCRIPTION_}));if(!r)return[3,4];j.info("Start to download transcription for message "+e);n=new URL(r.uri);return[4,v.downloadTranscription(n.origin,n.pathname)];case 2:o=l.sent();i=function(e){return R(R({},e),{transcriptDownloaded:true,transcription:o})};a=function(e){return Promise.resolve(e)};return[4,this._partialModifyController.updatePartially({preHandlePartialEntity:i,doUpdateEntity:a,entityId:e})];case 3:l.sent();l.label=4;case 4:return[3,6];case 5:j.info("Invalid transcription status: "+t.vmTranscriptionStatus+" message: "+e);l.label=6;case 6:return[2]}}))}))};TranscriptionFetchController.prototype._getProcessorName=function(e){return k+"_"+e};return TranscriptionFetchController}();var U=r(298784);var G=r.n(U);var Y=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var q=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var K=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var Q="VoicemailViewDao";var z="All";var W=function(e){Y(VoicemailViewDao,e);function VoicemailViewDao(t){return e.call(this,VoicemailViewDao.COLLECTION_NAME,t,(function(){return[z]}))||this}VoicemailViewDao.prototype.toViewItem=function(e){return{id:e.id,from:this._getFromView(e),__timestamp:e.__timestamp}};VoicemailViewDao.prototype.toPartialViewItem=function(e){return G().pickBy({id:e.id,from:this._getFromView(e),__timestamp:e.__timestamp},G().identity)};VoicemailViewDao.prototype.getCollection=function(){return this.getDb().getCollection(this.modelName)};VoicemailViewDao.prototype._getFromView=function(e){return e.from&&c.RCItemUtils.toCallerView(e.from)};VoicemailViewDao.prototype.queryNewestTimestamp=function(){return q(this,void 0,void 0,(function(){var e;return K(this,(function(t){switch(t.label){case 0:return[4,this.createQuery().orderBy("__timestamp",true).first()];case 1:e=t.sent();d.tags(Q).info("queryOldestTimestamp, ",e);return[2,e?e.__timestamp:undefined]}}))}))};VoicemailViewDao.prototype.queryVoicemails=function(e){return q(this,void 0,Promise,(function(){var t,r,n,o,i,l,u,f,p,h,v,_,m;var y=this;return K(this,(function(b){switch(b.label){case 0:t=d.performance();r=[];n=e.filterKey,o=e.anchorId,i=e.limit,l=i===void 0?c.DEFAULT_FETCH_SIZE:i,u=e.direction,f=u===void 0?a.QUERY_DIRECTION.OLDER:u,p=e.getCallerInfoFunc;if(!!n)return[3,2];return[4,this.fetchItemsFromCache(e,z)];case 1:r=b.sent();return[3,6];case 2:v=o;if(!v)return[3,4];return[4,this.get(o)];case 3:v=b.sent();b.label=4;case 4:h=v||undefined;return[4,c.RCItemUtils.getMatchedViews({isInValidAnchor:!h&&f===a.QUERY_DIRECTION.NEWER,direction:f,filterKey:n,sortFunc:c.RCItemUtils.sortRCItemsByTimestamp(),getEntitiesFunc:function(){return y.getAll()},getCallerInfoFunc:p,translate2EntityForFilter:this._translate2VMForFilter})];case 5:_=b.sent();m=a.ArrayUtils.sliceIdModelArray(_,l,h,f);r=m.data.map((function(e){return e.id}));b.label=6;case 6:t.end({key:g.FILTER_AND_SORT_VOICEMAIL,level:s.LOG_CONTROL_LEVEL.HIGH,count:r.length,infos:{options:e}});return[2,r]}}))}))};VoicemailViewDao.prototype._translate2VMForFilter=function(e){return{id:e.id,direction:f.CALL_DIRECTION.INBOUND,availability:c.MESSAGE_AVAILABILITY.ALIVE,from:e.from}};VoicemailViewDao.COLLECTION_NAME="voicemailView";return VoicemailViewDao}(c.RCItemIdCacheDao);var X=r(95279);var Z=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var J=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var $=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var ee=function(e){Z(VoicemailDao,e);function VoicemailDao(t,r){var n=e.call(this,VoicemailDao.COLLECTION_NAME,t)||this;n._voicemailViewDao=r.getDao(W);n.addViewDaos([n._voicemailViewDao]);return n}VoicemailDao.prototype.queryItems=function(e){return J(this,void 0,Promise,(function(){var t,r;return $(this,(function(n){switch(n.label){case 0:return[4,this._voicemailViewDao.queryVoicemails(e)];case 1:t=n.sent();r=t.length;if(!r)return[3,3];return[4,this.batchGet(t,{order:true})];case 2:r=n.sent();n.label=3;case 3:return[2,r||[]]}}))}))};VoicemailDao.prototype.queryNewestTimestamp=function(){return this._voicemailViewDao.queryNewestTimestamp()};VoicemailDao.prototype.shouldSaveViewItem=function(e){return true};VoicemailDao.prototype.isEntityFitDao=function(e){return true};VoicemailDao.COLLECTION_NAME="voicemail";return VoicemailDao}(X.AbstractComposedDao);var te=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var re=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var ne=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var oe=function(e){te(VoicemailService,e);function VoicemailService(t){var r=e.call(this,{isSupportedCache:false},{dao:t.getDao(ee,t)})||this;r._daoManager=t;r._partialModifyController=new a.PartialModifyController(r.getEntitySource());r._handleVoicemailEvent=function(e){return re(r,void 0,void 0,(function(){return ne(this,(function(t){switch(t.label){case 0:return[4,this.voicemailHandleDataController.handleVoicemailEvent(e)];case 1:t.sent();return[2]}}))}))};r._initBadge=function(){return re(r,void 0,void 0,(function(){return ne(this,(function(e){switch(e.label){case 0:return[4,this.voicemailBadgeController.initializeBadge()];case 1:e.sent();return[2]}}))}))};return r}VoicemailService.prototype.onAppRestored=function(){e.prototype.onAppRestored.call(this);(0,l.gT)().onLoginResult(this._onRCLogin.bind(this))};VoicemailService.prototype._onRCLogin=function(e){if(e.success){this.voicemailFetchController.init();this.voicemailBadgeController.start();this.voicemailFetchController.doSilentSyncLatestData();this._initBadge()}};VoicemailService.prototype.onStarted=function(){e.prototype.onStarted.call(this);this._rcNotificationModule.subscribe(u.RCSubscriptionKeys.Voicemail,this._handleVoicemailEvent)};VoicemailService.prototype.onStopped=function(){this.voicemailFetchController.dispose();this.voicemailBadgeController.stop();this._rcNotificationModule.unsubscribe(u.RCSubscriptionKeys.Voicemail,this._handleVoicemailEvent);e.prototype.onStopped.call(this)};Object.defineProperty(VoicemailService.prototype,"userConfig",{get:function(){if(!this._rcItemUserConfig){this._rcItemUserConfig=new c.RCItemUserConfig(i.cT,this._daoManager.getDBConfigService(),"voicemail")}return this._rcItemUserConfig},enumerable:true,configurable:true});VoicemailService.prototype.updateReadStatus=function(e,t){return re(this,void 0,void 0,(function(){return ne(this,(function(r){switch(r.label){case 0:return[4,this.voicemailActionController.updateReadStatus(e,t)];case 1:return[2,r.sent()]}}))}))};VoicemailService.prototype.getRCItemFetchController=function(){return this.voicemailFetchController};Object.defineProperty(VoicemailService.prototype,"voicemailActionController",{get:function(){if(!this._voicemailActionController){this._voicemailActionController=new C(this.getEntitySource(),this._partialModifyController)}return this._voicemailActionController},enumerable:true,configurable:true});Object.defineProperty(VoicemailService.prototype,"voicemailFetchController",{get:function(){if(!this._voicemailFetchController){this._voicemailFetchController=new M(this.userConfig,this.getEntitySource(),this.voicemailBadgeController,this.dao)}return this._voicemailFetchController},enumerable:true,configurable:true});Object.defineProperty(VoicemailService.prototype,"voicemailBadgeController",{get:function(){if(!this._voicemailBadgeController){this._voicemailBadgeController=new S(this.getEntitySource())}return this._voicemailBadgeController},enumerable:true,configurable:true});Object.defineProperty(VoicemailService.prototype,"voicemailHandleDataController",{get:function(){if(!this._voicemailHandleDataController){this._voicemailHandleDataController=new L(this.getEntityNotificationController(),this.getEntitySource())}return this._voicemailHandleDataController},enumerable:true,configurable:true});Object.defineProperty(VoicemailService.prototype,"transcriptionFetchController",{get:function(){if(!this._transcriptionFetchController){this._transcriptionFetchController=new H(this._partialModifyController,this.getEntitySource())}return this._transcriptionFetchController},enumerable:true,configurable:true});return VoicemailService}(c.AbstractRCItemService);var ie=r(684997);var ae=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var ce=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var le=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;o=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];o=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var ue=undefined&&undefined.__read||function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return i};var se=function(e){ae(VoicemailModule,e);function VoicemailModule(){var t=e!==null&&e.apply(this,arguments)||this;t._getHealthyStatus=function(){return ce(t,void 0,void 0,(function(){var e,t,r,n;return le(this,(function(o){switch(o.label){case 0:e=this.isLoaded()&&this.voicemailService;if(!e)return[3,2];return[4,Promise.all([this.voicemailService.userConfig.getHasMore(),this.voicemailService.getEntitySource().getTotalCount()])];case 1:t=ue.apply(void 0,[o.sent(),2]),r=t[0],n=t[1];return[2,{hasMoreOlder:r,DBCnt:n,lastSyncTime:this.voicemailService.voicemailFetchController.getLastSyncTime(),UMI:this.voicemailService.voicemailBadgeController.getBadge()}];case 2:return[2,{}]}}))}))};return t}VoicemailModule.prototype.onLoad=function(){this._setupNetworkClient();this.voicemailService.start();this._initHealthyModule()};VoicemailModule.prototype.onUnload=function(){this._disposeHealthyModule();this.voicemailService.stop()};VoicemailModule.prototype.getSchema=function(){return o};VoicemailModule.prototype.moduleName=function(){return i.cT};VoicemailModule.prototype.fetchEntities=function(e){return this.voicemailService.fetchEntities(e)};VoicemailModule.prototype.buildFilterFunc=function(e){return this.voicemailService.buildFilterFunc(e)};VoicemailModule.prototype.updateReadStatus=function(e,t){return this.voicemailService.voicemailActionController.updateReadStatus(e,t)};VoicemailModule.prototype.downloadTranscription=function(e){return this.voicemailService.transcriptionFetchController.downloadTranscription(e)};VoicemailModule.prototype.startFetchTranscriptions=function(e){return this.voicemailService.transcriptionFetchController.startFetchTranscriptions(e)};VoicemailModule.prototype.stopFetchTranscriptions=function(e){return this.voicemailService.transcriptionFetchController.stopFetchTranscriptions(e)};VoicemailModule.prototype.deleteVoicemails=function(e){return this.voicemailService.voicemailActionController.deleteRcMessages(e,false)};VoicemailModule.prototype.clearAllVoicemails=function(){return this.voicemailService.voicemailFetchController.clearAll()};VoicemailModule.prototype.startPolling=function(){return this.voicemailService.voicemailFetchController.startPolling()};VoicemailModule.prototype.stopPolling=function(){return this.voicemailService.voicemailFetchController.stopPolling()};VoicemailModule.prototype.silentSyncNewerData=function(){return this.voicemailService.voicemailFetchController.doSilentSyncLatestData()};VoicemailModule.prototype.getById=function(e){return this.voicemailService.getById(e)};VoicemailModule.prototype.addEntityNotificationObserver=function(e){this.voicemailService.addEntityNotificationObserver(e)};VoicemailModule.prototype.removeEntityNotificationObserver=function(e){this.voicemailService.removeEntityNotificationObserver(e)};Object.defineProperty(VoicemailModule.prototype,"voicemailService",{get:function(){if(!this._voicemailService){this._voicemailService=new oe(this.daoManager)}return this._voicemailService},enumerable:true,configurable:true});VoicemailModule.prototype._setupNetworkClient=function(){var e=(0,l.gT)();if(e){v.setNetworkClientProvider((function(){return e.buildNetworkClient()}))}};VoicemailModule.prototype._disposeHealthyModule=function(){this._healthModuleController&&this._healthModuleController.dispose()};VoicemailModule.prototype._initHealthyModule=function(){this._healthModuleController=new ie.HealthModuleController(Symbol(i.cT),i.cT,{VoicemailDataInfo:this._getHealthyStatus});this._healthModuleController.init()};return VoicemailModule}(n.AbstractModule)},551047:(e,t,r)=>{r.d(t,{FY:()=>a,DX:()=>i,cT:()=>o});var n=r(295454);var o=n.Lb.VOICEMAIL;var i=o+".VOICEMAILS";var a={ENTITY:{VOICEMAIL:"ENTITY.VOICEMAIL"}}}}]);