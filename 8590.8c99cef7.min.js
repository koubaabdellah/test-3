"use strict";(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[8590],{588590:(e,t,n)=>{n.r(t);n.d(t,{CallLogModule:()=>Ue});var r=n(667489);var o=n(587040);var gen=function(e,t,n){if(e===void 0){e="id"}if(t===void 0){t=[]}return{unique:e,indices:t,onUpgrade:n}};var i={name:"CallLog",version:1,schema:{1:{callLog:gen("id",["sessionId"]),callLogView:gen("id",["__timestamp"]),userConfigs:gen("key")}}};var l=n(158820);var a=n(228164);var s=n(507857);var u=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var c=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var d=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var f=function(e){u(CallLogUserConfig,e);function CallLogUserConfig(){return e!==null&&e.apply(this,arguments)||this}CallLogUserConfig.prototype.setPseudoCallLogInfo=function(e){return c(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.put(s.bg.PSEUDO_CALL_LOG_INFO,e)];case 1:t.sent();return[2]}}))}))};CallLogUserConfig.prototype.getPseudoCallLogInfo=function(){return c(this,void 0,Promise,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this.get(s.bg.PSEUDO_CALL_LOG_INFO)];case 1:return[2,e.sent()||{}]}}))}))};CallLogUserConfig.prototype.setLastReadMissed=function(e){return c(this,void 0,void 0,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.put(s.bg.LAST_READ_MISSED,e)];case 1:t.sent();return[2]}}))}))};CallLogUserConfig.prototype.getLastReadMissed=function(){return c(this,void 0,Promise,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,this.get(s.bg.LAST_READ_MISSED)];case 1:return[2,e.sent()]}}))}))};return CallLogUserConfig}(l.RCItemUserConfig);var p=n(95279);var h=n(298784);var _=n.n(h);var C=n(862926);var g=n(827027);var L="[CALL_LOG][CORE]";var v=C.ModuleLogger.getLogger(L,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),g.PHONE_EVENT_DATA_FEATURE_KEY);var y;(function(e){e["FETCH_CALL_LOG_FROM_DB"]="fetch_call_log_from_db";e["FILTER_AND_SORT_CALL_LOG"]="filter_and_sort_call_log";e["FETCH_CALL_LOG"]="fetch_call_log";e["CLEAR_ALL_CALL_LOG_FROM_SERVER"]="clear_all_call_log_from_server";e["CLEAR_ALL_CALL_LOG"]="clear_all_call_log";e["DELETE_CALL_LOG_FROM_SERVER"]="delete_call_log_from_server";e["DELETE_CALL_LOG"]="delete_call_log";e["INIT_RC_CALL_LOG_BADGE"]="init_rc_call_log_badge";e["FETCH_RECENT_CALL_LOGS"]="fetch_recent_call_logs";e["FETCH_CALL_WITH_RECORDING"]="fetch_call_with_recording";e["CALL_LOG_MIGRATE_HISTORY"]="call_log_migrate_history"})(y||(y={}));var b=n(328613);var E=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var m=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var R=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var I=undefined&&undefined.__values||function(e){var t=typeof Symbol==="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};var S="CallLogViewDao";var getSectionsFn=function(e){var t=[];if(e.__localInfo&s.jK.IS_MISSED){t.push(s.Nl.MISSED)}if(e.__localInfo&s.jK.HAS_RECORDING){t.push(s.Nl.RECORDING)}if(!(e.__localInfo&s.jK.IS_RECORDING_SOURCE)&&!(e.__localInfo&s.jK.IS_MISSED_SOURCE)){t.push(s.Nl.ALL)}return t};var O=function(e){E(CallLogViewDao,e);function CallLogViewDao(t){return e.call(this,CallLogViewDao.COLLECTION_NAME,t,getSectionsFn)||this}CallLogViewDao.prototype.toViewItem=function(e){return this.toPartialViewItem(e)};CallLogViewDao.prototype.toPartialViewItem=function(e){var t=e.direction?e.direction===g.CALL_DIRECTION.INBOUND?e.from:e.to:undefined;return _().pickBy({id:e.id,__timestamp:e.__timestamp,__localInfo:e.__localInfo,caller:t&&l.RCItemUtils.toCallerView(t)},(function(e){return e!==undefined&&e!==null}))};CallLogViewDao.prototype.getCollection=function(){return this.getDb().getCollection(CallLogViewDao.COLLECTION_NAME)};CallLogViewDao.prototype.queryCallLogs=function(e,t){return m(this,void 0,Promise,(function(){var n,o,i,a,u,c,d,f,p,h,_,g,L,b;return R(this,(function(E){switch(E.label){case 0:n=v.performance();o=[];i=t.filterKey,a=t.limit,u=a===void 0?l.DEFAULT_FETCH_SIZE:a,c=t.direction,d=c===void 0?r.QUERY_DIRECTION.OLDER:c,f=t.anchorId,p=t.callLogSource,h=p===void 0?s.Nl.ALL:p,_=t.getCallerInfoFunc;if(!f)return[3,2];return[4,this.get(f)];case 1:g=E.sent();if(!g){v.tags(S).info("queryCallLogs return [], invalid anchorId:"+f+", direction:"+d+", limit:"+u);return[2,[]]}E.label=2;case 2:if(!!i)return[3,4];return[4,this.fetchItemsFromCache(t,h)];case 3:o=E.sent();return[3,6];case 4:return[4,this.queryAllViews({source:h,desc:false,filterKey:i,getCallerInfoFunc:_,direction:d})];case 5:L=E.sent();if(!(L===null||L===void 0?void 0:L.length)){v.tags(S).info("can not get any callLogView");n.end({key:y.FILTER_AND_SORT_CALL_LOG,level:C.LOG_CONTROL_LEVEL.NORMAL});return[2,[]]}o=r.ArrayUtils.sliceIdArray(L.map((function(e){return e.id})),u===Infinity?l.DEFAULT_FETCH_SIZE:u,f,d);E.label=6;case 6:return[4,e(o)];case 7:b=E.sent();v.tags(S).info("queryCallLogs success, resultSize:"+b.length);n.end({key:y.FILTER_AND_SORT_CALL_LOG,level:C.LOG_CONTROL_LEVEL.NORMAL});return[2,b]}}))}))};CallLogViewDao.prototype._isExpectSourceData=function(e,t){return e===s.Nl.ALL&&!(t.__localInfo&s.jK.IS_MISSED_SOURCE)&&!(t.__localInfo&s.jK.IS_RECORDING_SOURCE)||e===s.Nl.MISSED&&t.__localInfo&s.jK.IS_MISSED||e===s.Nl.RECORDING&&t.__localInfo&s.jK.HAS_RECORDING};CallLogViewDao.prototype.queryAllViews=function(e){return m(this,void 0,Promise,(function(){var t,n,o,i,a,s,u;var c=this;return R(this,(function(d){switch(d.label){case 0:t=e.source,n=e.desc,o=n===void 0?false:n,i=e.filterKey,a=e.getCallerInfoFunc,s=e.direction;u=this.createQuery();return[4,l.RCItemUtils.getMatchedViews({isInValidAnchor:false,direction:s,filterKey:i,sortFunc:function(e,t){return r.SortUtils.sortModelByKey(e,t,[{key:"__timestamp"}],o)},getEntitiesFunc:function(){return u.toArray()},getCallerInfoFunc:a,translate2EntityForFilter:this._translate2CallLogForFilter,filterViewsFunc:function(e){return!!c._isExpectSourceData(t,e)}})];case 1:return[2,d.sent()]}}))}))};CallLogViewDao.prototype.queryOldestCallBySource=function(e){return m(this,void 0,Promise,(function(){var t,n;return R(this,(function(r){switch(r.label){case 0:return[4,this.queryAllViews({source:e,desc:true})];case 1:t=r.sent();n=_().last(t);return[2,n&&n.__timestamp]}}))}))};CallLogViewDao.prototype.queryNewestTimestamp=function(){return m(this,void 0,Promise,(function(){var e,t;return R(this,(function(n){switch(n.label){case 0:return[4,this.createQuery().orderBy("__timestamp",true).first()];case 1:e=n.sent();t=e?e.__timestamp:undefined;v.tags(S).info("queryNewestTimestamp, ",t);return[2,t]}}))}))};CallLogViewDao.prototype.getAllUniquePhoneNumberCalls=function(e){return m(this,void 0,void 0,(function(){var t,n,r,o,i,l,a;var s,u;return R(this,(function(c){switch(c.label){case 0:return[4,this.queryAllViews({source:e,desc:true})];case 1:t=c.sent();n=new Map;try{for(r=I(t),o=r.next();!o.done;o=r.next()){i=o.value;l=i.caller?b.c.buildRecentCallLogCacheKey(i.caller):undefined;if(l){a=n.get(l);if(!a){n.set(l,{id:i.id,creationTime:i.__timestamp})}}}}catch(e){s={error:e}}finally{try{if(o&&!o.done&&(u=r.return))u.call(r)}finally{if(s)throw s.error}}return[2,n]}}))}))};CallLogViewDao.prototype._translate2CallLogForFilter=function(e){return{direction:g.CALL_DIRECTION.INBOUND,from:e.caller,result:e.__localInfo&s.jK.IS_MISSED?s.E7.MISSED:s.E7.UNKNOWN,deleted:false,recording:e.__localInfo&s.jK.HAS_RECORDING?{}:undefined,__localInfo:e.__localInfo,__timestamp:e.__timestamp}};CallLogViewDao.prototype.shouldHandleUpdate=function(){return true};CallLogViewDao.COLLECTION_NAME="callLogView";return CallLogViewDao}(l.RCItemIdCacheDao);var N=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var A=function(e){N(CallLogDao,e);function CallLogDao(t,n){var r=e.call(this,CallLogDao.COLLECTION_NAME,t)||this;r._fetchCallLogsFunc=function(e){return r.batchGet(e,{order:true})};r._viewDao=n.getDao(O);r.addViewDaos([r._viewDao]);return r}CallLogDao.prototype.queryItems=function(e){return this._viewDao.queryCallLogs(this._fetchCallLogsFunc,e)};CallLogDao.prototype.queryAllUniquePhoneNumberCalls=function(e){return this._viewDao.getAllUniquePhoneNumberCalls(e)};CallLogDao.prototype.callLogCount=function(){var e=this.createQuery();return e.count()};CallLogDao.prototype.queryCallLogBySessionId=function(e){var t=this.createQuery();return t.equal("sessionId",e).first()};CallLogDao.prototype.queryNewestTimestamp=function(){return this._viewDao.queryNewestTimestamp()};CallLogDao.prototype.queryOldestCallTimestampBySource=function(e){return this._viewDao.queryOldestCallBySource(e)};CallLogDao.COLLECTION_NAME="callLog";return CallLogDao}(p.AbstractComposedDao);var T=n(390582);var w=n(461197);var D=n(470033);var M={CALL_LOG:"/"+g.API_VERSION+"/account/~/extension/~/call-log",CALL_LOG_SYNC:"/"+g.API_VERSION+"/account/~/extension/~/call-log-sync"};var P=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var F=function(e){P(CallLogApi,e);function CallLogApi(){return e!==null&&e.apply(this,arguments)||this}CallLogApi.queryCallLogs=function(e){var t={params:e,path:C.RequestPath.buildRequestPath(M.CALL_LOG),method:C.NETWORK_METHOD.GET,authFree:false,via:C.NETWORK_VIA.HTTP};return this.networkClient.http(t)};CallLogApi.deleteCallLog=function(e){var t={path:C.RequestPath.buildRequestPath(M.CALL_LOG+"/"+C.FORMAT_MARK,e.join(",")),method:C.NETWORK_METHOD.DELETE,authFree:false,via:C.NETWORK_VIA.HTTP,HAPriority:C.HA_PRIORITY.HIGH};return this.networkClient.http(t)};CallLogApi.syncCallLog=function(e){var t={params:e,path:C.RequestPath.buildRequestPath(M.CALL_LOG_SYNC),authFree:false,via:C.NETWORK_VIA.HTTP,HAPriority:C.HA_PRIORITY.HIGH};return this.networkClient.get(t)};CallLogApi.deleteAllCallLogs=function(e){var t={params:e,path:C.RequestPath.buildRequestPath(M.CALL_LOG),method:C.NETWORK_METHOD.DELETE,authFree:false,via:C.NETWORK_VIA.HTTP,HAPriority:C.HA_PRIORITY.BASIC};return this.networkClient.http(t)};return CallLogApi}(l.BaseRCItemApi);var U=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var G=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var x=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var B=function(e){U(AbstractFetchController,e);function AbstractFetchController(t,n,r,o,i){var l=e.call(this,{syncName:t,syncConfig:n,entityKey:s.FY.ENTITY.CALL_LOG,dao:r})||this;l.sourceController=o;l._badgeController=i;return l}AbstractFetchController.prototype.buildFilterFunc=function(t){return G(this,void 0,Promise,(function(){var n,r,o;return x(this,(function(i){switch(i.label){case 0:n=t.callLogSource,r=n===void 0?s.Nl.ALL:n;return[4,e.prototype.buildFilterFunc.call(this,t)];case 1:o=i.sent();return[2,function(e){var t=true;switch(r){case s.Nl.ALL:t=!(e.__localInfo&s.jK.IS_MISSED_SOURCE)&&!(e.__localInfo&s.jK.IS_RECORDING_SOURCE);break;case s.Nl.MISSED:t=e.result===s.E7.MISSED||e.result===s.E7.VOICEMAIL;break;case s.Nl.RECORDING:t=!!e.recording;break;default:break}return!e.deleted&&t&&o(e)}]}}))}))};AbstractFetchController.prototype.isTokenInvalidError=function(t){var n;v.tags(this.syncName).info("receive sync error",t);return t&&(t.code===g.ERROR_CODES_RC.CLG_101||t.code===g.ERROR_CODES_RC.CLG_102||t.code===g.ERROR_CODES_RC.CLG_104||((n=t.message)===null||n===void 0?void 0:n.includes(g.ERROR_MSG_RC.CALL_LOG_SYNC_TOKEN_INVALID_ERROR_MSG))||e.prototype.isTokenInvalidError.call(this,t))};AbstractFetchController.prototype.requestClearAllAndRemoveLocalData=function(){return G(this,void 0,Promise,(function(){var e;return x(this,(function(t){switch(t.label){case 0:e=v.performance();v.tags(this.syncName).info("clear call logs");return[4,F.deleteAllCallLogs()];case 1:t.sent();e.trace({key:y.CLEAR_ALL_CALL_LOG_FROM_SERVER,level:C.LOG_CONTROL_LEVEL.LOW});return[4,this.removeLocalData()];case 2:t.sent();e.end({key:y.CLEAR_ALL_CALL_LOG,level:C.LOG_CONTROL_LEVEL.LOW});return[2]}}))}))};AbstractFetchController.prototype.removeLocalData=function(){return G(this,void 0,Promise,(function(){return x(this,(function(e){switch(e.label){case 0:return[4,this.sourceController.clear()];case 1:e.sent();return[4,(0,w.getModule)(s.Em).userConfig.setPseudoCallLogInfo({})];case 2:e.sent();return[2]}}))}))};AbstractFetchController.prototype.hasPermission=function(){return Promise.resolve(!!(0,r.getCurrentAccount)().context.entitlement.get(D.H3.RCExtensionFeaturesId.ReadExtensionCallLog))};AbstractFetchController.prototype.reset=function(){return(0,w.getModule)(s.Em).resetFetchControllers()};AbstractFetchController.prototype.internalReset=function(){return e.prototype.reset.call(this)};AbstractFetchController.prototype.getFilterInfo=function(e){var t=e.direction===g.CALL_DIRECTION.INBOUND?e.from?[e.from]:[]:e.to?[e.to]:[];return{callers:t}};AbstractFetchController.prototype.onDBFetchFinished=function(e,t){t&&t.trace({key:y.FETCH_CALL_LOG_FROM_DB+"_"+this.syncName,level:C.LOG_CONTROL_LEVEL.NORMAL,count:e.length})};AbstractFetchController.prototype.onFetchFinished=function(e,t){this._badgeController.handleBadgeUpdate(e);t&&t.end({key:y.FETCH_CALL_LOG+"_"+this.syncName,level:C.LOG_CONTROL_LEVEL.NORMAL,count:e.length})};AbstractFetchController.prototype.getLastItemCreatTimeFromSource=function(e){var t=e.filter((function(e){return!e.deleted})).sort((function(e,t){return T.jj.sortModelByKey(e,t,[{key:"__timestamp"}],true)}));return t.length&&t[0].__timestamp||undefined};AbstractFetchController.prototype.sendSyncRequest=function(e,t,n){return G(this,void 0,Promise,(function(){return x(this,(function(r){switch(r.label){case 0:return[4,F.syncCallLog({syncType:e,recordCount:n,syncToken:t,showDeleted:e!==g.SYNC_TYPE.FSYNC})];case 1:return[2,r.sent()]}}))}))};AbstractFetchController.prototype.tryDoFullSync=function(){return G(this,void 0,void 0,(function(){var e;return x(this,(function(t){switch(t.label){case 0:return[4,this.syncConfig.getSyncToken()];case 1:e=!!t.sent();if(!e){this.doSilentSyncLatestData();v.tags(this.syncName).info("DoFullSync done")}return[2]}}))}))};return AbstractFetchController}(l.RCItemFetchController);var H=n(814678);var k=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var j=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var V=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var K="AllCallLogFetchController";var W=function(e){k(AllCallLogFetchController,e);function AllCallLogFetchController(t,n,r,o,i){var l=e.call(this,K,t,n,r,o)||this;l._userConfig=t;l._callLogDao=n;l._callLogHandleDataController=i;l._handleDataAndSaveInternal=function(e){return j(l,void 0,void 0,(function(){var t,n,r,o,i,l,a;return V(this,(function(u){switch(u.label){case 0:t=[];n=[];r=new Map;return[4,this._userConfig.getPseudoCallLogInfo()];case 1:o=u.sent();e.records.forEach((function(e){if(b.c.isFaxType(e)){return}b.c.addLocalInfoToCallLog(e,s.Nl.ALL);e.deleted=!!e.deleted;var i=o[e.sessionId];if(i){v.tags(K).info("pseudo call log found, need to be replaced",i.id);n.push(i.id);r.set(i.id,e);delete o[e.sessionId]}if(e.deleted){n.push(e.id)}else{t.push(e)}}));i=n.length;if(!i)return[3,3];return[4,this.sourceController.bulkDelete(n)];case 2:i=u.sent();u.label=3;case 3:i;l=t.length;if(!l)return[3,5];return[4,this.sourceController.bulkPut(t)];case 4:l=u.sent();u.label=5;case 5:l;return[4,this._userConfig.setPseudoCallLogInfo(o)];case 6:u.sent();r.size&&H.rF.emitEntityReplace(this.sourceController.getEntityNotificationKey(),r);a=e.records.filter((function(e){return!b.c.isFaxType(e)&&!r.has(e.id)}));v.tags(K).info("handleDataAndSave",{updateLength:t.length,deleteLength:n.length,needNotifyResultsLen:a.length,pseudoInfo:Object.keys(o)});return[2,a]}}))}))};return l}AllCallLogFetchController.prototype.handleDataAndSave=function(e){var t=this;return this._callLogHandleDataController.handleCallLogDataInQueue((function(){return t._handleDataAndSaveInternal(e)}))};AllCallLogFetchController.prototype.fetchAllUniquePhoneNumberCalls=function(){return j(this,void 0,void 0,(function(){var e,t;return V(this,(function(n){switch(n.label){case 0:e=v.performance();return[4,this._callLogDao.queryAllUniquePhoneNumberCalls(s.Nl.ALL)];case 1:t=n.sent();e.end({key:y.FETCH_RECENT_CALL_LOGS,level:C.LOG_CONTROL_LEVEL.HIGH,count:t.size});return[2,t]}}))}))};return AllCallLogFetchController}(B);var Y=n(295454);var q=undefined&&undefined.__assign||function(){q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return q.apply(this,arguments)};var X=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Q=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var z="CallLogActionController";var Z=function(){function CallLogActionController(e,t,n){this._entitySourceController=e;this._badgeController=t;this._callLogDao=n}CallLogActionController.prototype.deleteCallLogs=function(e){return X(this,void 0,void 0,(function(){var t,n,o;return Q(this,(function(i){switch(i.label){case 0:t=v.performance();v.tags(z).info("deleteCallLogs",e);i.label=1;case 1:i.trys.push([1,5,6,7]);return[4,this._entitySourceController.getEntitiesLocally(e,false)];case 2:n=i.sent();n.forEach((function(e){e.deleted=true}));return[4,F.deleteCallLog(e)];case 3:i.sent();t.trace({key:y.DELETE_CALL_LOG_FROM_SERVER,level:C.LOG_CONTROL_LEVEL.LOW});return[4,this._entitySourceController.bulkDelete(e)];case 4:i.sent();r.notificationCenter.emitEntityUpdate(this._entitySourceController.getEntityNotificationKey(),n);return[3,7];case 5:o=i.sent();v.tags(z).warn("failed to delete callLogs: ",e);throw o;case 6:t.end({key:y.DELETE_CALL_LOG,level:C.LOG_CONTROL_LEVEL.LOW});return[7];case 7:return[2]}}))}))};CallLogActionController.prototype.clearUnreadMissedCall=function(){return X(this,void 0,void 0,(function(){var e,t,n;return Q(this,(function(r){switch(r.label){case 0:e=this._badgeController.getBadge();t=Date.now();if(!(e===0))return[3,4];if(!!this._badgeController.readMissedTimestampHandler.isSupportSync())return[3,3];return[4,this._callLogDao.queryNewestTimestamp()];case 1:t=r.sent()||0;return[4,this._getRawLastReadMissedTimeStamp()];case 2:n=r.sent();if(n>t){return[2]}v.tags(z).warn("local raw read timestamp small than latest call log but no badge");return[3,4];case 3:if(t<=Y.lo.ONE_MINUTES+this._lastUpdateMissedTimestamp){return[2]}r.label=4;case 4:v.tags(z).log("clear miss call badge",e);return[4,this._badgeController.readMissedTimestampHandler.updateLastReadMissedTimestamp(t)];case 5:r.sent();this._lastUpdateMissedTimestamp=t;return[2]}}))}))};CallLogActionController.prototype._getRawLastReadMissedTimeStamp=function(){var e,t;return X(this,void 0,void 0,(function(){var n;return Q(this,(function(r){switch(r.label){case 0:return[4,(t=(e=this._badgeController.readMissedTimestampHandler).getRawLastReadMissedTimestamp)===null||t===void 0?void 0:t.call(e)];case 1:n=r.sent();if(n)return[3,3];return[4,this._badgeController.readMissedTimestampHandler.getLastReadMissedTimestamp()];case 2:n=r.sent();r.label=3;case 3:return[2,n||0]}}))}))};CallLogActionController.prototype.updateRecordingDuration=function(e,t){return X(this,void 0,void 0,(function(){var n,o;return Q(this,(function(i){switch(i.label){case 0:return[4,this._entitySourceController.get(e)];case 1:n=i.sent();if(!(n&&n.recording&&n.recording.__duration!==t))return[3,3];o={id:e,recording:q(q({},n.recording),{__duration:t})};return[4,this._entitySourceController.update(o)];case 2:i.sent();r.notificationCenter.emitEntityUpdate(this._entitySourceController.getEntityNotificationKey(),[],[o]);i.label=3;case 3:return[2]}}))}))};return CallLogActionController}();var J=n(302186);var $=n(960782);var ee=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var te=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var ne=function(){function ReadMissedTimestampHandler(e){this._userConfig=e;this._observers=[]}ReadMissedTimestampHandler.prototype.startObserveReadMissedTimestampChange=function(e){this._observers.push(e)};ReadMissedTimestampHandler.prototype.stopObserveReadMissedTimestampChange=function(e){this._observers=this._observers.filter((function(t){return t!==e}))};ReadMissedTimestampHandler.prototype.getLastReadMissedTimestamp=function(){return ee(this,void 0,Promise,(function(){var e;return te(this,(function(t){switch(t.label){case 0:return[4,this._userConfig.getLastReadMissed()];case 1:e=t.sent();if(!!e)return[3,3];e=Date.now();return[4,this._userConfig.setLastReadMissed(e)];case 2:t.sent();t.label=3;case 3:return[2,e]}}))}))};ReadMissedTimestampHandler.prototype.updateLastReadMissedTimestamp=function(e){return ee(this,void 0,Promise,(function(){return te(this,(function(t){switch(t.label){case 0:return[4,this._userConfig.setLastReadMissed(e)];case 1:t.sent();this._notifyTimestampUpdate(e);return[2]}}))}))};ReadMissedTimestampHandler.prototype._notifyTimestampUpdate=function(e){this._observers.forEach((function(t){return t(e)}))};ReadMissedTimestampHandler.prototype.isSupportSync=function(){return false};return ReadMissedTimestampHandler}();var re=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var oe=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ie=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var le=v.tags("[CallLogBadgeController]");var ae=function(e){re(CallLogBadgeController,e);function CallLogBadgeController(t,n){var o=e.call(this,{badgeId:s.sl,badgeConfigName:s.oF,entityKey:s.FY.ENTITY.CALL_LOG,lazyInitialization:true,traceLoadPerformance:{key:y.INIT_RC_CALL_LOG_BADGE,level:C.LOG_CONTROL_LEVEL.HIGH}})||this;o._sourceController=t;o._userConfig=n;o._initDataBarrier=new C.Barrier;o.handleLastReadMissedChanged=function(e){return oe(o,void 0,void 0,(function(){var t;return ie(this,(function(n){switch(n.label){case 0:t=this;return[4,this._getMaxLastReadMissed(e)];case 1:t._lastReadMissed=n.sent();this.recalculateBadge();return[2]}}))}))};o._initReadMissedTimestampObservers=function(){(0,r.setTimeoutWhenAccountAvailable)((function(){return oe(o,void 0,void 0,(function(){var e=this;return ie(this,(function(t){switch(t.label){case 0:le.info("set unread handler",{isMessagePermissionEnabled:this._isMessagePermissionEnabled});if(!this._isMessagePermissionEnabled)return[3,2];return[4,this._onReadMissedTimestampHandlerChanged((function(t){return oe(e,void 0,void 0,(function(){return ie(this,(function(e){switch(e.label){case 0:le.info("switch read miss handler because glip on");if(!t){le.trace("failed to switch read miss handler because handler is undefined");return[2]}this._switchToNewDelegateHandler(t);this.reset();return[4,this.initializeBadge()];case 1:e.sent();this.start();this._initDataBarrier.open();return[2]}}))}))}))];case 1:t.sent();return[3,4];case 2:return[4,this.initializeBadge()];case 3:t.sent();this._startListenReadMissedTimestampChange();this.start();this._initDataBarrier.open();t.label=4;case 4:return[2]}}))}))}),0)};o._setLastReadMissed=function(e){return oe(o,void 0,Promise,(function(){return ie(this,(function(t){switch(t.label){case 0:return[4,this._getMaxLastReadMissed(e)];case 1:e=t.sent();return[4,this._userConfig.setLastReadMissed(e)];case 2:t.sent();return[2,e]}}))}))};return o}CallLogBadgeController.prototype.init=function(){var e=J.Pal.instance.getLifecycle();e.when(J.AppLifecyclePhase.Restored).then(this._initReadMissedTimestampObservers)};CallLogBadgeController.prototype.dispose=function(){this._stopListenReadMissedTimestampChange();this.stop()};CallLogBadgeController.prototype.getAllEntities=function(){return oe(this,void 0,Promise,(function(){var e;return ie(this,(function(t){switch(t.label){case 0:e=this;return[4,this.readMissedTimestampHandler.getLastReadMissedTimestamp()];case 1:e._lastReadMissed=t.sent();return[2,this._sourceController.getEntities()]}}))}))};CallLogBadgeController.prototype.getEntityBadge=function(e){if(e.result!==s.E7.MISSED&&e.result!==s.E7.VOICEMAIL)return 0;return e.deleted||this._lastReadMissed&&this._lastReadMissed>=e.__timestamp?0:1};CallLogBadgeController.prototype.recalculateEntityBadge=function(e,t){var n=this._unreadMap.get(e);if(n!==undefined&&this._lastReadMissed&&this._lastReadMissed>=n)return 0;return t};CallLogBadgeController.prototype.reset=function(){e.prototype.reset.call(this);this._lastReadMissed=undefined};CallLogBadgeController.prototype.onBadgeCacheChange=function(e){switch(e.type){case"reset":this._unreadMap=new Map;break;case"set":e.entity&&this._unreadMap.set(e.id,e.entity.__timestamp);break;case"delete":this._unreadMap.delete(e.id);break;default:le.warn("handleBadgeCache, unknown action:",e)}};CallLogBadgeController.prototype.handleBadgeUpdate=function(t){return oe(this,void 0,void 0,(function(){return ie(this,(function(n){switch(n.label){case 0:return[4,this._initDataBarrier.wait()];case 1:n.sent();return[4,e.prototype.handleBadgeUpdate.call(this,t)];case 2:n.sent();return[2]}}))}))};Object.defineProperty(CallLogBadgeController.prototype,"readMissedTimestampHandler",{get:function(){return this._readMissedTimestampHandler||this.defaultReadMissedTimestampHandler},enumerable:true,configurable:true});CallLogBadgeController.prototype._onReadMissedTimestampHandlerChanged=function(e){return oe(this,void 0,Promise,(function(){var t,n,o,i;var l=this;return ie(this,(function(a){switch(a.label){case 0:t=(0,r.getModule)($.COMMON_KEY_ACTION_MODULE).getKeyActionService().get($.ACTION_KEY.ON_GLIP_LOGIN_RESULT);o=t===null||t===void 0?void 0:t.getAction;if(!o)return[3,2];return[4,t.getAction()];case 1:o=a.sent();a.label=2;case 2:n=o;i=n;if(!i)return[3,4];return[4,n((function(t){return t.success&&e(l._getHandler())}))];case 3:i=a.sent();a.label=4;case 4:i;return[2]}}))}))};CallLogBadgeController.prototype._getHandler=function(){return new(function(){function class_1(){var e=this;this._observers=[];this._handleProfile=function(t){e._observers.forEach((function(e){e(t)}))};this.observeReadMissedTimestampChange()}class_1.prototype.startObserveReadMissedTimestampChange=function(e){this._observers.push(e)};class_1.prototype.stopObserveReadMissedTimestampChange=function(e){this._observers=this._observers.filter((function(t){return t!==e}))};class_1.prototype.getLastReadMissedTimestamp=function(){return oe(this,void 0,Promise,(function(){var e,t;return ie(this,(function(n){switch(n.label){case 0:e=(0,r.getModule)($.COMMON_KEY_ACTION_MODULE).getKeyActionService().get($.ACTION_KEY.GET_LAST_READ_MISSED_TIMESTAMP);t=e===null||e===void 0?void 0:e.getAction;if(!t)return[3,2];return[4,e.getAction()];case 1:t=n.sent();n.label=2;case 2:return[2,t]}}))}))};class_1.prototype.updateLastReadMissedTimestamp=function(e){return oe(this,void 0,Promise,(function(){var t,n,o,i;return ie(this,(function(l){switch(l.label){case 0:t=(0,r.getModule)($.COMMON_KEY_ACTION_MODULE).getKeyActionService().get($.ACTION_KEY.UPDATE_LAST_READ_MISSED_TIMESTAMP);o=t===null||t===void 0?void 0:t.getAction;if(!o)return[3,2];return[4,t.getAction()];case 1:o=l.sent();l.label=2;case 2:n=o;i=n;if(!i)return[3,4];return[4,n(e)];case 3:i=l.sent();l.label=4;case 4:return[2,i]}}))}))};class_1.prototype.observeReadMissedTimestampChange=function(){return oe(this,void 0,Promise,(function(){var e,t,n,o;return ie(this,(function(i){switch(i.label){case 0:e=(0,r.getModule)($.COMMON_KEY_ACTION_MODULE).getKeyActionService().get($.ACTION_KEY.OBSERVE_READ_MISSED_TIMESTAMP_CHANGE);n=e===null||e===void 0?void 0:e.getAction;if(!n)return[3,2];return[4,e.getAction()];case 1:n=i.sent();i.label=2;case 2:t=n;o=t;if(!o)return[3,4];return[4,t(this._handleProfile)];case 3:o=i.sent();i.label=4;case 4:return[2,o]}}))}))};class_1.prototype.isSupportSync=function(){return true};return class_1}())};Object.defineProperty(CallLogBadgeController.prototype,"defaultReadMissedTimestampHandler",{get:function(){if(!this._defaultReadMissedTimestampHandler){this._defaultReadMissedTimestampHandler=new ne(this._userConfig)}return this._defaultReadMissedTimestampHandler},enumerable:true,configurable:true});CallLogBadgeController.prototype._stopListenReadMissedTimestampChange=function(){this.readMissedTimestampHandler.stopObserveReadMissedTimestampChange(this.handleLastReadMissedChanged);this.readMissedTimestampHandler.stopObserveReadMissedTimestampChange(this._setLastReadMissed)};CallLogBadgeController.prototype._startListenReadMissedTimestampChange=function(){this.readMissedTimestampHandler.startObserveReadMissedTimestampChange(this.handleLastReadMissedChanged);this.readMissedTimestampHandler.startObserveReadMissedTimestampChange(this._setLastReadMissed)};CallLogBadgeController.prototype._initDelegateHandler=function(e){var t=this;var n=e.getLastReadMissedTimestamp.bind(e);e.getLastReadMissedTimestamp=function(){return n().then((function(e){return oe(t,void 0,void 0,(function(){var t;return ie(this,(function(n){switch(n.label){case 0:t=e;if(!t)return[3,2];return[4,this._setLastReadMissed(e)];case 1:t=e=n.sent();n.label=2;case 2:t;return[2,e]}}))}))}))};e.getRawLastReadMissedTimestamp=function(){return n()};var r=e.updateLastReadMissedTimestamp.bind(e);e.updateLastReadMissedTimestamp=function(e){return r(e).then((function(){return t._userConfig.setLastReadMissed(e)}))};this._readMissedTimestampHandler=e};CallLogBadgeController.prototype._switchToNewDelegateHandler=function(e){this._stopListenReadMissedTimestampChange();this._initDelegateHandler(e);this._startListenReadMissedTimestampChange()};CallLogBadgeController.prototype._getMaxLastReadMissed=function(e){return oe(this,void 0,Promise,(function(){var t;return ie(this,(function(n){switch(n.label){case 0:return[4,this._userConfig.getLastReadMissed()];case 1:t=n.sent()||0;return[2,Math.max(t,e)]}}))}))};Object.defineProperty(CallLogBadgeController.prototype,"_isMessagePermissionEnabled",{get:function(){var e,t;return(t=(e=(0,o.gT)())===null||e===void 0?void 0:e.context)===null||t===void 0?void 0:t.entitlement.get(D.H3.RCExtensionFeaturesId.Glip)},enumerable:true,configurable:true});Object.defineProperty(CallLogBadgeController.prototype,"logger",{get:function(){return le},enumerable:true,configurable:true});return CallLogBadgeController}(g.AbstractEntityBadgeController);var se=n(274251);var ue=undefined&&undefined.__assign||function(){ue=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return ue.apply(this,arguments)};var ce=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var de=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var fe="CallLogHandleDataController";var pe=function(){function CallLogHandleDataController(e,t,n,o){var i=this;this._userConfig=e;this._sourceController=t;this._notificationController=n;this._callLogDao=o;this._callLogDataHandlingQueue=new r.SequenceProcessorHandler({name:fe});this.handleMissedCallEvent=function(e){return i.handleCallLogDataInQueue((function(){return i._handleMissedCallEventInternal(e)}))};this._handleMissedCallEventInternal=function(e){return ce(i,void 0,void 0,(function(){var t,n,r,o,i;return de(this,(function(l){switch(l.label){case 0:if(!this._userConfig.getSyncToken()||!e.sessionId||!e.timestamp||e.extensionId<=0){v.tags(fe).info("ignore the missed call, ",e.extensionId,e.uuid);return[2]}return[4,this._getCallLogBySessionId(e.sessionId)];case 1:t=l.sent();if(t&&t.result===s.E7.MISSED){v.tags(fe).info("already has the local missed call, ",e.sessionId);return[2]}return[4,this._userConfig.getPseudoCallLogInfo()];case 2:n=l.sent();r=n[e.sessionId];if(r&&r.result===s.E7.MISSED){v.tags(fe).info("already has the pseudo missed call, ",e.sessionId);return[2]}if(!r&&this._handledSessionIds.has(e.sessionId)){return[2]}this._handledSessionIds.add(e.sessionId);o=r&&r.id||e.sessionId+g.CALL_DIRECTION.INBOUND;i=this._getCallLogFromMissedCall(e,o);n[i.sessionId]={id:o,result:s.E7.MISSED};v.tags(fe).info("create pseudo missed call, ",i.id);this._saveDataAndNotify(n,[i]);this._notificationController.onReceivedNotification([i]);return[2]}}))}))};this.handleRCPresenceEvent=function(e){if(e.extensionId.toString()!==i._currentUserExtensionId){return}return i.handleCallLogDataInQueue((function(){return i._handleRCPresenceEventInternal(e)}))};this._handleRCPresenceEventInternal=function(e){return ce(i,void 0,void 0,(function(){var t,n,r;var o=this;return de(this,(function(i){switch(i.label){case 0:if(!this._userConfig.getSyncToken()){v.tags(fe).info("ignore the rc presence");return[2]}return[4,this._userConfig.getPseudoCallLogInfo()];case 1:t=i.sent();n=[];r=e.activeCalls;if(!r)return[3,3];return[4,Promise.all(e.activeCalls.map((function(e){return ce(o,void 0,void 0,(function(){var r,o,i,l;return de(this,(function(a){switch(a.label){case 0:o=!g.CallUtils.isMultiPartyConfCall(e)&&this._hasValidDataInActiveCall(e)&&this._isAnEndCall(e);if(!o)return[3,2];return[4,this._getCallLogBySessionId(e.sessionId)];case 1:o=!a.sent();a.label=2;case 2:r=o;if(!r)return[3,4];return[4,this._userConfig.getPseudoCallLogInfo()];case 3:r=!a.sent()[e.sessionId];a.label=4;case 4:if(r&&!this._handledSessionIds.has(e.sessionId)){this._handledSessionIds.add(e.sessionId);i=e.sessionId+e.direction;l=this._getCallLogFromActiveCall(e,i);t[l.sessionId]={id:i,result:s.E7.UNKNOWN};n.push(l)}return[2]}}))}))})))];case 2:r=i.sent();i.label=3;case 3:r;v.tags(fe).info("create pseudo calls from presence, ",n.map((function(e){return{id:e.id,sessionId:e.sessionId,direction:e.direction}})));if(n.length){this._saveDataAndNotify(t,n)}return[2]}}))}))};this._handledSessionIds=new Set}CallLogHandleDataController.prototype._saveDataAndNotify=function(e,t){return ce(this,void 0,void 0,(function(){var n=this;return de(this,(function(o){switch(o.label){case 0:return[4,this._userConfig.setPseudoCallLogInfo(e)];case 1:o.sent();t.forEach((function(e){return n._handledSessionIds.delete(e.sessionId)}));return[4,this._sourceController.bulkUpdate(t)];case 2:o.sent();r.notificationCenter.emitEntityUpdate(this._sourceController.getEntityNotificationKey(),t);return[2]}}))}))};CallLogHandleDataController.prototype._hasValidDataInActiveCall=function(e){return!!(e.sessionId&&e.direction&&e.telephonyStatus&&e.terminationType&&e.startTime)};CallLogHandleDataController.prototype._isAnEndCall=function(e){return e.telephonyStatus===g.TELEPHONY_STATUS.NoCall&&e.terminationType==="final"};CallLogHandleDataController.prototype._getCallLogBySessionId=function(e){return this._callLogDao.queryCallLogBySessionId(e)};CallLogHandleDataController.prototype._getCallLogFromActiveCall=function(e,t){var n;var r=this._parseCallLog({pseudoId:t,sessionId:e.sessionId,fromNumber:e.from,fromName:e.fromName,toNumber:e.to,toName:e.toName,direction:e.direction,startTime:e.startTime,result:s.E7.UNKNOWN,onBehalfOf:e.onBehalfOf});if(((n=r.from)===null||n===void 0?void 0:n.phoneNumber)===se.vX.PhoneNumberAnonymous){delete r.from}return r};CallLogHandleDataController.prototype._getCallLogFromMissedCall=function(e,t){var n;var r=this._parseCallLog({pseudoId:t,sessionId:e.sessionId,fromNumber:e.from,fromName:e.fromName,toNumber:e.to,toName:e.toName,direction:g.CALL_DIRECTION.INBOUND,startTime:e.timestamp,result:s.E7.MISSED});if(((n=r.from)===null||n===void 0?void 0:n.phoneNumber)===se.vX.PhoneNumberAnonymous){delete r.from}return r};CallLogHandleDataController.prototype._parseCallLog=function(e){var t=e.pseudoId,n=e.sessionId,r=e.fromNumber,o=e.fromName,i=e.toNumber,l=e.toName,a=e.direction,u=e.startTime,c=e.result,d=e.onBehalfOf;var f=0;if(c===s.E7.MISSED||c===s.E7.VOICEMAIL){f=f|s.jK.IS_MISSED|s.jK.IS_INBOUND}else{a===g.CALL_DIRECTION.INBOUND&&(f=f|s.jK.IS_INBOUND)}var p={phoneNumber:r,extensionNumber:"",location:"",name:o};var h={phoneNumber:i,extensionNumber:"",location:"",name:l};var _={sessionId:n,direction:a,startTime:u,result:c,id:t,uri:"",type:s.E.VOICE,action:s.rE.UNKNOWN,duration:0,__localInfo:f,__timestamp:Date.parse(u),deleted:false,__isPseudo:true,to:h,from:p};if(d&&a===g.CALL_DIRECTION.INBOUND){h={extensionId:d,phoneNumber:"",extensionNumber:"",location:"",name:""};_=ue(ue({},_),{delegate:{id:this._currentUserExtensionId,name:l},to:h})}if(d&&a===g.CALL_DIRECTION.OUTBOUND){p={phoneNumber:r,extensionId:d,extensionNumber:"",location:"",name:o};_=ue(ue({},_),{delegate:{id:this._currentUserExtensionId,name:""},from:p})}return _};CallLogHandleDataController.prototype.handleCallLogDataInQueue=function(e){var t=this;return new Promise((function(n,o){var i=new(function(){function class_1(){}class_1.prototype.process=function(){return ce(this,void 0,void 0,(function(){var t,r;return de(this,(function(i){switch(i.label){case 0:i.trys.push([0,2,,3]);t=n;return[4,e()];case 1:t.apply(void 0,[i.sent()]);return[3,3];case 2:r=i.sent();o(r);return[3,3];case 3:return[2,true]}}))}))};class_1.prototype.name=function(){return fe+"_"+Date.now()+"_"+(0,r.randomInt)()};return class_1}());t._callLogDataHandlingQueue.addProcessor(i)}))};Object.defineProperty(CallLogHandleDataController.prototype,"_currentUserExtensionId",{get:function(){return(0,o.gT)().userConfig.getExtensionId().toString()},enumerable:true,configurable:true});return CallLogHandleDataController}();var he=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var _e=undefined&&undefined.__assign||function(){_e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return _e.apply(this,arguments)};var Ce=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ge=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var Le="CallWithRecordingFetchController";var ve=v.tags("["+Le+"]");var ye=function(e){he(CallWithRecordingFetchController,e);function CallWithRecordingFetchController(t,n,r,o){var i=e.call(this,Le,n,t,r,o)||this;i._callLogDao=t;return i}CallWithRecordingFetchController.prototype.handleDataAndSave=function(e){return Ce(this,void 0,Promise,(function(){var t,n,r;return ge(this,(function(o){switch(o.label){case 0:t=e.records.filter((function(e){return!!e.recording}));return[4,b.c.handleCallLogsLocalInfo(t,s.Nl.RECORDING,this._callLogDao)];case 1:n=o.sent();ve.info("handleDataAndSave, data length: ",n.length);r=n.length;if(!r)return[3,3];return[4,this.sourceController.bulkPut(n)];case 2:r=o.sent();o.label=3;case 3:r;return[2,n]}}))}))};CallWithRecordingFetchController.prototype.sendSyncRequest=function(e,t,n){var r={syncType:e,recordCount:n,syncToken:t};if(e===l.SYNC_TYPE.FSYNC){r=_e(_e({},r),{statusGroup:s.Nl.ALL,withRecording:true})}return F.syncCallLog(r)};return CallWithRecordingFetchController}(B);var be=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ee=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var me=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var Re="MissedCallLogFetchController";var Ie=function(e){be(MissedCallLogFetchController,e);function MissedCallLogFetchController(t,n,r,o){var i=e.call(this,Re,t,o,n,r)||this;i._callLogDao=o;return i}MissedCallLogFetchController.prototype.handleDataAndSave=function(e){return Ee(this,void 0,Promise,(function(){var t,n;return me(this,(function(r){switch(r.label){case 0:return[4,b.c.handleCallLogsLocalInfo(e.records,s.Nl.MISSED,this._callLogDao)];case 1:t=r.sent();v.tags(Re).info("handleDataAndSave, data length: ",t.length);n=t.length;if(!n)return[3,3];return[4,this.sourceController.bulkPut(t)];case 2:n=r.sent();r.label=3;case 3:n;return[2,t]}}))}))};MissedCallLogFetchController.prototype.sendSyncRequest=function(e,t,n){return F.syncCallLog({syncType:e,recordCount:n,syncToken:t,statusGroup:e===l.SYNC_TYPE.FSYNC?s.Nl.MISSED:undefined})};return MissedCallLogFetchController}(B);var Se=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Oe=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var getCallLogDBHistory=function(e){return{version:1,moduleName:s.oF,changes:{1:function(){return Se(void 0,void 0,void 0,(function(){var t,n,o,i;return Oe(this,(function(l){switch(l.label){case 0:v.tags("DBChangeHistory").log("start update call log data");t=v.performance();n=e.getDao(A,e);return[4,n.getAll()];case 1:o=l.sent();i=[];o.forEach((function(e){if(b.c.isFaxType(e)){i.push(e)}}));if(!i.length)return[3,3];return[4,n.bulkDelete(i.map((function(e){return e.id})))];case 2:l.sent();r.notificationCenter.emitEntityUpdate(s.FY.ENTITY.CALL_LOG,[],i);l.label=3;case 3:t.end({key:y.CALL_LOG_MIGRATE_HISTORY,level:C.LOG_CONTROL_LEVEL.LOW,count:i.length});v.tags("DBChangeHistory").log("end update call log data");return[2]}}))}))}}}};var Ne=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Ae=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Te=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var we=function(e){Ne(CallLogService,e);function CallLogService(t){var n=e.call(this,{isSupportedCache:false},{dao:t.getDao(A,t)})||this;n._daoManager=t;n._onRCLogin=function(e){if(e.success){setTimeout((function(){n.allCallLogFetchController.init();n.callLogBadgeController.init();n.allCallLogFetchController.doSilentSyncLatestData();n.callWithRecordingFetchController.tryDoFullSync();n.missedCallLogFetchController.tryDoFullSync()}))}};n._handleMissedCallEvent=function(e){return n.callLogHandleDataController.handleMissedCallEvent(e)};n._handleRCPresenceEvent=function(e){return n.callLogHandleDataController.handleRCPresenceEvent(e)};return n}CallLogService.prototype.onAppRestored=function(){e.prototype.onAppRestored.call(this);(0,o.gT)().onLoginResult(this._onRCLogin)};CallLogService.prototype.onStarted=function(){var t=this;e.prototype.onStarted.call(this);this._rcNotificationModule.subscribe(a.RCSubscriptionKeys.MissedCall,this._handleMissedCallEvent);this._rcNotificationModule.subscribe(a.RCSubscriptionKeys.TelephonyDetail,this._handleRCPresenceEvent);r.dbMigrator.addHistory({getDBHistoryDetail:function(){return getCallLogDBHistory(t._daoManager)}})};CallLogService.prototype.onStopped=function(){this.allCallLogFetchController.dispose();this.callLogBadgeController.dispose();this._rcNotificationModule.unsubscribe(a.RCSubscriptionKeys.MissedCall,this._handleMissedCallEvent);this._rcNotificationModule.unsubscribe(a.RCSubscriptionKeys.TelephonyDetail,this._handleRCPresenceEvent);e.prototype.onStopped.call(this)};Object.defineProperty(CallLogService.prototype,"userConfig",{get:function(){if(!this._userConfig){this._userConfig=new f(s.oF+"."+s.Nl.ALL,this._daoManager.getDBConfigService(),"callLog."+s.Nl.ALL)}return this._userConfig},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"missedCallUserConfig",{get:function(){if(!this._missedCallUserConfig){this._missedCallUserConfig=new l.RCItemUserConfig(s.oF+"."+s.Nl.MISSED,this._daoManager.getDBConfigService())}return this._missedCallUserConfig},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"callWithRecordingUserConfig",{get:function(){if(!this._callWithRecordingConfig){this._callWithRecordingConfig=new l.RCItemUserConfig(s.oF+"."+s.Nl.RECORDING,this._daoManager.getDBConfigService())}return this._callWithRecordingConfig},enumerable:true,configurable:true});CallLogService.prototype.updateCallRecordingDuration=function(e,t){return this.callLogActionController.updateRecordingDuration(e,t)};CallLogService.prototype.getRCItemFetchController=function(){return this.allCallLogFetchController};CallLogService.prototype.fetchEntities=function(e){var t=e.callLogSource,n=t===void 0?s.Nl.ALL:t;switch(n){case s.Nl.ALL:return this.allCallLogFetchController.fetchData(e);case s.Nl.MISSED:return this.missedCallLogFetchController.fetchData(e);case s.Nl.RECORDING:return this.callWithRecordingFetchController.fetchData(e);default:return Promise.resolve({data:[],hasMore:false})}};CallLogService.prototype.fetchRecentCallLogs=function(){return this.allCallLogFetchController.fetchAllUniquePhoneNumberCalls()};CallLogService.prototype.clearUnreadMissedCall=function(){return this.callLogActionController.clearUnreadMissedCall()};CallLogService.prototype.deleteCallLogs=function(e){return this.callLogActionController.deleteCallLogs(e)};CallLogService.prototype.clearAllCallLogs=function(){return this.allCallLogFetchController.clearAll()};CallLogService.prototype.resetFetchControllers=function(){return Ae(this,void 0,void 0,(function(){return Te(this,(function(e){switch(e.label){case 0:return[4,Promise.all([this.allCallLogFetchController.internalReset(),this.missedCallLogFetchController.internalReset(),this.callWithRecordingFetchController.internalReset()])];case 1:e.sent();return[2]}}))}))};CallLogService.prototype.getTotalCount=function(){return this.getEntitySource().getTotalCount()};Object.defineProperty(CallLogService.prototype,"callLogActionController",{get:function(){if(!this._callLogActionController){this._callLogActionController=new Z(this.getEntitySource(),this.callLogBadgeController,this._callLogDao)}return this._callLogActionController},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"allCallLogFetchController",{get:function(){if(!this._allCallLogFetchController){this._allCallLogFetchController=new W(this.userConfig,this._callLogDao,this.getEntitySource(),this.callLogBadgeController,this.callLogHandleDataController)}return this._allCallLogFetchController},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"callWithRecordingFetchController",{get:function(){if(!this._recordingCallFetchController){this._recordingCallFetchController=new ye(this._callLogDao,this.callWithRecordingUserConfig,this.getEntitySource(),this.callLogBadgeController)}return this._recordingCallFetchController},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"missedCallLogFetchController",{get:function(){if(!this._missedCallLogFetchController){this._missedCallLogFetchController=new Ie(this.missedCallUserConfig,this.getEntitySource(),this.callLogBadgeController,this._callLogDao)}return this._missedCallLogFetchController},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"callLogBadgeController",{get:function(){if(!this._callLogBadgeController){this._callLogBadgeController=new ae(this.getEntitySource(),this.userConfig)}return this._callLogBadgeController},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"callLogHandleDataController",{get:function(){this._callLogHandleDataController=r.ObjectUtils.buildObjectHelper(this._callLogHandleDataController,pe,this.userConfig,this.getEntitySource(),this.getEntityNotificationController(),this._callLogDao);return this._callLogHandleDataController},enumerable:true,configurable:true});Object.defineProperty(CallLogService.prototype,"_callLogDao",{get:function(){return this.dao},enumerable:true,configurable:true});return CallLogService}(l.AbstractRCItemService);var De=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var Me=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Pe=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var Fe=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],l;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){l={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(l)throw l.error}}return i};var Ue=function(e){De(CallLogModule,e);function CallLogModule(t){var n=e.call(this,t)||this;n._getHealthyStatus=function(){return Me(n,void 0,void 0,(function(){var e,t,n,r,o;return Pe(this,(function(i){switch(i.label){case 0:if(!this.isLoaded())return[3,2];return[4,Promise.all([this.callLogService.userConfig.getLastReadMissed(),this.callLogService.userConfig.getHasMore(),this.callLogService.getEntitySource().getTotalCount(),this.callLogService.userConfig.getPseudoCallLogInfo()])];case 1:e=Fe.apply(void 0,[i.sent(),4]),t=e[0],n=e[1],r=e[2],o=e[3];return[2,{lastReadMissed:t,hasMoreOlder:n,DBCnt:r,pseudoInfo:o,lastSyncNewerTime:this.callLogService.allCallLogFetchController.getLastSyncTime(),UMI:this.callLogService.callLogBadgeController.getBadge()}];case 2:return[2,{}]}}))}))};return n}CallLogModule.prototype.onLoad=function(){this._setupNetworkClient();this.callLogService.start();this._initHealthyModule()};CallLogModule.prototype.onUnload=function(){this._disposeHealthyModule();this.callLogService.stop()};CallLogModule.prototype.getSchema=function(){return i};CallLogModule.prototype.moduleName=function(){return s.Em};CallLogModule.prototype.batchGet=function(e,t){return this.callLogService.batchGet(e,{order:t})};CallLogModule.prototype.fetchEntities=function(e){var t=e.callLogSource,n=t===void 0?s.Nl.ALL:t;switch(n){case s.Nl.ALL:return this.callLogService.allCallLogFetchController.fetchData(e);case s.Nl.MISSED:return this.callLogService.missedCallLogFetchController.fetchData(e);case s.Nl.RECORDING:return this.callLogService.callWithRecordingFetchController.fetchData(e);default:return Promise.resolve({data:[],hasMore:false})}};CallLogModule.prototype.buildFilterFunc=function(e){return this.callLogService.allCallLogFetchController.buildFilterFunc(e)};CallLogModule.prototype.startPolling=function(){return this.callLogService.allCallLogFetchController.startPolling()};CallLogModule.prototype.stopPolling=function(){return this.callLogService.allCallLogFetchController.stopPolling()};CallLogModule.prototype.silentSyncNewerData=function(){return this.callLogService.allCallLogFetchController.doSilentSyncLatestData()};CallLogModule.prototype.getById=function(e){return this.callLogService.getById(e)};CallLogModule.prototype.addEntityNotificationObserver=function(e){this.callLogService.addEntityNotificationObserver(e)};CallLogModule.prototype.removeEntityNotificationObserver=function(e){this.callLogService.removeEntityNotificationObserver(e)};CallLogModule.prototype.updateCallRecordingDuration=function(e,t){return this.callLogService.callLogActionController.updateRecordingDuration(e,t)};CallLogModule.prototype.clearAllCallLogs=function(){return this.callLogService.allCallLogFetchController.clearAll()};CallLogModule.prototype.fetchRecentCallLogs=function(){return this.callLogService.allCallLogFetchController.fetchAllUniquePhoneNumberCalls()};CallLogModule.prototype.clearUnreadMissedCall=function(){return this.callLogService.callLogActionController.clearUnreadMissedCall()};CallLogModule.prototype.deleteCallLogs=function(e){return this.callLogService.callLogActionController.deleteCallLogs(e)};CallLogModule.prototype.getTotalCount=function(){return this.callLogService.getEntitySource().getTotalCount()};Object.defineProperty(CallLogModule.prototype,"userConfig",{get:function(){return this.callLogService.userConfig},enumerable:true,configurable:true});CallLogModule.prototype.resetFetchControllers=function(){return this.callLogService.resetFetchControllers()};Object.defineProperty(CallLogModule.prototype,"callLogService",{get:function(){if(!this._callLogService){this._callLogService=new we(this.daoManager)}return this._callLogService},enumerable:true,configurable:true});CallLogModule.prototype._setupNetworkClient=function(){var e=(0,o.gT)();if(e){F.setNetworkClientProvider((function(){return e.buildNetworkClient()}))}};CallLogModule.prototype._initHealthyModule=function(){this._healthModuleController=new r.HealthModuleController(Symbol(this.moduleName()),this.moduleName(),{CallLogInfo:this._getHealthyStatus});this._healthModuleController.init()};CallLogModule.prototype._disposeHealthyModule=function(){this._healthModuleController&&this._healthModuleController.dispose()};return CallLogModule}(r.AbstractModule)},507857:(e,t,n)=>{n.d(t,{E:()=>a,rE:()=>s,E7:()=>u,Nl:()=>r.STATUS_GROUP,sl:()=>C,oF:()=>i,bg:()=>_,jK:()=>h,FY:()=>l,Em:()=>i});var r=n(827027);var o=n(295454);var i=o.Lb.CALL_LOG;var l={ENTITY:{CALL_LOG:"ENTITY.CALLLOG"},SERVICE:{RESET_DATA:"RESET_DATA"}};var a;(function(e){e["VOICE"]="Voice";e["FAX"]="Fax"})(a||(a={}));var s;(function(e){e["UNKNOWN"]="Unknown";e["PHONE_CALL"]="Phone Call";e["PHONE_LOGIN"]="Phone Login";e["INCOMING_FAX"]="Incoming Fax";e["ACCEPT_CALL"]="Accept Call";e["FIND_ME"]="FindMe";e["FOLLOW_ME"]="FollowMe";e["OUTGOING_FAX"]="Outgoing Fax";e["CALL_RETURN"]="Call Return";e["CALLING_CARD"]="Calling Card";e["RING_DIRECTLY"]="Ring Directly";e["RING_OUT_WEB"]="RingOut Web";e["VoIP_CALL"]="VoIP Call";e["RING_OUT_RC"]="RingOut PC";e["RING_ME"]="RingMe";e["TRANSFER"]="Transfer";e["INFO_411"]="411 Info";e["EMERGENCY"]="Emergency";e["E911_UPDATE"]="E911 Update";e["SUPPORT"]="Support";e["RING_OUT_MOBILE"]="RingOut Mobile"})(s||(s={}));var u;(function(e){e["UNKNOWN"]="Unknown";e["RESULT_IN_PROGRESS"]="ResultInProgress";e["MISSED"]="Missed";e["CALL_ACCEPTED"]="Call accepted";e["VOICEMAIL"]="Voicemail";e["REJECTED"]="Rejected";e["REPLY"]="Reply";e["RECEIVED"]="Received";e["RECEIVE_ERROR"]="Receive Error";e["FAX_ON_DEMAND"]="Fax on Demand";e["PARTIAL_RECEIVE"]="Partial Receive";e["BLOCKED"]="Blocked";e["CALL_CONNECTED"]="Call connected";e["NO_ANSWER"]="No Answer";e["INTERNATIONAL_DISABLED"]="International Disabled";e["BUSY"]="Busy";e["SEND_ERROR"]="Send Error";e["SENT"]="Sent";e["NO_FAX_MACHINE"]="No fax machine";e["RESULT_EMPTY"]="ResultEmpty";e["ACCOUNT"]="Account";e["SUSPENDED"]="Suspended";e["CALL_FAILED"]="Call Failed";e["CALL_FAILURE_"]="Call Failure";e["INTERNAL_ERROR_"]="Internal Error";e["IP_PHONE_OFFLINE"]="IP Phone offline";e["RESTRICTED_NUMBER"]="Restricted Number";e["WRONG_NUMBER"]="Wrong Number";e["STOPPED"]="Stopped";e["HANG_UP"]="Hang up";e["POOR_LINE_QUALITY"]="Poor Line Quality";e["PARTIALLY_SENT"]="Partially Sent";e["INTERNATIONAL_RESTRICTION_"]="International Restriction";e["ABANDONED"]="Abandoned";e["DECLINED"]="Declined";e["FAX_RECEIPT_ERROR"]="Fax Receipt Error";e["FAX_SEND_ERROR"]="Fax Send Error"})(u||(u={}));var c;(function(e){e["ACCEPTED"]="Accepted";e["CONNECTED"]="Connected";e["LINE_BUSY"]="Line Busy";e["NOT_ANSWERED"]="Not Answered";e["NO_ANSWER"]="No Answer";e["HANG_UP"]="Hang Up";e["STOPPED"]="Stopped";e["INTERNAL_ERROR"]="Internal Error";e["NO_CREDIT"]="No Credit";e["RESTRICTED_NUMBER"]="Restricted Number";e["WRONG_NUMBER"]="Wrong Number";e["INTERNATIONAL_DISABLED"]="International Disabled";e["INTERNATIONAL_RESTRICTED"]="International Restricted";e["BAD_NUMBER"]="Bad Number";e["INFO_411_RESTRICTED"]="Info 411 Restricted";e["CUSTOMER_611_RESTRICTED"]="Customer 611 Restricted";e["NO_DIGITAL_LINE"]="No Digital Line";e["FAILED_TRY_AGAIN"]="Failed Try Again";e["MAX_CALL_LIMIT"]="Max Call Limit";e["TOO_MANY_CALLS"]="Too Many Calls";e["CALLS_NOT_ACCEPTED"]="Calls Not Accepted";e["NUMBER_NOT_ALLOWED"]="Number Not Allowed";e["NUMBER_BLOCKED"]="Number Blocked";e["NUMBER_DISABLED_"]="Number Disabled";e["RESOURCE_ERROR"]="Resource Error";e["CALL_LOOP"]="Call Loop";e["FAX_NOT_RECEIVED"]="Fax Not Received";e["FAX_PARTIALLY_SENT"]="Fax Partially Sent";e["FAX_NOT_SENT"]="Fax Not Sent";e["FAX_POOR_LINE"]="Fax Poor Line";e["FAX_PREPARE_ERROR"]="Fax Prepare Error";e["FAX_SAVE_ERROR"]="Fax Save Error";e["FAX_SEND_ERROR"]="Fax Send Error"})(c||(c={}));var d;(function(e){e["AUTOMATIC"]="Automatic";e["ON_DEMAND"]="OnDemand"})(d||(d={}));var f;(function(e){e["PSTN"]="PSTN";e["VoIP"]="VoIP"})(f||(f={}));var p;(function(e){e["SIP_FORWARDING"]="SipForwarding";e["SERVICE_MINUS_2"]="ServiceMinus2";e["SERVICE_MINUS_3"]="ServiceMinus3";e["PSTN_TO_SIP"]="PstnToSip";e["ACCEPT"]="Accept";e["FIND_ME"]="FindMe";e["FOLLOW_ME"]="FollowMe";e["TEST_CALL"]="TestCall";e["FAX_SENT"]="FaxSent";e["CALL_BACK"]="CallBack";e["CALLING_CARD"]="CallingCard";e["RING_DIRECTLY"]="RingDirectly";e["RING_OUT_WEB_TO_SUBSCRIBER"]="RingOutWebToSubscriber";e["RING_OUT_WEB_TO_CALLER"]="RingOutWebToCaller";e["SIP_TO_PSTN_METERED"]="SipToPstnMetered";e["RING_OUT_CLIENT_TO_SUBSCRIBER"]="RingOutClientToSubscriber";e["RING_OUT_CLIENT_TO_CALLER"]="RingOutClientToCaller";e["RING_ME"]="RingMe";e["TRANSFER_CALL"]="TransferCall";e["SIP_TO_PSTN_UNMETERED"]="SipToPstnUnmetered";e["RING_OUT_DEVICE_TO_SUBSCRIBER"]="RingOutDeviceToSubscriber";e["RING_OUT_DEVICE_TO_CALLER"]="RingOutDeviceToCaller";e["RING_OUT_ONE_LEG_TO_CALLER"]="RingOutOneLegToCaller";e["EXTENSION_TO_EXTENSION"]="ExtensionToExtension";e["CALL_PARK"]="CallPark";e["PAGING_SERVER"]="PagingServer";e["HUNTING"]="Hunting";e["OUTGOING_FREE_SP_DL"]="OutgoingFreeSpDl";e["PARK_LOCATION"]="ParkLocation";e["CONFERENCE_CALL"]="ConferenceCall";e["MOBILE_APP"]="MobileApp";e["MOVE_TO_CONFERENCE"]="MoveToConference";e["UNKNOWN"]="Unknown"})(p||(p={}));var h;(function(e){e[e["IS_INBOUND"]=1]="IS_INBOUND";e[e["IS_MISSED"]=2]="IS_MISSED";e[e["IS_MISSED_SOURCE"]=4]="IS_MISSED_SOURCE";e[e["IS_RECORDING_SOURCE"]=8]="IS_RECORDING_SOURCE";e[e["HAS_RECORDING"]=16]="HAS_RECORDING"})(h||(h={}));var _={PSEUDO_CALL_LOG_INFO:"pseudo_call_log_info",LAST_READ_MISSED:"last_read_missed"};var C=i+".MISSED_CALLS";var g=20;var L=50;var v=1},328613:(e,t,n)=>{n.d(t,{c:()=>u});var r=n(827027);var o=n(166418);var i=n(507857);var l=undefined&&undefined.__assign||function(){l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return l.apply(this,arguments)};var a=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var s=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,l;return l={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(l[Symbol.iterator]=function(){return this}),l;function verb(e){return function(t){return step([e,t])}}function step(l){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=l[0]&2?o["return"]:l[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;if(o=0,i)l=[l[0]&2,i.value];switch(l[0]){case 0:case 1:i=l;break;case 4:n.label++;return{value:l[1],done:false};case 5:n.label++;o=l[1];l=[0];continue;case 7:l=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1];i=l;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(l);break}if(i[2])n.ops.pop();n.trys.pop();continue}l=t.call(e,n)}catch(e){l=[6,e];o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:true}}};var u=function(){function CallLogUtils(){}CallLogUtils.handleCallLogsLocalInfo=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o;var a=this;return s(this,(function(s){switch(s.label){case 0:r=[];if(!(t!==i.Nl.ALL))return[3,2];return[4,n.queryOldestCallTimestampBySource(i.Nl.ALL)];case 1:o=s.sent();s.label=2;case 2:e.forEach((function(e){var n=Date.parse(e.startTime);if(!o||n<o){a.addLocalInfoToCallLog(e,t,n);r.push(l({},e))}}));return[2,r]}}))}))};CallLogUtils.isFaxType=function(e){return e.type===i.E.FAX};CallLogUtils.addLocalInfoToCallLog=function(e,t,n){var o;e.__timestamp=n||Date.parse(e.startTime);e.__localInfo=0;e.from=(o=e.from)!==null&&o!==void 0?o:{};if(t===i.Nl.MISSED){e.__localInfo=e.__localInfo|i.jK.IS_MISSED_SOURCE}else if(t===i.Nl.RECORDING){e.__localInfo=e.__localInfo|i.jK.IS_RECORDING_SOURCE}if(e.result===i.E7.MISSED||e.result===i.E7.VOICEMAIL){e.__localInfo=e.__localInfo|i.jK.IS_MISSED|i.jK.IS_INBOUND}else{e.__localInfo=e.direction===r.CALL_DIRECTION.INBOUND?e.__localInfo|i.jK.IS_INBOUND:e.__localInfo;if(e.recording){e.__localInfo=e.__localInfo|i.jK.HAS_RECORDING}}};CallLogUtils.buildRecentCallLogCacheKey=function(e){var t=e.extensionNumber||e.phoneNumber;return t?o.PhoneContactUtils.buildPhoneContactId({phoneNumber:t,displayName:e===null||e===void 0?void 0:e.name}):undefined};return CallLogUtils}()}}]);