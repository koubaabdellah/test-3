"use strict";(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[9031],{819031:(e,t,n)=>{n.r(t);n.d(t,{E911Module:()=>ye});var r=n(667489);var o=n(862926);var i=n(827027);var s=n(587040);var a=n(379269);var u=n(794104);var c=n(298784);var l=n.n(c);var d=n(696206);var f=n(831513);var h=n(295454);var p=n(598263);var v=n(324865);var E=n(484181);var g=n(228164);var _=n(271010);var y=n(693914);var C=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var m=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var A=function(){function AbstractE911Controller(e,t){this.sipProvisionController=e;this.getCurrentRegionDigitalLine=t}AbstractE911Controller.prototype.isInAutoAssignAddressMode=function(){return Promise.resolve(false)};AbstractE911Controller.prototype.isAutoAssignAddressFinished=function(){return Promise.resolve(true)};AbstractE911Controller.prototype.clearEmergencyAddress=function(){_.q1.removeEmergencyAddress();r.notificationCenter.emit(a.FY.RC_INFO_SERVICE.E911_UPDATED,v.El.ADDRESS_CHANGED)};AbstractE911Controller.prototype.requireE911Address=function(){return Promise.resolve(true)};AbstractE911Controller.prototype.onReceiveSipProv=function(e,t){return Promise.resolve()};AbstractE911Controller.prototype.isNoActualEA=function(){return Promise.resolve(false)};AbstractE911Controller.prototype.handleLocationAuthStatusChange=function(){};AbstractE911Controller.prototype.getCurrentDigitalLine=function(){return C(this,void 0,Promise,(function(){var e,t;return m(this,(function(n){switch(n.label){case 0:e=y.Z.getPhoneLineId(this.sipProvisionController.getSipProv());if(!e){return[2,undefined]}return[4,this.rcInfoModule.getDigitalLines()];case 1:t=n.sent();return[2,t===null||t===void 0?void 0:t.find((function(t){return a.te.getPhoneLineId(t)===e}))]}}))}))};Object.defineProperty(AbstractE911Controller.prototype,"rcInfoModule",{get:function(){return(0,r.getModule)(a.oF)},enumerable:true,configurable:true});return AbstractE911Controller}();var b=n(302186);var P=n(470033);var I=n(38942);var R=n(682958);var N=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var L=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var S=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var w=R.k.tags("[NetworkInfoController]");var O=function(e){N(NetworkInfoController,e);function NetworkInfoController(t){var n=e.call(this)||this;n._hasN911Permission=t;n._initBarrier=new o.Barrier;n._handleOnLine=function(e){return L(n,void 0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:if(!e.onLine){return[2]}return[4,this._handleNetworkChanged()];case 1:t.sent();return[2]}}))}))};n._handleNetworkChanged=function(){return L(n,void 0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:return[4,this._getCurrentNetworkInfo()];case 1:e=t.sent();if(this.isNetworkChanged(e)){this._networkInfo=e;r.notificationCenter.emit(E.FY.NETWORK_CHANGED)}return[2]}}))}))};return n}NetworkInfoController.prototype.load=function(){return L(this,void 0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:e.prototype.load.call(this);return[4,this._handleNetworkChanged()];case 1:t.sent();this.on(r.WINDOW_EVENT.ONLINE,this._handleOnLine);this.on(E.FY.NETWORK_INTERFACE_CHANGED,this._handleNetworkChanged);this._initBarrier.open();return[2]}}))}))};NetworkInfoController.prototype.handleLocationAuthStatusChange=function(){this._handleNetworkChanged()};NetworkInfoController.prototype.isNetworkChanged=function(e){return!l().isEqual(this._networkInfo,e)};NetworkInfoController.prototype.getNetworkInfo=function(){return L(this,void 0,Promise,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this._initBarrier.wait()];case 1:e.sent();return[2,this._networkInfo]}}))}))};NetworkInfoController.prototype._getCurrentNetworkInfo=function(){return L(this,void 0,Promise,(function(){var e,t,n,r;return S(this,(function(i){switch(i.label){case 0:e=b.Pal.instance.getPlatformUtils();if(!e.isElectron()){return[2,undefined]}return[4,this._hasN911Permission()];case 1:if(!i.sent()){w.info("no N911 permission");return[2,undefined]}return[4,this._canUseElectronNetworkAPI()];case 2:if(!i.sent()){w.info("LD not allowed");return[2,undefined]}i.label=3;case 3:i.trys.push([3,5,,6]);t=(0,o.commonPerformanceTracer)();return[4,e.getPlatformNetworkInfo()];case 4:n=i.sent();t.end({key:"PERFORMANCE_P_E911_GET_PLA_NETWORK",level:o.LOG_CONTROL_LEVEL.HIGH});(n===null||n===void 0?void 0:n.bssid)&&(n.bssid=n.bssid.toUpperCase());w.info("get network info from electron",n);if(l().isEmpty(n)){(0,o.doErrorTracking)(o.EVENT_DATA_FEATURE.COMMON,{key:"ERROR_P_E911_GET_EMPTY_PLA_NETWORK",message:"",level:o.LOG_CONTROL_LEVEL.HIGH})}return[2,n];case 5:r=i.sent();w.info("failed to get platform network info",r);(0,o.doErrorTracking)(o.EVENT_DATA_FEATURE.COMMON,{key:"ERROR_P_E911_GET_PLA_NETWORK_FAIL",message:JSON.stringify(r),level:o.LOG_CONTROL_LEVEL.HIGH});return[2,undefined];case 6:return[2]}}))}))};NetworkInfoController.prototype._canUseElectronNetworkAPI=function(){return L(this,void 0,void 0,(function(){var e;return S(this,(function(t){switch(t.label){case 0:e=(0,r.getModule)(I.FEATURE_FLAG_MODULE);return[4,e.hasPermission(I.G.D_USE_ELECTRON_NETWORK_API)];case 1:return[2,t.sent()]}}))}))};return NetworkInfoController}(i.BaseNotificationController);var D=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var T=undefined&&undefined.__assign||function(){T=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return T.apply(this,arguments)};var M=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var F=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var U=R.k.tags("[N911Controller]");var k=function(e){D(N911Controller,e);function N911Controller(t,n,o,i){var s=e.call(this)||this;s._sipProvisionController=t;s._getCurrentRegionDigitalLine=n;s._e911Mode=o;s._emergencyResponseLocationsController=i;s._definedEmergencyAddressInfo={inCompanyNet:false,emergencyAddressState:v.bN.UNSUPPORTED};s._noActualEA=false;s._notifyN911PermissionChange=function(e){return M(s,void 0,void 0,(function(){return F(this,(function(t){switch(t.label){case 0:this._noActualEA=false;if(!e)return[3,2];return[4,this.doDefinedLocationInternal().catch((function(e){U.info("do defined location fail when N911 permission changed.",e)}))];case 1:t.sent();return[3,3];case 2:U.log("N911 permission has been closed, clear variables related to N911");this._definedEmergencyAddressInfo={inCompanyNet:false,emergencyAddressState:v.bN.UNSUPPORTED};this._networkInfo=undefined;r.jobScheduler.cancelJob(E.wF.N911);t.label=3;case 3:return[2]}}))}))};s._handleNetworkChanged=function(){return M(s,void 0,void 0,(function(){var e;var t;return F(this,(function(n){switch(n.label){case 0:return[4,this.doDefinedLocationInternal(true).catch((function(e){U.info("do defined location fail when network changed.",e)}))];case 1:n.sent();e=this;return[4,(t=this._networkInfoController)===null||t===void 0?void 0:t.getNetworkInfo()];case 2:e._networkInfo=n.sent();return[2]}}))}))};return s}N911Controller.prototype.onLoad=function(){var e;return M(this,void 0,Promise,(function(){var t;var n=this;return F(this,(function(r){switch(r.label){case 0:this.load();this.on(E.FY.NETWORK_CHANGED,this._handleNetworkChanged);this.on(E.FY.COUNTRY_CHANGED,(function(){return M(n,void 0,void 0,(function(){return F(this,(function(e){switch(e.label){case 0:return[4,this.doDefinedLocationInternal(true).catch((function(e){U.info("do defined location fail when country changed.",e)}))];case 1:e.sent();return[2]}}))}))}));this._networkInfoController=new O(this._hasN911Permission.bind(this));return[4,this._networkInfoController.load()];case 1:r.sent();this._definedEmergencyAddressInfo.inCompanyNet=!!y.Z.getInCompanyNet(this._sipProvisionController.getSipProv());t=(e=(0,s.gT)())===null||e===void 0?void 0:e.context.entitlement;t===null||t===void 0?void 0:t.on(P.H3.RCExtensionFeaturesId.SoftPhoneAutoLocationUpdate,this._notifyN911PermissionChange);this._scheduleDefinedEmergencyAddress();return[2]}}))}))};N911Controller.prototype.onUnLoad=function(){var e,t;(e=this._networkInfoController)===null||e===void 0?void 0:e.unload();var n=(t=(0,s.gT)())===null||t===void 0?void 0:t.context.entitlement;n===null||n===void 0?void 0:n.off(P.H3.RCExtensionFeaturesId.SoftPhoneAutoLocationUpdate,this._notifyN911PermissionChange);r.jobScheduler.cancelJob(E.wF.N911);this._noActualEA=false;this.unload()};N911Controller.prototype.isInAutoAssignAddressMode=function(){return M(this,void 0,Promise,(function(){var e,t;return F(this,(function(n){switch(n.label){case 0:return[4,this._hasN911Permission()];case 1:if(!n.sent()){return[2,false]}return[4,this._allowEditOffNetMap()];case 2:if(!n.sent())return[3,3];return[2,!!this._definedEmergencyAddressInfo.inCompanyNet];case 3:e=this._definedEmergencyAddressInfo.emergencyAddressState===v.bN.ASSIGNED;if(!e){return[2,false]}return[4,this._isDefinedEmergencyAddressValid(this._definedEmergencyAddressInfo)];case 4:t=n.sent();return[2,t]}}))}))};N911Controller.prototype.handleLocationAuthStatusChange=function(){var e;(e=this._networkInfoController)===null||e===void 0?void 0:e.handleLocationAuthStatusChange()};N911Controller.prototype.isAutoAssignAddressFinished=function(){return M(this,void 0,void 0,(function(){return F(this,(function(e){switch(e.label){case 0:return[4,this.canUseN911()];case 1:return[2,!e.sent()||!!this._assignAddressFinished]}}))}))};N911Controller.prototype._allowEditOffNetMap=function(){return M(this,void 0,void 0,(function(){var e,t;return F(this,(function(n){switch(n.label){case 0:e=(0,r.getModule)(I.FEATURE_FLAG_MODULE);return[4,e.hasPermission(I.G.D_ALLOW_EDIT_N911_OFF_NET_MAP)];case 1:t=n.sent();return[2,t]}}))}))};N911Controller.prototype.doDefinedLocationInternal=function(e){if(e===void 0){e=false}var t;return M(this,void 0,void 0,(function(){var n,r,o,i,s,a;return F(this,(function(u){switch(u.label){case 0:e&&(this._networkInfo=undefined);n=this._sipProvisionController.getSipProv();r=y.Z.getDeviceId(n);if(!r){return[2]}o=y.Z.getPhoneLineId(n);if(!o){return[2]}return[4,this._canDefinedEmergencyAddress()];case 1:if(!u.sent()){return[2]}return[4,(t=this._networkInfoController)===null||t===void 0?void 0:t.getNetworkInfo()];case 2:i=u.sent();if(!i){U.info("Unable to get network information");return[2]}return[4,this._getWebappEmergencyAddress(i)];case 3:s=u.sent();if(!s){return[2]}U.log("Current N911 automatic emergency address state",{state:s.emergencyAddressState,inCompanyNet:s.inCompanyNet});a=s.emergencyAddressState;switch(a){case v.bN.ASSIGNED:return[3,4];case v.bN.OCCUPIED:return[3,6];case v.bN.UNDEFINED:return[3,6];case v.bN.UNSUPPORTED:return[3,8]}return[3,9];case 4:return[4,this._handleAddressAssigned(s,r,o)];case 5:u.sent();return[3,10];case 6:return[4,this._handleAddressUndefined(r,o)];case 7:u.sent();return[3,10];case 8:{U.log("N911 is not supported, it means nomadic disabled, do not save noActualEA");this._noActualEA=false;return[3,10]}u.label=9;case 9:U.log("N911 state is",s.emergencyAddressState);return[3,10];case 10:this._handleAfterDefinedEmergencyAddress(s);return[2]}}))}))};N911Controller.prototype.isNoActualEA=function(){var e;return M(this,void 0,Promise,(function(){var t;return F(this,(function(n){switch(n.label){case 0:if(this._e911Mode!==v.ay.NECF){U.info("Store actual EA status because of current mode is not NECF");return[2,false]}return[4,this.canUseN911()];case 1:if(!n.sent()){U.info("Store actual EA status because of cannot use N911");return[2,false]}if(this._noActualEA){U.info("Store no actual EA status because of assign line & create nomadic map & webapp emergency address failed");return[2,true]}return[4,this._emergencyResponseLocationsController.getAllERLs()];case 2:t=n.sent();if(!((e=t===null||t===void 0?void 0:t.filter((function(e){return e.addressStatus!==i.ADDRESS_STATUS.INVALID})))===null||e===void 0?void 0:e.length)){U.info("Store no actual EA status because of no ERLs");return[2,true]}U.info("Store actual EA status");return[2,false]}}))}))};N911Controller.prototype._handleAddressAssigned=function(e,t,n){return M(this,void 0,void 0,(function(){var r,o,i;return F(this,(function(s){switch(s.label){case 0:if(!e.definedEmergencyMap||!e.definedEmergencyAddress){U.log("There is no mapId and assigned emergency address found");return[2]}return[4,this._isDefinedEmergencyAddressValid(e)];case 1:if(!s.sent()){U.log("Defined EA is invalid");return[2]}r=_.q1.getEmergencyAddress();if(r&&y.U.isAddressEqual(r,e.definedEmergencyAddress)){U.info("N911 address is not changed");return[2]}s.label=2;case 2:s.trys.push([2,5,,6]);U.info("assign line with mapId");return[4,p.Z.assignLine(t,{phoneLineId:n,emergency:{map:e.definedEmergencyMap}})];case 3:s.sent();return[4,this._sipProvisionController.refreshProv()];case 4:s.sent();return[3,6];case 5:o=s.sent();U.warn("failed auto assign line",o);this._noActualEA=true;throw o;case 6:i=y.Z.getEmergencyAddress(this._sipProvisionController.getSipProv());i&&_.q1.setEmergencyAddress(i);return[2]}}))}))};N911Controller.prototype._handleAddressUndefined=function(e,t){return M(this,void 0,void 0,(function(){var n,o;return F(this,(function(i){switch(i.label){case 0:U.log("User is not in company network and need to clear address in sip");n=y.Z.getEmergencyAddress(this._sipProvisionController.getSipProv());if(!!l().isEmpty(n))return[3,2];return[4,p.Z.assignLine(e,T(T({},E.Rt),{phoneLineId:t})).catch((function(e){U.info("clear emergency address fail when emergency address unAssigned",e)}))];case 1:i.sent();i.label=2;case 2:o=_.q1.getEmergencyAddress();if(!o){return[2]}_.q1.removeEmergencyAddress();r.notificationCenter.emit(a.FY.RC_INFO_SERVICE.E911_UPDATED,v.El.N911_UNDEFINED_ADDRESS);return[4,this._sipProvisionController.refreshProv()];case 3:i.sent();return[2]}}))}))};N911Controller.prototype._handleAfterDefinedEmergencyAddress=function(e){this._definedEmergencyAddressInfo=e;r.jobScheduler.userConfig.setLastSuccessTime(E.wF.N911,Date.now());r.notificationCenter.emit(E.FY.DEFINE_EMERGENCY_ADDRESS_DONE);this._assignAddressFinished=true};N911Controller.prototype._scheduleDefinedEmergencyAddress=function(){var e=this;var t=y.Z.getEmergencyCountryId(this._sipProvisionController.getSipProv())?v.fd.SIX_HOUR:v.fd.FIFTEEN_MINUTE;U.log("start N911 schedule job",{scheduleTime:t});r.jobScheduler.schedulePeriodicJob(E.wF.N911,(function(t){return M(e,void 0,void 0,(function(){var e;return F(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);U.log("execute definedEmergencyAddress schedule job");return[4,this.doDefinedLocationInternal(true)];case 1:n.sent();t(true);return[3,3];case 2:e=n.sent();U.log("execute definedEmergencyAddress schedule job failed:",e);t(false);return[3,3];case 3:return[2]}}))}))}),true,t,r.INITIAL_OPTION.IGNORE_FIRST_TIME)};N911Controller.prototype.canUseN911=function(){var e,t;return M(this,void 0,Promise,(function(){var n,r,o,i;return F(this,(function(s){switch(s.label){case 0:r=(e=b.Pal.instance.getPlatformUtils())===null||e===void 0?void 0:e.isElectron();if(!r)return[3,2];return[4,this._hasN911Permission()];case 1:r=s.sent();s.label=2;case 2:n=r;if(!n)return[3,4];i=(o=l()).isEmpty;return[4,(t=this._networkInfoController)===null||t===void 0?void 0:t.getNetworkInfo()];case 3:n=!i.apply(o,[s.sent()]);s.label=4;case 4:return[2,n]}}))}))};N911Controller.prototype._hasN911Permission=function(){return M(this,void 0,Promise,(function(){var e,t,n,o;return F(this,(function(i){switch(i.label){case 0:e=false;i.label=1;case 1:t=r.accountManager.getCurrent().context;if(!t.entitlement.get(P.H3.RCExtensionFeaturesId.SoftPhoneAutoLocationUpdate)){U.info("There is no N911 extension features permission");return[3,4]}if(y.Z.getType(this._sipProvisionController.getSipProv())!==v._4.WEB_PHONE){U.info("Cannot use N911, current sip device type is not a web phone");return[3,4]}return[4,this._getCurrentRegionDigitalLine()];case 2:n=i.sent();if(a.te.getLineType(n)!==E.Dn){U.info("Cannot use N911, current DL is not a paid DL");return[3,4]}o=a.te.getPhoneInfoCountryId(n);if(o&&!E.Y2.includes(o)){U.info("Cannot use N911, current DL country is not in US or CA");return[3,4]}e=true;i.label=3;case 3:if(false){}i.label=4;case 4:return[2,e]}}))}))};N911Controller.prototype._canDefinedEmergencyAddress=function(){var e;return M(this,void 0,void 0,(function(){var t,n,r;return F(this,(function(o){switch(o.label){case 0:return[4,this.canUseN911()];case 1:if(!o.sent()){return[2,false]}return[4,(e=this._networkInfoController)===null||e===void 0?void 0:e.getNetworkInfo()];case 2:t=o.sent();if(l().isEqual(this._networkInfo,t)){return[2,false]}if(!y.U.isNewEmergencyCallFrameworkAvailable()){return[2,true]}n=this._sipProvisionController.getSipProv();r=y.Z.getPhoneInfoCountryId(n);return[2,E.$w.some((function(e){return e===r}))]}}))}))};N911Controller.prototype.updateOrCreateNomadicMap=function(e,t){var n,r,o;return M(this,void 0,Promise,(function(){var i,s,a;return F(this,(function(u){switch(u.label){case 0:if(!e&&!t){U.warn("both erl and ea are invalid");return[2,undefined]}return[4,this.canUseN911()];case 1:if(!u.sent()){U.warn("cant use n911");return[2,undefined]}return[4,(n=this._networkInfoController)===null||n===void 0?void 0:n.getNetworkInfo()];case 2:i=u.sent();if(!i||!i.bssid&&!i.hostIp){U.warn("invalid platform network info",i);return[2,undefined]}s=((r=this._definedEmergencyAddressInfo)===null||r===void 0?void 0:r.emergencyAddressState)===v.bN.ASSIGNED;if(!s)return[3,4];return[4,this._allowEditOffNetMap()];case 3:s=u.sent();u.label=4;case 4:if(!s)return[3,6];U.info("defined address state is ASSIGNED, try update map");return[4,this._tryUpdateNomadicMap(i,e,t)];case 5:a=u.sent();if(a){U.info("update exist nomadic map success");return[2,a]}u.label=6;case 6:if(((o=this._definedEmergencyAddressInfo)===null||o===void 0?void 0:o.emergencyAddressState)===v.bN.UNDEFINED){U.warn("defined address state is UNDEFINED, try create map");return[2,this._tryCreateNomadicMap(i,e,t)]}return[2,undefined]}}))}))};N911Controller.prototype._tryCreateNomadicMap=function(e,t,n){return M(this,void 0,void 0,(function(){var r;return F(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,,7]);if(!(e===null||e===void 0?void 0:e.bssid))return[3,2];return[4,this._createNomadicMap4WirelessPoint(e===null||e===void 0?void 0:e.bssid,t,n)];case 1:return[2,o.sent()];case 2:if(!(e===null||e===void 0?void 0:e.hostIp))return[3,4];return[4,this._createNomadicMap4Network(e===null||e===void 0?void 0:e.hostIp,t,n)];case 3:return[2,o.sent()];case 4:return[3,7];case 5:r=o.sent();return[4,this._trySyncFeaturesWhenPermissionErrors(r)];case 6:if(o.sent()){return[2,undefined]}this._noActualEA=true;U.error("create nomadic map error",r);throw r;case 7:return[2,undefined]}}))}))};N911Controller.prototype._tryUpdateNomadicMap=function(e,t,n){var r,o,i,s;return M(this,void 0,void 0,(function(){var a,u,c;return F(this,(function(l){switch(l.label){case 0:a=(o=(r=this._definedEmergencyAddressInfo)===null||r===void 0?void 0:r.definedEmergencyMap)===null||o===void 0?void 0:o.wirelessPointId;u=(s=(i=this._definedEmergencyAddressInfo)===null||i===void 0?void 0:i.definedEmergencyMap)===null||s===void 0?void 0:s.ipRangeId;l.label=1;case 1:l.trys.push([1,6,,8]);if(!(a&&(e===null||e===void 0?void 0:e.bssid)))return[3,3];return[4,this._updateNomadicMap4WirelessPoint({wirelessPointId:a,bssid:e.bssid,emergencyLocation:t,emergencyAddress:n})];case 2:l.sent();return[2,a];case 3:if(!(u&&(e===null||e===void 0?void 0:e.hostIp)))return[3,5];return[4,this._updateNomadicMap4Network({ipRangeId:u,emergencyLocation:t,emergencyAddress:n})];case 4:l.sent();return[2,u];case 5:return[3,8];case 6:c=l.sent();return[4,this._trySyncFeaturesWhenPermissionErrors(c)];case 7:if(l.sent()){return[2,undefined]}U.error("update nomadic map error",c);throw c;case 8:return[2,undefined]}}))}))};N911Controller.prototype._trySyncFeaturesWhenPermissionErrors=function(e){var t;return M(this,void 0,void 0,(function(){var n;return F(this,(function(a){switch(a.label){case 0:n=e.code===i.ERROR_CODES_RC.CMN_408||e.code===i.ERROR_CODES_RC.CMN_100||e.code===i.ERROR_CODES_RC.CMN_406;if(!n){return[2,false]}U.warn("need to sync feature");return[4,(t=(0,s.gT)())===null||t===void 0?void 0:t.accountInfoService.requestRCExtensionFeaturesInfo().catch((function(e){return U.error("sync feature error",e)}))];case 1:a.sent();r.notificationCenter.emit(E.FY.DEFINE_EMERGENCY_ADDRESS_DONE);(0,o.doErrorTracking)(o.EVENT_DATA_FEATURE.COMMON,{key:E.XM.CONFIRM_ADDRESS_FAIL,message:JSON.stringify(e),level:o.LOG_CONTROL_LEVEL.HIGH});return[2,n]}}))}))};N911Controller.prototype._updateNomadicMap4WirelessPoint=function(e){var t=e.wirelessPointId,n=e.bssid,r=e.emergencyLocation,o=e.emergencyAddress;var i=!r?{bssid:n,emergencyAddress:o}:{bssid:n,emergencyLocation:r};return p.Z.updateNomadicMap4WirelessPoint(t,i)};N911Controller.prototype._updateNomadicMap4Network=function(e){var t=e.ipRangeId,n=e.emergencyLocation,r=e.emergencyAddress;var o=!n?{emergencyAddress:r}:{emergencyLocation:n};return p.Z.updateNomadicMap4Network(t,T({},o))};N911Controller.prototype._createNomadicMap4WirelessPoint=function(e,t,n){var r;return M(this,void 0,void 0,(function(){var o,s,a,u,c;return F(this,(function(l){switch(l.label){case 0:o=!t?{bssid:e,emergencyAddress:n}:{bssid:e,emergencyLocation:t};l.label=1;case 1:l.trys.push([1,3,,7]);return[4,p.Z.createNomadicMap4WirelessPoint(o)];case 2:s=l.sent();return[3,7];case 3:a=l.sent();if(!(a.code===i.ERROR_CODES_RC.EME_302))return[3,6];U.warn("current wireless point already have nomadic map");return[4,this._getWebappEmergencyAddress({bssid:e})];case 4:u=l.sent();c=(r=u===null||u===void 0?void 0:u.definedEmergencyMap)===null||r===void 0?void 0:r.wirelessPointId;if(!c)return[3,6];U.warn("exist wireless point nomadic map, try update");return[4,p.Z.updateNomadicMap4WirelessPoint(c,o)];case 5:l.sent();return[2,c];case 6:throw a;case 7:return[2,s.id]}}))}))};N911Controller.prototype._getWebappEmergencyAddress=function(e){return M(this,void 0,void 0,(function(){var t,n;return F(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,p.Z.getWebappEmergencyAddress(e)];case 1:t=r.sent();return[2,t];case 2:n=r.sent();U.error("get webapp emergency address failed",n);this._noActualEA=true;throw n;case 3:return[2]}}))}))};N911Controller.prototype._createNomadicMap4Network=function(e,t,n){var r;return M(this,void 0,void 0,(function(){var o,s,a,u,c,l;return F(this,(function(d){switch(d.label){case 0:o=!t?{emergencyAddress:n}:{emergencyLocation:t};s={privateIpRanges:[T({startIp:e,endIp:e,name:this._generatePrivateIpRangeName4NomadicMap()},o)]};d.label=1;case 1:d.trys.push([1,3,,7]);return[4,p.Z.createNomadicMap4Network(s)];case 2:a=d.sent();return[3,7];case 3:u=d.sent();if(!(u.code===i.ERROR_CODES_RC.EME_313))return[3,6];U.warn("current ip range already have nomadic map");return[4,this._getWebappEmergencyAddress({hostIp:e})];case 4:c=d.sent();l=(r=c===null||c===void 0?void 0:c.definedEmergencyMap)===null||r===void 0?void 0:r.ipRangeId;if(!l)return[3,6];U.warn("exist ip range nomadic map, try update");return[4,p.Z.updateNomadicMap4Network(l,T({},o))];case 5:d.sent();return[2,l];case 6:throw u;case 7:return[2,a.id]}}))}))};N911Controller.prototype.getNomadicMapById=function(e,t){return M(this,void 0,Promise,(function(){var n,r;return F(this,(function(o){switch(o.label){case 0:r=e;switch(r){case v.Iq.WIRELESS_POINT:return[3,1];case v.Iq.NETWORK:return[3,3]}return[3,5];case 1:return[4,p.Z.getNomadicMapByWirelessPointId(t)];case 2:n=o.sent();return[3,6];case 3:return[4,p.Z.getNomadicMapByNetworkId(t)];case 4:n=o.sent();return[3,6];case 5:{U.warn("unsupported nomadicMapType",e);return[3,6]}o.label=6;case 6:return[2,n]}}))}))};N911Controller.prototype._generatePrivateIpRangeName4NomadicMap=function(){return(0,r.generateUUID)()};N911Controller.prototype._isDefinedEmergencyAddressValid=function(e,t){if(t===void 0){t=false}var n,r,o,s;return M(this,void 0,void 0,(function(){var a,u,c,d;return F(this,(function(f){switch(f.label){case 0:a=(r=(n=e.definedEmergencyAddress)===null||n===void 0?void 0:n.location)===null||r===void 0?void 0:r.id;if(!a){if(t){U.info("only check location and location id unavailable");return[2,false]}if(!e.definedEmergencyAddress){U.info("definedEmergencyAddress unavailable");return[2,false]}u=l().clone(e.definedEmergencyAddress);delete u.location;c=l().isEmpty(u);U.info("defined emergency empty",c);return[2,!c]}return[4,this._emergencyResponseLocationsController.getAllERLs()];case 1:d=(s=(o=f.sent())===null||o===void 0?void 0:o.find((function(e){return e.id===a})))===null||s===void 0?void 0:s.addressStatus;U.info("defined emergency address status",d);if(d){return[2,d!==i.ADDRESS_STATUS.INVALID]}return[2,false]}}))}))};return N911Controller}(i.BaseNotificationController);var x=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var j=undefined&&undefined.__assign||function(){j=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return j.apply(this,arguments)};var V=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var G=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var q=R.k.tags("[ERLController]");var W=function(e){x(ERLController,e);function ERLController(t,n,r,o){var i=e.call(this,t,n)||this;i._emergencyResponseLocationsController=r;i._e911Mode=o;i._handleERLNotification=function(e){return V(i,void 0,void 0,(function(){var t,n,r,o,i,s;var u;return G(this,(function(c){switch(c.label){case 0:q.info("handler ERL notification, payload:",{time:(new Date).getTime(),payload:e});c.label=1;case 1:c.trys.push([1,7,,8]);return[4,this.getCurrentRegionDigitalLine()];case 2:t=c.sent();return[4,this._emergencyResponseLocationsController.getRemoteERLsAndSave()];case 3:n=c.sent();return[4,this.rcInfoModule.syncAndSaveDeviceInfo()];case 4:c.sent();r=y.Z.getLocationId(this.sipProvisionController.getSipProv());if(!r){return[2]}o=n.find((function(e){return a.te.getPhoneInfoCountryId(t)===e.address.countryId&&e.id===r}));i=(u=_.q1.getEmergencyAddress())!==null&&u!==void 0?u:undefined;if(!(!o||i&&!y.U.isAddressEqual(i,o.address)))return[3,6];q.info("emergency response location was changed");return[4,this._n911Controller.isInAutoAssignAddressMode()];case 5:if(c.sent()){q.info("in auto assign address mode, will force auto assign address");this._n911Controller.doDefinedLocationInternal(true)}else{q.info("will clear EA and prompt user to confirm");this.clearEmergencyAddress()}c.label=6;case 6:return[3,8];case 7:s=c.sent();q.info("can not get emergency response locations from api");return[3,8];case 8:return[2]}}))}))};i._isLocalConfirmAsNoDefined=function(){var e;var t=(e=_.q1.getEmergencyAddress())!==null&&e!==void 0?e:undefined;return l().isEqual(t,{})};return i}ERLController.prototype.onLoad=function(){return V(this,void 0,Promise,(function(){return G(this,(function(e){switch(e.label){case 0:this._n911Controller=new k(this.sipProvisionController,this.getCurrentRegionDigitalLine,this._e911Mode,this._emergencyResponseLocationsController);return[4,this._n911Controller.onLoad()];case 1:e.sent();this._listenEmergencyAddressChanged();return[2]}}))}))};ERLController.prototype.onUnLoad=function(){this._n911Controller.onUnLoad()};ERLController.prototype.handleLocationAuthStatusChange=function(){var e;(e=this._n911Controller)===null||e===void 0?void 0:e.handleLocationAuthStatusChange()};ERLController.prototype.isDataReady=function(){return V(this,void 0,Promise,(function(){var e,t;return G(this,(function(n){switch(n.label){case 0:return[4,this.rcInfoModule.getDigitalLines()];case 1:e=n.sent();t=!!(e===null||e===void 0?void 0:e.length);if(!t){q.info("ERL data is not ready",{mode:this._e911Mode,phoneLinesLen:(e===null||e===void 0?void 0:e.length)||0,isDataReady:t})}return[2,t]}}))}))};ERLController.prototype.getAddressConfig=function(){return V(this,void 0,Promise,(function(){var e,t,n,r,t,o,i,n,s;return G(this,(function(a){switch(a.label){case 0:if(!(this._e911Mode===v.ay.NECF))return[3,2];return[4,this._getNECFDefaultEmergencyAddress()];case 1:e=a.sent(),t=e.committedAddress,n=e.currentAddress,r=e.defaultERLId;return[2,{featureType:this._e911Mode,currentAddress:n,committedAddress:t,defaultERLId:r,valueType:v.l_.ERL}];case 2:if(!(this._e911Mode===v.ay.ERL))return[3,6];t=void 0;!this._isLocalConfirmAsNoDefined()&&(t=y.Z.getEmergencyAddress(this.sipProvisionController.getSipProv()));return[4,this._getERLDefaultEmergencyAddress()];case 3:o=a.sent(),i=o.preDefinedOtherLocation,n=o.currentAddress;s={preDefinedOtherLocation:i,featureType:this._e911Mode,currentAddress:n,committedAddress:t,valueType:(n===null||n===void 0?void 0:n.emergencyId)?v.l_.ERL:!l().isEmpty(n)?v.l_.OTHER_LOCATION:v.l_.NO_DEFINED_LOCATION};return[4,this._canEditOtherLocation()];case 4:s.canEditOtherLocation=a.sent();return[4,this._getDefaultERLId()];case 5:return[2,(s.defaultERLId=a.sent(),s)];case 6:return[2,undefined]}}))}))};ERLController.prototype.isNoActualEA=function(){return this._n911Controller.isNoActualEA()};ERLController.prototype.assignLine=function(e){return V(this,void 0,Promise,(function(){var t,n,r,o,i,s,a;return G(this,(function(u){switch(u.label){case 0:t=this.sipProvisionController.getSipProv();n=y.Z.getDeviceId(t);if(!n){q.info("Unable to assign line, there is no deviceId in sip");return[2,{shouldRefreshSip:false}]}r=y.Z.getPhoneLineId(t);if(!r){q.info("Unable to assign line, there is no digital line in sip");return[2,{shouldRefreshSip:false}]}o=y.U.ignoreEmptyFields(e);delete o.emergencyId;if(e===null||e===void 0?void 0:e.emergencyId){s=v.l_.ERL;i={emergency:{location:{id:e.emergencyId}},phoneLineId:r}}else if(l().isEmpty(o)){s=v.l_.NO_DEFINED_LOCATION;i=j(j({},E.Rt),{phoneLineId:r})}else{s=v.l_.OTHER_LOCATION;i={emergency:{address:o},phoneLineId:r}}return[4,this._saveAndGetNomadicMapId(s,e)];case 1:a=u.sent();if(!a)return[3,3];return[4,this._n911Controller.doDefinedLocationInternal(true)];case 2:u.sent();return[3,5];case 3:return[4,p.Z.assignLine(n,i)];case 4:u.sent();u.label=5;case 5:this._listenEmergencyAddressChanged();return[2,{shouldRefreshSip:true,currentOpt:s}]}}))}))};ERLController.prototype._saveAndGetNomadicMapId=function(e,t){if(e===v.l_.ERL&&t.emergencyId){return this._n911Controller.updateOrCreateNomadicMap({id:t.emergencyId},undefined)}if(e===v.l_.OTHER_LOCATION){var n=y.U.transAddressInfo2NomadicMapEA(t);return this._n911Controller.updateOrCreateNomadicMap(undefined,n)}return Promise.resolve(undefined)};ERLController.prototype.isInAutoAssignAddressMode=function(){return this._n911Controller.isInAutoAssignAddressMode()};ERLController.prototype.requireE911Address=function(){return V(this,void 0,Promise,(function(){var e,t;return G(this,(function(n){switch(n.label){case 0:if(!y.U.isNewEmergencyCallFrameworkAvailable()){return[2,true]}e=this.sipProvisionController.getSipProv();t=y.Z.getPhoneInfoCountryId(e);if(!E.Yd.some((function(e){return e===t})))return[3,2];return[4,this._n911Controller.canUseN911()];case 1:return[2,n.sent()];case 2:return[2,true]}}))}))};ERLController.prototype._getNECFDefaultEmergencyAddress=function(){var e;return V(this,void 0,void 0,(function(){var t,n,r,o,i,s,u,c,l,d;return G(this,(function(f){switch(f.label){case 0:n=this.sipProvisionController.getSipProv();r=y.Z.getLocationId(n);return[4,this._emergencyResponseLocationsController.getAllERLs()];case 1:o=f.sent();if(!(r&&(o===null||o===void 0?void 0:o.find((function(e){return r===e.id})))))return[3,2];t=y.Z.getEmergencyAddress(n);i=r;return[3,4];case 2:return[4,this.rcInfoModule.getDigitalLines()];case 3:u=f.sent();c=y.Z.getPhoneLineId(n);l=u===null||u===void 0?void 0:u.find((function(e){return e.phoneLines.find((function(e){return e.id===c}))}));t=a.te.getAddress(l);i=a.te.getLocationId(l);f.label=4;case 4:i&&(s=(e=o===null||o===void 0?void 0:o.find((function(e){return e.id===i})))===null||e===void 0?void 0:e.name);t&&(t=j(j({},t),{emergencyId:i,emergencyName:s}));d=y.Z.getEmergencyAddress(this.sipProvisionController.getSipProv());d&&(d=j(j({},d),{emergencyId:i,emergencyName:s}));return[2,{committedAddress:d,currentAddress:t,defaultERLId:i}]}}))}))};ERLController.prototype._listenEmergencyAddressChanged=function(){var e=this.sipProvisionController.getSipProv();if(!(e===null||e===void 0?void 0:e.device.id)){return}var t=g.RCSubscriptionKeys.RCDevice+"/"+e.device.id+"/emergency-address";q.info("subscribe Emergency Address Changed:",{time:(new Date).getTime(),url:t});try{this._rcNotificationModule.subscribe(t,this._handleERLNotification)}catch(e){q.warn("failed subscribe Emergency Address Change:",{url:t,error:e})}};ERLController.prototype._canEditOtherLocation=function(){return V(this,void 0,void 0,(function(){var e;return G(this,(function(t){switch(t.label){case 0:return[4,this.getCurrentRegionDigitalLine()];case 1:e=t.sent();return[2,a.te.getAddressEditableStatus(e)===i.ADDRESS_EDITABLE_STATUS.ANY_DEVICE]}}))}))};ERLController.prototype._getDefaultERLId=function(){return V(this,void 0,Promise,(function(){var e,t,n,r;return G(this,(function(o){switch(o.label){case 0:e=y.Z.getLocationId(this.sipProvisionController.getSipProv());return[4,this._getAllERLs()];case 1:t=o.sent();if(e&&(t===null||t===void 0?void 0:t.find((function(t){return e===t.id})))){return[2,e]}return[4,this.rcInfoModule.getCurrentCountry()];case 2:n=o.sent();r=(t===null||t===void 0?void 0:t.find((function(e){var t;return((t=e.address)===null||t===void 0?void 0:t.countryId)===n.id})))||(t===null||t===void 0?void 0:t[0]);return[2,(r===null||r===void 0?void 0:r.id)||""]}}))}))};ERLController.prototype._getAllERLs=function(e){if(e===void 0){e=false}return V(this,void 0,Promise,(function(){var t,n,r,o,s,u;return G(this,(function(c){switch(c.label){case 0:n=(t=this._emergencyResponseLocationsController).getAllERLs;r={};if(!e)return[3,1];o=undefined;return[3,3];case 1:u=(s=a.te).getPhoneInfoCountryId;return[4,this.getCurrentRegionDigitalLine()];case 2:o=u.apply(s,[c.sent()]);c.label=3;case 3:return[2,n.apply(t,[(r.countryId=o,r.addressStatus=i.ADDRESS_STATUS.VALID,r)])]}}))}))};ERLController.prototype._getERLDefaultEmergencyAddress=function(){return V(this,void 0,void 0,(function(){var e,t,n,r,o,s,u,c,l,d,f;return G(this,(function(h){switch(h.label){case 0:return[4,this._getPredefinedLocation()];case 1:t=h.sent();n=this.sipProvisionController.getSipProv();if(!n){return[2,{currentAddress:e,preDefinedOtherLocation:t}]}if(this._isLocalConfirmAsNoDefined()){return[2,{currentAddress:e,preDefinedOtherLocation:t}]}r=y.Z.getEmergencyAddress(n);o=y.Z.getPhoneLine(n);return[4,this.getCurrentRegionDigitalLine()];case 2:s=h.sent();if(!(r&&o&&o.id===a.te.getPhoneLineId(s)))return[3,6];u=y.Z.getLocationId(n);if(!u)return[3,5];l=this._getAllERLs;return[4,this._n911Controller.canUseN911()];case 3:return[4,l.apply(this,[h.sent()])];case 4:c=h.sent()||[];d=!!(c===null||c===void 0?void 0:c.find((function(e){return u===e.id})));if(d){e=j({emergencyId:u},r)}return[3,6];case 5:e=r;h.label=6;case 6:if(!e&&a.te.getEmergencyAddressStatus(s)===i.ADDRESS_STATUS.VALID){e=a.te.getAddress(s);f=a.te.getLocationId(s);if(e&&f){e.emergencyId=f}q.info("Use digital line as current emergency address")}return[2,{currentAddress:e,preDefinedOtherLocation:t}]}}))}))};ERLController.prototype._getPredefinedLocation=function(){return V(this,void 0,Promise,(function(){var e,t;return G(this,(function(n){switch(n.label){case 0:return[4,this.getCurrentRegionDigitalLine()];case 1:e=n.sent();t=a.te.getPhoneLineId(e);if(!t){return[2,undefined]}if(a.te.getAddressEditableStatus(e)===i.ADDRESS_EDITABLE_STATUS.MAIN_DEVICE){return[2,a.te.getAddress(e)]}return[2,undefined]}}))}))};ERLController.prototype.onReceiveSipProv=function(e,t){return this._handleInvalidEmergencyLocation(e,t)};ERLController.prototype.isAutoAssignAddressFinished=function(){return this._n911Controller.isAutoAssignAddressFinished()};ERLController.prototype._handleInvalidEmergencyLocation=function(e,t){return V(this,void 0,void 0,(function(){var n,o,s,u,c,l;return G(this,(function(d){switch(d.label){case 0:if(this._e911Mode!==v.ay.NECF){return[2]}n=y.Z.getAddressStatus(e);if(!n||n!==i.ADDRESS_STATUS.INVALID){return[2]}q.info("The emergency location confirmed by the user has become invalid");return[4,this._emergencyResponseLocationsController.getAllERLs()];case 1:o=d.sent();s=o===null||o===void 0?void 0:o.find((function(t){return t.id===y.Z.getLocationId(e)}));if(!((s===null||s===void 0?void 0:s.addressStatus)&&s.addressStatus!==n))return[3,3];q.info("The address status in ERL has expired, need to refresh ERL");return[4,this._emergencyResponseLocationsController.syncAndSaveData()];case 2:d.sent();d.label=3;case 3:return[4,this.rcInfoModule.getDigitalLines()];case 4:u=d.sent();c=u===null||u===void 0?void 0:u.find((function(t){return a.te.getPhoneLineId(t)===y.Z.getPhoneLineId(e)}));l=a.te.getEmergencyAddressStatus(c);if(!(l!==n))return[3,6];q.info("The address status in digital lines has expired, need to refresh digital lines");return[4,this.rcInfoModule.syncAndSaveDeviceInfo()];case 5:d.sent();d.label=6;case 6:t&&r.notificationCenter.emit(E.FY.EMERGENCY_LOCATION_REGISTERED_FAIL);return[2]}}))}))};Object.defineProperty(ERLController.prototype,"_rcNotificationModule",{get:function(){return(0,r.getModule)(g.RC_NOTIFICATION_MODULE_NAME)},enumerable:true,configurable:true});return ERLController}(A);var H=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var B=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Z=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var Y=R.k.tags("[EAController]");var K=function(e){H(EAController,e);function EAController(){return e!==null&&e.apply(this,arguments)||this}EAController.prototype.onLoad=function(){return Promise.resolve()};EAController.prototype.onUnLoad=function(){};EAController.prototype.isDataReady=function(){return B(this,void 0,Promise,(function(){var e,t;return Z(this,(function(n){switch(n.label){case 0:return[4,this.rcInfoModule.getDigitalLines()];case 1:e=n.sent();t=(e===null||e===void 0?void 0:e.length)>0;if(!t){Y.info("EA data is not ready",{mode:v.ay.EA,digitalLineLen:(e===null||e===void 0?void 0:e.length)||0,isDataReady:t})}return[2,t]}}))}))};EAController.prototype.getAddressConfig=function(){return B(this,void 0,Promise,(function(){var e;return Z(this,(function(t){switch(t.label){case 0:e={featureType:v.ay.EA};return[4,this._getDefaultEmergencyAddress()];case 1:return[2,(e.currentAddress=t.sent(),e.committedAddress=y.Z.getEmergencyAddress(this.sipProvisionController.getSipProv()),e)]}}))}))};EAController.prototype._getDefaultEmergencyAddress=function(){var e;return B(this,void 0,void 0,(function(){var t,n,r,o,i;return Z(this,(function(s){switch(s.label){case 0:t=this.sipProvisionController.getSipProv();if(!t){return[2,undefined]}n=(e=_.q1.getEmergencyAddress())!==null&&e!==void 0?e:undefined;if(!l().isEmpty(n)){r=y.Z.getEmergencyAddress(this.sipProvisionController.getSipProv());if(r&&!y.U.isAddressEqual(r,n)){Y.info("Prefer remote EA when it is not equal to local EA");return[2,r]}return[2,n]}i=(o=a.te).getAddress;return[4,this.getCurrentRegionDigitalLine()];case 1:return[2,i.apply(o,[s.sent()])]}}))}))};EAController.prototype.assignLine=function(e){var t;return B(this,void 0,Promise,(function(){var n,r,o,i,s;return Z(this,(function(a){switch(a.label){case 0:n=this.sipProvisionController.getSipProv();r=y.Z.getDeviceId(n);if(!r){Y.info("Unable to assign line, there is no deviceId in sip");return[2,{shouldRefreshSip:false}]}return[4,this.getCurrentDigitalLine()];case 1:o=(t=a.sent())===null||t===void 0?void 0:t.id;if(!o){Y.info("Unable to assign line, there is no DL in sip");return[2,{shouldRefreshSip:false}]}i=y.U.ignoreEmptyFields(e);s={emergencyServiceAddress:i,originalDeviceId:o};return[4,p.Z.assignLine(r,s)];case 2:a.sent();return[2,{shouldRefreshSip:true}]}}))}))};return EAController}(A);var J=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var z=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var X=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var $=R.k.tags("[E911FetchController]");var Q=function(e){J(E911FetchController,e);function E911FetchController(t,n,o){var i=e.call(this)||this;i._sipProvisionController=t;i._emergencyResponseLocationsController=n;i._DBConfig=o;i._isSipReady=false;i._handleDeviceUpdateInfo=function(e){return z(i,void 0,void 0,(function(){var t;return X(this,(function(n){switch(n.label){case 0:if(e.from.records.length&&!e.to.records.length){$.warn("user has no device, so clear local EA records");_.q1.removeEmergencyAddress()}t=e.to.records.length>0;if(!t)return[3,2];return[4,this._handleAutoAssignLineIfNeedInDebounce()];case 1:t=n.sent();n.label=2;case 2:t;return[2]}}))}))};i._handleAutoAssignLineIfNeedInDebounce=l().debounce((function(){return z(i,void 0,void 0,(function(){return X(this,(function(e){switch(e.label){case 0:return[4,this._handleAutoAssignLineIfNeed()];case 1:e.sent();return[2]}}))}))}),h.lo.FIVE_SECOND);i.onReceiveSipProv=function(e,t){return z(i,void 0,void 0,(function(){var n;var o,i,s,a,u;return X(this,(function(c){switch(c.label){case 0:$.info("receive sip",{newSipPhoneLineSize:(i=(o=e===null||e===void 0?void 0:e.device)===null||o===void 0?void 0:o.phoneLines)===null||i===void 0?void 0:i.length,oldSipPhoneLineSize:(a=(s=t===null||t===void 0?void 0:t.device)===null||s===void 0?void 0:s.phoneLines)===null||a===void 0?void 0:a.length,time:(new Date).getTime()});this._isSipReady=true;return[4,this._rcInfoModule.setAssignedDigitalLine(y.Z.getPhoneLine(e))];case 1:c.sent();return[4,this._handleAutoAssignLineIfNeed()];case 2:c.sent();n=this.isEmergencyAddrConfirmed();return[4,this._getE911Controller()];case 3:return[4,(u=c.sent())===null||u===void 0?void 0:u.onReceiveSipProv(e,n)];case 4:c.sent();r.notificationCenter.emit(E.FY.SIP_PROVISION_RECEIVED);return[2]}}))}))};return i}E911FetchController.prototype.onLoad=function(){var e=this;this.load();this.on(a.FY.RC_INFO_SERVICE.DEVICE_INFO_UPDATE,this._handleDeviceUpdateInfo);this.on(a.FY.RC_INFO.DEVICE_INFO,this._handleAutoAssignLineIfNeedInDebounce);this.on(a.FY.RC_INFO.RC_REGION_INFO,(function(t){return z(e,void 0,void 0,(function(){return X(this,(function(e){switch(e.label){case 0:if(!t)return[3,2];_.q1.removeEmergencyAddress();return[4,this._handleAutoAssignLineIfNeed()];case 1:e.sent();r.notificationCenter.emit(E.FY.COUNTRY_CHANGED);e.label=2;case 2:return[2]}}))}))}));this._startE911ServiceUnavailableJob()};E911FetchController.prototype.onUnLoad=function(){r.jobScheduler.cancelJob(E.wF.E911_SERVICE_UNAVAILABLE);this.unload()};E911FetchController.prototype._getE911Controller=function(){return z(this,void 0,void 0,(function(){var e;return X(this,(function(t){switch(t.label){case 0:return[4,this.getE911Mode()];case 1:e=t.sent();if(!((e===v.ay.ERL||e===v.ay.NECF)&&!(this._e911Controller instanceof W)))return[3,3];$.log("transfer to "+e+" mode");this._e911Controller&&this._e911Controller.onUnLoad();this._e911Controller=new W(this._sipProvisionController,this.getCurrentRegionDigitalLine.bind(this),this._emergencyResponseLocationsController,e);return[4,this._e911Controller.onLoad()];case 2:t.sent();return[3,6];case 3:if(!(e===v.ay.EA&&!(this._e911Controller instanceof K)))return[3,5];$.log("transfer to "+e+" mode");this._e911Controller&&this._e911Controller.onUnLoad();this._e911Controller=new K(this._sipProvisionController,this.getCurrentRegionDigitalLine.bind(this));return[4,this._e911Controller.onLoad()];case 4:t.sent();return[3,6];case 5:if(e===v.ay.UNSUPPORTED&&this._e911Controller){$.log("transfer to "+e+" mode");this._e911Controller.onUnLoad();delete this._e911Controller}t.label=6;case 6:return[2,this._e911Controller]}}))}))};E911FetchController.prototype.isEmergencyAddrConfirmedWithValidAddr=function(){var e;return this.isEmergencyAddrConfirmed()&&!this._isNoDefinedLocation((e=_.q1.getEmergencyAddress())!==null&&e!==void 0?e:undefined)};E911FetchController.prototype.isEmergencyAddrConfirmed=function(){var e;var t=(e=_.q1.getEmergencyAddress())!==null&&e!==void 0?e:undefined;if(!t){return false}var n=y.Z.getEmergencyAddress(this._sipProvisionController.getSipProv());if(n){var r=y.U.isAddressEqual(t,n);!r&&$.info("EA has been changed, need to update");return r}return this._isNoDefinedLocation(t)};E911FetchController.prototype._isNoDefinedLocation=function(e){return l().isEqual(e,{})};E911FetchController.prototype.getAllERLs=function(){return z(this,void 0,Promise,(function(){var e,t,n,r,o;return X(this,(function(s){switch(s.label){case 0:t=(e=this._emergencyResponseLocationsController).getAllERLs;n={};o=(r=a.te).getPhoneInfoCountryId;return[4,this.getCurrentRegionDigitalLine()];case 1:return[2,t.apply(e,[(n.countryId=o.apply(r,[s.sent()]),n.addressStatus=i.ADDRESS_STATUS.VALID,n)])]}}))}))};E911FetchController.prototype.getE911Mode=function(){var e;return z(this,void 0,Promise,(function(){var t,n,r;return X(this,(function(o){switch(o.label){case 0:return[4,this._hasE911Permission()];case 1:if(!o.sent()){return[2,v.ay.UNSUPPORTED]}if(y.U.isNewEmergencyCallFrameworkAvailable()){return[2,v.ay.NECF]}if(!this._emergencyResponseLocationsController.hasERLsPermission()){return[2,v.ay.EA]}return[4,this.getAllERLs()];case 2:if(!!((e=o.sent())===null||e===void 0?void 0:e.length))return[3,4];r=(n=a.te).getPhoneInfoCountryId;return[4,this.getCurrentRegionDigitalLine()];case 3:t=r.apply(n,[o.sent()]);if(!t||!E.xe.includes(t)){return[2,v.ay.EA]}o.label=4;case 4:return[2,v.ay.ERL]}}))}))};E911FetchController.prototype.getCurrentRegionDigitalLine=function(){return z(this,void 0,Promise,(function(){var e,t,n,r,o,i,s,u,c;return X(this,(function(l){switch(l.label){case 0:return[4,this._rcInfoModule.getCurrentCountry()];case 1:e=l.sent();return[4,this._setRegionPhoneLineBarrier()];case 2:l.sent();t=this._sipProvisionController.getSipProv();n=t===null||t===void 0?void 0:t.device;if(!e||!n){this._releaseRegionPhoneLineBarrier();return[2]}return[4,this._rcInfoModule.getDigitalLines()];case 3:r=l.sent();o=y.Z.getPhoneLine(t);if(!o)return[3,7];i=r===null||r===void 0?void 0:r.find((function(e){return a.te.getPhoneLineId(e)===o.id}));s=function(){return a.te.getAddressEditableStatus(i)!==y.Z.getAddressEditableStatus(t)};if(!(!i||s()))return[3,7];$.info("update local digital line");return[4,this._rcInfoModule.syncAndSaveDeviceInfo()];case 4:l.sent();return[4,this._rcInfoModule.getDigitalLines()];case 5:r=l.sent();i=r===null||r===void 0?void 0:r.find((function(e){return a.te.getPhoneLineId(e)===o.id}));if(!(!i||s()))return[3,7];$.info("The phoneLine in SIP is old and needs to be refreshed");return[4,this._sipProvisionController.refreshProv()];case 6:l.sent();l.label=7;case 7:u=i&&e.id===y.Z.getPhoneInfoCountryId(t);c=this._getCurrentRegionWebRTCDevice(e.id,r);this._releaseRegionPhoneLineBarrier();return[2,u&&(this._isWebRTCDevice(i)||!this._isWebRTCDevice(c))?i:c]}}))}))};E911FetchController.prototype._getCurrentRegionWebRTCDevice=function(e,t){var n=t.filter((function(t){return a.te.getPhoneInfoCountryId(t)===e}));return n.length?this._getWebRTCDevice(n)||l().first(n):this._getWebRTCDevice(t)||l().first(t)};E911FetchController.prototype._getWebRTCDevice=function(e){var t=this;return e.find((function(e){return t._isWebRTCDevice(e)}))};E911FetchController.prototype._isWebRTCDevice=function(e){return(e===null||e===void 0?void 0:e.type)===i.DEVICE_TYPE.WEB_RTC};E911FetchController.prototype._setRegionPhoneLineBarrier=function(){return z(this,void 0,void 0,(function(){return X(this,(function(e){switch(e.label){case 0:if(!!this._getRegionPhoneLineBarrier)return[3,1];this._getRegionPhoneLineBarrier=new o.Barrier;return[3,3];case 1:return[4,this._getRegionPhoneLineBarrier.wait()];case 2:e.sent();e.label=3;case 3:return[2]}}))}))};E911FetchController.prototype._releaseRegionPhoneLineBarrier=function(){if(this._getRegionPhoneLineBarrier){this._getRegionPhoneLineBarrier.open();delete this._getRegionPhoneLineBarrier}};E911FetchController.prototype.getE911State=function(){return z(this,void 0,void 0,(function(){var e,t;return X(this,(function(n){switch(n.label){case 0:return[4,this._hasE911Permission()];case 1:t=n.sent();if(!t)return[3,3];return[4,this._requireE911AddressInMode()];case 2:t=n.sent();n.label=3;case 3:e=t;if(!e)return[3,5];return[4,this.isE911DataReady()];case 4:e=n.sent();n.label=5;case 5:if(!e)return[3,7];return[4,this.isInAutoAssignAddressMode()];case 6:return[2,n.sent()?d.ESettingItemState.DISABLE:d.ESettingItemState.ENABLE];case 7:return[2,d.ESettingItemState.INVISIBLE]}}))}))};E911FetchController.prototype._hasE911Permission=function(){return z(this,void 0,void 0,(function(){var e;return X(this,(function(t){switch(t.label){case 0:e=this._isSipReady;if(!e)return[3,2];return[4,this._requireE911Address()];case 1:e=t.sent();t.label=2;case 2:return[2,e]}}))}))};E911FetchController.prototype.isE911DataReady=function(){var e,t;return z(this,void 0,Promise,(function(){return X(this,(function(n){switch(n.label){case 0:if(!this._isSipReady){return[2,false]}if(!((e=this._rcInfoModule)===null||e===void 0?void 0:e.getIsRegionInfoReady())){return[2,false]}return[4,this._getE911Controller()];case 1:return[2,!!((t=n.sent())===null||t===void 0?void 0:t.isDataReady())]}}))}))};E911FetchController.prototype._handleAutoAssignLineIfNeed=function(){return z(this,void 0,void 0,(function(){var e,t,n,r,o;return X(this,(function(i){switch(i.label){case 0:e=this._sipProvisionController.getSipProv();if(!e){return[2]}return[4,this.getCurrentRegionDigitalLine()];case 1:t=i.sent();n=a.te.getPhoneLineId(t);if(!n){return[2]}r=y.Z.getPhoneLine(e);o=!r||r.id!==n;if(!o)return[3,3];$.log("start auto assign line");return[4,this._assignLineWithoutAddress(e.device.id,n)];case 2:i.sent();this._rcInfoModule.setAssignedDigitalLine(r);i.label=3;case 3:return[2]}}))}))};E911FetchController.prototype._assignLineWithoutAddress=function(e,t){return z(this,void 0,void 0,(function(){var n,r;return X(this,(function(o){switch(o.label){case 0:o.trys.push([0,3,,4]);return[4,p.Z.assignLine(e,{phoneLineId:t})];case 1:n=o.sent();$.info("DL in sip is changed, need refresh sip");this._DBConfig.setIsDeclarationRead(false);return[4,this._sipProvisionController.refreshProv()];case 2:o.sent();return[2,n];case 3:r=o.sent();$.warn("failed auto assign line",r);return[3,4];case 4:return[2,undefined]}}))}))};E911FetchController.prototype.requireE911Address=function(){return z(this,void 0,Promise,(function(){var e;return X(this,(function(t){switch(t.label){case 0:return[4,this._requireE911Address()];case 1:e=t.sent();if(!e)return[3,3];return[4,this._requireE911AddressInMode()];case 2:e=t.sent();t.label=3;case 3:return[2,e]}}))}))};E911FetchController.prototype.getSipPhoneLineCountry=function(){return z(this,void 0,Promise,(function(){var e,t,n;return X(this,(function(r){switch(r.label){case 0:return[4,this.getCurrentRegionDigitalLine()];case 1:e=r.sent();t=a.te.getPhoneInfoCountryId(e);n=a.te.getPhoneInfoCountryName(e);return[2,t&&n?{id:t,name:n}:{id:a.Fc.id,name:a.Fc.name}]}}))}))};E911FetchController.prototype.isInAutoAssignAddressMode=function(){var e;return z(this,void 0,Promise,(function(){return X(this,(function(t){switch(t.label){case 0:return[4,this._getE911Controller()];case 1:return[4,(e=t.sent())===null||e===void 0?void 0:e.isInAutoAssignAddressMode()];case 2:return[2,!!t.sent()]}}))}))};E911FetchController.prototype.isAutoAssignAddressFinished=function(){var e;return z(this,void 0,void 0,(function(){return X(this,(function(t){switch(t.label){case 0:return[4,this._getE911Controller()];case 1:return[4,(e=t.sent())===null||e===void 0?void 0:e.isAutoAssignAddressFinished()];case 2:return[2,t.sent()]}}))}))};E911FetchController.prototype.getE911AddressConfig=function(){var e;return z(this,void 0,void 0,(function(){return X(this,(function(t){switch(t.label){case 0:if(!this._isSipReady){return[2]}return[4,this._getE911Controller()];case 1:return[2,(e=t.sent())===null||e===void 0?void 0:e.getAddressConfig()]}}))}))};E911FetchController.prototype.createEmergencyLocation=function(e){return z(this,void 0,Promise,(function(){var t;return X(this,(function(n){switch(n.label){case 0:n.trys.push([0,3,,5]);return[4,this._emergencyResponseLocationsController.createEmergencyLocation(e)];case 1:n.sent();return[4,this._resumeE911Service()];case 2:n.sent();return[3,5];case 3:t=n.sent();return[4,this._handleE911ServiceUnavailable(t.code)];case 4:n.sent();throw t;case 5:return[2]}}))}))};E911FetchController.prototype.updateE911AddressConfig=function(e){var t;return z(this,void 0,void 0,(function(){var n,r,s,a,u;return X(this,(function(c){switch(c.label){case 0:c.trys.push([0,8,,12]);return[4,this._sipProvisionController.refreshProv(true)];case 1:c.sent();return[4,this._handleAutoAssignLineIfNeed()];case 2:c.sent();return[4,this._getE911Controller()];case 3:return[4,(t=c.sent())===null||t===void 0?void 0:t.assignLine(e.currentAddress)];case 4:n=c.sent();$.info("assign line info",n);r=n===null||n===void 0?void 0:n.shouldRefreshSip;if(!r)return[3,6];return[4,this._handleAfterE911Update(n.currentOpt)];case 5:r=c.sent();c.label=6;case 6:r;return[4,this._resumeE911Service()];case 7:c.sent();return[3,12];case 8:s=c.sent();$.warn("Update E911 address failed.",s);a=s.code===i.ERROR_CODES_RC.CMN_102&&s.payload.parameterName===E.rM;u=s.code===i.ERROR_CODES_RC.EME_360;if(!(a||u))return[3,10];$.warn("The ERL address selected by the user has been "+(a?"deleted":"invalid")+", need refresh ERLs");return[4,this._emergencyResponseLocationsController.getRemoteERLsAndSave()];case 9:c.sent();c.label=10;case 10:return[4,this._handleE911ServiceUnavailable(s.code,e.currentAddress)];case 11:c.sent();(0,o.doErrorTracking)(o.EVENT_DATA_FEATURE.COMMON,{key:E.XM.CONFIRM_ADDRESS_FAIL,message:JSON.stringify(s),level:o.LOG_CONTROL_LEVEL.HIGH});throw s;case 12:return[2]}}))}))};E911FetchController.prototype.isNoActualEA=function(){var e,t;return z(this,void 0,Promise,(function(){return X(this,(function(n){switch(n.label){case 0:return[4,this._getE911Controller()];case 1:return[4,(e=n.sent())===null||e===void 0?void 0:e.isNoActualEA()];case 2:return[2,(t=n.sent())!==null&&t!==void 0?t:false]}}))}))};E911FetchController.prototype.EASDisabled=function(){var e=y.Z.getPhoneLine(this._sipProvisionController.getSipProv());if(!e){return undefined}return!e.emergencyAddress.required};E911FetchController.prototype._handleAfterE911Update=function(e){return z(this,void 0,void 0,(function(){var t;return X(this,(function(n){switch(n.label){case 0:return[4,this._sipProvisionController.refreshProv()];case 1:n.sent();if(e===v.l_.NO_DEFINED_LOCATION){_.q1.setEmergencyAddress({})}else{t=y.Z.getEmergencyAddress(this._sipProvisionController.getSipProv());t&&_.q1.setEmergencyAddress(t)}return[2]}}))}))};E911FetchController.prototype._requireE911Address=function(){var e;return z(this,void 0,Promise,(function(){var t,n,o,i,s;return X(this,(function(a){switch(a.label){case 0:return[4,(e=(0,r.getModule)(f.Y0))===null||e===void 0?void 0:e.getAccountInfo()];case 1:t=a.sent();n=E.ey.some((function(e){var n,r;return e===((r=(n=t===null||t===void 0?void 0:t.serviceInfo)===null||n===void 0?void 0:n.contractedCountry)===null||r===void 0?void 0:r.id)}));o=this._sipProvisionController.getSipProv();i=y.Z.requireEA(o);s=y.Z.isExternalNumberProvider(o);return[2,!n&&i&&!s]}}))}))};E911FetchController.prototype._requireE911AddressInMode=function(){var e;return z(this,void 0,Promise,(function(){var t;return X(this,(function(n){switch(n.label){case 0:return[4,this._getE911Controller()];case 1:return[4,(e=n.sent())===null||e===void 0?void 0:e.requireE911Address()];case 2:t=n.sent();return[2,t!==null&&t!==void 0?t:true]}}))}))};E911FetchController.prototype.canSupportOutOfCountry=function(){return y.Z.canSupportOutOfCountry(this._sipProvisionController.getSipProv())};E911FetchController.prototype.needHideEAInNECF=function(){return z(this,void 0,Promise,(function(){var e,t;return X(this,(function(n){switch(n.label){case 0:return[4,this.getE911Mode()];case 1:e=n.sent();t=e===v.ay.NECF;if(!t)return[3,3];return[4,this._requireE911AddressInMode()];case 2:t=!n.sent();n.label=3;case 3:return[2,t]}}))}))};E911FetchController.prototype.isE911ServiceUnavailable=function(){return z(this,void 0,Promise,(function(){var e,t;return X(this,(function(n){switch(n.label){case 0:return[4,this._DBConfig.getE911ServiceUnavailableTime()];case 1:e=n.sent();if(!e){return[2,false]}t=e+E.b7>=(0,o.getCurrentTime)();$.info("E911 service unavailable",t);return[2,t]}}))}))};E911FetchController.prototype.handleLocationAuthStatusChange=function(){var e;return z(this,void 0,void 0,(function(){return X(this,(function(t){switch(t.label){case 0:return[4,this._getE911Controller()];case 1:(e=t.sent())===null||e===void 0?void 0:e.handleLocationAuthStatusChange();return[2]}}))}))};E911FetchController.prototype._handleE911ServiceUnavailable=function(e,t){var n;return z(this,void 0,void 0,(function(){var r,s,a;return X(this,(function(u){switch(u.label){case 0:if(e!==h.sz.HTTP_503){return[2]}return[4,this._DBConfig.getE911ServiceUnavailableTime()];case 1:r=u.sent();if(r){return[2]}return[4,this.getE911Mode()];case 2:s=u.sent();if(!(s===v.ay.NECF))return[3,4];return[4,this._emergencyResponseLocationsController.getAllERLs()];case 3:a=u.sent();if((n=a===null||a===void 0?void 0:a.filter((function(e){return e.addressStatus!==i.ADDRESS_STATUS.INVALID})))===null||n===void 0?void 0:n.length){$.info("Exists valid ERLs, no need to judge whether e911 service (bandwidth service) is unavailable");return[2]}return[3,5];case 4:if(s===v.ay.ERL&&(l().isEmpty(t)||(t===null||t===void 0?void 0:t.emergencyId))){$.info("Not confirm other location, no need to judge whether e911 service (bandwidth service) is unavailable");return[2]}u.label=5;case 5:return[4,this._DBConfig.setE911ServiceUnavailableTime((0,o.getCurrentTime)())];case 6:u.sent();return[4,this._startE911ServiceUnavailableJob()];case 7:u.sent();return[2]}}))}))};E911FetchController.prototype._resumeE911Service=function(){return z(this,void 0,void 0,(function(){return X(this,(function(e){switch(e.label){case 0:return[4,this._DBConfig.getE911ServiceUnavailableTime()];case 1:if(!e.sent()){return[2]}r.jobScheduler.cancelJob(E.wF.E911_SERVICE_UNAVAILABLE,true);return[4,this._DBConfig.removeE911ServiceUnavailableTime()];case 2:e.sent();return[2]}}))}))};E911FetchController.prototype._startE911ServiceUnavailableJob=function(){return z(this,void 0,void 0,(function(){var e=this;return X(this,(function(t){switch(t.label){case 0:return[4,this.isE911ServiceUnavailable()];case 1:if(!t.sent()){return[2]}$.log("start E911 service unavailable job");r.jobScheduler.scheduleJob({key:E.wF.E911_SERVICE_UNAVAILABLE,intervalSeconds:h.YW.THREE_HOURS,periodic:true,needNetwork:false,executeFunc:function(t){return z(e,void 0,void 0,(function(){var e;return X(this,(function(n){switch(n.label){case 0:n.trys.push([0,2,,3]);r.notificationCenter.emit(a.FY.RC_INFO_SERVICE.E911_UPDATED,v.El.E911_SERVICE_UNAVAILABLE);return[4,this.isE911ServiceUnavailable()];case 1:if(!n.sent()){r.jobScheduler.cancelJob(E.wF.E911_SERVICE_UNAVAILABLE,true)}t(true);return[3,3];case 2:e=n.sent();t(false);return[3,3];case 3:return[2]}}))}))}},r.INITIAL_OPTION.BASE_ON_LAST_TIME);return[2]}}))}))};Object.defineProperty(E911FetchController.prototype,"_rcInfoModule",{get:function(){return(0,r.getModule)(a.oF)},enumerable:true,configurable:true});return E911FetchController}(i.BaseNotificationController);var ee=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var te=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var ne=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var re=R.k.tags("[EmergencyResponseLocationController]");var oe=function(e){ee(EmergencyResponseLocationsController,e);function EmergencyResponseLocationsController(t,n){var r=e.call(this,{jobConfig:{jobKey:a.m.FETCH_EMERGENCY_RESPONSE_LOCATIONS},dataKey:E.FY.EMERGENCY_RESPONSE_LOCATIONS,dbConfig:n,dataFetchConfig:i.DATA_FETCH_CONFIG.EXECUTE_FIRST_TIME_NOT_IN_QUEUE|i.DATA_FETCH_CONFIG.FETCH_WHEN_SCHEDULE,entitlementKeys:[[P.H3.RCExtensionFeaturesId.ReadExtensionEmergencyLocations,P.H3.RCExtensionFeaturesId.EmergencyLocations]]})||this;r._sipProvisionController=t;r.requestDataFromServer=function(){return te(r,void 0,void 0,(function(){var e;return ne(this,(function(t){switch(t.label){case 0:if(!this.hasERLsPermission()){return[2,[]]}return[4,new i.RCPaginationController({fetchHandler:p.Z.getAllERLs}).getAllPage({page:i.FIRST_PAGE_INDEX,perPage:i.MAX_PER_PAGE})];case 1:e=t.sent();if(!e||e.length===0){re.info("get Emergency Response Locations error, no remote ERLs")}return[2,e]}}))}))};return r}EmergencyResponseLocationsController.prototype.start=function(){var t=this;(0,s.gT)().onLoginResult((function(n){if(n.success){e.prototype.start.call(t)}}))};EmergencyResponseLocationsController.prototype.hasERLsPermission=function(){var e=r.accountManager.getCurrent().context;return e.entitlement.isAllEnable([P.H3.RCExtensionFeaturesId.ReadExtensionEmergencyLocations,P.H3.RCExtensionFeaturesId.EmergencyLocations])};EmergencyResponseLocationsController.prototype.getAllERLs=function(e){return te(this,void 0,Promise,(function(){var t;return ne(this,(function(n){switch(n.label){case 0:return[4,this.getLocalAndRemoteData()];case 1:t=n.sent();return[2,t===null||t===void 0?void 0:t.filter((function(t){if((e===null||e===void 0?void 0:e.addressStatus)&&t.addressStatus!==e.addressStatus){return false}if(e===null||e===void 0?void 0:e.countryId){return E.ZR.includes(e.countryId)?E.ZR.includes(t.address.countryId):t.address.countryId===e.countryId}return true}))]}}))}))};EmergencyResponseLocationsController.prototype.getRemoteERLsAndSave=function(){return te(this,void 0,void 0,(function(){return ne(this,(function(e){switch(e.label){case 0:return[4,this.syncAndSaveData()];case 1:e.sent();return[4,this.getLocalData()];case 2:return[2,e.sent()||[]]}}))}))};EmergencyResponseLocationsController.prototype.getERLCountLimits=function(){var e,t,n,r;return te(this,void 0,Promise,(function(){var o,s,a,u;return ne(this,(function(c){switch(c.label){case 0:return[4,this._accountInfoModule.getExtensionFeaturesInfo()];case 1:o=(e=c.sent())===null||e===void 0?void 0:e.records;s=(t=o===null||o===void 0?void 0:o.find((function(e){return e.id===P.pl.NewEmergencyCallingFramework})))===null||t===void 0?void 0:t.params;a=l().toNumber((n=s===null||s===void 0?void 0:s.find((function(e){return e.name===i.RCExtensionFeaturesParam.MaxNumberOfCompanyERLs})))===null||n===void 0?void 0:n.value)||v.WO.COMPANY;u=l().toNumber((r=s===null||s===void 0?void 0:s.find((function(e){return e.name===i.RCExtensionFeaturesParam.MaxNumberOfPrivateERLsForSingleUser})))===null||r===void 0?void 0:r.value)||v.WO.PRIVATE_FOR_SINGLE_USER;return[2,{company:a,personal:u}]}}))}))};EmergencyResponseLocationsController.prototype.updateEmergencyLocation=function(e){return te(this,void 0,Promise,(function(){var t,n,r,o,i;return ne(this,(function(s){switch(s.label){case 0:s.trys.push([0,4,,5]);t=y.U.transAddressInfo2ERL(e);return[4,p.Z.updateEmergencyLocation(t)];case 1:n=s.sent();return[4,this.getAllERLs()];case 2:r=s.sent()||[];o=r.findIndex((function(e){return e.id===n.id}));if(o>=0){re.info("Update local emergency location",{locationId:e.id});r.splice(o,1,n)}else{re.info("Update local emergency location but there is no corresponding emergency location, should add a new emergency",{locationId:e.id});r.push(n)}return[4,this.handleRemoteData(r)];case 3:s.sent();return[3,5];case 4:i=s.sent();re.warn("failed to update emergency location",{error:i,locationId:e.id});throw i;case 5:return[2]}}))}))};EmergencyResponseLocationsController.prototype.deleteEmergencyLocation=function(e){return te(this,void 0,Promise,(function(){var t,n,r;return ne(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,,6]);return[4,p.Z.deleteEmergencyLocation(e)];case 1:o.sent();return[4,this.getAllERLs()];case 2:t=o.sent()||[];n=t.findIndex((function(t){return t.id===e}));if(!(n>=0))return[3,4];re.info("Delete local emergency location",{locationId:e});t.splice(n,1);return[4,this.handleRemoteData(t)];case 3:o.sent();o.label=4;case 4:return[3,6];case 5:r=o.sent();re.warn("failed to delete emergency location",{error:r,locationId:e});throw r;case 6:return[2]}}))}))};EmergencyResponseLocationsController.prototype.createEmergencyLocation=function(e){return te(this,void 0,Promise,(function(){var t,n,r,o;return ne(this,(function(i){switch(i.label){case 0:i.trys.push([0,4,,5]);t=y.U.transAddressInfo2ERL(e);return[4,p.Z.createEmergencyLocation(t)];case 1:n=i.sent();return[4,this.getAllERLs()];case 2:r=i.sent()||[];re.info("Create local emergency location",{locationId:e.id});r.push(n);return[4,this.handleRemoteData(r)];case 3:i.sent();return[3,5];case 4:o=i.sent();re.warn("failed to create emergency location",{error:o});throw o;case 5:return[2]}}))}))};EmergencyResponseLocationsController.prototype.handleRemoteData=function(t){return te(this,void 0,Promise,(function(){var n,r,o,i,s;return ne(this,(function(a){switch(a.label){case 0:return[4,e.prototype.handleRemoteData.call(this,t)];case 1:a.sent();n=this._sipProvisionController.getSipProv();r=y.Z.getLocationId(n);if(!r){return[2]}return[4,this.getAllERLs()];case 2:o=a.sent();i=o===null||o===void 0?void 0:o.find((function(e){return e.id===r}));s=y.Z.getEmergencyAddress(n);if(!(!i||i.addressStatus!==y.Z.getAddressStatus(n)||s&&!y.U.isAddressEqual(s,i.address)))return[3,4];re.info("The address in sip has expired, need to refresh sip");return[4,this._sipProvisionController.refreshProv()];case 3:a.sent();a.label=4;case 4:return[2]}}))}))};Object.defineProperty(EmergencyResponseLocationsController.prototype,"_accountInfoModule",{get:function(){return(0,r.getModule)(f.Y0)},enumerable:true,configurable:true});Object.defineProperty(EmergencyResponseLocationsController.prototype,"logger",{get:function(){return re},enumerable:true,configurable:true});return EmergencyResponseLocationsController}(i.AbstractBaseRCInfoFetchController);var ie=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var se=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var ae=R.k.tags("[SipProvisionController]");var ue=function(){function SipProvisionController(e){this._rtcAccount=e;this._requestOnly=false}SipProvisionController.prototype.setOnReceiveSipProv=function(e){this._onReceiveSipProv=e};SipProvisionController.prototype.refreshProv=function(e){if(e===void 0){e=false}this._requestOnly=e;return this._rtcAccount.refreshProv()};SipProvisionController.prototype.getSipProv=function(){return this._rtcAccount.getSipProv()};SipProvisionController.prototype.onReceiveSipProv=function(e,t){return ie(this,void 0,Promise,(function(){var n;return se(this,(function(r){switch(r.label){case 0:if(this._requestOnly){ae.info("Only trigger the sipProv API and do nothing else");this._requestOnly=false;return[2,Promise.resolve()]}ae.info("Trigger the sipProv API and handle it");n=this._onReceiveSipProv;if(!n)return[3,2];return[4,this._onReceiveSipProv(e,t)];case 1:n=r.sent();r.label=2;case 2:n;return[2]}}))}))};return SipProvisionController}();var ce=n(410156);var le=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var de=function(e){le(E911Service,e);function E911Service(){return e.call(this)||this}E911Service.prototype.onStopped=function(){var t,n,r;(t=this._settingManager)===null||t===void 0?void 0:t.unload();(n=this._emergencyResponseLocationsController)===null||n===void 0?void 0:n.stop();(r=this._e911FetchController)===null||r===void 0?void 0:r.onUnLoad();e.prototype.onStopped.call(this)};E911Service.prototype.initial=function(e){this._sipProvisionController=new ue(e);this._emergencyResponseLocationsController=new oe(this._sipProvisionController,this._rcInfoModule.DBConfig);this._emergencyResponseLocationsController.start();this._e911FetchController=new Q(this._sipProvisionController,this._emergencyResponseLocationsController,this.DBConfig);this._sipProvisionController.setOnReceiveSipProv(this._e911FetchController.onReceiveSipProv);this._settingManager=new u.b(this._e911FetchController);this._e911FetchController.onLoad();this._settingManager.load()};Object.defineProperty(E911Service.prototype,"emergencyResponseLocationsController",{get:function(){return this._emergencyResponseLocationsController},enumerable:true,configurable:true});Object.defineProperty(E911Service.prototype,"e911FetchController",{get:function(){return this._e911FetchController},enumerable:true,configurable:true});Object.defineProperty(E911Service.prototype,"sipProvisionController",{get:function(){return this._sipProvisionController},enumerable:true,configurable:true});Object.defineProperty(E911Service.prototype,"_rcInfoModule",{get:function(){return(0,r.getModule)(a.oF)},enumerable:true,configurable:true});Object.defineProperty(E911Service.prototype,"DBConfig",{get:function(){if(!this._DBConfig){this._DBConfig=new ce.a(this._rcInfoModule.getDBConfigService())}return this._DBConfig},enumerable:true,configurable:true});return E911Service}(r.MicroService);var fe=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var he=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,i=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)if(s=e[a])i=(o<3?s(i):o>3?s(t,n,i):s(t,n))||i;return o>3&&i&&Object.defineProperty(t,n,i),i};var pe=undefined&&undefined.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var ve=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var Ee=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var ge=R.k.tags("[E911Module]");var _e=(0,o.createLogDecorator)(ge.tags("[EXECUTE_LOG]"));var ye=function(e){fe(E911Module,e);function E911Module(t){return e.call(this,t)||this}Object.defineProperty(E911Module.prototype,"_service",{get:function(){if(!this._e911Service){this._e911Service=new de}return this._e911Service},enumerable:true,configurable:true});E911Module.prototype.moduleName=function(){return E.l9};E911Module.prototype.onLoad=function(){var e=this;ge.log("load E911Module");this._setupNetworkClient();this.getHealthController().registerItemMap({emergencyAddrConfirmed:function(){return e.isEmergencyAddrConfirmed()},emergencyAddrConfirmedWithValidAddr:function(){return e.isEmergencyAddrConfirmedWithValidAddr()},emergencyAddress:function(){return _.q1.getEmergencyAddress()}});this._service.start()};E911Module.prototype.onUnload=function(){ge.log("unload E911Module");this.getHealthController().dispose();this._service.stop()};E911Module.prototype.initial=function(e){this._service.initial(e)};E911Module.prototype._setupNetworkClient=function(){var e=(0,s.gT)();if(e){p.Z.networkClient=e.buildNetworkClient()}};E911Module.prototype.onReceiveSipProv=function(e,t){var n;return ve(this,void 0,Promise,(function(){return Ee(this,(function(r){switch(r.label){case 0:return[4,(n=this._service.sipProvisionController)===null||n===void 0?void 0:n.onReceiveSipProv(e,t)];case 1:return[2,r.sent()]}}))}))};E911Module.prototype.getSipPhoneLineCountry=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.getSipPhoneLineCountry()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.requireE911Address=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.requireE911Address()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.isInAutoAssignAddressMode=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.isInAutoAssignAddressMode()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.isEmergencyAddrConfirmedWithValidAddr=function(){var e;return(e=this._service.e911FetchController)===null||e===void 0?void 0:e.isEmergencyAddrConfirmedWithValidAddr()};E911Module.prototype.isEmergencyAddrConfirmed=function(){var e;return(e=this._service.e911FetchController)===null||e===void 0?void 0:e.isEmergencyAddrConfirmed()};E911Module.prototype.getE911Mode=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.getE911Mode()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.isE911DataReady=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.isE911DataReady()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.getERLCountLimits=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.emergencyResponseLocationsController)===null||e===void 0?void 0:e.getERLCountLimits()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.getEmergencyLocations=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.emergencyResponseLocationsController)===null||e===void 0?void 0:e.getAllERLs()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.updateEmergencyLocation=function(e){var t;return ve(this,void 0,Promise,(function(){return Ee(this,(function(n){switch(n.label){case 0:return[4,(t=this._service.emergencyResponseLocationsController)===null||t===void 0?void 0:t.updateEmergencyLocation(e)];case 1:return[2,n.sent()]}}))}))};E911Module.prototype.createEmergencyLocation=function(e){var t;return ve(this,void 0,Promise,(function(){return Ee(this,(function(n){switch(n.label){case 0:return[4,(t=this._service.e911FetchController)===null||t===void 0?void 0:t.createEmergencyLocation(e)];case 1:return[2,n.sent()]}}))}))};E911Module.prototype.deleteEmergencyLocation=function(e){var t;return ve(this,void 0,Promise,(function(){return Ee(this,(function(n){switch(n.label){case 0:return[4,(t=this._service.emergencyResponseLocationsController)===null||t===void 0?void 0:t.deleteEmergencyLocation(e)];case 1:return[2,n.sent()]}}))}))};E911Module.prototype.canSupportOutOfCountry=function(){var e;return(e=this._service.e911FetchController)===null||e===void 0?void 0:e.canSupportOutOfCountry()};E911Module.prototype.getAllERLs=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.getAllERLs()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.EASDisabled=function(){var e;return(e=this._service.e911FetchController)===null||e===void 0?void 0:e.EASDisabled()};E911Module.prototype.isNoActualEA=function(){var e,t;return ve(this,void 0,Promise,(function(){return Ee(this,(function(n){switch(n.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.isNoActualEA()];case 1:return[2,(t=n.sent())!==null&&t!==void 0?t:false]}}))}))};E911Module.prototype.needHideEAInNECF=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.needHideEAInNECF()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.syncERLsData=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.emergencyResponseLocationsController)===null||e===void 0?void 0:e.syncAndSaveData()];case 1:return[2,t.sent()]}}))}))};E911Module.prototype.isE911ServiceUnavailable=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,(e=this._service.e911FetchController)===null||e===void 0?void 0:e.isE911ServiceUnavailable()];case 1:return[2,!!t.sent()]}}))}))};E911Module.prototype.getIsDeclarationRead=function(){var e;return ve(this,void 0,Promise,(function(){return Ee(this,(function(t){switch(t.label){case 0:return[4,this._service.DBConfig.getIsDeclarationRead()];case 1:return[2,(e=t.sent())!==null&&e!==void 0?e:false]}}))}))};E911Module.prototype.setIsDeclarationRead=function(e){return this._service.DBConfig.setIsDeclarationRead(e)};E911Module.prototype.handleLocationAuthStatusChange=function(){var e;return(e=this._service.e911FetchController)===null||e===void 0?void 0:e.handleLocationAuthStatusChange()};var t,n,r,o,a,u,c;he([_e({call:true,error:true}),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",typeof(t=typeof Promise!=="undefined"&&Promise)==="function"?t:Object)],E911Module.prototype,"getEmergencyLocations",null);he([_e({call:true,error:true}),pe("design:type",Function),pe("design:paramtypes",[typeof(n=typeof i.EmergencyLocationInfo!=="undefined"&&i.EmergencyLocationInfo)==="function"?n:Object]),pe("design:returntype",typeof(r=typeof Promise!=="undefined"&&Promise)==="function"?r:Object)],E911Module.prototype,"updateEmergencyLocation",null);he([_e({call:true,error:true}),pe("design:type",Function),pe("design:paramtypes",[typeof(o=typeof i.EmergencyLocationInfo!=="undefined"&&i.EmergencyLocationInfo)==="function"?o:Object]),pe("design:returntype",typeof(a=typeof Promise!=="undefined"&&Promise)==="function"?a:Object)],E911Module.prototype,"createEmergencyLocation",null);he([_e({call:true,error:true}),pe("design:type",Function),pe("design:paramtypes",[String]),pe("design:returntype",typeof(u=typeof Promise!=="undefined"&&Promise)==="function"?u:Object)],E911Module.prototype,"deleteEmergencyLocation",null);he([_e({call:true,error:true}),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",typeof(c=typeof Promise!=="undefined"&&Promise)==="function"?c:Object)],E911Module.prototype,"syncERLsData",null);return E911Module}(r.AbstractModule)},598263:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(298784);var o=n(862926);var i=n(827027);var s={EMERGENCY_RESPONSE_LOCATIONS:"/"+i.API_VERSION+"/account/~/extension/~/emergency-locations",WEBAPP_EMERGENCY_ADDRESS:"/"+i.API_VERSION+"/account/~/extension/~/webapp-emergency-address",UPDATE_DEVICE:"/"+i.API_VERSION+"/account/~/device",NOMADIC_MAP_WIRELESS_POINTS:"/"+i.API_VERSION+"/account/~/extension/~/emergency/wireless-points",NOMADIC_MAP_NETWORK:"/"+i.API_VERSION+"/account/~/extension/~/emergency/networks",NOMADIC_MAP_NETWORK_4_UPDATE:"/"+i.API_VERSION+"/account/~/extension/~/emergency/ip-ranges"};var a=["stateIsoCode","countryIsoCode"];var u=function(){function E911Api(){}E911Api.getAllERLs=function(e){return E911Api.networkClient.get({params:e,path:o.RequestPath.buildRequestPath(s.EMERGENCY_RESPONSE_LOCATIONS),via:o.NETWORK_VIA.HTTP,HAPriority:o.HA_PRIORITY.HIGH,retryCount:o.DEFAULT_RETRY_COUNT})};E911Api.updateEmergencyLocation=function(e){e.address=(0,r.omit)(e.address,a);return E911Api.networkClient.put({data:e,path:o.RequestPath.buildRequestPath(s.EMERGENCY_RESPONSE_LOCATIONS+"/"+o.FORMAT_MARK,e.id),via:o.NETWORK_VIA.HTTP})};E911Api.deleteEmergencyLocation=function(e){return E911Api.networkClient.delete({path:o.RequestPath.buildRequestPath(s.EMERGENCY_RESPONSE_LOCATIONS+"/"+o.FORMAT_MARK,e),via:o.NETWORK_VIA.HTTP})};E911Api.createEmergencyLocation=function(e){e.address=(0,r.omit)(e.address,a);return E911Api.networkClient.post({data:e,path:o.RequestPath.buildRequestPath(s.EMERGENCY_RESPONSE_LOCATIONS),via:o.NETWORK_VIA.HTTP})};E911Api.getWebappEmergencyAddress=function(e){return E911Api.networkClient.get({params:e,HAPriority:o.HA_PRIORITY.HIGH,retryCount:o.DEFAULT_RETRY_COUNT,path:o.RequestPath.buildRequestPath(s.WEBAPP_EMERGENCY_ADDRESS)})};E911Api.assignLine=function(e,t){return E911Api.networkClient.post({data:t,path:o.RequestPath.buildRequestPath(s.UPDATE_DEVICE+"/"+o.FORMAT_MARK+"/assign-line",e),via:o.NETWORK_VIA.HTTP})};E911Api.createNomadicMap4WirelessPoint=function(e){return E911Api.networkClient.post({data:e,path:o.RequestPath.buildRequestPath(s.NOMADIC_MAP_WIRELESS_POINTS),via:o.NETWORK_VIA.HTTP})};E911Api.updateNomadicMap4WirelessPoint=function(e,t){return E911Api.networkClient.put({data:t,path:o.RequestPath.buildRequestPath(s.NOMADIC_MAP_WIRELESS_POINTS+"/"+o.FORMAT_MARK,e),via:o.NETWORK_VIA.HTTP})};E911Api.createNomadicMap4Network=function(e){return E911Api.networkClient.post({data:e,path:o.RequestPath.buildRequestPath(s.NOMADIC_MAP_NETWORK),via:o.NETWORK_VIA.HTTP})};E911Api.updateNomadicMap4Network=function(e,t){var n={path:o.RequestPath.buildRequestPath(s.NOMADIC_MAP_NETWORK_4_UPDATE+"/"+o.FORMAT_MARK,e),data:t,method:o.NETWORK_METHOD.PATCH,authFree:false,via:o.NETWORK_VIA.HTTP};return E911Api.networkClient.http(n)};E911Api.getNomadicMapByWirelessPointId=function(e){var t={path:o.RequestPath.buildRequestPath(s.NOMADIC_MAP_WIRELESS_POINTS+"/"+o.FORMAT_MARK,e),via:o.NETWORK_VIA.HTTP};return E911Api.networkClient.get(t)};E911Api.getNomadicMapByNetworkId=function(e){var t={path:o.RequestPath.buildRequestPath(s.NOMADIC_MAP_NETWORK+"/"+o.FORMAT_MARK,e),via:o.NETWORK_VIA.HTTP};return E911Api.networkClient.get(t)};return E911Api}()},410156:(e,t,n)=>{n.d(t,{a:()=>u});var r=n(667489);var o=n.n(r);var i=n(484181);var s=n(919867);var a=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var u=function(e){a(E911UserConfig,e);function E911UserConfig(t){return e.call(this,i.l9,t)||this}E911UserConfig.prototype.getIsDeclarationRead=function(){return this.get(s.iT.IS_DECLARATION_READ)};E911UserConfig.prototype.setIsDeclarationRead=function(e){return this.put(s.iT.IS_DECLARATION_READ,e)};E911UserConfig.prototype.getE911ServiceUnavailableTime=function(){return this.get(s.iT.E911_SERVICE_UNAVAILABLE_TIME)};E911UserConfig.prototype.setE911ServiceUnavailableTime=function(e){return this.put(s.iT.E911_SERVICE_UNAVAILABLE_TIME,e)};E911UserConfig.prototype.removeE911ServiceUnavailableTime=function(){return this.remove(s.iT.E911_SERVICE_UNAVAILABLE_TIME)};return E911UserConfig}(r.DBConfig)},919867:(e,t,n)=>{n.d(t,{rz:()=>r,Li:()=>i,iT:()=>o});var r={EMERGENCY_ADDRESS:"emergency_address"};var o={IS_DECLARATION_READ:"is_declaration_read",E911_SERVICE_UNAVAILABLE_TIME:"e911_service_unavailable_time"};var i="telephony"},271010:(e,t,n)=>{n.d(t,{Li:()=>r.Li,q1:()=>a});var r=n(919867);var o=n(667489);var i=n(587040);var s=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var a=function(e){s(E911GlobalConfig,e);function E911GlobalConfig(){return e!==null&&e.apply(this,arguments)||this}E911GlobalConfig.buildKey=function(e){var t=(0,i.gT)().userConfig.getExtensionId();if(!t){throw new o.JSdkError("","can not set e911 before rc extension id is ready")}return e+"."+t};E911GlobalConfig.setEmergencyAddress=function(e){return this.put(this.buildKey(r.rz.EMERGENCY_ADDRESS),e)};E911GlobalConfig.removeEmergencyAddress=function(){return this.remove(this.buildKey(r.rz.EMERGENCY_ADDRESS))};E911GlobalConfig.getEmergencyAddress=function(){return this.get(this.buildKey(r.rz.EMERGENCY_ADDRESS))};E911GlobalConfig.onEmergencyAddressChange=function(e){this.on(this.buildKey(r.rz.EMERGENCY_ADDRESS),e)};E911GlobalConfig.moduleName=r.Li;return E911GlobalConfig}(o.GlobalConfig);var u=n(410156)},682958:(e,t,n)=>{n.d(t,{k:()=>a});var r=n(862926);var o=n.n(r);var i=n(827027);var s="[E911_MODULE][CORE]";var a=r.ModuleLogger.getLogger(s,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),i.PHONE_EVENT_DATA_FEATURE_KEY)},794104:(e,t,n)=>{n.d(t,{b:()=>a});var r=n(696206);var o=n(957570);var i=n(324865);var s=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var a=function(e){s(E911SettingManager,e);function E911SettingManager(t){var n=e.call(this)||this;n._e911FetchController=t;return n}E911SettingManager.prototype.getProviderMap=function(){var e;return e={},e[i.c$.PHONE_E911]=new o.T(this._e911FetchController),e};return E911SettingManager}(r.AbstractModuleSettingProviderManager)},957570:(e,t,n)=>{n.d(t,{T:()=>_});var r=n(298784);var o=n.n(r);var i=n(667489);var s=n.n(i);var a=n(696206);var u=n(295454);var c=n(38942);var l=n(379269);var d=n(324865);var f=n(484181);var h=n(682958);var p=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var v=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var E=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,s;return s={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function verb(e){return function(t){return step([e,t])}}function step(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=s[0]&2?o["return"]:s[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;if(o=0,i)s=[s[0]&2,i.value];switch(s[0]){case 0:case 1:i=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;o=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!i||s[1]>i[0]&&s[1]<i[3])){n.label=s[1];break}if(s[0]===6&&n.label<i[1]){n.label=i[1];i=s;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(s);break}if(i[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];o=0}finally{r=i=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var g=h.k.tags("[E911SettingItemProvider]");var _=function(e){p(E911SettingItemProvider,e);function E911SettingItemProvider(t){var n=e.call(this,{id:d.c$.PHONE_E911,source:{type:a.Pe.CONSTANT}})||this;n._e911FetchController=t;n._e911UpdateEmitted=false;n._notifyManageE911Debounce=o().debounce((function(e){return v(n,void 0,void 0,(function(){var t,n;return E(this,(function(r){switch(r.label){case 0:this._handleChange();n=!this._e911UpdateEmitted;if(!n)return[3,2];return[4,this._e911FetchController.isE911DataReady()];case 1:n=r.sent();r.label=2;case 2:t=n&&!this._e911FetchController.isEmergencyAddrConfirmed();if(!t)return[3,4];return[4,this._e911FetchController.isAutoAssignAddressFinished()];case 3:t=r.sent();r.label=4;case 4:if(t){this._e911UpdateEmitted=true;i.notificationCenter.emit(l.FY.RC_INFO_SERVICE.E911_UPDATED,e)}return[2]}}))}))}),u.lo.ONE_SECOND);n._handleChange=function(){n.getStateProvider().notifyChange();n.getValueProvider().notifyChange()};g.info("load E911 setting provider");n._notificationKeys=[f.FY.SIP_PROVISION_RECEIVED,f.FY.DEFINE_EMERGENCY_ADDRESS_DONE,l.FY.RC_INFO.DEVICE_INFO,l.FY.RC_INFO_SERVICE.REGION_UPDATED];return n}E911SettingItemProvider.prototype.onLoad=function(){var e=this;this.on(l.FY.RC_INFO_SERVICE.E911_UPDATED,this._handleChange);this._notificationKeys.forEach((function(t){e.on(t,e._notifyManageE911Debounce)}));this.addSubscription((function(){var t=(0,i.getModule)(c.FEATURE_FLAG_MODULE);t.observeFeatureFlag(c.G.D_ALLOW_EDIT_N911_OFF_NET_MAP,e._handleChange);e._rcInfoModule.DBConfig.on(f.FY.EMERGENCY_RESPONSE_LOCATIONS,e._notifyManageE911Debounce);return function(){e._rcInfoModule.DBConfig.off(f.FY.EMERGENCY_RESPONSE_LOCATIONS,e._notifyManageE911Debounce);t.unsubscribe(c.G.D_ALLOW_EDIT_N911_OFF_NET_MAP,e._handleChange)}}))};E911SettingItemProvider.prototype.buildValueProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return v(e,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return[4,this._e911FetchController.getE911AddressConfig()];case 1:return[2,e.sent()]}}))}))},setter:function(t){return v(e,void 0,void 0,(function(){return E(this,(function(e){switch(e.label){case 0:return[4,this._e911FetchController.updateE911AddressConfig(t)];case 1:e.sent();this.getValueProvider().notifyChange();return[2]}}))}))}})};E911SettingItemProvider.prototype.buildStateProvider=function(){var e=this;return this.buildBaseItemValueProvider({getter:function(){return e._e911FetchController.getE911State()}})};Object.defineProperty(E911SettingItemProvider.prototype,"_rcInfoModule",{get:function(){return(0,i.getModule)(l.oF)},enumerable:true,configurable:true});return E911SettingItemProvider}(a.BaseSettingItemProvider)},693914:(e,t,n)=>{n.d(t,{U:()=>u,Z:()=>l});var r=n(298784);var o=n.n(r);var i=n(667489);var s=n(470033);var a=n(484181);var u=function(){function EmergencyAddressUtils(){}EmergencyAddressUtils.checkIsZipValid=function(e,t){var n,r;var o=(r=(n=a.dD.find((function(t){return e===t.countryName})))===null||n===void 0?void 0:n.zipRegex)!==null&&r!==void 0?r:"";return new RegExp(o).test(t)};EmergencyAddressUtils.ignoreEmptyFields=function(e){return o().omitBy(e,(function(e){return o().isString(e)&&e.length<1}))};EmergencyAddressUtils.isAddressEqual=function(e,t){if(o().isEqual(e,t)){return true}if(o().isEqual(e,{})||o().isEqual(t,{})){return false}var n=Object.keys(e);var r=Object.keys(t);return n.every((function(n){if(e[n]===undefined||n===a.Zx||!r.includes(n)||t[n]===undefined){return true}return o().isEqual(e[n],t[n])}))};EmergencyAddressUtils.isNewEmergencyCallFrameworkAvailable=function(){var e=i.accountManager.getCurrent().context;return e.entitlement.get(s.H3.RCExtensionFeaturesId.NewEmergencyCallingFramework)};EmergencyAddressUtils.transAddressInfo2NomadicMapEA=function(e){return{street:e.street,street2:e.street2,city:e.city,state:e.state,stateId:e.stateId,zip:e.zip,country:e.country,countryId:e.countryId,customerName:e.customerName}};EmergencyAddressUtils.transAddressInfo2ERL=function(e){var t=o().clone(e);t.address={street:e.address.street,street2:e.address.street2,city:e.address.city,state:e.address.state,stateId:e.address.stateId,stateName:e.address.stateName,country:e.address.country,countryId:e.address.countryId,countryName:e.address.countryName,zip:e.address.zip,customerName:e.address.customerName,outOfCountry:e.address.outOfCountry,emergencyId:e.address.emergencyId,emergencyName:e.address.emergencyName};return t};return EmergencyAddressUtils}();var c=n(827027);var l=function(){function SipProvUtils(){}SipProvUtils.getDeviceId=function(e){var t;return(t=e===null||e===void 0?void 0:e.device)===null||t===void 0?void 0:t.id};SipProvUtils.getType=function(e){var t;return(t=e===null||e===void 0?void 0:e.device)===null||t===void 0?void 0:t.type};SipProvUtils.getEmergency=function(e){var t;return(t=e===null||e===void 0?void 0:e.device)===null||t===void 0?void 0:t.emergency};SipProvUtils.getInCompanyNet=function(e){var t;return(t=e===null||e===void 0?void 0:e.device)===null||t===void 0?void 0:t.inCompanyNet};SipProvUtils.getEmergencyAddress=function(e){var t;return(t=SipProvUtils.getEmergency(e))===null||t===void 0?void 0:t.address};SipProvUtils.getEmergencyServiceAddress=function(e){var t;return(t=e===null||e===void 0?void 0:e.device)===null||t===void 0?void 0:t.emergencyServiceAddress};SipProvUtils.getAddressEditableStatus=function(e){var t;return(t=SipProvUtils.getEmergency(e))===null||t===void 0?void 0:t.addressEditableStatus};SipProvUtils.getAddressStatus=function(e){var t;return(t=SipProvUtils.getEmergency(e))===null||t===void 0?void 0:t.addressStatus};SipProvUtils.getEmergencyCountryId=function(e){var t,n;return(n=(t=SipProvUtils.getEmergency(e))===null||t===void 0?void 0:t.address)===null||n===void 0?void 0:n.countryId};SipProvUtils.getLocationId=function(e){var t,n;return(n=(t=SipProvUtils.getEmergency(e))===null||t===void 0?void 0:t.location)===null||n===void 0?void 0:n.id};SipProvUtils.getLocationName=function(e){var t,n;return(n=(t=SipProvUtils.getEmergency(e))===null||t===void 0?void 0:t.location)===null||n===void 0?void 0:n.name};SipProvUtils.getPhoneLine=function(e){var t;return o().first((t=e===null||e===void 0?void 0:e.device)===null||t===void 0?void 0:t.phoneLines)};SipProvUtils.getPhoneInfoCountryId=function(e){var t,n,r;return(r=(n=(t=SipProvUtils.getPhoneLine(e))===null||t===void 0?void 0:t.phoneInfo)===null||n===void 0?void 0:n.country)===null||r===void 0?void 0:r.id};SipProvUtils.getPhoneLineId=function(e){var t;return(t=SipProvUtils.getPhoneLine(e))===null||t===void 0?void 0:t.id};SipProvUtils.canSupportOutOfCountry=function(e){var t,n;var r=(n=(t=SipProvUtils.getPhoneLine(e))===null||t===void 0?void 0:t.emergencyAddress)===null||n===void 0?void 0:n.localOnly;return r!==undefined?!r:undefined};SipProvUtils.requireEA=function(e){var t;return!!((t=SipProvUtils.getPhoneLine(e))===null||t===void 0?void 0:t.emergencyAddress.required)};SipProvUtils.isExternalNumberProvider=function(e){var t;return((t=SipProvUtils.getPhoneLine(e))===null||t===void 0?void 0:t.phoneInfo.paymentType)===c.PhoneNumberPaymentType.ExternalNumberProvider};return SipProvUtils}()}}]);