(this["webpackChunkapplication"]=this["webpackChunkapplication"]||[]).push([[8820],{34811:(e,t,n)=>{"use strict";n.d(t,{w:()=>c});var r=n(862926);var o=n(424843);var i=n(827027);var a={MESSAGE_STORE:"/"+i.API_VERSION+"/account/~/extension/~/message-store",MESSAGE_SYNC:"/"+i.API_VERSION+"/account/~/extension/~/message-sync"};var s={VND_MULTIPART_JSON:"application/vnd.ringcentral.multipart+json"};var u=function(){function RCItemCommonApi(e){this._networkClientProvider=e}Object.defineProperty(RCItemCommonApi.prototype,"networkClient",{get:function(){if(!this._networkClient){this._networkClient=this._networkClientProvider()}return this._networkClient},enumerable:true,configurable:true});RCItemCommonApi.prototype.deleteMessage=function(e){var t={path:r.RequestPath.buildRequestPath(a.MESSAGE_STORE+"/"+r.FORMAT_MARK,e.join(",")),method:r.NETWORK_METHOD.DELETE,authFree:false,via:r.NETWORK_VIA.HTTP,HAPriority:r.HA_PRIORITY.BASIC};return this.networkClient.http(t)};RCItemCommonApi.prototype.syncMessage=function(e){var t={params:e,path:r.RequestPath.buildRequestPath(a.MESSAGE_SYNC),authFree:false,via:r.NETWORK_VIA.HTTP,method:r.NETWORK_METHOD.GET,HAPriority:r.HA_PRIORITY.HIGH};return this.networkClient.get(t)};RCItemCommonApi.prototype.deleteAllMessages=function(e){var t={params:e,path:r.RequestPath.buildRequestPath(a.MESSAGE_STORE),method:r.NETWORK_METHOD.DELETE,authFree:false,via:r.NETWORK_VIA.HTTP,HAPriority:r.HA_PRIORITY.BASIC};return this.networkClient.http(t)};RCItemCommonApi.prototype.updateMessageReadStatus=function(e,t){var n;var o={data:{readStatus:t},path:r.RequestPath.buildRequestPath(a.MESSAGE_STORE+"/"+r.FORMAT_MARK,e),method:r.NETWORK_METHOD.PUT,authFree:false,via:r.NETWORK_VIA.HTTP,HAPriority:r.HA_PRIORITY.BASIC,headers:(n={},n[r.REQUEST_HEADER_KEYS.CONTENT_TYPE]=r.CONTENT_TYPES.JSON,n)};return this.networkClient.http(o)};RCItemCommonApi.prototype.batchUpdateMessageReadStatus=function(e,t){var n;var o=e.map((function(){return{body:{readStatus:t}}}));var i={data:o,HAPriority:r.HA_PRIORITY.BASIC,path:r.RequestPath.buildRequestPath(a.MESSAGE_STORE+"/"+r.FORMAT_MARK,e.join(",")),method:r.NETWORK_METHOD.PUT,via:r.NETWORK_VIA.HTTP,headers:(n={},n[r.REQUEST_HEADER_KEYS.CONTENT_TYPE]=s.VND_MULTIPART_JSON,n)};return this.networkClient.http(i)};RCItemCommonApi.prototype.deleteConversations=function(e){var t="conversationId="+e.join("&conversationId=");var n={path:r.RequestPath.buildRequestPath(a.MESSAGE_STORE+"?"+r.FORMAT_MARK,t),method:r.NETWORK_METHOD.DELETE,via:r.NETWORK_VIA.HTTP,HAPriority:r.HA_PRIORITY.BASIC};return this.networkClient.http(n)};RCItemCommonApi.prototype.queryRCMessages=function(e){var t={params:e,path:r.RequestPath.buildRequestPath(a.MESSAGE_STORE),method:r.NETWORK_METHOD.GET,via:r.NETWORK_VIA.HTTP,HAPriority:r.HA_PRIORITY.BASIC,thresholdPriority:o.THRESHOLD_PRIORITY.SPECIAL};return this.networkClient.http(t)};return RCItemCommonApi}();var c=function(){function BaseRCItemApi(){}BaseRCItemApi.setNetworkClientProvider=function(e){this._networkClientProvider=e};Object.defineProperty(BaseRCItemApi,"networkClient",{get:function(){return this.rcItemCommonApi.networkClient},enumerable:true,configurable:true});Object.defineProperty(BaseRCItemApi,"rcItemCommonApi",{get:function(){var e=this;if(!this._rcItemCommonApi){this._rcItemCommonApi=new u((function(){return e._networkClientProvider()}))}return this._rcItemCommonApi},enumerable:true,configurable:true});BaseRCItemApi.deleteMessage=function(e){return this.rcItemCommonApi.deleteMessage(e)};BaseRCItemApi.syncMessage=function(e){return this.rcItemCommonApi.syncMessage(e)};BaseRCItemApi.deleteAllMessages=function(e){return this.rcItemCommonApi.deleteAllMessages(e)};BaseRCItemApi.updateMessageReadStatus=function(e,t){return this.rcItemCommonApi.updateMessageReadStatus(e,t)};BaseRCItemApi.batchUpdateMessageReadStatus=function(e,t){return this.rcItemCommonApi.batchUpdateMessageReadStatus(e,t)};BaseRCItemApi.deleteConversations=function(e){return this.rcItemCommonApi.deleteConversations(e)};BaseRCItemApi.queryRCMessages=function(e){return this.rcItemCommonApi.queryRCMessages(e)};return BaseRCItemApi}()},45697:()=>{},497962:(e,t,n)=>{"use strict";n.d(t,{b:()=>u});var r=n(469882);var o={SYNC_TOKEN:"sync_token",HAS_MORE_IN_REMOTE:"has_more_in_remote"};var i=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var a=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var s=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var u=function(e){i(RCItemUserConfig,e);function RCItemUserConfig(t,n,r){var o=e.call(this,t,n)||this;o._fallbackName=r;return o}RCItemUserConfig.prototype.get=function(t,n){if(n===void 0){n=false}var r;return a(this,void 0,void 0,(function(){var o;return s(this,(function(i){switch(i.label){case 0:if(!this._fallbackName)return[3,5];return[4,this._configService.get(this.moduleName,t,n)];case 1:if(!((r=i.sent())!==null&&r!==void 0))return[3,2];o=r;return[3,4];case 2:return[4,this._configService.get(this._fallbackName,t,n)];case 3:o=i.sent();i.label=4;case 4:return[2,o];case 5:return[2,e.prototype.get.call(this,t,n)]}}))}))};RCItemUserConfig.prototype.remove=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:t=this._fallbackName;if(!t)return[3,2];return[4,this._configService.remove(this._fallbackName,e)];case 1:t=n.sent();n.label=2;case 2:t;return[4,this._configService.remove(this.moduleName,e)];case 3:n.sent();return[2]}}))}))};RCItemUserConfig.prototype.setSyncToken=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.put(o.SYNC_TOKEN,e)];case 1:t.sent();return[2]}}))}))};RCItemUserConfig.prototype.getSyncToken=function(){return a(this,void 0,Promise,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.get(o.SYNC_TOKEN)];case 1:return[2,e.sent()]}}))}))};RCItemUserConfig.prototype.removeSyncToken=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.remove(o.SYNC_TOKEN)];case 1:e.sent();return[2]}}))}))};RCItemUserConfig.prototype.setHasMore=function(e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.put(o.HAS_MORE_IN_REMOTE,e)];case 1:t.sent();return[2]}}))}))};RCItemUserConfig.prototype.getHasMore=function(){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this.get(o.HAS_MORE_IN_REMOTE)];case 1:e=t.sent();return[2,e===undefined?true:e]}}))}))};RCItemUserConfig.prototype.removeHasMore=function(){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.remove(o.HAS_MORE_IN_REMOTE)];case 1:e.sent();return[2]}}))}))};return RCItemUserConfig}(r.DBConfig)},147853:(e,t,n)=>{"use strict";n.d(t,{RCItemUserConfig:()=>r.b,COMMON_RC_ITEMS_PERFORMANCE_KEYS:()=>a.c});var r=n(497962);var o=n(45697);var i=n.n(o);if(n.o(o,"ATTACHMENT_TYPE"))n.d(t,{ATTACHMENT_TYPE:function(){return o.ATTACHMENT_TYPE}});if(n.o(o,"AbstractRCItemService"))n.d(t,{AbstractRCItemService:function(){return o.AbstractRCItemService}});if(n.o(o,"BaseRCItemApi"))n.d(t,{BaseRCItemApi:function(){return o.BaseRCItemApi}});if(n.o(o,"COMMON_RC_ITEMS_PERFORMANCE_KEYS"))n.d(t,{COMMON_RC_ITEMS_PERFORMANCE_KEYS:function(){return o.COMMON_RC_ITEMS_PERFORMANCE_KEYS}});if(n.o(o,"Caller"))n.d(t,{Caller:function(){return o.Caller}});if(n.o(o,"DEFAULT_FETCH_SIZE"))n.d(t,{DEFAULT_FETCH_SIZE:function(){return o.DEFAULT_FETCH_SIZE}});if(n.o(o,"FAX_STATUS_GROUP"))n.d(t,{FAX_STATUS_GROUP:function(){return o.FAX_STATUS_GROUP}});if(n.o(o,"MAX_RECORD_COUNT"))n.d(t,{MAX_RECORD_COUNT:function(){return o.MAX_RECORD_COUNT}});if(n.o(o,"MESSAGE_AVAILABILITY"))n.d(t,{MESSAGE_AVAILABILITY:function(){return o.MESSAGE_AVAILABILITY}});if(n.o(o,"MESSAGE_PRIORITY"))n.d(t,{MESSAGE_PRIORITY:function(){return o.MESSAGE_PRIORITY}});if(n.o(o,"MESSAGE_STATUS"))n.d(t,{MESSAGE_STATUS:function(){return o.MESSAGE_STATUS}});if(n.o(o,"RCItemFetchController"))n.d(t,{RCItemFetchController:function(){return o.RCItemFetchController}});if(n.o(o,"RCItemIdCacheDao"))n.d(t,{RCItemIdCacheDao:function(){return o.RCItemIdCacheDao}});if(n.o(o,"RCItemUtils"))n.d(t,{RCItemUtils:function(){return o.RCItemUtils}});if(n.o(o,"RCMessageFetchController"))n.d(t,{RCMessageFetchController:function(){return o.RCMessageFetchController}});if(n.o(o,"RCMultiPartDataBuilder"))n.d(t,{RCMultiPartDataBuilder:function(){return o.RCMultiPartDataBuilder}});if(n.o(o,"READ_STATUS"))n.d(t,{READ_STATUS:function(){return o.READ_STATUS}});if(n.o(o,"RcMessageActionController"))n.d(t,{RcMessageActionController:function(){return o.RcMessageActionController}});if(n.o(o,"SYNC_DIRECTION"))n.d(t,{SYNC_DIRECTION:function(){return o.SYNC_DIRECTION}});if(n.o(o,"SYNC_TYPE"))n.d(t,{SYNC_TYPE:function(){return o.SYNC_TYPE}});if(n.o(o,"UriModel"))n.d(t,{UriModel:function(){return o.UriModel}});if(n.o(o,"VM_TRANSCRIPTION_STATUS"))n.d(t,{VM_TRANSCRIPTION_STATUS:function(){return o.VM_TRANSCRIPTION_STATUS}});if(n.o(o,"logger"))n.d(t,{logger:function(){return o.logger}});var a=n(267448)},267448:(e,t,n)=>{"use strict";n.d(t,{c:()=>r});var r;(function(e){e["DELETE_RC_MESSAGE_FROM_SERVER"]="delete_rc_message_from_server";e["DELETE_RC_MESSAGE"]="delete_rc_message";e["INIT_RC_MESSAGE_BADGE"]="init_rc_message_badge";e["FETCH_RC_MESSAGE"]="fetch_rc_message";e["FETCH_RC_MESSAGE_FROM_DB"]="fetch_rc_message_from_db";e["CLEAR_ALL_MESSAGE_IN_DB"]="clear_all_message_in_db";e["CLEAR_ALL_MESSAGE_FROM_SERVER"]="clear_all_message_from_server";e["CLEAR_ALL_MESSAGE"]="clear_all_message"})(r||(r={}))},908129:(e,t,n)=>{"use strict";n.d(t,{u:()=>r,I:()=>o});var r=50;var o="failed-rc-message-info"},916236:(e,t,n)=>{"use strict";n.d(t,{ge:()=>h,EB:()=>P,uJ:()=>I});var r=n(596555);var o=n(585648);var i=n(908129);var a=n(95279);var s=n(801688);var u=n(113141);var c=n(667489);var l=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var f=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var d=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var h=function(e){l(RCItemFetchController,e);function RCItemFetchController(t){return e.call(this,t.syncName,t.syncConfig,t.entityKey,t.minInterval,t.dao)||this}RCItemFetchController.prototype.buildFilterFunc=function(e){var t=this;var n=e.filterKey;if(!n){return Promise.resolve((function(){return true}))}return u.O.buildFilterFunc(n,(function(e){return t.getFilterInfo(e)}))};RCItemFetchController.prototype.fetchData=function(e){return f(this,void 0,Promise,(function(){var t,n,r,o,u,l,f,h,_,p;return d(this,(function(d){switch(d.label){case 0:t=e.limit,n=t===void 0?i.u:t,r=e.filterFunc;o=s.k.performance();u=true;this._logger.info("fetchData rc items by option",e);return[4,this.fetchDataFromDB(e)];case 1:l=d.sent();this.onDBFetchFinished(l,o);f=[];if(!(l.length<n&&e.direction!==a.QUERY_DIRECTION.BOTH))return[3,4];if(!r)return[3,2];u=false;return[3,4];case 2:return[4,this.fetchDataFromServer(e,l)];case 3:h=d.sent();u=h.hasMore;f=h.serverEntities;d.label=4;case 4:l=l.concat(f);this._logger.info("fetch rc item success, dataSize:"+l.length+", hasMore:"+u);this.onFetchFinished(f,o);if(!(e.direction===a.QUERY_DIRECTION.BOTH))return[3,7];_=l.map((function(e){return e.id}));u=c.ArrayUtils.getHasMoreForBothDirection(_,e.anchorId,e.limit);if(!(u&&u.older===false))return[3,6];p=u;return[4,this.hasMoreOlderDataInRemote(e)];case 5:p.older=d.sent();d.label=6;case 6:this._logger.info(_,e.anchorId,e.limit,u);d.label=7;case 7:return[2,{hasMore:u,data:l}]}}))}))};RCItemFetchController.prototype.fetchDataFromServer=function(e,t){return f(this,void 0,void 0,(function(){var n,r,i,s;return d(this,(function(u){switch(u.label){case 0:n=e.anchorId,r=e.direction;i=[];return[4,this.syncConfig.getHasMore()];case 1:s=u.sent();this._logger.info("fetch size not enough, need fetch from server: ",{hasMore:s});if(!s)return[3,4];return[4,this.doSync({isSilent:false,direction:r===a.QUERY_DIRECTION.OLDER?o.Su.OLDER:o.Su.NEWER,needNotification:false}).catch((function(e){if(!n&&!t.length){throw e}return[]}))];case 2:i=u.sent();return[4,this.syncConfig.getHasMore()];case 3:s=u.sent();u.label=4;case 4:return[2,{hasMore:s,serverEntities:i}]}}))}))};RCItemFetchController.prototype.fetchDataFromDB=function(e){var t=this;e.getCallerInfoFunc=function(e){return t.getFilterInfo(e)};return this.rcItemDao&&this.rcItemDao.queryItems(e)||[]};RCItemFetchController.prototype.hasMoreOlderDataInRemote=function(e){return Promise.resolve(false)};return RCItemFetchController}(r.io);var _=n(298784);var p=n.n(_);var C=n(267448);var S=n(390582);var m=n(862926);var v=undefined&&undefined.__assign||function(){v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return v.apply(this,arguments)};var y=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var R=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var E=50;var I=function(){function RcMessageActionController(e,t,n,r){this.controllerName=e;this._api=t;this.entitySourceController=n;this.partialModifyController=r}RcMessageActionController.prototype.deleteRcMessages=function(e,t){return y(this,void 0,void 0,(function(){var n,r,i,a,u;var c=this;return R(this,(function(l){switch(l.label){case 0:n=s.k.performance();s.k.tags(this.controllerName).info("deleteRcMessages",e);l.label=1;case 1:l.trys.push([1,6,7,8]);return[4,this.entitySourceController.batchGet(e)];case 2:r=l.sent();r.forEach((function(e){e.availability=t?o.qi.PURGED:o.qi.DELETED}));i=e.filter((function(e){return!c.isPreinsertId(e)}));a=i.length;if(!a)return[3,4];return[4,this._api.deleteMessage(e)];case 3:a=l.sent();l.label=4;case 4:a;n.trace({key:C.c.DELETE_RC_MESSAGE_FROM_SERVER,level:m.LOG_CONTROL_LEVEL.LOW,infos:{ids:i.toString()}});(0,S.h$)(this.entitySourceController,r);return[4,this.entitySourceController.bulkDelete(e)];case 5:l.sent();return[2,r];case 6:u=l.sent();s.k.tags(this.controllerName).warn("failed to delete messages: ",e);throw u;case 7:n.end({key:C.c.DELETE_RC_MESSAGE,level:m.LOG_CONTROL_LEVEL.LOW});return[7];case 8:return[2]}}))}))};RcMessageActionController.prototype.updateReadStatus=function(e,t){return y(this,void 0,void 0,(function(){var n;var r=this;return R(this,(function(o){switch(o.label){case 0:s.k.tags(this.controllerName).info("updateMessageReadStatus",{messageId:e,toStatus:t});n=function(e){return y(r,void 0,void 0,(function(){var t;return R(this,(function(n){switch(n.label){case 0:return[4,this._api.updateMessageReadStatus(e.id,e.readStatus)];case 1:t=n.sent();return[2,t]}}))}))};return[4,this.updateEntityPartially(e,{readStatus:t},n)];case 1:o.sent();return[2]}}))}))};RcMessageActionController.prototype.updateEntityPartially=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o;var i=this;return R(this,(function(a){switch(a.label){case 0:s.k.tags(this.controllerName).info("updateEntityPartially",{messageId:e,updateData:t});r=function(e){return v(v({},e),t)};o=function(e){return y(i,void 0,void 0,(function(){var t;return R(this,(function(r){switch(r.label){case 0:t=n;if(!t)return[3,2];return[4,n(e)];case 1:t=r.sent();r.label=2;case 2:return[2,t||e]}}))}))};return[4,this.partialModifyController.updatePartially({preHandlePartialEntity:r,doUpdateEntity:o,entityId:e,doPartialNotify:function(e,t){(0,S.h$)(i.entitySourceController,t)}})];case 1:a.sent();return[2]}}))}))};RcMessageActionController.prototype.batchRequestUpdateReadStatus=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i,a,u,c,l;return R(this,(function(f){switch(f.label){case 0:n=S.BB.splitArrayToChunks(e,E);r=[];f.label=1;case 1:f.trys.push([1,6,,7]);i=0;f.label=2;case 2:if(!(i<n.length))return[3,5];return[4,this._api.batchUpdateMessageReadStatus(n[i],t)];case 3:a=f.sent();r=r.concat(a.map((function(e){return e.body}))).filter((function(e){return e!==undefined}));f.label=4;case 4:i++;return[3,2];case 5:return[3,7];case 6:u=f.sent();s.k.tags(this.controllerName).log("failed to update read status",u);o=u;return[3,7];case 7:c=r.map((function(e){return e.id}));l=r.length===e.length?[]:p().difference(e,c);s.k.tags(this.controllerName).log("update message read status done",{succeedIds:c,failedIds:l,messageIds:e});return[2,{succeedRes:r,failedIds:l,error:o}]}}))}))};RcMessageActionController.prototype.isPreinsertId=function(e){return e<0};return RcMessageActionController}();var T=n(827027);var A=n(470033);var g=n(295454);var b=n(147853);var N=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var M=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var O=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var P=function(e){N(RCMessageFetchController,e);function RCMessageFetchController(t){var n=e.call(this,{syncConfig:t.userConfig,entityKey:t.entityKey||t.entitySourceController.getEntityNotificationKey(),dao:t.rcItemDao,syncName:t.moduleName})||this;n.syncNewerWithDebounce=p().debounce((function(){return M(n,void 0,void 0,(function(){return O(this,(function(e){switch(e.label){case 0:return[4,this.doSync({isSilent:false,needNotification:true,direction:o.Su.NEWER})];case 1:e.sent();return[2]}}))}))}),g.lo.ONE_SECOND);n.handleRCMessageEvent=function(e){if(n._isMessageChanged(e)){s.k.tags(n._moduleName).log("handleRCMessageEvent",e);n.syncNewerWithDebounce()}};n._api=t.api;n._moduleName=t.moduleName;n._entitySourceController=t.entitySourceController;n._badgeController=t.badgeController;n._messageType=t.messageType;return n}RCMessageFetchController.prototype.buildFilterFunc=function(t){return M(this,void 0,Promise,(function(){var n;return O(this,(function(r){switch(r.label){case 0:return[4,e.prototype.buildFilterFunc.call(this,t)];case 1:n=r.sent();return[2,function(e){return u.O.isMessageAlive(e)&&n(e)}]}}))}))};RCMessageFetchController.prototype.isTokenInvalidError=function(t){s.k.tags(this._moduleName).log("receive sync error",t);return t&&(t.code===T.ERROR_CODES_RC.MSG_333||t.message.includes(T.ERROR_MSG_RC.SYNC_TOKEN_INVALID_ERROR_MSG)||e.prototype.isTokenInvalidError.call(this,t))};RCMessageFetchController.prototype.requestClearAllAndRemoveLocalData=function(){return M(this,void 0,Promise,(function(){var e;return O(this,(function(t){switch(t.label){case 0:e=s.k.performance();s.k.tags(this._moduleName).log("clearMessages");return[4,this._api.deleteAllMessages({type:this._messageType})];case 1:t.sent();e.trace({key:b.COMMON_RC_ITEMS_PERFORMANCE_KEYS.CLEAR_ALL_MESSAGE_FROM_SERVER,level:m.LOG_CONTROL_LEVEL.LOW});return[4,this.removeLocalData()];case 2:t.sent();e.end({key:b.COMMON_RC_ITEMS_PERFORMANCE_KEYS.CLEAR_ALL_MESSAGE,level:m.LOG_CONTROL_LEVEL.HIGH});return[2]}}))}))};RCMessageFetchController.prototype.removeLocalData=function(){return M(this,void 0,Promise,(function(){return O(this,(function(e){switch(e.label){case 0:return[4,this._entitySourceController.clear()];case 1:e.sent();return[2]}}))}))};RCMessageFetchController.prototype.handleDataAndSave=function(e){return M(this,void 0,Promise,(function(){var t,n,r,i;return O(this,(function(a){switch(a.label){case 0:if(!(e&&e.records&&e.records.length))return[3,5];s.k.tags(this._moduleName).log("handleDataAndSave, receive message length is",e.records.length);t=[];n=[];e.records.forEach((function(e){e.__timestamp=Date.parse(e.creationTime);if(e.availability===o.qi.ALIVE){n.push(e)}else{t.push(e.id)}}));r=n.length;if(!r)return[3,2];return[4,this._entitySourceController.bulkPut(n)];case 1:r=a.sent();a.label=2;case 2:r;i=t.length;if(!i)return[3,4];return[4,this._entitySourceController.bulkDelete(t)];case 3:i=a.sent();a.label=4;case 4:i;a.label=5;case 5:return[2,e.records]}}))}))};RCMessageFetchController.prototype.hasPermission=function(){return Promise.resolve(this.hasReadMessagePermission())};RCMessageFetchController.prototype.hasReadMessagePermission=function(){return!!(0,c.getCurrentAccount)().context.entitlement.get(A.H3.RolePermissionId.READ_MESSAGES)};RCMessageFetchController.prototype.sendSyncRequest=function(e,t,n){return this._api.syncMessage({syncType:e,recordCount:n,syncToken:t,messageType:e===r.Jz.FSYNC?this._messageType:undefined})};RCMessageFetchController.prototype.getFilterInfo=function(e){return{callers:e.direction===T.CALL_DIRECTION.INBOUND?e.from&&[e.from]:e.to}};RCMessageFetchController.prototype.onDBFetchFinished=function(e,t){t&&t.trace({key:this.decoratePerformanceKey(b.COMMON_RC_ITEMS_PERFORMANCE_KEYS.FETCH_RC_MESSAGE_FROM_DB),level:m.LOG_CONTROL_LEVEL.LOW,count:e.length})};RCMessageFetchController.prototype.onFetchFinished=function(e,t){this._badgeController.handleBadgeUpdate(e);t&&t.end({key:this.decoratePerformanceKey(b.COMMON_RC_ITEMS_PERFORMANCE_KEYS.FETCH_RC_MESSAGE),level:m.LOG_CONTROL_LEVEL.HIGH,count:e.length})};RCMessageFetchController.prototype.decoratePerformanceKey=function(e){return e+"_"+this._messageType};RCMessageFetchController.prototype.getLastItemCreatTimeFromSource=function(e){var t=e.filter((function(e){return e.availability===o.qi.ALIVE})).sort((function(e,t){return S.jj.sortModelByKey(e,t,[{key:"__timestamp"}],true)}));return t.length&&t[0].__timestamp||undefined};RCMessageFetchController.prototype._isMessageChanged=function(e){var t=this;var n=e.changes;if(!n){return}return n.some((function(e){return e&&e.type===t._messageType}))};return RCMessageFetchController}(h)},703636:()=>{},232766:(e,t,n)=>{"use strict";n.d(t,{_:()=>a});var r=n(95279);var o=n(589283);var i=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var a=function(e){i(RCItemIdCacheDao,e);function RCItemIdCacheDao(t,n,r){return e.call(this,t,n,{transFunc:function(e){return{id:e.id,sortValue:e.__timestamp}},getSections:r},o.O.getSortRCItemByTimeFn(false))||this}return RCItemIdCacheDao}(r.IdCacheDao)},197679:(e,t,n)=>{"use strict";n.d(t,{RCItemIdCacheDao:()=>i._});var r=n(703636);var o=n.n(r);if(n.o(r,"ATTACHMENT_TYPE"))n.d(t,{ATTACHMENT_TYPE:function(){return r.ATTACHMENT_TYPE}});if(n.o(r,"AbstractRCItemService"))n.d(t,{AbstractRCItemService:function(){return r.AbstractRCItemService}});if(n.o(r,"BaseRCItemApi"))n.d(t,{BaseRCItemApi:function(){return r.BaseRCItemApi}});if(n.o(r,"Caller"))n.d(t,{Caller:function(){return r.Caller}});if(n.o(r,"DEFAULT_FETCH_SIZE"))n.d(t,{DEFAULT_FETCH_SIZE:function(){return r.DEFAULT_FETCH_SIZE}});if(n.o(r,"FAX_STATUS_GROUP"))n.d(t,{FAX_STATUS_GROUP:function(){return r.FAX_STATUS_GROUP}});if(n.o(r,"MAX_RECORD_COUNT"))n.d(t,{MAX_RECORD_COUNT:function(){return r.MAX_RECORD_COUNT}});if(n.o(r,"MESSAGE_AVAILABILITY"))n.d(t,{MESSAGE_AVAILABILITY:function(){return r.MESSAGE_AVAILABILITY}});if(n.o(r,"MESSAGE_PRIORITY"))n.d(t,{MESSAGE_PRIORITY:function(){return r.MESSAGE_PRIORITY}});if(n.o(r,"MESSAGE_STATUS"))n.d(t,{MESSAGE_STATUS:function(){return r.MESSAGE_STATUS}});if(n.o(r,"RCItemIdCacheDao"))n.d(t,{RCItemIdCacheDao:function(){return r.RCItemIdCacheDao}});if(n.o(r,"RCItemUtils"))n.d(t,{RCItemUtils:function(){return r.RCItemUtils}});if(n.o(r,"RCMultiPartDataBuilder"))n.d(t,{RCMultiPartDataBuilder:function(){return r.RCMultiPartDataBuilder}});if(n.o(r,"READ_STATUS"))n.d(t,{READ_STATUS:function(){return r.READ_STATUS}});if(n.o(r,"SYNC_DIRECTION"))n.d(t,{SYNC_DIRECTION:function(){return r.SYNC_DIRECTION}});if(n.o(r,"SYNC_TYPE"))n.d(t,{SYNC_TYPE:function(){return r.SYNC_TYPE}});if(n.o(r,"UriModel"))n.d(t,{UriModel:function(){return r.UriModel}});if(n.o(r,"VM_TRANSCRIPTION_STATUS"))n.d(t,{VM_TRANSCRIPTION_STATUS:function(){return r.VM_TRANSCRIPTION_STATUS}});if(n.o(r,"logger"))n.d(t,{logger:function(){return r.logger}});var i=n(232766)},158820:(e,t,n)=>{"use strict";n.d(t,{RCItemUserConfig:()=>r.RCItemUserConfig,RCItemFetchController:()=>o.ge,RCMessageFetchController:()=>o.EB,RcMessageActionController:()=>o.uJ,RCItemIdCacheDao:()=>i.RCItemIdCacheDao,AbstractRCItemService:()=>a.Z,MAX_RECORD_COUNT:()=>s.PB,SYNC_TYPE:()=>s.Jz,RCItemUtils:()=>u.O,RCMultiPartDataBuilder:()=>u.d,DEFAULT_FETCH_SIZE:()=>c.u,logger:()=>l.k,ATTACHMENT_TYPE:()=>f.G0,Caller:()=>f.I,FAX_STATUS_GROUP:()=>f.S,MESSAGE_AVAILABILITY:()=>f.qi,MESSAGE_PRIORITY:()=>f.IJ,MESSAGE_STATUS:()=>f.Gs,READ_STATUS:()=>f.f_,SYNC_DIRECTION:()=>f.Su,UriModel:()=>f.Ti,VM_TRANSCRIPTION_STATUS:()=>f.j6,BaseRCItemApi:()=>d.w});var r=n(147853);if(n.o(r,"ATTACHMENT_TYPE"))n.d(t,{ATTACHMENT_TYPE:function(){return r.ATTACHMENT_TYPE}});if(n.o(r,"AbstractRCItemService"))n.d(t,{AbstractRCItemService:function(){return r.AbstractRCItemService}});if(n.o(r,"BaseRCItemApi"))n.d(t,{BaseRCItemApi:function(){return r.BaseRCItemApi}});if(n.o(r,"Caller"))n.d(t,{Caller:function(){return r.Caller}});if(n.o(r,"DEFAULT_FETCH_SIZE"))n.d(t,{DEFAULT_FETCH_SIZE:function(){return r.DEFAULT_FETCH_SIZE}});if(n.o(r,"FAX_STATUS_GROUP"))n.d(t,{FAX_STATUS_GROUP:function(){return r.FAX_STATUS_GROUP}});if(n.o(r,"MAX_RECORD_COUNT"))n.d(t,{MAX_RECORD_COUNT:function(){return r.MAX_RECORD_COUNT}});if(n.o(r,"MESSAGE_AVAILABILITY"))n.d(t,{MESSAGE_AVAILABILITY:function(){return r.MESSAGE_AVAILABILITY}});if(n.o(r,"MESSAGE_PRIORITY"))n.d(t,{MESSAGE_PRIORITY:function(){return r.MESSAGE_PRIORITY}});if(n.o(r,"MESSAGE_STATUS"))n.d(t,{MESSAGE_STATUS:function(){return r.MESSAGE_STATUS}});if(n.o(r,"RCItemFetchController"))n.d(t,{RCItemFetchController:function(){return r.RCItemFetchController}});if(n.o(r,"RCItemIdCacheDao"))n.d(t,{RCItemIdCacheDao:function(){return r.RCItemIdCacheDao}});if(n.o(r,"RCItemUtils"))n.d(t,{RCItemUtils:function(){return r.RCItemUtils}});if(n.o(r,"RCMessageFetchController"))n.d(t,{RCMessageFetchController:function(){return r.RCMessageFetchController}});if(n.o(r,"RCMultiPartDataBuilder"))n.d(t,{RCMultiPartDataBuilder:function(){return r.RCMultiPartDataBuilder}});if(n.o(r,"READ_STATUS"))n.d(t,{READ_STATUS:function(){return r.READ_STATUS}});if(n.o(r,"RcMessageActionController"))n.d(t,{RcMessageActionController:function(){return r.RcMessageActionController}});if(n.o(r,"SYNC_DIRECTION"))n.d(t,{SYNC_DIRECTION:function(){return r.SYNC_DIRECTION}});if(n.o(r,"SYNC_TYPE"))n.d(t,{SYNC_TYPE:function(){return r.SYNC_TYPE}});if(n.o(r,"UriModel"))n.d(t,{UriModel:function(){return r.UriModel}});if(n.o(r,"VM_TRANSCRIPTION_STATUS"))n.d(t,{VM_TRANSCRIPTION_STATUS:function(){return r.VM_TRANSCRIPTION_STATUS}});if(n.o(r,"logger"))n.d(t,{logger:function(){return r.logger}});var o=n(916236);var i=n(197679);if(n.o(i,"ATTACHMENT_TYPE"))n.d(t,{ATTACHMENT_TYPE:function(){return i.ATTACHMENT_TYPE}});if(n.o(i,"AbstractRCItemService"))n.d(t,{AbstractRCItemService:function(){return i.AbstractRCItemService}});if(n.o(i,"BaseRCItemApi"))n.d(t,{BaseRCItemApi:function(){return i.BaseRCItemApi}});if(n.o(i,"Caller"))n.d(t,{Caller:function(){return i.Caller}});if(n.o(i,"DEFAULT_FETCH_SIZE"))n.d(t,{DEFAULT_FETCH_SIZE:function(){return i.DEFAULT_FETCH_SIZE}});if(n.o(i,"FAX_STATUS_GROUP"))n.d(t,{FAX_STATUS_GROUP:function(){return i.FAX_STATUS_GROUP}});if(n.o(i,"MAX_RECORD_COUNT"))n.d(t,{MAX_RECORD_COUNT:function(){return i.MAX_RECORD_COUNT}});if(n.o(i,"MESSAGE_AVAILABILITY"))n.d(t,{MESSAGE_AVAILABILITY:function(){return i.MESSAGE_AVAILABILITY}});if(n.o(i,"MESSAGE_PRIORITY"))n.d(t,{MESSAGE_PRIORITY:function(){return i.MESSAGE_PRIORITY}});if(n.o(i,"MESSAGE_STATUS"))n.d(t,{MESSAGE_STATUS:function(){return i.MESSAGE_STATUS}});if(n.o(i,"RCItemUtils"))n.d(t,{RCItemUtils:function(){return i.RCItemUtils}});if(n.o(i,"RCMultiPartDataBuilder"))n.d(t,{RCMultiPartDataBuilder:function(){return i.RCMultiPartDataBuilder}});if(n.o(i,"READ_STATUS"))n.d(t,{READ_STATUS:function(){return i.READ_STATUS}});if(n.o(i,"SYNC_DIRECTION"))n.d(t,{SYNC_DIRECTION:function(){return i.SYNC_DIRECTION}});if(n.o(i,"SYNC_TYPE"))n.d(t,{SYNC_TYPE:function(){return i.SYNC_TYPE}});if(n.o(i,"UriModel"))n.d(t,{UriModel:function(){return i.UriModel}});if(n.o(i,"VM_TRANSCRIPTION_STATUS"))n.d(t,{VM_TRANSCRIPTION_STATUS:function(){return i.VM_TRANSCRIPTION_STATUS}});if(n.o(i,"logger"))n.d(t,{logger:function(){return i.logger}});var a=n(991253);var s=n(596555);var u=n(113141);var c=n(908129);var l=n(801688);var f=n(585648);var d=n(34811)},801688:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});var r=n(862926);var o=n.n(r);var i=n(827027);var a="[RC_ITEM][CORE]";var s=r.ModuleLogger.getLogger(a,(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return e}),i.PHONE_EVENT_DATA_FEATURE_KEY)},991253:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(667489);var o=n(228164);var i=n(461197);var a=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var s=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var u=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var c=function(e){a(AbstractRCItemService,e);function AbstractRCItemService(t,n,r){return e.call(this,t,n,r)||this}AbstractRCItemService.prototype.onStarted=function(){e.prototype.onStarted.call(this);this._listenNotificationEvent(true)};AbstractRCItemService.prototype.onStopped=function(){this._listenNotificationEvent(false);e.prototype.onStopped.call(this)};AbstractRCItemService.prototype.startPolling=function(){this.getRCItemFetchController().startPolling()};AbstractRCItemService.prototype.stopPolling=function(){this.getRCItemFetchController().stopPolling()};AbstractRCItemService.prototype.silentSyncNewerData=function(){this.getRCItemFetchController().doSilentSyncLatestData()};AbstractRCItemService.prototype.fetchEntities=function(e){return s(this,void 0,Promise,(function(){return u(this,(function(t){return[2,this.getRCItemFetchController().fetchData(e)]}))}))};AbstractRCItemService.prototype.buildFilterFunc=function(e){return s(this,void 0,Promise,(function(){return u(this,(function(t){return[2,this.getRCItemFetchController().buildFilterFunc(e)]}))}))};AbstractRCItemService.prototype._listenNotificationEvent=function(e){var t=this.getRCItemFetchController().handleRCMessageEvent;if(!t)return;this.subscribeRCMessageEvent(e,o.RCSubscriptionKeys.MessageStore,t)};AbstractRCItemService.prototype.subscribeRCMessageEvent=function(e,t,n){if(e){this._rcNotificationModule.subscribe(t,n)}else{this._rcNotificationModule.unsubscribe(t,n)}};Object.defineProperty(AbstractRCItemService.prototype,"_rcNotificationModule",{get:function(){return(0,i.getModule)(o.MODULE_NAME)},enumerable:true,configurable:true});return AbstractRCItemService}(r.EntityBaseService)},596555:(e,t,n)=>{"use strict";n.d(t,{io:()=>I,PB:()=>i,Jz:()=>r.SYNC_TYPE});var r=n(827027);var o;(function(e){e[e["IN_FSYNC"]=1]="IN_FSYNC";e[e["IN_CLEAR"]=2]="IN_CLEAR"})(o||(o={}));var i=250;var a=50;var s=n(684997);var u=n(886236);var c=n(295454);var l=n(786923);var f=n(302186);var d=n(667489);var h=n(794457);var _=n(801688);var p=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var C=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var S=function(){function SilentSyncProcessor(e,t){this._syncName=e;this._processFunc=t}SilentSyncProcessor.prototype.process=function(){return p(this,void 0,Promise,(function(){return C(this,(function(e){switch(e.label){case 0:_.k.tags(this._syncName).info("silent sync start");return[4,this._processFunc()];case 1:e.sent();_.k.tags(this._syncName).info("silent sync end");return[2,true]}}))}))};SilentSyncProcessor.prototype.name=function(){return""+this._syncName};return SilentSyncProcessor}();var m=n(585648);var v=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var y=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var R=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var E=[h.N.WAKE_UP_FROM_SLEEP,h.N.FOCUS,h.N.ONLINE];var I=function(e){v(AbstractRCItemSyncController,e);function AbstractRCItemSyncController(t,n,r,o,i){if(o===void 0){o=c.lo.TEN_SECONDS}var a=e.call(this,{syncName:t})||this;a.syncName=t;a.syncConfig=n;a._entityKey=r;a._minInterval=o;a.rcItemDao=i;a._syncStatus=0;a._lastSyncNewerTime=0;a._FSyncQueue=[];a._pollingInterval=c.lo.NINETY_SECONDS;a._latestItemTime=0;a.handleEntityNotification=function(e){return y(a,void 0,void 0,(function(){var t;return R(this,(function(n){switch(n.label){case 0:t=e.type;switch(t){case l.E.UPDATE:return[3,1];case l.E.REPLACE:return[3,1];case l.E.RELOAD:return[3,2]}return[3,4];case 1:this._handleDataUpdateReplace(e);return[3,5];case 2:return[4,this._initPollingInfo(true)];case 3:n.sent();return[3,5];case 4:return[3,5];case 5:return[2]}}))}))};return a}AbstractRCItemSyncController.prototype.init=function(){this.initSilentSyncTriggers(E,c.lo.ONE_MINUTES)};AbstractRCItemSyncController.prototype.dispose=function(){e.prototype.dispose.call(this);d.notificationCenter.off(this._entityKey,this.handleEntityNotification)};AbstractRCItemSyncController.prototype.onPollingDone=function(){return y(this,void 0,void 0,(function(){return R(this,(function(e){return[2,this._updateSyncInterVal(this._latestItemTime)]}))}))};AbstractRCItemSyncController.prototype._handleDataUpdateReplace=function(e){var t=e.body.entities;var n=Array.from(t.values());if(n&&n.length){var r=this.getLastItemCreatTimeFromSource(n);this._updateSyncInterVal(r)}};AbstractRCItemSyncController.prototype.canDoSync=function(){return e.prototype.canDoSync.call(this)&&e.prototype.isPolling.call(this)};AbstractRCItemSyncController.prototype.onFirePollingJob=function(){return this._initPollingInfo()};AbstractRCItemSyncController.prototype.getPollingInterval=function(){return this._pollingInterval};AbstractRCItemSyncController.prototype._initPollingInfo=function(e){if(e===void 0){e=false}return y(this,void 0,void 0,(function(){var t;return R(this,(function(n){switch(n.label){case 0:if(!(!this._latestItemTime||e))return[3,2];return[4,this.rcItemDao.queryNewestTimestamp()];case 1:t=n.sent();this._logger.log("_initPollingInterval -> latestTime, pollingInterval",t,this._pollingInterval);this._updateSyncInterVal(t);d.notificationCenter.off(this._entityKey,this.handleEntityNotification);d.notificationCenter.on(this._entityKey,this.handleEntityNotification);n.label=2;case 2:return[2]}}))}))};AbstractRCItemSyncController.prototype._updateSyncInterVal=function(e){var t=e||this._latestItemTime;var n=this._calculatePollingInterval(t);if(n!==this._pollingInterval){this._logger.tags(this.syncName).log("polling interval updated",{exactlyLatestItemTime:t,old:this._pollingInterval,new:n});this._pollingInterval=n;this.onPollingIntervalUpdated()}if(this._latestItemTime===undefined||t>this._latestItemTime){this._latestItemTime=t}this._logger.log("_updateSyncInterVal, result ",{newLatestItemTime:e,exactlyLatestItemTime:t,recordLatestItemTime:this._latestItemTime,newPollingInterval:this._pollingInterval})};AbstractRCItemSyncController.prototype._calculatePollingInterval=function(e){var t=Date.now()-e;if(t<c.lo.TWO_MINUTES){return c.lo.TWENTY_SECONDS}if(t<c.lo.FIVE_MINUTES){return c.lo.THIRTY_SECONDS}return c.lo.NINETY_SECONDS};AbstractRCItemSyncController.prototype.canDoSilentSync=function(){var e=d.accountManager.getCurrent();return!!(f.Pal.instance.networkStatus().getStatus()&&e&&e.isLoggedIn()&&!f.Pal.instance.getPlatformUtils().getIsHidden())};AbstractRCItemSyncController.prototype.doSync=function(e){return y(this,void 0,Promise,(function(){var t,n,o,i,s,u,c,l,f,d,h;var _=this;return R(this,(function(p){switch(p.label){case 0:t=e.isSilent,n=e.direction,o=e.needNotification,i=o===void 0?true:o,s=e.recordCount,u=s===void 0?a:s,c=e.fireImmediately,l=c===void 0?false:c;return[4,this.hasPermission()];case 1:if(!p.sent()||this._isInClear()){this._logger.info("can not do sync now, status: "+this._syncStatus);return[2,[]]}return[4,this.getSyncToken()];case 2:f=p.sent();if(!!f)return[3,4];return[4,this._doFSync(t,u)];case 3:return[2,p.sent()];case 4:if(!t){this._logger.info("start do ISync");if(n===m.Su.NEWER){this._lastSyncNewerTime=Date.now()}return[2,this._startSync({isSilent:t,syncType:r.SYNC_TYPE.ISYNC,direction:n,recordCount:u,needNotification:i}).catch((function(e){_._logger.warn("do ISync failed, direction: "+n+", count: "+u+", error: "+e);return[]}))]}d=(l||Date.now()-this._lastSyncNewerTime>this._minInterval)&&this.canDoSilentSync();if(d){this._logger.info("try to add ISync processor");this._lastSyncNewerTime=Date.now();h=new S(this._getSyncName(),(function(){return y(_,void 0,void 0,(function(){var e=this;return R(this,(function(o){switch(o.label){case 0:return[4,this._startSync({isSilent:t,syncType:r.SYNC_TYPE.ISYNC,direction:m.Su.NEWER,recordCount:u,needNotification:i}).catch((function(t){e._logger.warn("do silent ISync failed, direction: "+n+", count: "+u+", error: "+t)}))];case 1:o.sent();return[2]}}))}))}));this._getSilentSyncProcessorHandler().addProcessor(h)}return[2,[]]}}))}))};AbstractRCItemSyncController.prototype._doFSync=function(e,t){return y(this,void 0,Promise,(function(){var n,i;var a=this;return R(this,(function(s){switch(s.label){case 0:if(this._isInFSync()){this._logger.info("is already in Fsync now, status: "+this._syncStatus);if(e){return[2,[]]}return[2,new Promise((function(e,t){a._FSyncQueue.push({resolve:e,reject:t})}))]}this._syncStatus=this._syncStatus|o.IN_FSYNC;n=[];if(!e)return[3,1];this._logger.info("try to add FSync processor");i=new S(this._getSyncName(),(function(){return y(a,void 0,void 0,(function(){var n;var i=this;return R(this,(function(a){switch(a.label){case 0:return[4,this._startSync({isSilent:e,syncType:r.SYNC_TYPE.FSYNC,recordCount:t}).catch((function(e){i._logger.warn("do silent FSync, count: "+t+", error: "+e);i._rejectResponses(e)})).finally((function(){i._syncStatus=i._syncStatus&~o.IN_FSYNC}))];case 1:n=a.sent();this._resolveResponses(n||[]);return[2]}}))}))}));this._getSilentSyncProcessorHandler().addProcessor(i);return[3,3];case 1:this._logger.info("start do FSync");return[4,this._startSync({isSilent:e,syncType:r.SYNC_TYPE.FSYNC,recordCount:t}).catch((function(e){a._logger.warn("do FSync, count: "+t+", error: "+e);a._rejectResponses(e);throw e})).finally((function(){a._syncStatus=a._syncStatus&~o.IN_FSYNC}))];case 2:n=s.sent();this._resolveResponses(n);s.label=3;case 3:return[2,n]}}))}))};AbstractRCItemSyncController.prototype._startSync=function(e){return y(this,void 0,Promise,(function(){var t,n,o,s,u,c,l;var f=this;return R(this,(function(d){switch(d.label){case 0:t=e.isSilent,n=e.syncType,o=e.direction,s=e.recordCount,u=e.needNotification;if(n===r.SYNC_TYPE.FSYNC){c=i}else if(o===m.Su.OLDER){c=s||a}this._logger.info("start sync, isSilent: "+t+", type:"+n+", direction:"+o+", count:"+c);return[4,this.getSyncToken()];case 1:l=d.sent();if(l&&n===r.SYNC_TYPE.FSYNC){this._logger.error("fsync but has token, should remove token first");return[2,[]]}if(!l&&n===r.SYNC_TYPE.ISYNC){this._logger.error("i-sync but has no token, should have token first");return[2,[]]}return[4,this.sendSyncRequest(n,l,c).then((function(e){return y(f,void 0,void 0,(function(){return R(this,(function(n){switch(n.label){case 0:if(!e||!e.records||!e.syncInfo){throw new r.JRCError(r.ERROR_CODES_RC.UNKNOWN,"incomplete response data")}this._logger.info("sync success, size:"+e.records.length,e.syncInfo);return[4,this.handleSuccessResponse(e,t,c,u)];case 1:return[2,n.sent()]}}))}))})).catch((function(e){return y(f,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return[4,this._handleFailedResponse(e)];case 1:t.sent();return[2,[]]}}))}))}))];case 2:return[2,d.sent()]}}))}))};AbstractRCItemSyncController.prototype.clearAll=function(){return y(this,void 0,Promise,(function(){var e=this;return R(this,(function(t){switch(t.label){case 0:if(this._isInClear()){this._logger.info("is already in clear now, status: "+this._syncStatus)}this._syncStatus=this._syncStatus|o.IN_CLEAR;return[4,this.requestClearAllAndRemoveLocalData().then((function(){return y(e,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,this.reset()];case 1:e.sent();this.notifyReloadData();return[2]}}))}))})).catch((function(e){throw e})).finally((function(){e._syncStatus=e._syncStatus&~o.IN_CLEAR}))];case 1:t.sent();return[2]}}))}))};AbstractRCItemSyncController.prototype.reset=function(){return y(this,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:this._getSilentSyncProcessorHandler().removeProcessorByName(this.syncName);this._syncStatus=0;this._lastSyncNewerTime=0;return[4,this.removeHasMore()];case 1:e.sent();return[4,this.removeSyncToken()];case 2:e.sent();return[2]}}))}))};AbstractRCItemSyncController.prototype.doSilentSyncLatestData=function(){return this.doSync({isSilent:true,direction:m.Su.NEWER})};AbstractRCItemSyncController.prototype.handleSuccessResponse=function(e,t,n,o){return y(this,void 0,Promise,(function(){var i;return R(this,(function(a){switch(a.label){case 0:return[4,this.handleDataAndSave(e)];case 1:i=a.sent();if(!this.canUpdateSyncToken(e.syncInfo))return[3,3];return[4,this.setSyncToken(e.syncInfo.syncToken)];case 2:a.sent();a.label=3;case 3:if(!(n&&e.records.length<n))return[3,5];return[4,this.setHasMore(false)];case 4:a.sent();a.label=5;case 5:if(t&&e.syncInfo.syncType===r.SYNC_TYPE.FSYNC){this.notifyReloadData()}if(o&&i.length){this.notifyEntityUpdate(i)}return[2,i]}}))}))};AbstractRCItemSyncController.prototype.notifyEntityUpdate=function(e){d.notificationCenter.emitEntityUpdate(this._entityKey,e)};AbstractRCItemSyncController.prototype._handleFailedResponse=function(e){return y(this,void 0,Promise,(function(){return R(this,(function(t){switch(t.label){case 0:this._logger.info("sync failed by error",e);if(!this.isTokenInvalidError(e))return[3,3];this._logger.info("sync token invalid, reset local data and do fsync again");return[4,this.removeLocalData()];case 1:t.sent();return[4,this.reset()];case 2:t.sent();this.doSync({isSilent:true,direction:m.Su.NEWER});return[3,4];case 3:throw e;case 4:return[2]}}))}))};AbstractRCItemSyncController.prototype._isInClear=function(){return!!(this._syncStatus&o.IN_CLEAR)};AbstractRCItemSyncController.prototype._isInFSync=function(){return!!(this._syncStatus&o.IN_FSYNC)};AbstractRCItemSyncController.prototype._resolveResponses=function(e){this._FSyncQueue.forEach((function(t){t.resolve(e)}));this._FSyncQueue=[]};AbstractRCItemSyncController.prototype._rejectResponses=function(e){this._FSyncQueue.forEach((function(t){t.reject(e)}));this._FSyncQueue=[]};AbstractRCItemSyncController.prototype.setSyncToken=function(e){return y(this,void 0,Promise,(function(){return R(this,(function(t){switch(t.label){case 0:return[4,this.syncConfig.setSyncToken(e)];case 1:t.sent();return[2]}}))}))};AbstractRCItemSyncController.prototype.getSyncToken=function(){return this.syncConfig.getSyncToken()};AbstractRCItemSyncController.prototype.removeSyncToken=function(){return y(this,void 0,Promise,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,this.syncConfig.removeSyncToken()];case 1:return[2,e.sent()]}}))}))};AbstractRCItemSyncController.prototype.setHasMore=function(e){return y(this,void 0,Promise,(function(){return R(this,(function(t){switch(t.label){case 0:return[4,this.syncConfig.setHasMore(e)];case 1:t.sent();return[2]}}))}))};AbstractRCItemSyncController.prototype.removeHasMore=function(){return y(this,void 0,Promise,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,this.syncConfig.removeHasMore()];case 1:e.sent();return[2]}}))}))};AbstractRCItemSyncController.prototype.getLastSyncTime=function(){return this._lastSyncNewerTime};AbstractRCItemSyncController.prototype.canUpdateSyncToken=function(e){return true};AbstractRCItemSyncController.prototype._getSilentSyncProcessorHandler=function(){if(!this._silentSyncProcessorHandler){this._silentSyncProcessorHandler=u.zv.getSequenceProcessorHandler({name:""+this.syncName,addProcessorStrategy:function(e,t,n){return[t]}})}return this._silentSyncProcessorHandler};AbstractRCItemSyncController.prototype._getSyncName=function(){return this.syncName+"_"+Date.now()};Object.defineProperty(AbstractRCItemSyncController.prototype,"_logger",{get:function(){return _.k.tags(this.syncName)},enumerable:true,configurable:true});AbstractRCItemSyncController.prototype.notifyReloadData=function(){d.notificationCenter.emitEntityReload(this._entityKey,[],true)};AbstractRCItemSyncController.prototype.isTokenInvalidError=function(e){var t,n,o;return((t=e===null||e===void 0?void 0:e[r.ERROR_PARAMETER_RC.message])===null||t===void 0?void 0:t.includes(r.ERROR_PARAMETER_RC.syncToken))&&((o=(n=e===null||e===void 0?void 0:e.payload)===null||n===void 0?void 0:n[r.ERROR_PARAMETER_RC.parameterName])===null||o===void 0?void 0:o.includes(r.ERROR_PARAMETER_RC.syncToken))};return AbstractRCItemSyncController}(s.AbstractPollingController)},585648:(e,t,n)=>{"use strict";n.d(t,{Gs:()=>o,S:()=>i,G0:()=>a,qi:()=>s,IJ:()=>c,f_:()=>l,j6:()=>f,Su:()=>d,Ti:()=>r.UriModel,I:()=>r.Caller});var r=n(386321);var o;(function(e){e["QUEUED"]="Queued";e["SENT"]="Sent";e["DELIVERED"]="Delivered";e["DELIVERY_FAILED"]="DeliveryFailed";e["SENDING_FAILED"]="SendingFailed";e["RECEIVED"]="Received"})(o||(o={}));var i;(function(e){e["ALL"]="ALL";e["SENT"]="Sent";e["RECEIVED"]="Received";e["FAILED"]="Failed"})(i||(i={}));var a;(function(e){e["AUDIO_RECORDING"]="AudioRecording";e["AUDIO_TRANSCRIPTION_"]="AudioTranscription";e["TEXT"]="Text";e["SOURCE_DOCUMENT"]="SourceDocument";e["RENDERED_DOCUMENT"]="RenderedDocument";e["MMS_ATTACHMENT"]="MmsAttachment";e["FAX_ATTACHMENT"]="FaxAttachment"})(a||(a={}));var s;(function(e){e["ALIVE"]="Alive";e["DELETED"]="Deleted";e["PURGED"]="Purged"})(s||(s={}));var u;(function(e){e["HIGH"]="High";e["LOW"]="Low"})(u||(u={}));var c;(function(e){e["NORMAL"]="Normal";e["HIGH"]="High"})(c||(c={}));var l;(function(e){e["READ"]="Read";e["UNREAD"]="Unread"})(l||(l={}));var f;(function(e){e["NOT_AVAILABLE"]="NotAvailable";e["IN_PROGRESS"]="InProgress";e["TIME_OUT"]="TimedOut";e["COMPLETED"]="Completed";e["COMPLETED_PARTIALLY"]="CompletedPartially";e["FAILED"]="Failed"})(f||(f={}));var d;(function(e){e[e["NEWER"]=0]="NEWER";e[e["OLDER"]=1]="OLDER"})(d||(d={}));var h;(function(e){e[e["IDLE"]=0]="IDLE";e[e["INITIALIZING"]=1]="INITIALIZING";e[e["INITIALIZED"]=2]="INITIALIZED"})(h||(h={}))},589283:(e,t,n)=>{"use strict";n.d(t,{O:()=>I});var r=n(298784);var o=n.n(r);var i=n(667489);var a=n(862926);var s=n(831270);var u=n(827027);var c=n(379269);var l=n(642107);var f=n(585648);var d=n(908129);var h=undefined&&undefined.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)}}();var _=function(e){h(FailedRCItemEvent,e);function FailedRCItemEvent(t,n,r){return e.call(this,a.EVENT_DATA_TYPE.Custom,t,n,r)||this}return FailedRCItemEvent}(a.BaseEvent);var p=undefined&&undefined.__assign||function(){p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};return p.apply(this,arguments)};var C=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var S=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var m=undefined&&undefined.__read||function(e,t){var n=typeof Symbol==="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),o,i=[],a;try{while((t===void 0||t-- >0)&&!(o=r.next()).done)i.push(o.value)}catch(e){a={error:e}}finally{try{if(o&&!o.done&&(n=r["return"]))n.call(r)}finally{if(a)throw a.error}}return i};var v=undefined&&undefined.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e};var y="HTTP_429";var R="/";var E={"text/vcard":"vcf/vcard","image/tiff":"tif/tiff","image/jpeg":"jpg/jpeg","x-ms-wmv":"wmv","x-flv":"flv","audio/mpeg":"mp3","video/mpeg":"mpeg","video/mp4":"mp4","text/plain":"txt","text/html":"html","image/svg+xml":"svg","image/png":"png","image/gif":"gif","image/bmp":"bmp","application/gzip":"gz","audio/mp4":"m4a","audio/amr":"amr","application/rtf":"rtf","application/zip":"zip","video/x-msvideo":"avi","video/msvideo":"msvideo","video/x-flv":"flv","video/quicktime":"mov"};var I=function(){function RCItemUtils(){}RCItemUtils.toCallerView=function(e){return e&&p({},o().pick(e,"name","phoneNumber","extensionNumber"))};RCItemUtils.isMessageAlive=function(e){return e.availability===f.qi.ALIVE};RCItemUtils.getNumbersBySide=function(e,t){var n=[];var r=t?u.CALL_DIRECTION.OUTBOUND:u.CALL_DIRECTION.INBOUND;if(e.direction===r){var o=RCItemUtils.getFromNumber(e);o&&n.push(o)}else{var i=RCItemUtils.getToNumbers(e);n=n.concat(i)}return n};RCItemUtils.getCallerBySide=function(e,t){var n=[];var r=t?u.CALL_DIRECTION.OUTBOUND:u.CALL_DIRECTION.INBOUND;if(e.direction===r){var o=e.from;o&&n.push(o)}else{var i=e.to;n=n.concat(i)}return n};RCItemUtils.getNumberFromCaller=function(e){return e.extensionNumber||e.phoneNumber||""};RCItemUtils.getFromNumber=function(e){return e.from?e.from.phoneNumber||e.from.extensionNumber:undefined};RCItemUtils.getToNumbers=function(e){var t=[];e.to&&e.to.forEach((function(e){var n=e.phoneNumber||e.extensionNumber;n&&t.push(n)}));return t};RCItemUtils.sortRCItemsByTimestamp=function(){return function(e,t){return i.SortUtils.sortModelByKey(e,t,[{key:"__timestamp"}],false)}};RCItemUtils.getExtensionNameFromContentType=function(e){var t=E[e]||"";if(t){t=t.split(R)[0]}else{var n=o().lastIndexOf(e,"/");t=n+1!==e.length?e.slice(n+1):""}return t};RCItemUtils.isOverAPILimitError=function(e){return!!(e&&e.code&&e.code.toUpperCase()===y)};RCItemUtils.getRCMIMEByFileExtension=function(e){var t={};Object.keys(E).forEach((function(e){var n=E[e];var r=n.split(R);r.forEach((function(n){return t[n]=e}))}));return t[e.toLowerCase()]||e};RCItemUtils.buildFilterFunc=function(e,t){return C(this,void 0,Promise,(function(){var n,r,o,a,u;return S(this,(function(c){switch(c.label){case 0:n=(0,i.getModule)(s.MODULE_NAME);return[4,n.doFuzzySearchPhoneContacts(e,{filterOnly:true})];case 1:r=c.sent();o=new Set(r.phoneContacts.map((function(e){return e.phoneInfo.phoneNumber})));a=i.SearchUtils.getTermsFromText(e.toLowerCase().trim());u=a.map((function(e){var t=i.SearchUtils.getValidPhoneNumber(e);return{validNumber:t,origin:e}}));return[2,function(e){var n=(t(e)||{}).callers,r=n===void 0?[]:n;return r.some((function(e){var t=e.name,n=e.extensionNumber,r=e.phoneNumber;var i=t&&t.toLowerCase();var a=!!(n&&o.has(n)||r&&o.has(r));return a||u.every((function(e){if(i===null||i===void 0?void 0:i.includes(e.origin)){return true}if(e.validNumber){return(n===null||n===void 0?void 0:n.includes(e.validNumber))||(r===null||r===void 0?void 0:r.includes(e.validNumber))}return false}))}))}]}}))}))};RCItemUtils._divideEntityByPhoneNumber=function(e){var t=new Map;var n=[];e.forEach((function(e,r){e.forEach((function(e){var o;var i=RCItemUtils.getNumberFromCaller(e);if(!t.has(i)){t.set(i,[]);n.push({isShortNumber:!!e.extensionNumber,e164:i,name:e.name})}(o=t.get(i))===null||o===void 0?void 0:o.push(r)}))}));return{phoneNumberToId:t,phoneSearchInfos:n}};RCItemUtils.filterMatchedContactNumbersCallers=function(e,t){var n=RCItemUtils._divideEntityByPhoneNumber(t),r=n.phoneNumberToId,o=n.phoneSearchInfos;var a=i.SearchUtils.genSearchKeyTerms(e,i.SearchUtils.generateFormattedTerms);var u=(0,i.getModule)(s.MODULE_NAME);var c=u.filterPhoneNumberByContactMatch({searchTerms:a,phoneSearchInfos:o},true);var l=[];c.forEach((function(e){var t=r.get(e.e164);t&&l.push.apply(l,v(t))}));var f=new Set(l);var d=a.searchKeyFormattedTerms;t.forEach((function(e,t){if(!f.has(t)){var n=e.some((function(e){var t=e.name,n=e.extensionNumber,r=e.phoneNumber;var o=t&&t.toLowerCase();return d.formattedKeys.every((function(e){if(o===null||o===void 0?void 0:o.includes(e.original)){return true}return e.formatted&&((n===null||n===void 0?void 0:n.includes(e.formatted))||(r===null||r===void 0?void 0:r.includes(e.formatted)))}))}));n&&f.add(t)}}));return Array.from(f.values())};RCItemUtils.getSortRCItemByTimeFn=function(e){return function(t,n){return i.SortUtils.sortModelByKey(t,n,[{key:"__timestamp",desc:e},{key:"id",desc:e}],e)}};RCItemUtils.isValidReceiverNumber=function(e,t){return C(this,void 0,Promise,(function(){var n,r;return S(this,(function(o){switch(o.label){case 0:return[4,(0,i.getModule)(l.PHONE_PARSER_MODULE).getPhoneParser(e)];case 1:n=o.sent();if(!n||!n.isValid()||n.isShortNumber()){return[2,false]}r=(0,i.getModule)(c.oF);return[2,r.isN11AllowedNumber(t,e)]}}))}))};RCItemUtils.collectFailedItemInfos=function(e){var t=e.filter((function(e){return e.messageStatus===f.Gs.DELIVERY_FAILED||e.messageStatus===f.Gs.SENDING_FAILED||e["__error"]}));return t.map((function(e){return{id:e.id,messageStatus:e.messageStatus,to:e.to,from:e.from,lastModifiedTime:e.lastModifiedTime,creationTime:e.creationTime,__error:e["__error"]}}))};RCItemUtils.filterMatchedView=function(e){return C(this,void 0,Promise,(function(){var t,n,r,o,i,a;return S(this,(function(s){t=e.filterKey,n=e.views,r=e.translate2EntityForFilter,o=e.getCallerInfoFunc;i=new Map;n.map((function(e){var t=(o(r(e))||{}).callers,n=t===void 0?[]:t;i.set(e.id,n)}));if(i.size){a=RCItemUtils.filterMatchedContactNumbersCallers(t,i);return[2,n.filter((function(e){return a.includes(e.id)}))]}return[2,n]}))}))};RCItemUtils.getMatchedViews=function(e){return C(this,void 0,Promise,(function(){var t,n,r,o,s,u,c,l,f,d,h,_;return S(this,(function(p){switch(p.label){case 0:t=e.filterKey,n=e.isInValidAnchor,r=e.direction,o=r===void 0?i.QUERY_DIRECTION.OLDER:r,s=e.getEntitiesFunc,u=e.sortFunc,c=e.filterViewsFunc,l=e.translate2EntityForFilter,f=e.getCallerInfoFunc;d=[];if(!n)return[3,1];a.mainLogger.warn("fetchItem return [], invalid undefined anchorId, direction:"+o);return[3,6];case 1:return[4,s()];case 2:h=p.sent();c&&(h=h.filter((function(e){return c(e)})));if(!(h===null||h===void 0?void 0:h.length))return[3,5];_=f&&l;if(!_)return[3,4];return[4,RCItemUtils.filterMatchedView({filterKey:t||"",views:h,translate2EntityForFilter:l,getCallerInfoFunc:f})];case 3:_=h=p.sent();p.label=4;case 4:_;d=h.sort(u);return[3,6];case 5:a.mainLogger.info("can not get any entities");p.label=6;case 6:return[2,d]}}))}))};RCItemUtils.reportFailedRCItem=function(e){var t=new _(d.I,e);a.dataTracerInstance.traceData(t);a.mainLogger.info("report Failed RCItem info to kibana ",t.getEventData)};return RCItemUtils}()},113141:(e,t,n)=>{"use strict";n.d(t,{O:()=>r.O,d:()=>d});var r=n(589283);var o=n(390582);var i=n(827027);var a=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var s=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var u="FAILED_READ_FILE";var c=function(){function Base64MultiPartData(){this._promises=[];this._boundary=this._makeBoundary()}Base64MultiPartData.prototype.getBoundary=function(){return this._boundary};Base64MultiPartData.prototype.append=function(e,t,n,r){var o;if(t instanceof File||t instanceof Blob){o=this._buildFormDataWithBlob(e,t,n,r)}else{o=this._buildFormDataWithJsonData(e,t)}this._promises.push(o)};Base64MultiPartData.prototype.getOutputDeferred=function(){return a(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:e="--"+this._boundary+"\r\n";return[4,Promise.all(this._promises)];case 1:t=r.sent();n=""+t.join(e);return[2,""+e+n+"--"+this._boundary+"--\r\n"]}}))}))};Object.defineProperty(Base64MultiPartData.prototype,"_readFileFailedError",{get:function(){return new i.JRCError(u,u)},enumerable:true,configurable:true});Base64MultiPartData.prototype._readAsBase64=function(e){return a(this,void 0,void 0,(function(){var t,n;var r=this;return s(this,(function(o){switch(o.label){case 0:t=new FileReader;n=new Promise((function(e,n){t.onload=function(t){var n=t.target.result.replace(/^data:.+;base64,/,"");e(n)};t.onabort=function(){n(r._readFileFailedError)};t.onerror=function(){n(r._readFileFailedError)}}));t.readAsDataURL(e);return[4,n];case 1:return[2,o.sent()]}}))}))};Base64MultiPartData.prototype._makeBoundary=function(){return"++Boundary_"+btoa(Math.random().toString()).substr(0,12)};Base64MultiPartData.prototype._buildFormDataWithJsonData=function(e,t,n,r){var o=n||"blob";return Promise.resolve('Content-Disposition: form-data; name="'+e+'"; filename='+o+"\r\n"+("Content-type: "+(r||"application/json")+"\r\n")+("\r\n"+t+"\r\n"))};Base64MultiPartData.prototype._buildFormDataWithBlob=function(e,t,n,r){return a(this,void 0,void 0,(function(){var o,i,a;return s(this,(function(s){switch(s.label){case 0:return[4,this._readAsBase64(t)];case 1:o=s.sent();i=encodeURI(n||"blob");a=r||t.type||"application/octet-stream";return[2,"Content-Disposition: form-data; "+('name="'+e+"\"; filename*=\"UTF-8''"+i+'"; filename="'+i+'"\r\n')+"Content-Transfer-Encoding: base64\r\n"+("Content-Type: "+a+"\r\n\r\n"+o+"\r\n")]}}))}))};return Base64MultiPartData}();var l=undefined&&undefined.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function fulfilled(e){try{step(r.next(e))}catch(e){o(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){o(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};var f=undefined&&undefined.__generator||function(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function verb(e){return function(t){return step([e,t])}}function step(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,o&&(i=a[0]&2?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;if(o=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;o=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){n.label=a[1];break}if(a[0]===6&&n.label<i[1]){n.label=i[1];i=a;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(a);break}if(i[2])n.ops.pop();n.trys.pop();continue}a=t.call(e,n)}catch(e){a=[6,e];o=0}finally{r=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var d=function(){function RCMultiPartDataBuilder(e){this._rawDataArr=e}RCMultiPartDataBuilder.prototype.buildMultiPartData=function(){return l(this,void 0,void 0,(function(){var e,t;return f(this,(function(n){switch(n.label){case 0:e=this._rawDataArr.map((function(e){return e.dataName}));if(!(0,o.F_)(e.join(" ")))return[3,2];return[4,this._buildBase64MultiPartData()];case 1:t=n.sent();return[3,3];case 2:t=this._buildNormalMultiPartData();n.label=3;case 3:return[2,t]}}))}))};RCMultiPartDataBuilder.prototype._buildNormalMultiPartData=function(){var e=new FormData;this._rawDataArr.forEach((function(t){var n=new Blob([t.data],{type:t.dataType});e.append(t.keyName,n,t.dataName)}));return{data:e}};RCMultiPartDataBuilder.prototype._buildBase64MultiPartData=function(){return l(this,void 0,void 0,(function(){var e,t;return f(this,(function(n){switch(n.label){case 0:e=new c;this._rawDataArr.forEach((function(t){e.append(t.keyName,t.data,t.dataName,t.dataType)}));return[4,e.getOutputDeferred()];case 1:t=n.sent();return[2,{data:t,boundary:e.getBoundary()}]}}))}))};return RCMultiPartDataBuilder}()}}]);